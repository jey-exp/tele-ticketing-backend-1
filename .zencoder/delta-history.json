{"snapshots":{"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/Role.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/Role.java","baseContent":"package com.capstone.tele_ticketing_backend_1.entities;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\nimport java.util.Set;\n\n@Entity\n@Table(name = \"roles\")\n@Data\n@NoArgsConstructor\npublic class Role {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Integer id;\n\n    @Column(unique = true, nullable = false, length = 50)\n    private String name;\n\n    // A role can be assigned to many users\n    @OneToMany(mappedBy = \"role\")\n    private Set<User> users;\n}","baseTimestamp":1761547735065,"deltas":[{"timestamp":1761547744125,"changes":[{"type":"DELETE","lineNumber":19,"oldContent":""},{"type":"DELETE","lineNumber":20,"oldContent":"    // A role can be assigned to many users"},{"type":"INSERT","lineNumber":19,"content":"    "}]},{"timestamp":1761547747355,"changes":[{"type":"MODIFY","lineNumber":19,"content":"","oldContent":"    "}]},{"timestamp":1761548631930,"changes":[{"type":"INSERT","lineNumber":20,"content":"    // A role can be assigned to many users"},{"type":"MODIFY","lineNumber":22,"content":"    private Set<AppUser> users;","oldContent":"    private Set<User> users;"}]},{"timestamp":1761595482544,"changes":[{"type":"MODIFY","lineNumber":18,"content":"    private ERole name;","oldContent":"    private String name;"},{"type":"DELETE","lineNumber":22,"oldContent":"    private Set<User> users;"},{"type":"INSERT","lineNumber":23,"content":"}"}]},{"timestamp":1761641027648,"changes":[{"type":"INSERT","lineNumber":5,"content":"import java.util.HashSet;"},{"type":"INSERT","lineNumber":18,"content":"    @Enumerated(EnumType.STRING)"},{"type":"DELETE","lineNumber":20,"oldContent":"    // A role can be assigned to many users"},{"type":"DELETE","lineNumber":21,"oldContent":"    @OneToMany(mappedBy = \"role\")"},{"type":"INSERT","lineNumber":22,"content":"    // ✅ Now it's a many-to-many, mapped by the 'roles' field in AppUser"},{"type":"INSERT","lineNumber":23,"content":"    @ManyToMany(mappedBy = \"roles\")"},{"type":"INSERT","lineNumber":24,"content":"    private Set<AppUser> users = new HashSet<>();"},{"type":"DELETE","lineNumber":23,"oldContent":"    private Set<AppUser> users;"},{"type":"INSERT","lineNumber":26,"content":""}]},{"timestamp":1761641045964,"changes":[{"type":"MODIFY","lineNumber":19,"content":"    @Column(unique = true, nullable = false, length = 50)","oldContent":"    @Column(unique = true, nullable = false, length = 50)"},{"type":"DELETE","lineNumber":22,"oldContent":"    // ✅ Now it's a many-to-many, mapped by the 'roles' field in AppUser"},{"type":"MODIFY","lineNumber":24,"content":"}","oldContent":"}"}]},{"timestamp":1761643289480,"changes":[{"type":"INSERT","lineNumber":18,"content":"    @Enumerated(EnumType.STRING)"},{"type":"DELETE","lineNumber":19,"oldContent":"    @Column(unique = true, nullable = false, length = 50)"},{"type":"DELETE","lineNumber":21,"oldContent":""},{"type":"DELETE","lineNumber":23,"oldContent":"}"},{"type":"DELETE","lineNumber":24,"oldContent":"    private Set<AppUser> users = new HashSet<>();"}]},{"timestamp":1761643298417,"changes":[{"type":"DELETE","lineNumber":13,"oldContent":""},{"type":"MODIFY","lineNumber":18,"content":"    @Column(length = 20)","oldContent":"    @Column(unique = true, nullable = false, length = 50)"}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/User.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/User.java","baseContent":"package com.capstone.tele_ticketing_backend_1.entities;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport lombok.EqualsAndHashCode;\nimport lombok.NoArgsConstructor;\nimport lombok.ToString;\nimport org.hibernate.annotations.CreationTimestamp;\nimport org.hibernate.annotations.UpdateTimestamp;\nimport java.time.LocalDateTime;\nimport java.util.HashSet;\nimport java.util.Set;\n\n@Entity\n@Table(name = \"users\")\n@Data\n@NoArgsConstructor\npublic class User {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @Column(unique = true, nullable = false, length = 100)\n    private String username;\n\n    @Column(nullable = false)\n    private String password;\n\n    @Column(name = \"full_name\", nullable = false)\n    private String fullName;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"role_id\", nullable = false)\n    private Role role;\n\n    // Self-referencing ManyToMany for team structure\n    // 'team_memberships' table links members to their leads\n    @ManyToMany\n    @JoinTable(\n            name = \"team_memberships\",\n            joinColumns = @JoinColumn(name = \"member_id\"),\n            inverseJoinColumns = @JoinColumn(name = \"team_lead_id\")\n    )\n    @ToString.Exclude\n    @EqualsAndHashCode.Exclude\n    private Set<User> teamLeads = new HashSet<>();\n\n    @ManyToMany(mappedBy = \"teamLeads\")\n    @ToString.Exclude\n    @EqualsAndHashCode.Exclude\n    private Set<User> teamMembers = new HashSet<>();\n\n    // A user can be assigned to many tickets as an engineer\n    @ManyToMany(mappedBy = \"assignedEngineers\")\n    @ToString.Exclude\n    @EqualsAndHashCode.Exclude\n    private Set<Ticket> assignedTickets = new HashSet<>();\n\n\n    @CreationTimestamp\n    @Column(name = \"created_at\", updatable = false)\n    private LocalDateTime createdAt;\n\n    @UpdateTimestamp\n    @Column(name = \"updated_at\")\n    private LocalDateTime updatedAt;\n}\n","baseTimestamp":1761547770816},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/Ticket.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/Ticket.java","baseContent":"package com.capstone.tele_ticketing_backend_1.entities;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport lombok.EqualsAndHashCode;\nimport lombok.NoArgsConstructor;\nimport lombok.ToString;\nimport org.hibernate.annotations.CreationTimestamp;\nimport org.hibernate.annotations.UpdateTimestamp;\nimport java.time.LocalDateTime;\nimport java.util.HashSet;\nimport java.util.Set;\n\n@Entity\n@Table(name = \"tickets\")\n@Data\n@NoArgsConstructor\npublic class Ticket {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @Column(name = \"ticket_uid\", unique = true, nullable = false, length = 50)\n    private String ticketUid;\n\n    @Column(nullable = false)\n    private String title;\n\n    @Lob // For longer text\n    private String description;\n\n    @Column(nullable = false, length = 50)\n    private String status;\n\n    @Column(nullable = false, length = 50)\n    private String priority;\n\n    @Column(nullable = false, length = 50)\n    private String severity;\n\n    private String category;\n\n    @Column(name = \"sub_category\")\n    private String subCategory;\n\n    @Column(name = \"sla_duration_hours\")\n    private Integer slaDurationHours;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"customer_id\", nullable = false)\n    private User customer;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"created_by_user_id\", nullable = false)\n    private User createdBy;\n\n    // Many engineers can be assigned to one ticket\n    @ManyToMany\n    @JoinTable(\n            name = \"ticket_assignments\",\n            joinColumns = @JoinColumn(name = \"ticket_id\"),\n            inverseJoinColumns = @JoinColumn(name = \"engineer_id\")\n    )\n    @ToString.Exclude\n    @EqualsAndHashCode.Exclude\n    private Set<User> assignedEngineers = new HashSet<>();\n\n    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true)\n    private Set<TicketActivity> activities = new HashSet<>();\n\n    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true)\n    private Set<Attachment> attachments = new HashSet<>();\n\n    @OneToOne(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true)\n    private Feedback feedback;\n\n    @Column(name = \"issue_date\")\n    private LocalDateTime issueDate;\n\n    @CreationTimestamp\n    @Column(name = \"created_at\", updatable = false)\n    private LocalDateTime createdAt;\n\n    @UpdateTimestamp\n    @Column(name = \"updated_at\")\n    private LocalDateTime updatedAt;\n\n    @Column(name = \"resolved_at\")\n    private LocalDateTime resolvedAt;\n}","baseTimestamp":1761547833358,"deltas":[{"timestamp":1761551228413,"changes":[{"type":"INSERT","lineNumber":1,"content":"package com.yourcompany.ticketing.entity;"},{"type":"INSERT","lineNumber":10,"content":""},{"type":"DELETE","lineNumber":29,"oldContent":"    @Lob // For longer text"},{"type":"INSERT","lineNumber":31,"content":"    @Lob // Specifies that this should be mapped to a large object type in the DB"},{"type":"DELETE","lineNumber":51,"oldContent":"    private User customer;"},{"type":"INSERT","lineNumber":53,"content":"    private AppUser customer;"},{"type":"DELETE","lineNumber":55,"oldContent":"    private User createdBy;"},{"type":"INSERT","lineNumber":57,"content":"    private AppUser createdBy;"},{"type":"DELETE","lineNumber":57,"oldContent":"    // Many engineers can be assigned to one ticket"},{"type":"INSERT","lineNumber":59,"content":"    // Relationship to assigned engineers (many-to-many)"},{"type":"DELETE","lineNumber":66,"oldContent":"    private Set<User> assignedEngineers = new HashSet<>();"},{"type":"INSERT","lineNumber":68,"content":"    private Set<AppUser> assignedEngineers = new HashSet<>();"},{"type":"DELETE","lineNumber":68,"oldContent":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true)"},{"type":"INSERT","lineNumber":70,"content":"    // Relationship to activities (one-to-many)"},{"type":"INSERT","lineNumber":71,"content":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":72,"content":"    @ToString.Exclude"},{"type":"INSERT","lineNumber":73,"content":"    @EqualsAndHashCode.Exclude"},{"type":"DELETE","lineNumber":71,"oldContent":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true)"},{"type":"INSERT","lineNumber":76,"content":"    // Relationship to attachments (one-to-many)"},{"type":"INSERT","lineNumber":77,"content":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":78,"content":"    @ToString.Exclude"},{"type":"INSERT","lineNumber":79,"content":"    @EqualsAndHashCode.Exclude"},{"type":"DELETE","lineNumber":74,"oldContent":"    @OneToOne(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true)"},{"type":"INSERT","lineNumber":82,"content":"    // Relationship to feedback (one-to-one)"},{"type":"INSERT","lineNumber":83,"content":"    @OneToOne(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":84,"content":"    @ToString.Exclude"},{"type":"INSERT","lineNumber":85,"content":"    @EqualsAndHashCode.Exclude"},{"type":"DELETE","lineNumber":90,"oldContent":"}"},{"type":"INSERT","lineNumber":101,"content":"}}"}]},{"timestamp":1761551233283,"changes":[{"type":"MODIFY","lineNumber":11,"content":"import java.time.LocalDateTime;","oldContent":"import java.time.LocalDateTime;"},{"type":"MODIFY","lineNumber":32,"content":"    private String description;","oldContent":"    private String description;"},{"type":"MODIFY","lineNumber":54,"content":"","oldContent":""},{"type":"DELETE","lineNumber":57,"oldContent":""},{"type":"DELETE","lineNumber":59,"oldContent":"    @ManyToMany"},{"type":"INSERT","lineNumber":58,"content":""},{"type":"INSERT","lineNumber":60,"content":"    @ManyToMany"},{"type":"DELETE","lineNumber":68,"oldContent":""},{"type":"DELETE","lineNumber":70,"oldContent":"    private Set<TicketActivity> activities = new HashSet<>();"},{"type":"INSERT","lineNumber":69,"content":""},{"type":"INSERT","lineNumber":71,"content":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":72,"content":"    @ToString.Exclude"},{"type":"INSERT","lineNumber":73,"content":"    @EqualsAndHashCode.Exclude"},{"type":"INSERT","lineNumber":74,"content":"    private Set<TicketActivity> activities = new HashSet<>();"},{"type":"INSERT","lineNumber":76,"content":"    // Relationship to attachments (one-to-many)"},{"type":"DELETE","lineNumber":75,"oldContent":"    private Set<Attachment> attachments = new HashSet<>();"},{"type":"INSERT","lineNumber":80,"content":"    private Set<Attachment> attachments = new HashSet<>();"},{"type":"INSERT","lineNumber":82,"content":"    // Relationship to feedback (one-to-one)"},{"type":"INSERT","lineNumber":83,"content":"    @OneToOne(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":84,"content":"    @ToString.Exclude"},{"type":"INSERT","lineNumber":85,"content":"    @EqualsAndHashCode.Exclude"},{"type":"DELETE","lineNumber":79,"oldContent":"    // Relationship to attachments (one-to-many)"},{"type":"DELETE","lineNumber":81,"oldContent":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"DELETE","lineNumber":83,"oldContent":"    @ToString.Exclude"},{"type":"DELETE","lineNumber":85,"oldContent":"    @EqualsAndHashCode.Exclude"},{"type":"DELETE","lineNumber":89,"oldContent":"    // Relationship to feedback (one-to-one)"},{"type":"DELETE","lineNumber":91,"oldContent":"    @OneToOne(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"DELETE","lineNumber":93,"oldContent":"    @ToString.Exclude"},{"type":"DELETE","lineNumber":95,"oldContent":"    @EqualsAndHashCode.Exclude"},{"type":"MODIFY","lineNumber":101,"content":"}","oldContent":"}}"}]},{"timestamp":1761551240351,"changes":[{"type":"DELETE","lineNumber":1,"oldContent":"package com.yourcompany.ticketing.entity;"},{"type":"INSERT","lineNumber":9,"content":""},{"type":"DELETE","lineNumber":11,"oldContent":"import java.time.LocalDateTime;"},{"type":"INSERT","lineNumber":30,"content":"    @Lob // Specifies that this should be mapped to a large object type in the DB"},{"type":"DELETE","lineNumber":32,"oldContent":"    private String description;"},{"type":"INSERT","lineNumber":52,"content":"    private AppUser customer;"},{"type":"DELETE","lineNumber":54,"oldContent":""},{"type":"DELETE","lineNumber":57,"oldContent":""},{"type":"DELETE","lineNumber":59,"oldContent":"    @ManyToMany"},{"type":"INSERT","lineNumber":57,"content":""},{"type":"INSERT","lineNumber":59,"content":"    @ManyToMany"},{"type":"DELETE","lineNumber":68,"oldContent":""},{"type":"DELETE","lineNumber":70,"oldContent":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":68,"content":""},{"type":"INSERT","lineNumber":70,"content":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"DELETE","lineNumber":73,"oldContent":""},{"type":"DELETE","lineNumber":75,"oldContent":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"DELETE","lineNumber":77,"oldContent":"    @ToString.Exclude"},{"type":"INSERT","lineNumber":74,"content":""},{"type":"INSERT","lineNumber":76,"content":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":77,"content":"    @ToString.Exclude"},{"type":"DELETE","lineNumber":80,"oldContent":""},{"type":"DELETE","lineNumber":81,"oldContent":"    private Feedback feedback;"},{"type":"DELETE","lineNumber":85,"oldContent":"    @Column(name = \"issue_date\")"},{"type":"DELETE","lineNumber":88,"oldContent":"    private LocalDateTime issueDate;"},{"type":"INSERT","lineNumber":85,"content":"    private Feedback feedback;"},{"type":"INSERT","lineNumber":87,"content":"    @Column(name = \"issue_date\")"},{"type":"INSERT","lineNumber":88,"content":"    private LocalDateTime issueDate;"},{"type":"INSERT","lineNumber":89,"content":""}]},{"timestamp":1761647535003,"changes":[{"type":"MODIFY","lineNumber":9,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":25,"content":"    private String ticketUid;;lpol;p;'.?'","oldContent":"    private String ticketUid;"},{"type":"MODIFY","lineNumber":30,"content":"    @Lob // Specifies that this should be mapped to a large object type in the DB","oldContent":"    @Lob // Specifies that this should be mapped to a large object type in the DB"},{"type":"MODIFY","lineNumber":52,"content":"    private AppUser customer;","oldContent":"    private AppUser customer;"},{"type":"DELETE","lineNumber":56,"oldContent":""},{"type":"DELETE","lineNumber":58,"oldContent":"    @ManyToMany"},{"type":"INSERT","lineNumber":57,"content":""},{"type":"INSERT","lineNumber":59,"content":"    @ManyToMany"},{"type":"DELETE","lineNumber":67,"oldContent":""},{"type":"DELETE","lineNumber":69,"oldContent":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":68,"content":""},{"type":"INSERT","lineNumber":70,"content":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"DELETE","lineNumber":72,"oldContent":""},{"type":"DELETE","lineNumber":74,"oldContent":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"DELETE","lineNumber":76,"oldContent":"    @ToString.Exclude"},{"type":"INSERT","lineNumber":74,"content":""},{"type":"INSERT","lineNumber":76,"content":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":77,"content":"    @ToString.Exclude"},{"type":"DELETE","lineNumber":82,"oldContent":"    private Feedback feedback;"},{"type":"DELETE","lineNumber":84,"oldContent":"    @Column(name = \"issue_date\")"},{"type":"DELETE","lineNumber":86,"oldContent":"    private LocalDateTime issueDate;"},{"type":"DELETE","lineNumber":87,"oldContent":""},{"type":"INSERT","lineNumber":85,"content":"    private Feedback feedback;"},{"type":"INSERT","lineNumber":87,"content":"    @Column(name = \"issue_date\")"},{"type":"INSERT","lineNumber":88,"content":"    private LocalDateTime issueDate;"},{"type":"INSERT","lineNumber":89,"content":""}]},{"timestamp":1761647618676,"changes":[{"type":"INSERT","lineNumber":8,"content":"import org.hibernate.annotations.UpdateTimestamp;"},{"type":"DELETE","lineNumber":9,"oldContent":""},{"type":"MODIFY","lineNumber":25,"content":"    private String ticketUid;","oldContent":"    private String ticketUid;;lpol;p;'.?'"},{"type":"INSERT","lineNumber":29,"content":""},{"type":"DELETE","lineNumber":30,"oldContent":"    @Lob // Specifies that this should be mapped to a large object type in the DB"},{"type":"INSERT","lineNumber":51,"content":"    @JoinColumn(name = \"customer_id\", nullable = false)"},{"type":"DELETE","lineNumber":52,"oldContent":"    private AppUser customer;"},{"type":"DELETE","lineNumber":56,"oldContent":""},{"type":"DELETE","lineNumber":58,"oldContent":"    @ManyToMany"},{"type":"INSERT","lineNumber":57,"content":""},{"type":"INSERT","lineNumber":59,"content":"    @ManyToMany"},{"type":"DELETE","lineNumber":67,"oldContent":""},{"type":"DELETE","lineNumber":69,"oldContent":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":68,"content":""},{"type":"INSERT","lineNumber":70,"content":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"MODIFY","lineNumber":74,"content":"","oldContent":""},{"type":"INSERT","lineNumber":75,"content":"    // Relationship to attachments (one-to-many)"},{"type":"DELETE","lineNumber":77,"oldContent":"    // Relationship to attachments (one-to-many)"},{"type":"DELETE","lineNumber":83,"oldContent":"    private Feedback feedback;"},{"type":"INSERT","lineNumber":84,"content":"    @EqualsAndHashCode.Exclude"},{"type":"INSERT","lineNumber":85,"content":"    private Feedback feedback;"},{"type":"INSERT","lineNumber":86,"content":""},{"type":"DELETE","lineNumber":87,"oldContent":"    @EqualsAndHashCode.Exclude"},{"type":"DELETE","lineNumber":89,"oldContent":""}]},{"timestamp":1761648427792,"changes":[{"type":"DELETE","lineNumber":56,"oldContent":""},{"type":"DELETE","lineNumber":58,"oldContent":"    @ManyToMany"},{"type":"INSERT","lineNumber":57,"content":""},{"type":"INSERT","lineNumber":59,"content":"    @ManyToMany"},{"type":"DELETE","lineNumber":67,"oldContent":""},{"type":"DELETE","lineNumber":69,"oldContent":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":68,"content":""},{"type":"INSERT","lineNumber":70,"content":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":73,"content":"    private Set<TicketActivity> activities = new HashSet<>();"},{"type":"DELETE","lineNumber":74,"oldContent":""},{"type":"MODIFY","lineNumber":84,"content":"    @EqualsAndHashCode.Exclude","oldContent":"    @EqualsAndHashCode.Exclude"},{"type":"MODIFY","lineNumber":87,"content":"    @Column(name = \"issue_date\")","oldContent":"    @Column(name = \"issue_date\")"},{"type":"INSERT","lineNumber":100,"content":""},{"type":"INSERT","lineNumber":101,"content":"    @PostPersist"},{"type":"INSERT","lineNumber":102,"content":"    private void onPostPersist() {"},{"type":"INSERT","lineNumber":103,"content":"        if (this.ticketUid == null) {"},{"type":"INSERT","lineNumber":104,"content":"            this.ticketUid = \"TK\" + (this.id + 1000);"},{"type":"INSERT","lineNumber":105,"content":"        }"},{"type":"INSERT","lineNumber":106,"content":"    }"}]},{"timestamp":1761648436813,"changes":[{"type":"MODIFY","lineNumber":24,"content":"    @Column(name = \"ticket_uid\", unique = true, length = 50)","oldContent":"    @Column(name = \"ticket_uid\", unique = true, nullable = false, length = 50)"},{"type":"DELETE","lineNumber":56,"oldContent":""},{"type":"DELETE","lineNumber":58,"oldContent":"    @ManyToMany"},{"type":"INSERT","lineNumber":57,"content":""},{"type":"INSERT","lineNumber":59,"content":"    @ManyToMany"},{"type":"DELETE","lineNumber":67,"oldContent":""},{"type":"DELETE","lineNumber":69,"oldContent":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":68,"content":""},{"type":"INSERT","lineNumber":70,"content":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":83,"content":"    @ToString.Exclude"},{"type":"DELETE","lineNumber":84,"oldContent":"    @EqualsAndHashCode.Exclude"},{"type":"INSERT","lineNumber":86,"content":""},{"type":"DELETE","lineNumber":87,"oldContent":"    @Column(name = \"issue_date\")"},{"type":"DELETE","lineNumber":101,"oldContent":"}"},{"type":"DELETE","lineNumber":103,"oldContent":"    }"},{"type":"MODIFY","lineNumber":105,"content":"        }","oldContent":"        }"},{"type":"INSERT","lineNumber":106,"content":"    }"},{"type":"INSERT","lineNumber":107,"content":"}"}]},{"timestamp":1761649394718,"changes":[{"type":"MODIFY","lineNumber":33,"content":"    @Column(length = 50)","oldContent":"    @Column(nullable = false, length = 50)"},{"type":"DELETE","lineNumber":56,"oldContent":""},{"type":"DELETE","lineNumber":58,"oldContent":"    @ManyToMany"},{"type":"INSERT","lineNumber":57,"content":""},{"type":"INSERT","lineNumber":59,"content":"    @ManyToMany"},{"type":"DELETE","lineNumber":67,"oldContent":""},{"type":"DELETE","lineNumber":69,"oldContent":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":68,"content":""},{"type":"INSERT","lineNumber":70,"content":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":103,"content":"        if (this.ticketUid == null) {"},{"type":"INSERT","lineNumber":104,"content":"            this.ticketUid = \"TK\" + (this.id + 1000);"},{"type":"DELETE","lineNumber":105,"oldContent":"        if (this.ticketUid == null) {"},{"type":"DELETE","lineNumber":107,"oldContent":"            this.ticketUid = \"TK\" + (this.id + 1000);"}]},{"timestamp":1761649398158,"changes":[{"type":"MODIFY","lineNumber":36,"content":"    @Column(length = 50)","oldContent":"    @Column(nullable = false, length = 50)"},{"type":"DELETE","lineNumber":56,"oldContent":""},{"type":"DELETE","lineNumber":58,"oldContent":"    @ManyToMany"},{"type":"INSERT","lineNumber":57,"content":""},{"type":"INSERT","lineNumber":59,"content":"    @ManyToMany"},{"type":"DELETE","lineNumber":67,"oldContent":""},{"type":"DELETE","lineNumber":69,"oldContent":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":68,"content":""},{"type":"INSERT","lineNumber":70,"content":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"MODIFY","lineNumber":105,"content":"        }","oldContent":"        }"}]},{"timestamp":1761649402760,"changes":[{"type":"MODIFY","lineNumber":39,"content":"    @Column(length = 50)","oldContent":"    @Column(nullable = false, length = 50)"},{"type":"DELETE","lineNumber":56,"oldContent":""},{"type":"DELETE","lineNumber":58,"oldContent":"    @ManyToMany"},{"type":"INSERT","lineNumber":57,"content":""},{"type":"INSERT","lineNumber":59,"content":"    @ManyToMany"},{"type":"DELETE","lineNumber":67,"oldContent":""},{"type":"DELETE","lineNumber":69,"oldContent":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":68,"content":""},{"type":"INSERT","lineNumber":70,"content":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":104,"content":"            this.ticketUid = \"TK\" + (this.id + 1000);"},{"type":"DELETE","lineNumber":105,"oldContent":"        }"}]},{"timestamp":1761649664451,"changes":[{"type":"MODIFY","lineNumber":41,"content":"    ","oldContent":""},{"type":"INSERT","lineNumber":42,"content":"    "},{"type":"DELETE","lineNumber":56,"oldContent":""},{"type":"MODIFY","lineNumber":58,"content":"","oldContent":"    @ManyToMany"},{"type":"INSERT","lineNumber":60,"content":"    @ManyToMany"},{"type":"DELETE","lineNumber":67,"oldContent":""},{"type":"MODIFY","lineNumber":69,"content":"","oldContent":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":71,"content":"    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)"}]},{"timestamp":1761649670553,"changes":[{"type":"MODIFY","lineNumber":42,"content":"    @Column(nullable = false)","oldContent":"    "}]},{"timestamp":1761649677885,"changes":[{"type":"MODIFY","lineNumber":45,"content":"    @Column(name = \"sub_category\", nullable = false)","oldContent":"    @Column(name = \"sub_category\")"}]},{"timestamp":1761649748387,"changes":[{"type":"MODIFY","lineNumber":41,"content":"","oldContent":"    "}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/ActivityType.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/ActivityType.java","baseContent":"package com.capstone.tele_ticketing_backend_1.entities;\n\npublic enum ActivityType {\n    CREATION,\n    STATUS_CHANGE,\n    ASSIGNMENT,\n    COMMENT,\n    RESOLUTION,\n    REOPENED,\n    ATTACHMENT_ADDED\n}","baseTimestamp":1761547863275,"deltas":[{"timestamp":1761551250409,"changes":[{"type":"INSERT","lineNumber":2,"content":"package com.yourcompany.ticketing.entity;"},{"type":"INSERT","lineNumber":3,"content":""},{"type":"INSERT","lineNumber":7,"content":"    PRIORITY_CHANGE,"}]},{"timestamp":1761551255988,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"package com.yourcompany.ticketing.entity;"},{"type":"DELETE","lineNumber":4,"oldContent":""},{"type":"INSERT","lineNumber":5,"content":"    PRIORITY_CHANGE,"},{"type":"DELETE","lineNumber":9,"oldContent":"    PRIORITY_CHANGE,"}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/TicketActivity.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/TicketActivity.java","baseContent":"package com.capstone.tele_ticketing_backend_1.entities;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\nimport org.hibernate.annotations.CreationTimestamp;\nimport java.time.LocalDateTime;\n\n@Entity\n@Table(name = \"ticket_activities\")\n@Data\n@NoArgsConstructor\npublic class TicketActivity {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"ticket_id\", nullable = false)\n    private Ticket ticket;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"user_id\", nullable = false)\n    private User user;\n\n    @Enumerated(EnumType.STRING) // Maps the Enum to a String column\n    @Column(name = \"activity_type\", nullable = false, length = 50)\n    private ActivityType activityType;\n\n    @Lob\n    @Column(name = \"activity_description\")\n    private String description;\n\n    @CreationTimestamp\n    @Column(name = \"created_at\", updatable = false)\n    private LocalDateTime createdAt;\n}","baseTimestamp":1761547876270,"deltas":[{"timestamp":1761551265049,"changes":[{"type":"INSERT","lineNumber":1,"content":"package com.yourcompany.ticketing.entity;"},{"type":"INSERT","lineNumber":7,"content":""},{"type":"DELETE","lineNumber":24,"oldContent":"    private User user;"},{"type":"INSERT","lineNumber":26,"content":"    private AppUser user;"},{"type":"DELETE","lineNumber":26,"oldContent":"    @Enumerated(EnumType.STRING) // Maps the Enum to a String column"},{"type":"INSERT","lineNumber":28,"content":"    @Enumerated(EnumType.STRING) // Maps the Enum to a String column in the DB"}]},{"timestamp":1761551272060,"changes":[{"type":"DELETE","lineNumber":1,"oldContent":"package com.yourcompany.ticketing.entity;"},{"type":"INSERT","lineNumber":6,"content":""},{"type":"DELETE","lineNumber":9,"oldContent":""},{"type":"DELETE","lineNumber":26,"oldContent":""},{"type":"DELETE","lineNumber":28,"oldContent":"    @Column(name = \"activity_type\", nullable = false, length = 50)"},{"type":"INSERT","lineNumber":26,"content":""},{"type":"INSERT","lineNumber":28,"content":"    @Column(name = \"activity_type\", nullable = false, length = 50)"}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/Feedback.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/Feedback.java","baseContent":"package com.capstone.tele_ticketing_backend_1.entities;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\nimport org.hibernate.annotations.CreationTimestamp;\nimport java.time.LocalDateTime;\n\n@Entity\n@Table(name = \"feedback\")\n@Data\n@NoArgsConstructor\npublic class Feedback {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @OneToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"ticket_id\", nullable = false, unique = true)\n    private Ticket ticket;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"user_id\", nullable = false)\n    private User user;\n\n    @Column(nullable = false)\n    private Integer rating;\n\n    @Lob\n    private String comment;\n\n    @CreationTimestamp\n    @Column(name = \"created_at\", updatable = false)\n    private LocalDateTime createdAt;\n}\n","baseTimestamp":1761547891616,"deltas":[{"timestamp":1761551284588,"changes":[{"type":"INSERT","lineNumber":1,"content":"package com.yourcompany.ticketing.entity;"},{"type":"INSERT","lineNumber":7,"content":""},{"type":"DELETE","lineNumber":19,"oldContent":"    @JoinColumn(name = \"ticket_id\", nullable = false, unique = true)"},{"type":"INSERT","lineNumber":21,"content":"    @JoinColumn(name = \"ticket_id\", nullable = false, unique = true) // 'unique = true' enforces one feedback per ticket"},{"type":"DELETE","lineNumber":24,"oldContent":"    private User user;"},{"type":"INSERT","lineNumber":26,"content":"    private AppUser user;"},{"type":"DELETE","lineNumber":36,"oldContent":""}]},{"timestamp":1761551288499,"changes":[{"type":"DELETE","lineNumber":1,"oldContent":"package com.yourcompany.ticketing.entity;"},{"type":"INSERT","lineNumber":2,"content":""},{"type":"INSERT","lineNumber":7,"content":""},{"type":"DELETE","lineNumber":9,"oldContent":""},{"type":"MODIFY","lineNumber":22,"content":"    private Ticket ticket;","oldContent":"    private Ticket ticket;"},{"type":"MODIFY","lineNumber":27,"content":"","oldContent":""}]},{"timestamp":1761551314782,"changes":[{"type":"INSERT","lineNumber":21,"content":"    @JoinColumn(name = \"ticket_id\", nullable = false, unique = true) // 'unique = true' enforces one feedback per ticket"},{"type":"DELETE","lineNumber":22,"oldContent":"    private Ticket ticket;"},{"type":"INSERT","lineNumber":26,"content":"    private AppUser user;"},{"type":"DELETE","lineNumber":27,"oldContent":""}]},{"timestamp":1761551352534,"changes":[{"type":"MODIFY","lineNumber":21,"content":"    @JoinColumn(name = \"ticket_id\", nullable = false) // 'unique = true' enforces one feedback per ticket","oldContent":"    @JoinColumn(name = \"ticket_id\", nullable = false, unique = true) // 'unique = true' enforces one feedback per ticket"}]},{"timestamp":1761551356546,"changes":[{"type":"MODIFY","lineNumber":21,"content":"    @JoinColumn(name = \"ticket_id\", nullable = false) ","oldContent":"    @JoinColumn(name = \"ticket_id\", nullable = false) // 'unique = true' enforces one feedback per ticket"}]},{"timestamp":1761551398195,"changes":[{"type":"MODIFY","lineNumber":21,"content":"    @JoinColumn(name = \"ticket_id\", nullable = false)","oldContent":"    @JoinColumn(name = \"ticket_id\", nullable = false) "}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/Attachment.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/Attachment.java","baseContent":"package com.capstone.tele_ticketing_backend_1.entities;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\nimport org.hibernate.annotations.CreationTimestamp;\nimport java.time.LocalDateTime;\n\n@Entity\n@Table(name = \"attachments\")\n@Data\n@NoArgsConstructor\npublic class Attachment {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"ticket_id\", nullable = false)\n    private Ticket ticket;\n\n    @Column(name = \"file_path\", nullable = false, unique = true)\n    private String filePath;\n\n    @Column(name = \"file_name\", nullable = false)\n    private String fileName;\n\n    @CreationTimestamp\n    @Column(name = \"uploaded_at\", updatable = false)\n    private LocalDateTime uploadedAt;\n}\n","baseTimestamp":1761547907414},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/repo/UserRepo.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/repo/UserRepo.java","baseContent":"package com.capstone.tele_ticketing_backend_1.repo;\n\npublic interface UserRepo  {\n}\n","baseTimestamp":1761548433555,"deltas":[{"timestamp":1761548453202,"changes":[{"type":"MODIFY","lineNumber":2,"content":"import org.springframework.data.jpa.repository.JpaRepository;","oldContent":"public interface UserRepo  {"},{"type":"INSERT","lineNumber":3,"content":""},{"type":"INSERT","lineNumber":4,"content":"public interface UserRepo extends JpaRepository<User> {"}]},{"timestamp":1761548464140,"changes":[{"type":"INSERT","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.entities.User;"},{"type":"DELETE","lineNumber":4,"oldContent":"}"},{"type":"INSERT","lineNumber":6,"content":"}"}]},{"timestamp":1761548595461,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.User;"}]},{"timestamp":1761551880849,"changes":[{"type":"INSERT","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.entities.AppUser;"},{"type":"MODIFY","lineNumber":5,"content":"public interface UserRepo extends JpaRepository<AppUser, Long> {","oldContent":"public interface UserRepo extends JpaRepository<User> {"}]},{"timestamp":1761555006988,"changes":[{"type":"DELETE","lineNumber":5,"oldContent":"public interface UserRepo extends JpaRepository<User> {"},{"type":"INSERT","lineNumber":6,"content":"    Optional<AppUser> findByUsername(String username);"},{"type":"INSERT","lineNumber":7,"content":"}"}]},{"timestamp":1761555012115,"changes":[{"type":"MODIFY","lineNumber":5,"content":"import java.util.Optional;","oldContent":"    Optional<AppUser> findByUsername(String username);"},{"type":"INSERT","lineNumber":6,"content":""},{"type":"INSERT","lineNumber":8,"content":"    @Override"},{"type":"INSERT","lineNumber":9,"content":"    Optional<AppUser> findById(Long aLong);"},{"type":"INSERT","lineNumber":10,"content":""},{"type":"INSERT","lineNumber":11,"content":"    <AppUser> findByUsername(String username);"}]},{"timestamp":1761555018980,"changes":[{"type":"INSERT","lineNumber":8,"content":"    Optional<AppUser> findByUsername(String username);"},{"type":"DELETE","lineNumber":9,"oldContent":"    @Override"},{"type":"DELETE","lineNumber":11,"oldContent":"    Optional<AppUser> findById(Long aLong);"},{"type":"DELETE","lineNumber":12,"oldContent":"    <AppUser> findByUsername(String username);"},{"type":"DELETE","lineNumber":13,"oldContent":""}]},{"timestamp":1761627049917,"changes":[{"type":"INSERT","lineNumber":9,"content":"    Boolean existsByUsername(String username);"}]},{"timestamp":1761634794807,"changes":[{"type":"INSERT","lineNumber":4,"content":"import org.springframework.stereotype.Repository;"},{"type":"INSERT","lineNumber":8,"content":"@Repository"}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/AppUser.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/AppUser.java","baseContent":"package com.capstone.tele_ticketing_backend_1.entities;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport lombok.EqualsAndHashCode;\nimport lombok.NoArgsConstructor;\nimport lombok.ToString;\nimport org.hibernate.annotations.CreationTimestamp;\nimport org.hibernate.annotations.UpdateTimestamp;\nimport java.time.LocalDateTime;\nimport java.util.HashSet;\nimport java.util.Set;\n\n@Entity\n@Table(name = \"users\") // The table name in the DB remains \"users\"\n@Data\n@NoArgsConstructor\npublic class AppUser {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @Column(unique = true, nullable = false, length = 100)\n    private String username;\n\n    @Column(nullable = false)\n    private String password;\n\n    @Column(name = \"full_name\", nullable = false)\n    private String fullName;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"role_id\", nullable = false)\n    private Role role;\n\n    // Self-referencing ManyToMany for team structure\n    @ManyToMany\n    @JoinTable(\n            name = \"team_memberships\",\n            joinColumns = @JoinColumn(name = \"member_id\"),\n            inverseJoinColumns = @JoinColumn(name = \"team_lead_id\")\n    )\n    @ToString.Exclude\n    @EqualsAndHashCode.Exclude\n    private Set<AppUser> teamLeads = new HashSet<>();\n\n    @ManyToMany(mappedBy = \"teamLeads\")\n    @ToString.Exclude\n    @EqualsAndHashCode.Exclude\n    private Set<AppUser> teamMembers = new HashSet<>();\n\n    // A user can be assigned to many tickets as an engineer\n    @ManyToMany(mappedBy = \"assignedEngineers\")\n    @ToString.Exclude\n    @EqualsAndHashCode.Exclude\n    private Set<Ticket> assignedTickets = new HashSet<>();\n\n    @CreationTimestamp\n    @Column(name = \"created_at\", updatable = false)\n    private LocalDateTime createdAt;\n\n    @UpdateTimestamp\n    @Column(name = \"updated_at\")\n    private LocalDateTime updatedAt;\n}\n","baseTimestamp":1761548608963,"deltas":[{"timestamp":1761633700285,"changes":[{"type":"MODIFY","lineNumber":66,"content":"    public AppUser appUser(String username, String Role,)","oldContent":"    public AppUser appUser()"}]},{"timestamp":1761633722308,"changes":[{"type":"MODIFY","lineNumber":66,"content":"    public AppUser appUser(String username, String Role, )","oldContent":"    public AppUser appUser(String username, String Role,)"}]},{"timestamp":1761633825796,"changes":[{"type":"MODIFY","lineNumber":66,"content":"    public AppUser appUser(String username, String password ){","oldContent":"    public AppUser appUser(String username, String Role, )"},{"type":"INSERT","lineNumber":67,"content":"        this.username = username;"},{"type":"INSERT","lineNumber":68,"content":"        this.password = password;"},{"type":"INSERT","lineNumber":69,"content":"    }"}]},{"timestamp":1761633832035,"changes":[{"type":"DELETE","lineNumber":68,"oldContent":"}"},{"type":"DELETE","lineNumber":70,"oldContent":""},{"type":"INSERT","lineNumber":69,"content":"        return"},{"type":"INSERT","lineNumber":71,"content":"}"},{"type":"INSERT","lineNumber":72,"content":""}]},{"timestamp":1761633837669,"changes":[{"type":"MODIFY","lineNumber":66,"content":"    public void appUser(String username, String password ){","oldContent":"    public AppUser appUser(String username, String password ){"},{"type":"DELETE","lineNumber":68,"oldContent":"        return"},{"type":"DELETE","lineNumber":70,"oldContent":"}"},{"type":"INSERT","lineNumber":69,"content":"        return"},{"type":"INSERT","lineNumber":71,"content":"}"}]},{"timestamp":1761633847830,"changes":[{"type":"MODIFY","lineNumber":65,"content":"","oldContent":"    "},{"type":"DELETE","lineNumber":68,"oldContent":"        return"},{"type":"DELETE","lineNumber":70,"oldContent":"}"},{"type":"INSERT","lineNumber":69,"content":"        return"},{"type":"INSERT","lineNumber":71,"content":"}"}]},{"timestamp":1761633852737,"changes":[{"type":"MODIFY","lineNumber":66,"content":"    public AppUser(String username, String password ){","oldContent":"    public void appUser(String username, String password ){"},{"type":"DELETE","lineNumber":68,"oldContent":"        return"},{"type":"DELETE","lineNumber":70,"oldContent":"}"},{"type":"INSERT","lineNumber":69,"content":"        return"},{"type":"INSERT","lineNumber":71,"content":"}"}]},{"timestamp":1761633855760,"changes":[{"type":"DELETE","lineNumber":68,"oldContent":"        return"},{"type":"MODIFY","lineNumber":70,"content":"}","oldContent":"}"}]},{"timestamp":1761634190385,"changes":[{"type":"MODIFY","lineNumber":70,"content":"}","oldContent":"}"}]},{"timestamp":1761634224621,"changes":[{"type":"INSERT","lineNumber":11,"content":"import java.util.List;"},{"type":"MODIFY","lineNumber":35,"content":"    private List<Role> roles;","oldContent":"    private Role role;"},{"type":"INSERT","lineNumber":70,"content":"    }"},{"type":"DELETE","lineNumber":70,"oldContent":"}"}]},{"timestamp":1761634308829,"changes":[{"type":"DELETE","lineNumber":35,"oldContent":"    private Role role;"},{"type":"MODIFY","lineNumber":35,"content":"    private Set<Role> roles;","oldContent":"    private List<Role> roles;"},{"type":"INSERT","lineNumber":36,"content":""},{"type":"MODIFY","lineNumber":71,"content":"}","oldContent":"}"}]},{"timestamp":1761640862592,"changes":[{"type":"DELETE","lineNumber":33,"oldContent":"    @ManyToOne(fetch = FetchType.LAZY)"},{"type":"DELETE","lineNumber":34,"oldContent":"    @JoinColumn(name = \"role_id\", nullable = false)"},{"type":"DELETE","lineNumber":35,"oldContent":"    private Set<Role> roles;"},{"type":"DELETE","lineNumber":36,"oldContent":"    private List<Role> roles;"},{"type":"INSERT","lineNumber":33,"content":"    @ManyToMany(fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":34,"content":"    @JoinTable("},{"type":"INSERT","lineNumber":35,"content":"            name = \"user_roles\","},{"type":"INSERT","lineNumber":36,"content":"            joinColumns = @JoinColumn(name = \"user_id\"),"},{"type":"INSERT","lineNumber":37,"content":"            inverseJoinColumns = @JoinColumn(name = \"role_id\")"},{"type":"INSERT","lineNumber":38,"content":"    )"},{"type":"INSERT","lineNumber":39,"content":"    private Set<Role> roles = new HashSet<>();"},{"type":"INSERT","lineNumber":40,"content":""},{"type":"INSERT","lineNumber":41,"content":""},{"type":"INSERT","lineNumber":75,"content":"    }"},{"type":"DELETE","lineNumber":71,"oldContent":"}"}]},{"timestamp":1761640958785,"changes":[{"type":"DELETE","lineNumber":33,"oldContent":"    @ManyToMany(fetch = FetchType.LAZY)"},{"type":"DELETE","lineNumber":34,"oldContent":"    @JoinTable("},{"type":"DELETE","lineNumber":35,"oldContent":"            name = \"user_roles\","},{"type":"DELETE","lineNumber":36,"oldContent":"            joinColumns = @JoinColumn(name = \"user_id\"),"},{"type":"DELETE","lineNumber":37,"oldContent":"            inverseJoinColumns = @JoinColumn(name = \"role_id\")"},{"type":"INSERT","lineNumber":33,"content":"package com.capstone.tele_ticketing_backend_1.entities;"},{"type":"INSERT","lineNumber":34,"content":""},{"type":"INSERT","lineNumber":35,"content":"import jakarta.persistence.*;"},{"type":"INSERT","lineNumber":36,"content":"import lombok.Data;"},{"type":"INSERT","lineNumber":37,"content":"import lombok.NoArgsConstructor;"},{"type":"INSERT","lineNumber":38,"content":"import java.util.Set;"},{"type":"INSERT","lineNumber":39,"content":""},{"type":"INSERT","lineNumber":40,"content":"    @Entity"},{"type":"INSERT","lineNumber":41,"content":"    @Table(name = \"roles\")"},{"type":"INSERT","lineNumber":42,"content":"    @Data"},{"type":"INSERT","lineNumber":43,"content":"    @NoArgsConstructor"},{"type":"INSERT","lineNumber":44,"content":"    public class Role {"},{"type":"INSERT","lineNumber":45,"content":""},{"type":"INSERT","lineNumber":46,"content":"        @Id"},{"type":"INSERT","lineNumber":47,"content":"        @GeneratedValue(strategy = GenerationType.IDENTITY)"},{"type":"INSERT","lineNumber":48,"content":"        private Integer id;"},{"type":"INSERT","lineNumber":49,"content":""},{"type":"INSERT","lineNumber":50,"content":"        @Column(unique = true, nullable = false, length = 50)"},{"type":"INSERT","lineNumber":51,"content":"        private ERole name;"},{"type":"INSERT","lineNumber":52,"content":""},{"type":"INSERT","lineNumber":53,"content":"        // A role can be assigned to many users"},{"type":"INSERT","lineNumber":54,"content":"        @OneToMany(mappedBy = \"role\")"},{"type":"INSERT","lineNumber":55,"content":"        private Set<AppUser> users;"},{"type":"INSERT","lineNumber":56,"content":"    }"},{"type":"INSERT","lineNumber":57,"content":""},{"type":"INSERT","lineNumber":58,"content":""},{"type":"DELETE","lineNumber":39,"oldContent":"    )"},{"type":"DELETE","lineNumber":41,"oldContent":"    private Set<Role> roles = new HashSet<>();"},{"type":"DELETE","lineNumber":43,"oldContent":""},{"type":"DELETE","lineNumber":45,"oldContent":""},{"type":"INSERT","lineNumber":92,"content":"    }"},{"type":"DELETE","lineNumber":77,"oldContent":"    }"}]},{"timestamp":1761640967861,"changes":[{"type":"MODIFY","lineNumber":33,"content":"    @ManyToMany(fetch = FetchType.LAZY)","oldContent":"package com.capstone.tele_ticketing_backend_1.entities;"},{"type":"INSERT","lineNumber":34,"content":"    @JoinTable("},{"type":"INSERT","lineNumber":35,"content":"            name = \"user_roles\","},{"type":"INSERT","lineNumber":36,"content":"            joinColumns = @JoinColumn(name = \"user_id\"),"},{"type":"INSERT","lineNumber":37,"content":"            inverseJoinColumns = @JoinColumn(name = \"role_id\")"},{"type":"INSERT","lineNumber":38,"content":"    )"},{"type":"INSERT","lineNumber":39,"content":"    private Set<Role> roles = new HashSet<>();"},{"type":"DELETE","lineNumber":35,"oldContent":"import jakarta.persistence.*;"},{"type":"DELETE","lineNumber":36,"oldContent":"import lombok.Data;"},{"type":"DELETE","lineNumber":37,"oldContent":"import lombok.NoArgsConstructor;"},{"type":"DELETE","lineNumber":38,"oldContent":"import java.util.Set;"},{"type":"DELETE","lineNumber":39,"oldContent":"    // Self-referencing ManyToMany for team structure"},{"type":"DELETE","lineNumber":41,"oldContent":"    @Entity"},{"type":"INSERT","lineNumber":42,"content":"    // Self-referencing ManyToMany for team structure"},{"type":"DELETE","lineNumber":43,"oldContent":"    @Table(name = \"roles\")"},{"type":"DELETE","lineNumber":44,"oldContent":"    @Data"},{"type":"DELETE","lineNumber":46,"oldContent":"    @NoArgsConstructor"},{"type":"DELETE","lineNumber":47,"oldContent":"    public class Role {"},{"type":"DELETE","lineNumber":49,"oldContent":""},{"type":"DELETE","lineNumber":50,"oldContent":"        @Id"},{"type":"DELETE","lineNumber":52,"oldContent":"        @GeneratedValue(strategy = GenerationType.IDENTITY)"},{"type":"DELETE","lineNumber":54,"oldContent":"        private Integer id;"},{"type":"DELETE","lineNumber":56,"oldContent":""},{"type":"DELETE","lineNumber":58,"oldContent":"        @Column(unique = true, nullable = false, length = 50)"},{"type":"DELETE","lineNumber":60,"oldContent":"        private ERole name;"},{"type":"DELETE","lineNumber":63,"oldContent":""},{"type":"DELETE","lineNumber":64,"oldContent":"        // A role can be assigned to many users"},{"type":"DELETE","lineNumber":66,"oldContent":"        @OneToMany(mappedBy = \"role\")"},{"type":"DELETE","lineNumber":68,"oldContent":"        private Set<AppUser> users;"},{"type":"DELETE","lineNumber":70,"oldContent":"    }"},{"type":"DELETE","lineNumber":73,"oldContent":""},{"type":"DELETE","lineNumber":74,"oldContent":""},{"type":"INSERT","lineNumber":75,"content":"    }"},{"type":"DELETE","lineNumber":94,"oldContent":"    }"}]},{"timestamp":1761642753231,"changes":[{"type":"INSERT","lineNumber":34,"content":"    @Enumerated"},{"type":"DELETE","lineNumber":35,"oldContent":""},{"type":"INSERT","lineNumber":42,"content":""},{"type":"DELETE","lineNumber":58,"oldContent":"    }"},{"type":"INSERT","lineNumber":76,"content":"    }"}]},{"timestamp":1761642758421,"changes":[{"type":"MODIFY","lineNumber":34,"content":"    @Enumerated(EnumType.ORDINAL)","oldContent":"    @Enumerated"}]},{"timestamp":1761642763308,"changes":[{"type":"MODIFY","lineNumber":34,"content":"    @Enumerated(EnumType.STRING)","oldContent":"    @Enumerated(EnumType.ORDINAL)"}]},{"timestamp":1761643047643,"changes":[{"type":"DELETE","lineNumber":34,"oldContent":"    @Enumerated(EnumType.STRING)"},{"type":"DELETE","lineNumber":35,"oldContent":"    @JoinTable("},{"type":"DELETE","lineNumber":36,"oldContent":"            name = \"user_roles\","},{"type":"DELETE","lineNumber":37,"oldContent":"            joinColumns = @JoinColumn(name = \"user_id\"),"},{"type":"DELETE","lineNumber":38,"oldContent":"            inverseJoinColumns = @JoinColumn(name = \"role_id\")"},{"type":"DELETE","lineNumber":39,"oldContent":"    )"},{"type":"INSERT","lineNumber":34,"content":"    @JoinTable(name = \"user_roles\", joinColumns = @JoinColumn(name = \"user_id\"), inverseJoinColumns = @JoinColumn(name = \"role_id\"))"},{"type":"INSERT","lineNumber":35,"content":"    @ToString.Exclude"}]},{"timestamp":1761643474041,"changes":[{"type":"MODIFY","lineNumber":69,"content":"    public AppUser(String username, String password, String fullName ){","oldContent":"    public AppUser(String username, String password ){"},{"type":"MODIFY","lineNumber":74,"content":"","oldContent":"    }"}]},{"timestamp":1761643482630,"changes":[{"type":"INSERT","lineNumber":72,"content":"        this.fullName = fullName;"}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/LoginRequest.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/LoginRequest.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\npackage com.yourcompany.ticketing.dto;\n\nimport lombok.Data;\n\n@Data\npublic class LoginRequest {\n    private String username;\n    private String password;\n}\n","baseTimestamp":1761554858850,"deltas":[{"timestamp":1761554863706,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"package com.yourcompany.ticketing.dto;"},{"type":"DELETE","lineNumber":3,"oldContent":""}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/LoginResponse.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/LoginResponse.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\npackage com.yourcompany.ticketing.dto;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\n\n@Data\n@AllArgsConstructor // Useful for creating instances easily\npublic class LoginResponse {\n    private boolean success;\n    private String message;\n    private String role; // Will be null on failure\n}","baseTimestamp":1761555207718,"deltas":[{"timestamp":1761555211215,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"package com.yourcompany.ticketing.dto;"},{"type":"DELETE","lineNumber":3,"oldContent":""}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/config/AppConfig.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/config/AppConfig.java","baseContent":"package com.capstone.tele_ticketing_backend_1.config;\n\npackage com.yourcompany.ticketing.config;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.security.crypto.password.PasswordEncoder;\n\n@Configuration\npublic class AppConfig {\n    @Bean\n    public PasswordEncoder passwordEncoder() {\n        return new BCryptPasswordEncoder();\n    }\n}\n","baseTimestamp":1761555850671,"deltas":[{"timestamp":1761555853383,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"package com.yourcompany.ticketing.config;"}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/AuthService.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/AuthService.java","baseContent":"package com.capstone.tele_ticketing_backend_1.security;\n\npackage com.yourcompany.ticketing.service;\n\nimport com.yourcompany.ticketing.dto.LoginRequest;\nimport com.yourcompany.ticketing.dto.LoginResponse;\nimport com.yourcompany.ticketing.entity.AppUser;\nimport com.yourcompany.ticketing.repository.AppUserRepository;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.stereotype.Service;\nimport java.util.Optional;\n\n@Service\npublic class AuthService {\n\n    @Autowired\n    private AppUserRepository appUserRepository;\n\n    @Autowired\n    private PasswordEncoder passwordEncoder;\n\n    public LoginResponse login(LoginRequest loginRequest) {\n        // 1. Find the user by username\n        Optional<AppUser> userOptional = appUserRepository.findByUsername(loginRequest.getUsername());\n\n        // 2. Check if user exists\n        if (userOptional.isEmpty()) {\n            return new LoginResponse(false, \"Invalid username or password.\", null);\n        }\n\n        AppUser user = userOptional.get();\n\n        // 3. Compare the provided password with the stored hashed password\n        if (passwordEncoder.matches(loginRequest.getPassword(), user.getPassword())) {\n            // Passwords match\n            String role = user.getRole().getName();\n            return new LoginResponse(true, \"Login successful.\", role);\n        } else {\n            // Passwords do not match\n            return new LoginResponse(false, \"Invalid username or password.\", null);\n        }\n    }\n}\n","baseTimestamp":1761555871145,"deltas":[{"timestamp":1761555874464,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"package com.yourcompany.ticketing.service;"}]},{"timestamp":1761555894821,"changes":[{"type":"DELETE","lineNumber":3,"oldContent":"import com.yourcompany.ticketing.dto.LoginRequest;"},{"type":"DELETE","lineNumber":4,"oldContent":"import com.yourcompany.ticketing.dto.LoginResponse;"},{"type":"DELETE","lineNumber":5,"oldContent":"import com.yourcompany.ticketing.entity.AppUser;"},{"type":"DELETE","lineNumber":6,"oldContent":"import com.yourcompany.ticketing.repository.AppUserRepository;"},{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.repo.UserRepo;"},{"type":"DELETE","lineNumber":16,"oldContent":"    private AppUserRepository appUserRepository;"},{"type":"INSERT","lineNumber":13,"content":"    private UserRepo appUserRepository;"}]},{"timestamp":1761555898407,"changes":[{"type":"DELETE","lineNumber":10,"oldContent":"    private UserRepo appUserRepository;"},{"type":"INSERT","lineNumber":13,"content":"    private UserRepo appUserRepository;"}]},{"timestamp":1761555902381,"changes":[{"type":"MODIFY","lineNumber":13,"content":"    private UserRepo appUserRepository;","oldContent":"    private UserRepo appUserRepository;"}]},{"timestamp":1761555904999,"changes":[{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.dto.LoginResponse;"},{"type":"INSERT","lineNumber":13,"content":"    @Autowired"},{"type":"DELETE","lineNumber":13,"oldContent":"    private UserRepo appUserRepository;"}]},{"timestamp":1761555908107,"changes":[{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.dto.LoginRequest;"},{"type":"DELETE","lineNumber":13,"oldContent":"    private UserRepo appUserRepository;"},{"type":"INSERT","lineNumber":15,"content":"    private UserRepo appUserRepository;"}]},{"timestamp":1761555911302,"changes":[{"type":"INSERT","lineNumber":5,"content":"import com.capstone.tele_ticketing_backend_1.entities.AppUser;"}]},{"timestamp":1761626779022,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":""},{"type":"DELETE","lineNumber":3,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.LoginRequest;"},{"type":"DELETE","lineNumber":4,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.LoginResponse;"},{"type":"INSERT","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.security.payload.request.LoginRequest;"},{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.security.payload.response.MessageResponse;"}]},{"timestamp":1761626794243,"changes":[{"type":"MODIFY","lineNumber":20,"content":"    public MessageResponse login(LoginRequest loginRequest) {","oldContent":"    public LoginResponse login(LoginRequest loginRequest) {"},{"type":"MODIFY","lineNumber":26,"content":"            return new MessageResponse(\"Invalid username or password.\");","oldContent":"            return new LoginResponse(false, \"Invalid username or password.\", null);"},{"type":"DELETE","lineNumber":34,"oldContent":"            String role = user.getRole().getName();"},{"type":"MODIFY","lineNumber":34,"content":"            return new MessageResponse(\"Login successful.\");","oldContent":"            return new LoginResponse(true, \"Login successful.\", role);"},{"type":"MODIFY","lineNumber":37,"content":"            return new MessageResponse(\"Invalid username or password.\");","oldContent":"            return new LoginResponse(false, \"Invalid username or password.\", null);"}]},{"timestamp":1761626929645,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"import com.capstone.tele_ticketing_backend_1.security.payload.request.LoginRequest;"},{"type":"DELETE","lineNumber":3,"oldContent":"import com.capstone.tele_ticketing_backend_1.security.payload.response.MessageResponse;"},{"type":"DELETE","lineNumber":4,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.AppUser;"},{"type":"DELETE","lineNumber":5,"oldContent":"import com.capstone.tele_ticketing_backend_1.repo.UserRepo;"},{"type":"INSERT","lineNumber":2,"content":"import java.util.Optional;"},{"type":"INSERT","lineNumber":3,"content":""},{"type":"DELETE","lineNumber":9,"oldContent":"import java.util.Optional;"},{"type":"INSERT","lineNumber":8,"content":"import com.capstone.tele_ticketing_backend_1.entities.AppUser;"},{"type":"INSERT","lineNumber":9,"content":"import com.capstone.tele_ticketing_backend_1.repo.UserRepo;"},{"type":"INSERT","lineNumber":10,"content":"import com.capstone.tele_ticketing_backend_1.security.payload.request.LoginRequest;"},{"type":"INSERT","lineNumber":11,"content":"import com.capstone.tele_ticketing_backend_1.security.payload.response.MessageResponse;"},{"type":"INSERT","lineNumber":12,"content":""},{"type":"INSERT","lineNumber":38,"content":"            // Passwords do not match"},{"type":"DELETE","lineNumber":37,"oldContent":"            return new LoginResponse(false, \"Invalid username or password.\", null);"}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/AuhthController.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/AuhthController.java","baseContent":"package com.capstone.tele_ticketing_backend_1.controller;\n\npackage com.yourcompany.ticketing.controller;\n\nimport com.yourcompany.ticketing.dto.LoginRequest;\nimport com.yourcompany.ticketing.dto.LoginResponse;\nimport com.yourcompany.ticketing.service.AuthService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.HttpStatus;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n@RestController\n@RequestMapping(\"/api/auth\")\npublic class AuthController {\n\n    @Autowired\n    private AuthService authService;\n\n    @PostMapping(\"/login\")\n    public ResponseEntity<LoginResponse> login(@RequestBody LoginRequest loginRequest) {\n        LoginResponse response = authService.login(loginRequest);\n\n        if (response.isSuccess()) {\n            return ResponseEntity.ok(response);\n        } else {\n            // Use 401 Unauthorized for failed login attempts\n            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body(response);\n        }\n    }\n}\n","baseTimestamp":1761555943191,"deltas":[{"timestamp":1761555946222,"changes":[{"type":"DELETE","lineNumber":4,"oldContent":"import com.yourcompany.ticketing.dto.LoginRequest;"},{"type":"DELETE","lineNumber":5,"oldContent":"import com.yourcompany.ticketing.dto.LoginResponse;"},{"type":"DELETE","lineNumber":6,"oldContent":"import com.yourcompany.ticketing.service.AuthService;"}]},{"timestamp":1761555948594,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"package com.yourcompany.ticketing.controller;"},{"type":"DELETE","lineNumber":3,"oldContent":""}]},{"timestamp":1761555964886,"changes":[{"type":"INSERT","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.security.AuthService;"}]},{"timestamp":1761555968445,"changes":[{"type":"INSERT","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.dto.LoginResponse;"}]},{"timestamp":1761555975012,"changes":[{"type":"INSERT","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.dto.LoginRequest;"}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/config/SecurityConfig.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/config/SecurityConfig.java","baseContent":"package com.capstone.tele_ticketing_backend_1.config;\n\npackage com.yourcompany.ticketing.config;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.web.SecurityFilterChain;\n\n@Configuration\n@EnableWebSecurity\npublic class SecurityConfig {\n\n    @Bean\n    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n        http\n                // 1. Disable CSRF protection\n                .csrf(csrf -> csrf.disable())\n\n                // 2. Set authorization rules\n                .authorizeHttpRequests(auth -> auth\n                        // That's the magic line: it permits ALL requests without authentication.\n                        .anyRequest().permitAll()\n                );\n\n        return http.build();\n    }\n}\n","baseTimestamp":1761556027378,"deltas":[{"timestamp":1761556030385,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"package com.yourcompany.ticketing.config;"}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/resources/application.properties":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/resources/application.properties","baseContent":"spring.application.name=tele-ticketing-backend-1\nspring.datasource.url=jdbc:mysql://localhost:3306/springsecuritybasics?createDatabaseIfNotExist=true\nspring.datasource.username=root\nspring.datasource.password=root\nspring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect","baseTimestamp":1761556585982,"deltas":[{"timestamp":1761556589061,"changes":[{"type":"MODIFY","lineNumber":1,"content":"spring.datasource.url=jdbc:mysql://localhost:3306/tele?createDatabaseIfNotExist=true","oldContent":"spring.datasource.url=jdbc:mysql://localhost:3306/springsecuritybasics?createDatabaseIfNotExist=true"}]},{"timestamp":1761556595793,"changes":[{"type":"MODIFY","lineNumber":1,"content":"spring.datasource.url=jdbc:mysql://localhost:3306/tele_ticketing_1?createDatabaseIfNotExist=true","oldContent":"spring.datasource.url=jdbc:mysql://localhost:3306/tele?createDatabaseIfNotExist=true"}]},{"timestamp":1761556910617,"changes":[{"type":"INSERT","lineNumber":5,"content":"spring.jpa.hibernate.ddl-auto=update"}]},{"timestamp":1761641198928,"changes":[{"type":"MODIFY","lineNumber":5,"content":"spring.jpa.hibernate.ddl-auto=","oldContent":"spring.jpa.hibernate.ddl-auto=update"},{"type":"INSERT","lineNumber":6,"content":""},{"type":"INSERT","lineNumber":7,"content":""},{"type":"INSERT","lineNumber":8,"content":"jwtSecret: BLUEYONDERBELLANDURBENGALURUBLUEYONDERBELLANDURBENGALURUBLUEYONDERBELLANDURBENGALURUBENGALURUBLUEYONDERBELLANDURBENGALURUBENGALURUBLUEYONDERBELLANDURBENGALURU"},{"type":"INSERT","lineNumber":9,"content":"jwtExpirationMs: 86400000"}]},{"timestamp":1761641223617,"changes":[{"type":"DELETE","lineNumber":7,"oldContent":"jwtExpirationMs: 86400000"},{"type":"MODIFY","lineNumber":8,"content":"jwtExpirationMs: 86400000","oldContent":""}]},{"timestamp":1761641608282,"changes":[{"type":"MODIFY","lineNumber":5,"content":"spring.jpa.hibernate.ddl-auto=true","oldContent":"spring.jpa.hibernate.ddl-auto="},{"type":"MODIFY","lineNumber":8,"content":"jwtExpirationMs: 86400000","oldContent":"jwtExpirationMs: 86400000"}]},{"timestamp":1761641729240,"changes":[{"type":"MODIFY","lineNumber":5,"content":"spring.jpa.hibernate.ddl-auto=update","oldContent":"spring.jpa.hibernate.ddl-auto=true"},{"type":"INSERT","lineNumber":6,"content":"spring.jpa.hibernate"},{"type":"INSERT","lineNumber":8,"content":"jwtSecret: BLUEYONDERBELLANDURBENGALURUBLUEYONDERBELLANDURBENGALURUBLUEYONDERBELLANDURBENGALURUBENGALURUBLUEYONDERBELLANDURBENGALURUBENGALURUBLUEYONDERBELLANDURBENGALURU"},{"type":"DELETE","lineNumber":8,"oldContent":"jwtExpirationMs: 86400000"}]},{"timestamp":1761641739962,"changes":[{"type":"MODIFY","lineNumber":6,"content":"spring.jpa.show-sql=true","oldContent":"spring.jpa.hibernate"},{"type":"MODIFY","lineNumber":9,"content":"jwtExpirationMs: 86400000","oldContent":"jwtExpirationMs: 86400000"}]},{"timestamp":1761678321446,"changes":[{"type":"INSERT","lineNumber":1,"content":"server.port=3000"},{"type":"INSERT","lineNumber":9,"content":"jwtSecret: BLUEYONDERBELLANDURBENGALURUBLUEYONDERBELLANDURBENGALURUBLUEYONDERBELLANDURBENGALURUBENGALURUBLUEYONDERBELLANDURBENGALURUBENGALURUBLUEYONDERBELLANDURBENGALURU"},{"type":"DELETE","lineNumber":9,"oldContent":"jwtExpirationMs: 86400000"}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/repo/RoleRepo.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/repo/RoleRepo.java","baseContent":"package com.capstone.tele_ticketing_backend_1.repo;\n\nimport org.springframework.data.jpa.repository.JpaRepository;\n\npublic interface RoleRepo extends JpaRepository<> {\n}\n","baseTimestamp":1761590600354,"deltas":[{"timestamp":1761590609194,"changes":[{"type":"INSERT","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.entities.Role;"},{"type":"MODIFY","lineNumber":5,"content":"public interface RoleRepo extends JpaRepository<Role, Long> {","oldContent":"public interface RoleRepo extends JpaRepository<> {"},{"type":"INSERT","lineNumber":6,"content":"    "}]},{"timestamp":1761590694047,"changes":[{"type":"DELETE","lineNumber":5,"oldContent":"public interface RoleRepo extends JpaRepository<> {"},{"type":"MODIFY","lineNumber":7,"content":"}","oldContent":"    "},{"type":"INSERT","lineNumber":8,"content":""}]},{"timestamp":1761627064954,"changes":[{"type":"INSERT","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.entities.ERole;"},{"type":"DELETE","lineNumber":5,"oldContent":"public interface RoleRepo extends JpaRepository<Role, Long> {"},{"type":"INSERT","lineNumber":6,"content":"import java.util.Optional;"},{"type":"INSERT","lineNumber":7,"content":""},{"type":"INSERT","lineNumber":8,"content":"public interface RoleRepo extends JpaRepository<Role, Integer> {"},{"type":"INSERT","lineNumber":9,"content":"    Optional<Role> findByName(ERole name);"},{"type":"DELETE","lineNumber":8,"oldContent":""}]},{"timestamp":1761627413052,"changes":[{"type":"DELETE","lineNumber":7,"oldContent":"}"},{"type":"DELETE","lineNumber":9,"oldContent":""},{"type":"INSERT","lineNumber":10,"content":"}"},{"type":"INSERT","lineNumber":11,"content":""}]},{"timestamp":1761634789793,"changes":[{"type":"INSERT","lineNumber":5,"content":"import org.springframework.stereotype.Repository;"},{"type":"DELETE","lineNumber":8,"oldContent":"}"},{"type":"DELETE","lineNumber":9,"oldContent":"public interface RoleRepo extends JpaRepository<Role, Integer> {"},{"type":"INSERT","lineNumber":10,"content":"@Repository"},{"type":"INSERT","lineNumber":11,"content":"public interface RoleRepo extends JpaRepository<Role, Integer> {"},{"type":"INSERT","lineNumber":13,"content":"}"},{"type":"INSERT","lineNumber":14,"content":""}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/jwt/AuthTokenFilter.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/jwt/AuthTokenFilter.java","baseContent":"package com.capstone.tele_ticketing_backend_1.security.jwt;\n\n\nimport com.capstone.tele_ticketing_backend_1.security.service.UserDetailsServiceImpl;\nimport com.prodapt.springsecurityusingjwtexample.security.service.UserDetailsServiceImpl;\nimport jakarta.servlet.FilterChain;\nimport jakarta.servlet.ServletException;\nimport jakarta.servlet.http.HttpServletRequest;\nimport jakarta.servlet.http.HttpServletResponse;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.web.authentication.WebAuthenticationDetailsSource;\nimport org.springframework.util.StringUtils;\nimport org.springframework.web.filter.OncePerRequestFilter;\n\nimport java.io.IOException;\n\npublic class AuthTokenFilter extends OncePerRequestFilter {\n  @Autowired\n  private JwtUtils jwtUtils;\n\n  @Autowired\n  private UserDetailsServiceImpl userDetailsService;\n\n  private static final Logger logger = LoggerFactory.getLogger(AuthTokenFilter.class);\n\n  @Override\n  protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)\n      throws ServletException, IOException {\n    try {\n      String jwt = parseJwt(request);\n      if (jwt != null && jwtUtils.validateJwtToken(jwt)) {\n        String username = jwtUtils.getUserNameFromJwtToken(jwt);\n        //Validate user specific keys\n        UserDetails userDetails = userDetailsService.loadUserByUsername(username);\n        UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(userDetails, null,\n            userDetails.getAuthorities());\n        authentication.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));\n\n        SecurityContextHolder.getContext().setAuthentication(authentication);\n      }\n    } catch (Exception e) {\n      logger.error(\"Cannot set user authentication: {}\", e);\n    }\n\n    filterChain.doFilter(request, response);\n  }\n\n  private String parseJwt(HttpServletRequest request) {\n    String headerAuth = request.getHeader(\"Authorization\");\n\n    if (StringUtils.hasText(headerAuth) && headerAuth.startsWith(\"Bearer \")) {\n      return headerAuth.substring(7, headerAuth.length());\n    }\n\n    return null;\n  }\n}","baseTimestamp":1761593775957,"deltas":[{"timestamp":1761593784281,"changes":[{"type":"DELETE","lineNumber":4,"oldContent":"import com.prodapt.springsecurityusingjwtexample.security.service.UserDetailsServiceImpl;"}]},{"timestamp":1761628303576,"changes":[{"type":"INSERT","lineNumber":4,"content":"import com.prodapt.springsecurityusingjwtexample.security.service.UserDetailsServiceImpl;"}]},{"timestamp":1761628319861,"changes":[{"type":"DELETE","lineNumber":4,"oldContent":"import com.prodapt.springsecurityusingjwtexample.security.service.UserDetailsServiceImpl;"}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/jwt/JwtUtils.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/jwt/JwtUtils.java","baseContent":"package com.capstone.tele_ticketing_backend_1.security.jwt;\n\n\nimport com.capstone.tele_ticketing_backend_1.security.service.UserDetailsImpl;\nimport com.prodapt.springsecurityusingjwtexample.security.service.UserDetailsImpl;\nimport io.jsonwebtoken.*;\nimport io.jsonwebtoken.io.Decoders;\nimport io.jsonwebtoken.security.Keys;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.stereotype.Component;\n\nimport java.security.Key;\nimport java.util.Date;\n\n@Component\npublic class JwtUtils {\n  private static final Logger logger = LoggerFactory.getLogger(JwtUtils.class);\n\n  @Value(\"${toyandbooklibapp.jwtSecret}\")\n  private String jwtSecret;\n\n  @Value(\"${toyandbooklibapp.jwtExpirationMs}\")\n  private int jwtExpirationMs;\n\n  public String generateJwtToken(Authentication authentication) {\n\n    UserDetailsImpl userPrincipal = (UserDetailsImpl) authentication.getPrincipal();\n\n    return Jwts.builder().setSubject((userPrincipal.getUsername()))\n    \t\t.setIssuedAt(new Date())\n        .setExpiration(new Date((new Date()).getTime() + jwtExpirationMs))\n        .signWith(getSignInKey(),SignatureAlgorithm.HS512)\n        .compact(); \n  }\n\n  public String getUserNameFromJwtToken(String token) {\n   //0.9.0// return Jwts.parser().setSigningKey(getSignInKey()).parseClaimsJws(token).getBody().getSubject();\n\t//0.11.5  //return Jwts.parserBuilder().setSigningKey(getSignInKey()).build().parseClaimsJws(token).getBody().getSubject();\n\t  return Jwts.parserBuilder().setSigningKey(getSignInKey()).build().parseClaimsJws(token).getBody().getSubject();\n  }\n\n  public boolean validateJwtToken(String authToken) {\n    try {\n      //Jwts.parser().setSigningKey(getSignInKey()).parseClaimsJws(authToken);\n    \tJwts.parserBuilder().setSigningKey(getSignInKey()).build().parseClaimsJws(authToken);\n    \treturn true;\n\t}catch (MalformedJwtException e) {\n      logger.error(\"Invalid JWT token: {}\", e.getMessage());\n    } catch (ExpiredJwtException e) {\n      logger.error(\"JWT token is expired: {}\", e.getMessage());\n    } catch (UnsupportedJwtException e) {\n      logger.error(\"JWT token is unsupported: {}\", e.getMessage());\n    } catch (IllegalArgumentException e) {\n      logger.error(\"JWT claims string is empty: {}\", e.getMessage());\n    }\n\n    return false;\n  }\n  \n  private Key getSignInKey() {\n\t    byte[] keyBytes = Decoders.BASE64.decode(jwtSecret);\n\t    return Keys.hmacShaKeyFor(keyBytes);\n\t  }\n}","baseTimestamp":1761593795129,"deltas":[{"timestamp":1761593817121,"changes":[{"type":"DELETE","lineNumber":4,"oldContent":"import com.prodapt.springsecurityusingjwtexample.security.service.UserDetailsImpl;"}]},{"timestamp":1761628329110,"changes":[{"type":"MODIFY","lineNumber":3,"content":"import com.prodapt.springsecurityusingjwtexample.security.service.UserDetailsImpl;","oldContent":"import com.capstone.tele_ticketing_backend_1.security.service.UserDetailsImpl;"}]},{"timestamp":1761628332276,"changes":[{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.security.service.UserDetailsImpl;"}]},{"timestamp":1761628344747,"changes":[{"type":"DELETE","lineNumber":4,"oldContent":"import com.prodapt.springsecurityusingjwtexample.security.service.UserDetailsImpl;"}]},{"timestamp":1761641167141,"changes":[{"type":"MODIFY","lineNumber":20,"content":"  @Value(\"${toyandbooklibppjwtSecret}\")","oldContent":"  @Value(\"${toyandbooklibapp.jwtSecret}\")"}]},{"timestamp":1761641172927,"changes":[{"type":"MODIFY","lineNumber":20,"content":"  @Value(\"${jwtSecret}\")","oldContent":"  @Value(\"${toyandbooklibppjwtSecret}\")"},{"type":"MODIFY","lineNumber":23,"content":"  @Value(\"${jwtExpirationMs}\")","oldContent":"  @Value(\"${toyandbooklibapp.jwtExpirationMs}\")"}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/pom.xml":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/pom.xml","baseContent":"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\t<parent>\n\t\t<groupId>org.springframework.boot</groupId>\n\t\t<artifactId>spring-boot-starter-parent</artifactId>\n\t\t<version>3.5.7</version>\n\t\t<relativePath/> <!-- lookup parent from repository -->\n\t</parent>\n\t<groupId>com.capstone</groupId>\n\t<artifactId>tele-ticketing-backend-1</artifactId>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<name>tele-ticketing-backend-1</name>\n\t<description>Telecom ticketing application</description>\n\t<url/>\n\t<licenses>\n\t\t<license/>\n\t</licenses>\n\t<developers>\n\t\t<developer/>\n\t</developers>\n\t<scm>\n\t\t<connection/>\n\t\t<developerConnection/>\n\t\t<tag/>\n\t\t<url/>\n\t</scm>\n\t<properties>\n\t\t<java.version>17</java.version>\n\t</properties>\n\t<dependencies>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-data-jpa</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-security</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-web</artifactId>\n\t\t</dependency>\n\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-devtools</artifactId>\n\t\t\t<scope>runtime</scope>\n\t\t\t<optional>true</optional>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>com.mysql</groupId>\n\t\t\t<artifactId>mysql-connector-j</artifactId>\n\t\t\t<scope>runtime</scope>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.projectlombok</groupId>\n\t\t\t<artifactId>lombok</artifactId>\n\t\t\t<optional>true</optional>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-test</artifactId>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.security</groupId>\n\t\t\t<artifactId>spring-security-test</artifactId>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>io.jsonwebtoken</groupId>\n\t\t\t<artifactId>jjwt-api</artifactId>\n\t\t\t<version>0.11.5</version>\n\t\t</dependency>\n\t\t<!-- https://mvnrepository.com/artifact/io.jsonwebtoken/jjwt-impl -->\n\t\t<dependency>\n\t\t\t<groupId>io.jsonwebtoken</groupId>\n\t\t\t<artifactId>jjwt-impl</artifactId>\n\t\t\t<version>0.11.5</version>\n\t\t\t<scope>runtime</scope>\n\t\t</dependency>\n\t\t<!-- https://mvnrepository.com/artifact/io.jsonwebtoken/jjwt-jackson -->\n\t\t<dependency>\n\t\t\t<groupId>io.jsonwebtoken</groupId>\n\t\t\t<artifactId>jjwt-jackson</artifactId>\n\t\t\t<version>0.11.5</version>\n\t\t\t<scope>runtime</scope>\n\t\t</dependency>\n\t\t<!--\n\t\thttps://mvnrepository.com/artifact/org.springdoc/springdoc-openapi-starter-webmvc-ui -->\n\t\t<dependency>\n\t\t\t<groupId>org.springdoc</groupId>\n\t\t\t<artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>\n\t\t\t<version>2.8.8</version>\n\t\t</dependency>\n\t</dependencies>\n\n\t<build>\n\t\t<plugins>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n\t\t\t\t<artifactId>maven-compiler-plugin</artifactId>\n\t\t\t\t<configuration>\n\t\t\t\t\t<annotationProcessorPaths>\n\t\t\t\t\t\t<path>\n\t\t\t\t\t\t\t<groupId>org.projectlombok</groupId>\n\t\t\t\t\t\t\t<artifactId>lombok</artifactId>\n\t\t\t\t\t\t</path>\n\t\t\t\t\t</annotationProcessorPaths>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t\t<artifactId>spring-boot-maven-plugin</artifactId>\n\t\t\t\t<configuration>\n\t\t\t\t\t<excludes>\n\t\t\t\t\t\t<exclude>\n\t\t\t\t\t\t\t<groupId>org.projectlombok</groupId>\n\t\t\t\t\t\t\t<artifactId>lombok</artifactId>\n\t\t\t\t\t\t</exclude>\n\t\t\t\t\t</excludes>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n\t\t</plugins>\n\t</build>\n\n</project>\n","baseTimestamp":1761593895965},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/config/WebSecurityConfig.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/config/WebSecurityConfig.java","baseContent":"package com.capstone.tele_ticketing_backend_1.security.config;\n\n\nimport com.capstone.tele_ticketing_backend_1.security.jwt.AuthEntryPointJwt;\nimport com.capstone.tele_ticketing_backend_1.security.jwt.AuthTokenFilter;\nimport com.capstone.tele_ticketing_backend_1.security.service.UserDetailsServiceImpl;\nimport com.prodapt.springsecurityusingjwtexample.security.jwt.AuthEntryPointJwt;\nimport com.prodapt.springsecurityusingjwtexample.security.jwt.AuthTokenFilter;\nimport com.prodapt.springsecurityusingjwtexample.security.service.UserDetailsServiceImpl;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.authentication.AuthenticationManager;\nimport org.springframework.security.authentication.dao.DaoAuthenticationProvider;\nimport org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;\nimport org.springframework.security.config.http.SessionCreationPolicy;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.security.web.SecurityFilterChain;\nimport org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;\n\n@Configuration\n@EnableWebSecurity \npublic class WebSecurityConfig { \n\t@Autowired\n\tprivate UserDetailsServiceImpl userDetailsService;\n\n\t@Autowired\n\tprivate AuthEntryPointJwt unauthorizedHandler;\n\n\t@Bean\n\tpublic AuthTokenFilter authenticationJwtTokenFilter() {\n\t\treturn new AuthTokenFilter();\n\t}\n\n\n\n\t@Bean\n\tpublic DaoAuthenticationProvider authenticationProvider() {\n\t\tDaoAuthenticationProvider authProvider = new DaoAuthenticationProvider();\n\n\t\tauthProvider.setUserDetailsService(userDetailsService);\n\t\tauthProvider.setPasswordEncoder(passwordEncoder());\n\n\t\treturn authProvider;\n\t}\n\n\t@Bean\n\tpublic AuthenticationManager authenticationManager(AuthenticationConfiguration authConfig) throws Exception {\n\t\treturn authConfig.getAuthenticationManager();\n\t}\n\n\t@Bean\n\tpublic PasswordEncoder passwordEncoder() {\n\t\treturn new BCryptPasswordEncoder();\n\t}\n\n\tpublic final static String[] PUBLIC_REQUEST_MATCHERS = { \"/api/test/all\",\"/api/auth/**\", \"/api-docs/**\", \"/swagger-ui/**\",\"/v3/api-docs/**\" };\n\n\t@Bean\n\tpublic SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n\t\t//http.cors(AbstractHttpConfigurer :: disable).csrf(AbstractHttpConfigurer::disable)\n\t\thttp.csrf(AbstractHttpConfigurer::disable)\n\t\t\t\t.authorizeHttpRequests(req -> req.requestMatchers(PUBLIC_REQUEST_MATCHERS).permitAll()\n\t\t\t\t\t\t//.requestMatchers(\"/api/toyandbooklibapp/**\").permitAll())\n\t\t\t\t\t\t.requestMatchers(\"/api/toyandbooklibapp/user\").hasAnyRole(\"USER\", \"ADMIN\")\n\t\t\t\t\t\t.requestMatchers(\"/api/toyandbooklibapp/child\").hasAnyRole(\"USER\",\"CHILD\")\n\t\t\t\t\t\t.requestMatchers(\"/api/toyandbooklibapp/parent\").hasRole(\"PARENT\")\n\t\t\t\t\t\t.requestMatchers(\"/api/test/user\").hasRole(\"USER\")\n\t\t\t\t\t\t.requestMatchers(\"/api/test/parent\").hasRole(\"PARENT\")\n\t\t\t\t\t\t.requestMatchers(\"/api/test/admin\").hasRole(\"ADMIN\")\n\t\t\t\t\t\t)\n\t\t\t\t\n\t\t\t\t\t\t//.anyRequest().authenticated())http://localhost:8080/api/test/\n\t\t\t\t.exceptionHandling(exception -> exception.authenticationEntryPoint(unauthorizedHandler))\n\t\t\t\t.sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))\n\t\t\t\t.authenticationProvider(authenticationProvider())\n\t\t\t\t.addFilterBefore(authenticationJwtTokenFilter(), UsernamePasswordAuthenticationFilter.class);\n\t\treturn http.build();\n\t}\n}","baseTimestamp":1761593928788,"deltas":[{"timestamp":1761593933981,"changes":[{"type":"DELETE","lineNumber":6,"oldContent":"import com.prodapt.springsecurityusingjwtexample.security.jwt.AuthEntryPointJwt;"},{"type":"DELETE","lineNumber":7,"oldContent":"import com.prodapt.springsecurityusingjwtexample.security.jwt.AuthTokenFilter;"},{"type":"DELETE","lineNumber":8,"oldContent":"import com.prodapt.springsecurityusingjwtexample.security.service.UserDetailsServiceImpl;"}]},{"timestamp":1761628267854,"changes":[{"type":"DELETE","lineNumber":3,"oldContent":"import com.capstone.tele_ticketing_backend_1.security.jwt.AuthEntryPointJwt;"},{"type":"MODIFY","lineNumber":4,"content":"import com.prodapt.springsecurityusingjwtexample.security.jwt.AuthEntryPointJwt;","oldContent":"import com.capstone.tele_ticketing_backend_1.security.jwt.AuthTokenFilter;"},{"type":"INSERT","lineNumber":5,"content":"import com.prodapt.springsecurityusingjwtexample.security.jwt.AuthTokenFilter;"},{"type":"INSERT","lineNumber":6,"content":"import com.prodapt.springsecurityusingjwtexample.security.service.UserDetailsServiceImpl;"}]},{"timestamp":1761628271026,"changes":[{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.security.jwt.AuthEntryPointJwt;"},{"type":"INSERT","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.security.service.UserDetailsServiceImpl;"},{"type":"DELETE","lineNumber":5,"oldContent":"import com.capstone.tele_ticketing_backend_1.security.service.UserDetailsServiceImpl;"}]},{"timestamp":1761628279333,"changes":[{"type":"MODIFY","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.security.jwt.AuthTokenFilter;","oldContent":"import com.prodapt.springsecurityusingjwtexample.security.jwt.AuthEntryPointJwt;"},{"type":"INSERT","lineNumber":6,"content":"import com.prodapt.springsecurityusingjwtexample.security.jwt.AuthEntryPointJwt;"}]},{"timestamp":1761628285893,"changes":[{"type":"DELETE","lineNumber":6,"oldContent":"import com.prodapt.springsecurityusingjwtexample.security.jwt.AuthEntryPointJwt;"},{"type":"DELETE","lineNumber":7,"oldContent":"import com.prodapt.springsecurityusingjwtexample.security.jwt.AuthTokenFilter;"},{"type":"DELETE","lineNumber":8,"oldContent":"import com.prodapt.springsecurityusingjwtexample.security.service.UserDetailsServiceImpl;"}]},{"timestamp":1761645984075,"changes":[{"type":"INSERT","lineNumber":68,"content":"\t\t\t\t\t\t\t\t.requestMatchers(\"/greet\")"}]},{"timestamp":1761645993434,"changes":[{"type":"MODIFY","lineNumber":68,"content":"\t\t\t\t\t\t\t\t.requestMatchers(\"/greet\").hasRole(\"\")","oldContent":"\t\t\t\t\t\t\t\t.requestMatchers(\"/greet\")"}]},{"timestamp":1761646001256,"changes":[{"type":"MODIFY","lineNumber":68,"content":"\t\t\t\t\t\t\t\t.requestMatchers(\"/greet\").hasRole(\"CUSTOMER\")","oldContent":"\t\t\t\t\t\t\t\t.requestMatchers(\"/greet\").hasRole(\"\")"}]},{"timestamp":1761646005789,"changes":[{"type":"DELETE","lineNumber":67,"oldContent":"\t\t\t\t\t\t.requestMatchers(\"/api/toyandbooklibapp/parent\").hasRole(\"PARENT\")"},{"type":"MODIFY","lineNumber":67,"content":"\t\t\t\t\t\t.requestMatchers(\"/api/toyandbooklibapp/parent\").hasRole(\"PARENT\").requestMatchers(\"/greet\").hasRole(\"CUSTOMER\")","oldContent":"\t\t\t\t\t\t\t\t.requestMatchers(\"/greet\").hasRole(\"CUSTOMER\")"}]},{"timestamp":1761646007926,"changes":[{"type":"MODIFY","lineNumber":67,"content":"\t\t\t\t\t\t.requestMatchers(\"/api/toyandbooklibapp/parent\").hasRole(\"PARENT\")","oldContent":"\t\t\t\t\t\t.requestMatchers(\"/api/toyandbooklibapp/parent\").hasRole(\"PARENT\").requestMatchers(\"/greet\").hasRole(\"CUSTOMER\")"},{"type":"INSERT","lineNumber":68,"content":"\t\t\t\t\t\t\t\t.requestMatchers(\"/greet\").hasRole(\"CUSTOMER\")"}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/AuthController.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/AuthController.java","baseContent":"package com.capstone.tele_ticketing_backend_1.controller;\n\n\nimport com.prodapt.springsecurityusingjwtexample.entities.ERole;\nimport com.prodapt.springsecurityusingjwtexample.entities.Role;\nimport com.prodapt.springsecurityusingjwtexample.entities.UserEntity;\nimport com.prodapt.springsecurityusingjwtexample.repositories.RoleRepository;\nimport com.prodapt.springsecurityusingjwtexample.repositories.UserRepository;\nimport com.prodapt.springsecurityusingjwtexample.security.jwt.JwtUtils;\nimport com.prodapt.springsecurityusingjwtexample.security.payload.request.LoginRequest;\nimport com.prodapt.springsecurityusingjwtexample.security.payload.request.SignupRequest;\nimport com.prodapt.springsecurityusingjwtexample.security.payload.response.JwtResponse;\nimport com.prodapt.springsecurityusingjwtexample.security.payload.response.MessageResponse;\nimport com.prodapt.springsecurityusingjwtexample.security.service.UserDetailsImpl;\nimport jakarta.validation.Valid;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.security.authentication.AuthenticationManager;\nimport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.web.bind.annotation.*;\n\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Set;\nimport java.util.stream.Collectors;\n\n\n@CrossOrigin(origins = \"*\", maxAge = 3600)\n@RestController\n@RequestMapping(\"/api/auth\")\npublic class AuthController {\n\t@Autowired\n\tAuthenticationManager authenticationManager;\n\n\t@Autowired\n\tUserRepository userRepository;\n\n\t@Autowired\n\tRoleRepository roleRepository;\n\n\t@Autowired\n\tPasswordEncoder encoder;\n\n\t@Autowired\n\tJwtUtils jwtUtils;\n\n\t@PostMapping(\"/signin\")\n\tpublic ResponseEntity<?> authenticateUser(@Valid @RequestBody LoginRequest loginRequest) {\n\n\t\tAuthentication authentication = authenticationManager.authenticate(\n\t\t\t\tnew UsernamePasswordAuthenticationToken(loginRequest.getUsername(), \n\t\t\t\t\t\tloginRequest.getPassword()));\n\n\t\tSecurityContextHolder.getContext().setAuthentication(authentication);\n\t\tString jwt = jwtUtils.generateJwtToken(authentication);\n\t\t\n\t\tUserDetailsImpl userDetails = (UserDetailsImpl) authentication.getPrincipal();\t\t\n\t\tList<String> roles = userDetails.getAuthorities().stream()\n\t\t\t\t.map(item -> item.getAuthority())\n\t\t\t\t.collect(Collectors.toList());\n\n\t\treturn ResponseEntity.ok(new JwtResponse(jwt, \n\t\t\t\t\t\t\t\t\t\t\t\t userDetails.getId(), \n\t\t\t\t\t\t\t\t\t\t\t\t userDetails.getUsername(), \n\t\t\t\t\t\t\t\t\t\t\t\t userDetails.getEmail(), \n\t\t\t\t\t\t\t\t\t\t\t\t roles));\n\t}\n\n\t@PostMapping(\"/signup\")\n\tpublic ResponseEntity<?> registerUser(@Valid @RequestBody SignupRequest signUpRequest) {\n\t\tif (userRepository.existsByUsername(signUpRequest.getUsername())) {\n\t\t\treturn ResponseEntity\n\t\t\t\t\t.badRequest()\n\t\t\t\t\t.body(new MessageResponse(\"Error: Username is already taken!\"));\n\t\t}\n\n\t\tif (userRepository.existsByEmail(signUpRequest.getEmail())) {\n\t\t\treturn ResponseEntity\n\t\t\t\t\t.badRequest()\n\t\t\t\t\t.body(new MessageResponse(\"Error: Email is already in use!\"));\n\t\t}\n\n\t\t// Create new user's account\n\t\tUserEntity user = new UserEntity(signUpRequest.getUsername(), \n\t\t\t\t\t\t\t signUpRequest.getEmail(),\n\t\t\t\t\t\t\t encoder.encode(signUpRequest.getPassword()));\n\n\t\tSet<String> strRoles = signUpRequest.getRole();\n\t\tSet<Role> roles = new HashSet<>();\n\n\t\tif (strRoles == null) {\n\t\t\tRole userRole = roleRepository.findByName(ERole.ROLE_USER)\n\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role is not found.\"));\n\t\t\troles.add(userRole);\n\t\t} else {\n\t\t\tstrRoles.forEach(role -> {\n\t\t\t\tswitch (role) {\n\t\t\t\tcase \"admin\":\n\t\t\t\t\tRole adminRole = roleRepository.findByName(ERole.ROLE_ADMIN)\n\t\t\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role is not found.\"));\n\t\t\t\t\troles.add(adminRole);\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"child\":\n\t\t\t\t\tRole childRole = roleRepository.findByName(ERole.ROLE_CHILD)\n\t\t\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role is not found.\"));\n\t\t\t\t\troles.add(childRole);\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"parent\":\n\t\t\t\t\tRole parentRole = roleRepository.findByName(ERole.ROLE_PARENT)\n\t\t\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role is not found.\"));\n\t\t\t\t\troles.add(parentRole);\n\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tRole userRole = roleRepository.findByName(ERole.ROLE_USER)\n\t\t\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role is not found.\"));\n\t\t\t\t\troles.add(userRole);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tuser.setRoles(roles);\n\t\tuser.setAddress(signUpRequest.getAddress());\n\t\tuser.setEmail(signUpRequest.getEmail());\n\t\tuser.setMobile(signUpRequest.getMobile());\n\t\tuser.setGender(signUpRequest.getGender());\n\t\t//saving UserEntity to the database \n\t\tuserRepository.save(user);\n\n\t\treturn ResponseEntity.ok(new MessageResponse(\"User registered successfully!\"));\n\t}\n}","baseTimestamp":1761595369612,"deltas":[{"timestamp":1761678954831,"changes":[{"type":"MODIFY","lineNumber":14,"content":"import com.capstone.tele_ticketing_backend_1.security.payload.request.LoginRequest;","oldContent":"import jakarta.validation.Valid;"},{"type":"MODIFY","lineNumber":28,"content":"import org.springframework.web.bind.annotation.RequestBody;","oldContent":""},{"type":"MODIFY","lineNumber":37,"content":"@RequestMapping(\"/api/auth\")","oldContent":"\t@Autowired"},{"type":"MODIFY","lineNumber":39,"content":"\t@Autowired","oldContent":""},{"type":"INSERT","lineNumber":41,"content":""},{"type":"DELETE","lineNumber":42,"oldContent":"\t@Autowired"},{"type":"MODIFY","lineNumber":43,"content":"\tUserRepo userRepository;","oldContent":"\t@Autowired"},{"type":"MODIFY","lineNumber":45,"content":"\t@Autowired","oldContent":""},{"type":"INSERT","lineNumber":47,"content":""},{"type":"DELETE","lineNumber":48,"oldContent":"\t@Autowired"},{"type":"MODIFY","lineNumber":67,"content":"\t\t\t\t.collect(Collectors.toList());","oldContent":"\t\t\t\t\t\t\t\t\t\t\t\t userDetails.getUsername(), "},{"type":"DELETE","lineNumber":71,"oldContent":"\t}"},{"type":"MODIFY","lineNumber":71,"content":"\t\t\t\tuserDetails.getId(),","oldContent":"\t\t\t\tuserDetails.getUsername(), "},{"type":"INSERT","lineNumber":72,"content":"\t\t\t\tuserDetails.getUsername(),"},{"type":"INSERT","lineNumber":77,"content":"\t@PostMapping(\"/signup\")"},{"type":"INSERT","lineNumber":78,"content":"\tpublic ResponseEntity<?> registerUser(@Valid @RequestBody SignupRequest signUpRequest) {"},{"type":"DELETE","lineNumber":79,"oldContent":"\t\t\t\t\t.body(new MessageResponse(\"Error: Username is already taken!\"));"},{"type":"DELETE","lineNumber":80,"oldContent":"\t\t\treturn ResponseEntity"},{"type":"INSERT","lineNumber":82,"content":"\t\t\t\t\t.body(new MessageResponse(\"Error: Username is already taken!\"));"},{"type":"DELETE","lineNumber":83,"oldContent":"\t\t}"},{"type":"MODIFY","lineNumber":85,"content":"\t\t// Create new user's account","oldContent":"\t\t\t\t\t.badRequest()"},{"type":"INSERT","lineNumber":141,"content":"\t\t\t\t}"},{"type":"DELETE","lineNumber":142,"oldContent":"\t\t\t\tcase \"cxo\": {"},{"type":"DELETE","lineNumber":167,"oldContent":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":168,"oldContent":"\t\t\t\tcase \"noc_admin\": {"},{"type":"DELETE","lineNumber":169,"oldContent":"\t\t\t\t}"}]},{"timestamp":1761679001539,"changes":[{"type":"MODIFY","lineNumber":12,"content":"import com.capstone.tele_ticketing_backend_1.repo.UserRepo;","oldContent":"import com.prodapt.springsecurityusingjwtexample.security.payload.response.MessageResponse;"},{"type":"MODIFY","lineNumber":18,"content":"import com.capstone.tele_ticketing_backend_1.security.service.UserDetailsImpl;","oldContent":"import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;"},{"type":"MODIFY","lineNumber":26,"content":"import org.springframework.web.bind.annotation.CrossOrigin;","oldContent":"import java.util.Set;"},{"type":"MODIFY","lineNumber":32,"content":"import jakarta.validation.Valid;","oldContent":"@RequestMapping(\"/api/auth\")"},{"type":"MODIFY","lineNumber":34,"content":"","oldContent":"\t@Autowired"},{"type":"MODIFY","lineNumber":68,"content":"\t\tString firstAuthority = authorities.stream()","oldContent":"\t\tString role = userDetails.getAuthorities();"},{"type":"INSERT","lineNumber":69,"content":"\t\t\t\t.findFirst()"},{"type":"INSERT","lineNumber":70,"content":"\t\t\t\t.map(GrantedAuthority::getAuthority)"},{"type":"INSERT","lineNumber":71,"content":"\t\t\t\t.orElse(null);"},{"type":"DELETE","lineNumber":72,"oldContent":"\t\t\t\tuserDetails.getUsername(), "},{"type":"INSERT","lineNumber":75,"content":"\t\t\t\tuserDetails.getUsername(),"},{"type":"DELETE","lineNumber":75,"oldContent":"\tpublic ResponseEntity<?> registerUser(@Valid @RequestBody SignupRequest signUpRequest) {"},{"type":"INSERT","lineNumber":78,"content":"\t}"},{"type":"DELETE","lineNumber":78,"oldContent":"\t\t\treturn ResponseEntity"},{"type":"INSERT","lineNumber":82,"content":"\t\tif (userRepository.existsByUsername(signUpRequest.getUsername())) {"},{"type":"INSERT","lineNumber":83,"content":"\t\t\treturn ResponseEntity"},{"type":"DELETE","lineNumber":81,"oldContent":"\t\t\t\t\t.badRequest()"},{"type":"DELETE","lineNumber":90,"oldContent":"\t\t\t\t\t\t\t signUpRequest.getEmail(),"},{"type":"INSERT","lineNumber":93,"content":"\t\tSet<Role> roles = new HashSet<>();"},{"type":"DELETE","lineNumber":167,"oldContent":"\t\t\t\tcase \"noc_admin\": {"}]},{"timestamp":1761679009677,"changes":[{"type":"MODIFY","lineNumber":16,"content":"import com.capstone.tele_ticketing_backend_1.security.payload.response.JwtResponse;","oldContent":"import org.springframework.http.ResponseEntity;"},{"type":"MODIFY","lineNumber":66,"content":"\t\t\t\t.map(item -> item.getAuthority())","oldContent":"\t\t\t\t\t\t\t\t\t\t\t\t userDetails.getUsername(), "},{"type":"MODIFY","lineNumber":68,"content":"\t\tString firstAuthority = userDetails.getAuthorities().stream()","oldContent":"\t\tString firstAuthority = authorities.stream()"},{"type":"DELETE","lineNumber":70,"oldContent":""},{"type":"MODIFY","lineNumber":72,"content":"","oldContent":"\t}"},{"type":"INSERT","lineNumber":73,"content":"\t\treturn ResponseEntity.ok(new JwtResponse(jwt,"},{"type":"INSERT","lineNumber":75,"content":"\t\t\t\tuserDetails.getUsername(),"},{"type":"DELETE","lineNumber":77,"oldContent":"\t\t\t\tuserDetails.getUsername(),"},{"type":"INSERT","lineNumber":78,"content":"\t}"},{"type":"DELETE","lineNumber":80,"oldContent":"\t}"},{"type":"DELETE","lineNumber":82,"oldContent":"\t\t\t\t\t.badRequest()"},{"type":"MODIFY","lineNumber":84,"content":"\t\t\t\t\t.badRequest()","oldContent":"\t\t\t\t\t.body(new MessageResponse(\"Error: Username is already taken!\"));"},{"type":"INSERT","lineNumber":85,"content":"\t\t\t\t\t.body(new MessageResponse(\"Error: Username is already taken!\"));"},{"type":"INSERT","lineNumber":86,"content":"\t\t}"},{"type":"DELETE","lineNumber":87,"oldContent":""},{"type":"MODIFY","lineNumber":91,"content":"","oldContent":"\t\t// Create new user's account"},{"type":"DELETE","lineNumber":93,"oldContent":"\t\t\t\t\t\t\t encoder.encode(signUpRequest.getPassword()));"},{"type":"MODIFY","lineNumber":94,"content":"","oldContent":"\t\tstrRoles.forEach(role -> {"},{"type":"INSERT","lineNumber":95,"content":"\t\tstrRoles.forEach(role -> {"}]},{"timestamp":1761679016472,"changes":[{"type":"INSERT","lineNumber":24,"content":"import org.springframework.security.core.GrantedAuthority;"},{"type":"INSERT","lineNumber":72,"content":"\t\t\t\t.orElse(null);"},{"type":"DELETE","lineNumber":73,"oldContent":"\t\t\t\t.orElse(null);"},{"type":"INSERT","lineNumber":84,"content":"\t\t\treturn ResponseEntity"},{"type":"DELETE","lineNumber":85,"oldContent":"\t\t\treturn ResponseEntity"},{"type":"INSERT","lineNumber":94,"content":"\t\tSet<Role> roles = new HashSet<>();"},{"type":"DELETE","lineNumber":95,"oldContent":"\t\tSet<Role> roles = new HashSet<>();"}]},{"timestamp":1761679025699,"changes":[{"type":"MODIFY","lineNumber":73,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":77,"content":"\t\t\t\tfirstAuthority","oldContent":"\t\t\t\tuserDetails.getAuthorities().stream().findFirst();"},{"type":"MODIFY","lineNumber":85,"content":"\t\t\t\t\t.badRequest()","oldContent":"\t\t\t\t\t.badRequest()"},{"type":"INSERT","lineNumber":91,"content":"\t\t\t\tencoder.encode(signUpRequest.getPassword()), signUpRequest.getFullname());"},{"type":"DELETE","lineNumber":92,"oldContent":""},{"type":"MODIFY","lineNumber":95,"content":"","oldContent":""}]},{"timestamp":1761679388988,"changes":[{"type":"MODIFY","lineNumber":60,"content":"\t\t\t\t\t\tloginRequest.getPassword()));","oldContent":"\t\tUserDetailsImpl userDetails = (UserDetailsImpl) authentication.getPrincipal();\t\t"},{"type":"DELETE","lineNumber":62,"oldContent":"\t\t\t\t.map(item -> item.getAuthority())"},{"type":"DELETE","lineNumber":63,"oldContent":"\t\t\t\t.collect(Collectors.toList());"},{"type":"INSERT","lineNumber":62,"content":"\t\tSecurityContextHolder.getContext().setAuthentication(authentication);"},{"type":"INSERT","lineNumber":63,"content":"\t\tString jwt = jwtUtils.generateJwtToken(authentication);"},{"type":"INSERT","lineNumber":72,"content":"\t\t\t\t.orElse(null);"},{"type":"DELETE","lineNumber":73,"oldContent":""},{"type":"INSERT","lineNumber":84,"content":"\t\t\treturn ResponseEntity"},{"type":"DELETE","lineNumber":85,"oldContent":"\t\t\t\t\t.badRequest()"},{"type":"INSERT","lineNumber":94,"content":"\t\tSet<Role> roles = new HashSet<>();"},{"type":"DELETE","lineNumber":95,"oldContent":""},{"type":"INSERT","lineNumber":170,"content":""},{"type":"INSERT","lineNumber":171,"content":"\tprivate String mapRoleToFrontend(String backendRole) {"},{"type":"INSERT","lineNumber":172,"content":"\t\tswitch (backendRole) {"},{"type":"INSERT","lineNumber":173,"content":"\t\t\tcase \"ROLE_CUSTOMER\": return \"Customer\";"},{"type":"INSERT","lineNumber":174,"content":"\t\t\tcase \"ROLE_AGENT\": return \"Agent\";"},{"type":"INSERT","lineNumber":175,"content":"\t\t\tcase \"ROLE_TRIAGE_OFFICER\": return \"Triage Officer\";"},{"type":"INSERT","lineNumber":176,"content":"\t\t\tcase \"ROLE_FIELD_ENGINEER\": return \"Field Engineer\";"},{"type":"INSERT","lineNumber":177,"content":"\t\t\tcase \"ROLE_NOC_ENGINEER\": return \"NOC Engineer\";"},{"type":"INSERT","lineNumber":178,"content":"\t\t\tcase \"ROLE_L1_ENGINEER\": return \"L1 Engineer\";"},{"type":"INSERT","lineNumber":179,"content":"\t\t\tcase \"ROLE_TEAM_LEAD\": return \"Team Lead\";"},{"type":"INSERT","lineNumber":180,"content":"\t\t\tcase \"ROLE_MANAGER\": return \"Manager\";"},{"type":"INSERT","lineNumber":181,"content":"\t\t\tcase \"ROLE_CXO\": return \"CXO\";"},{"type":"INSERT","lineNumber":182,"content":"\t\t\tcase \"ROLE_NOC_ADMIN\": return \"NOC Admin\";"},{"type":"INSERT","lineNumber":183,"content":"\t\t\tdefault: return backendRole; // fallback if unknown"},{"type":"INSERT","lineNumber":184,"content":"\t\t}"},{"type":"INSERT","lineNumber":185,"content":"\t}"},{"type":"INSERT","lineNumber":186,"content":""}]},{"timestamp":1761679411577,"changes":[{"type":"MODIFY","lineNumber":15,"content":"import com.capstone.tele_ticketing_backend_1.security.payload.request.SignupRequest;","oldContent":"import org.springframework.beans.factory.annotation.Autowired;"},{"type":"MODIFY","lineNumber":50,"content":"\tPasswordEncoder encoder;","oldContent":"\t@PostMapping(\"/signin\")"},{"type":"MODIFY","lineNumber":53,"content":"\tJwtUtils jwtUtils;","oldContent":"\t\tAuthentication authentication = authenticationManager.authenticate("},{"type":"INSERT","lineNumber":72,"content":"\t\t\t\t.map(this::mapRoleToFrontend)"},{"type":"INSERT","lineNumber":75,"content":""},{"type":"DELETE","lineNumber":171,"oldContent":"}"},{"type":"DELETE","lineNumber":173,"oldContent":""},{"type":"DELETE","lineNumber":175,"oldContent":"\t}"},{"type":"DELETE","lineNumber":177,"oldContent":"\t\t}"},{"type":"DELETE","lineNumber":179,"oldContent":"\t\t\tdefault: return backendRole; // fallback if unknown"},{"type":"DELETE","lineNumber":181,"oldContent":"\t\t\tcase \"ROLE_NOC_ADMIN\": return \"NOC Admin\";"},{"type":"DELETE","lineNumber":183,"oldContent":"\t\t\tcase \"ROLE_CXO\": return \"CXO\";"},{"type":"DELETE","lineNumber":185,"oldContent":"\t\t\tcase \"ROLE_MANAGER\": return \"Manager\";"},{"type":"INSERT","lineNumber":182,"content":"\t\t\tcase \"ROLE_MANAGER\": return \"Manager\";"},{"type":"INSERT","lineNumber":183,"content":"\t\t\tcase \"ROLE_CXO\": return \"CXO\";"},{"type":"INSERT","lineNumber":184,"content":"\t\t\tcase \"ROLE_NOC_ADMIN\": return \"NOC Admin\";"},{"type":"INSERT","lineNumber":185,"content":"\t\t\tdefault: return backendRole; // fallback if unknown"},{"type":"INSERT","lineNumber":186,"content":"\t\t}"},{"type":"INSERT","lineNumber":187,"content":"\t}"},{"type":"INSERT","lineNumber":188,"content":""},{"type":"INSERT","lineNumber":189,"content":"}"}]},{"timestamp":1761679495405,"changes":[{"type":"MODIFY","lineNumber":17,"content":"import com.capstone.tele_ticketing_backend_1.security.payload.response.MessageResponse;","oldContent":"import org.springframework.security.authentication.AuthenticationManager;"},{"type":"MODIFY","lineNumber":22,"content":"import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;","oldContent":"import org.springframework.web.bind.annotation.*;"},{"type":"MODIFY","lineNumber":52,"content":"\t@Autowired","oldContent":""},{"type":"MODIFY","lineNumber":55,"content":"\t@PostMapping(\"/signin\")","oldContent":"\t\t\t\t\t\tloginRequest.getPassword()));"},{"type":"MODIFY","lineNumber":76,"content":"\t\treturn ResponseEntity.ok(new JwtResponse(jwt,","oldContent":"\t\treturn ResponseEntity.ok(new JwtResponse(jwt,"},{"type":"MODIFY","lineNumber":175,"content":"\t\t\tcase \"ROLE_CUSTOMER\": return \"CUSTOMER\";","oldContent":"\t\t\tcase \"ROLE_CUSTOMER\": return \"Customer\";"},{"type":"MODIFY","lineNumber":179,"content":"\t\t\tcase \"ROLE_NOC_ENGINEER\": return \"NOC Engineer\";","oldContent":"\t\t\tcase \"ROLE_MANAGER\": return \"Manager\";"},{"type":"INSERT","lineNumber":180,"content":"\t\t\tcase \"ROLE_L1_ENGINEER\": return \"L1 Engineer\";"},{"type":"INSERT","lineNumber":181,"content":"\t\t\tcase \"ROLE_TEAM_LEAD\": return \"Team Lead\";"},{"type":"INSERT","lineNumber":182,"content":"\t\t\tcase \"ROLE_MANAGER\": return \"Manager\";"},{"type":"DELETE","lineNumber":182,"oldContent":"\t\t\tcase \"ROLE_NOC_ENGINEER\": return \"NOC Engineer\";"},{"type":"DELETE","lineNumber":185,"oldContent":"\t\t\tcase \"ROLE_L1_ENGINEER\": return \"L1 Engineer\";"},{"type":"DELETE","lineNumber":187,"oldContent":"\t\t\tcase \"ROLE_TEAM_LEAD\": return \"Team Lead\";"}]},{"timestamp":1761679538220,"changes":[{"type":"INSERT","lineNumber":75,"content":""},{"type":"DELETE","lineNumber":76,"oldContent":"\t\treturn ResponseEntity.ok(new JwtResponse(jwt,"},{"type":"MODIFY","lineNumber":176,"content":"\t\t\tcase \"ROLE_AGENT\": return \"AGENT\";","oldContent":"\t\t\tcase \"ROLE_AGENT\": return \"Agent\";"},{"type":"MODIFY","lineNumber":178,"content":"\t\t\tcase \"ROLE_FIELD_ENGINEER\": return \"Field Engineer\";","oldContent":"\t\t\tcase \"ROLE_MANAGER\": return \"Manager\";"},{"type":"DELETE","lineNumber":181,"oldContent":"\t\t\tcase \"ROLE_CXO\": return \"CXO\";"},{"type":"MODIFY","lineNumber":183,"content":"\t\t\tcase \"ROLE_CXO\": return \"CXO\";","oldContent":"\t\t\tcase \"ROLE_NOC_ADMIN\": return \"NOC Admin\";"},{"type":"INSERT","lineNumber":184,"content":"\t\t\tcase \"ROLE_NOC_ADMIN\": return \"NOC Admin\";"}]},{"timestamp":1761679547084,"changes":[{"type":"MODIFY","lineNumber":51,"content":"","oldContent":"\tpublic ResponseEntity<?> authenticateUser(@Valid @RequestBody LoginRequest loginRequest) {"},{"type":"INSERT","lineNumber":56,"content":"\tpublic ResponseEntity<?> authenticateUser(@Valid @RequestBody LoginRequest loginRequest) {"},{"type":"DELETE","lineNumber":57,"oldContent":""},{"type":"MODIFY","lineNumber":177,"content":"\t\t\tcase \"ROLE_TRIAGE_OFFICER\": return \"TRIAGE_OFFICER\";","oldContent":"\t\t\tcase \"ROLE_TRIAGE_OFFICER\": return \"Triage Officer\";"},{"type":"INSERT","lineNumber":182,"content":"\t\t\tcase \"ROLE_MANAGER\": return \"Manager\";"},{"type":"DELETE","lineNumber":184,"oldContent":"\t\t\tcase \"ROLE_MANAGER\": return \"Manager\";"}]},{"timestamp":1761679552558,"changes":[{"type":"MODIFY","lineNumber":178,"content":"\t\t\tcase \"ROLE_FIELD_ENGINEER\": return \"FIELD_ENGINEER\";","oldContent":"\t\t\tcase \"ROLE_FIELD_ENGINEER\": return \"Field Engineer\";"},{"type":"DELETE","lineNumber":189,"oldContent":"\t\t\tcase \"ROLE_TEAM_LEAD\": return \"Team Lead\";"},{"type":"DELETE","lineNumber":191,"oldContent":"\t\t\tcase \"ROLE_CXO\": return \"CXO\";"},{"type":"DELETE","lineNumber":192,"oldContent":"\t\t\tcase \"ROLE_MANAGER\": return \"Manager\";"}]},{"timestamp":1761679562953,"changes":[{"type":"MODIFY","lineNumber":8,"content":"import com.capstone.tele_ticketing_backend_1.entities.AppUser;","oldContent":"import com.prodapt.springsecurityusingjwtexample.security.jwt.JwtUtils;"},{"type":"MODIFY","lineNumber":23,"content":"import org.springframework.security.core.Authentication;","oldContent":""},{"type":"DELETE","lineNumber":58,"oldContent":"\t\tSecurityContextHolder.getContext().setAuthentication(authentication);"},{"type":"MODIFY","lineNumber":58,"content":"\t\tAuthentication authentication = authenticationManager.authenticate(","oldContent":"\t\tString jwt = jwtUtils.generateJwtToken(authentication);"},{"type":"INSERT","lineNumber":59,"content":"\t\t\t\tnew UsernamePasswordAuthenticationToken(loginRequest.getUsername(),"},{"type":"DELETE","lineNumber":99,"oldContent":"\t\tSet<String> strRoles = signUpRequest.getRole();"},{"type":"DELETE","lineNumber":100,"oldContent":"\t\tSet<Role> roles = new HashSet<>();"},{"type":"DELETE","lineNumber":101,"oldContent":""},{"type":"DELETE","lineNumber":102,"oldContent":"\t\tif (strRoles == null) {"},{"type":"DELETE","lineNumber":103,"oldContent":"\t\t\tRole userRole = roleRepository.findByName(ERole.ROLE_USER)"},{"type":"DELETE","lineNumber":104,"oldContent":"\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role is not found.\"));"},{"type":"INSERT","lineNumber":99,"content":"\t\t\tswitch (role) {"},{"type":"INSERT","lineNumber":100,"content":"\t\t\t\tcase \"customer\": {"},{"type":"INSERT","lineNumber":101,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_CUSTOMER)"},{"type":"INSERT","lineNumber":102,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role 'CUSTOMER' is not found.\"));"},{"type":"INSERT","lineNumber":103,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":104,"content":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":107,"oldContent":"\t\t} else {"},{"type":"DELETE","lineNumber":108,"oldContent":"\t\t\tstrRoles.forEach(role -> {"},{"type":"DELETE","lineNumber":109,"oldContent":"\t\t\t\tswitch (role) {"},{"type":"DELETE","lineNumber":110,"oldContent":"\t\t\t\tcase \"admin\":"},{"type":"DELETE","lineNumber":111,"oldContent":"\t\t\t\t\tRole adminRole = roleRepository.findByName(ERole.ROLE_ADMIN)"},{"type":"DELETE","lineNumber":112,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role is not found.\"));"},{"type":"DELETE","lineNumber":113,"oldContent":"\t\t\t\t\troles.add(adminRole);"},{"type":"DELETE","lineNumber":114,"oldContent":""},{"type":"INSERT","lineNumber":107,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_AGENT)"},{"type":"INSERT","lineNumber":108,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role 'AGENT' is not found.\"));"},{"type":"INSERT","lineNumber":109,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"DELETE","lineNumber":116,"oldContent":"\t\t\t\tcase \"child\":"},{"type":"DELETE","lineNumber":117,"oldContent":"\t\t\t\t\tRole childRole = roleRepository.findByName(ERole.ROLE_CHILD)"},{"type":"DELETE","lineNumber":118,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role is not found.\"));"},{"type":"DELETE","lineNumber":119,"oldContent":"\t\t\t\t\troles.add(childRole);"},{"type":"INSERT","lineNumber":111,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":112,"content":"\t\t\t\tcase \"triage_officer\": {"},{"type":"INSERT","lineNumber":113,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_TRIAGE_OFFICER)"},{"type":"INSERT","lineNumber":114,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role 'TRIAGE_OFFICER' is not found.\"));"},{"type":"INSERT","lineNumber":115,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"DELETE","lineNumber":121,"oldContent":"\t\t\t\tcase \"parent\":"},{"type":"DELETE","lineNumber":122,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role is not found.\"));"},{"type":"DELETE","lineNumber":123,"oldContent":""},{"type":"DELETE","lineNumber":124,"oldContent":"\t\t\t\tdefault:"},{"type":"DELETE","lineNumber":125,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role is not found.\"));"},{"type":"DELETE","lineNumber":127,"oldContent":"\t\t}"},{"type":"DELETE","lineNumber":128,"oldContent":"\t\tuser.setRoles(roles);"},{"type":"DELETE","lineNumber":129,"oldContent":"\t\tuser.setEmail(signUpRequest.getEmail());"},{"type":"DELETE","lineNumber":130,"oldContent":"\t\tuser.setGender(signUpRequest.getGender());"},{"type":"DELETE","lineNumber":131,"oldContent":"\t\tuserRepository.save(user);"},{"type":"DELETE","lineNumber":132,"oldContent":"\t\treturn ResponseEntity.ok(new MessageResponse(\"User registered successfully!\"));"},{"type":"DELETE","lineNumber":133,"oldContent":"}"},{"type":"INSERT","lineNumber":118,"content":"\t\t\t\tcase \"field_engineer\": {"},{"type":"INSERT","lineNumber":119,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_FIELD_ENGINEER)"},{"type":"INSERT","lineNumber":120,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role 'FIELD_ENGINEER' is not found.\"));"},{"type":"INSERT","lineNumber":121,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":124,"content":"\t\t\t\tcase \"noc_engineer\": {"},{"type":"INSERT","lineNumber":125,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_NOC_ENGINEER)"},{"type":"INSERT","lineNumber":126,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role 'NOC_ENGINEER' is not found.\"));"},{"type":"INSERT","lineNumber":127,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":128,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":129,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":130,"content":"\t\t\t\tcase \"l1_engineer\": {"},{"type":"INSERT","lineNumber":131,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_L1_ENGINEER)"},{"type":"INSERT","lineNumber":132,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role 'L1_ENGINEER' is not found.\"));"},{"type":"INSERT","lineNumber":133,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":134,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":135,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":158,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":160,"content":"\t\t\t\tdefault:"},{"type":"INSERT","lineNumber":161,"content":"\t\t\t\t\t// Handles any role string that doesn't match a case"},{"type":"INSERT","lineNumber":162,"content":"\t\t\t\t\tthrow new RuntimeException(\"Error: Invalid role specified: \" + role);"},{"type":"INSERT","lineNumber":163,"content":"\t\t\t}"},{"type":"INSERT","lineNumber":164,"content":"\t\t});"},{"type":"INSERT","lineNumber":166,"content":"\t\tuser.setRoles(roles);"},{"type":"INSERT","lineNumber":167,"content":"\t\t//saving UserEntity to the database"},{"type":"INSERT","lineNumber":168,"content":"\t\tuserRepository.save(user);"},{"type":"INSERT","lineNumber":169,"content":""},{"type":"INSERT","lineNumber":170,"content":"\t\treturn ResponseEntity.ok(new MessageResponse(\"User registered successfully!\"));"},{"type":"DELETE","lineNumber":161,"oldContent":"\t\t}"},{"type":"DELETE","lineNumber":162,"oldContent":"\t\t\tdefault: return backendRole; // fallback if unknown"},{"type":"DELETE","lineNumber":163,"oldContent":"\t\t\tcase \"ROLE_NOC_ADMIN\": return \"NOC Admin\";"},{"type":"DELETE","lineNumber":164,"oldContent":"\t\t\tcase \"ROLE_CXO\": return \"CXO\";"},{"type":"DELETE","lineNumber":165,"oldContent":"\t\t\tcase \"ROLE_MANAGER\": return \"Manager\";"},{"type":"DELETE","lineNumber":166,"oldContent":"\t\t\tcase \"ROLE_TEAM_LEAD\": return \"Team Lead\";"},{"type":"DELETE","lineNumber":167,"oldContent":"\t\t\tcase \"ROLE_L1_ENGINEER\": return \"L1 Engineer\";"},{"type":"DELETE","lineNumber":168,"oldContent":"\t\t\tcase \"ROLE_NOC_ENGINEER\": return \"NOC Engineer\";"},{"type":"DELETE","lineNumber":169,"oldContent":"\t\t\tcase \"ROLE_FIELD_ENGINEER\": return \"Field Engineer\";"},{"type":"DELETE","lineNumber":170,"oldContent":"\t\t\tcase \"ROLE_TRIAGE_OFFICER\": return \"Triage Officer\";"},{"type":"DELETE","lineNumber":171,"oldContent":"\t\t\tcase \"ROLE_AGENT\": return \"Agent\";"},{"type":"MODIFY","lineNumber":174,"content":"\t\tswitch (backendRole) {","oldContent":"}"},{"type":"MODIFY","lineNumber":179,"content":"\t\t\tcase \"ROLE_NOC_ENGINEER\": return \"NOC_ENGINEER\";","oldContent":"\t\t\tcase \"ROLE_NOC_ENGINEER\": return \"NOC Engineer\";"},{"type":"INSERT","lineNumber":181,"content":"\t\t\tcase \"ROLE_TEAM_LEAD\": return \"Team Lead\";"},{"type":"INSERT","lineNumber":183,"content":"\t\t\tcase \"ROLE_CXO\": return \"CXO\";"},{"type":"INSERT","lineNumber":184,"content":"\t\t\tcase \"ROLE_NOC_ADMIN\": return \"NOC Admin\";"},{"type":"INSERT","lineNumber":185,"content":"\t\t\tdefault: return backendRole; // fallback if unknown"},{"type":"INSERT","lineNumber":186,"content":"\t\t}"},{"type":"INSERT","lineNumber":187,"content":"\t}"},{"type":"INSERT","lineNumber":188,"content":""},{"type":"INSERT","lineNumber":189,"content":"}"}]},{"timestamp":1761679569140,"changes":[{"type":"MODIFY","lineNumber":59,"content":"\t\t\t\tnew UsernamePasswordAuthenticationToken(loginRequest.getUsername(),","oldContent":"\t\t"},{"type":"MODIFY","lineNumber":80,"content":"\t\t\t\t));","oldContent":"\tpublic ResponseEntity<?> registerUser(@Valid @RequestBody SignupRequest signUpRequest) {"},{"type":"MODIFY","lineNumber":90,"content":"","oldContent":"\t\tif (userRepository.existsByEmail(signUpRequest.getEmail())) {"},{"type":"MODIFY","lineNumber":94,"content":"","oldContent":"\t\t// Create new user's account"},{"type":"MODIFY","lineNumber":105,"content":"\t\t\t\t}","oldContent":"\t\t\tstrRoles.forEach(role -> {"},{"type":"INSERT","lineNumber":110,"content":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":115,"oldContent":"\t\t\t\t\tRole childRole = roleRepository.findByName(ERole.ROLE_CHILD)"},{"type":"INSERT","lineNumber":116,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":117,"content":"\t\t\t\t}"},{"type":"DELETE","lineNumber":119,"oldContent":"\t\t\t\tcase \"parent\":"},{"type":"INSERT","lineNumber":122,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":123,"content":"\t\t\t\t}"},{"type":"DELETE","lineNumber":124,"oldContent":"\t\t\t\tdefault:"},{"type":"DELETE","lineNumber":133,"oldContent":"\t\tuser.setRoles(roles);"},{"type":"DELETE","lineNumber":135,"oldContent":"\t\t\t\t}"},{"type":"MODIFY","lineNumber":157,"content":"\t\t\t\t\troles.add(foundRole);","oldContent":""},{"type":"DELETE","lineNumber":159,"oldContent":"\t}"},{"type":"MODIFY","lineNumber":159,"content":"\t\t\t\t}","oldContent":"\t\t}"},{"type":"DELETE","lineNumber":162,"oldContent":"\t\t\tdefault: return backendRole; // fallback if unknown"},{"type":"INSERT","lineNumber":165,"content":""},{"type":"INSERT","lineNumber":171,"content":"\t}"},{"type":"MODIFY","lineNumber":173,"content":"\tprivate String mapRoleToFrontend(String backendRole) {","oldContent":"}"},{"type":"MODIFY","lineNumber":180,"content":"\t\t\tcase \"ROLE_L1_ENGINEER\": return \"L1_ENGINEER\";","oldContent":"\t\t\tcase \"ROLE_NOC_ADMIN\": return \"NOC Admin\";"},{"type":"DELETE","lineNumber":183,"oldContent":"}"},{"type":"DELETE","lineNumber":185,"oldContent":""},{"type":"MODIFY","lineNumber":187,"content":"\t}","oldContent":"\t}"},{"type":"INSERT","lineNumber":188,"content":""},{"type":"INSERT","lineNumber":189,"content":"}"}]},{"timestamp":1761679577431,"changes":[{"type":"MODIFY","lineNumber":10,"content":"import com.capstone.tele_ticketing_backend_1.entities.Role;","oldContent":"import com.prodapt.springsecurityusingjwtexample.security.payload.request.SignupRequest;"},{"type":"MODIFY","lineNumber":25,"content":"import org.springframework.security.core.context.SecurityContextHolder;","oldContent":"import java.util.HashSet;"},{"type":"MODIFY","lineNumber":92,"content":"\t\tAppUser user = new AppUser(signUpRequest.getUsername(),","oldContent":"\t\t// Create new user's account"},{"type":"MODIFY","lineNumber":106,"content":"\t\t\t\tcase \"agent\": {","oldContent":"\t\t\t\tswitch (role) {"},{"type":"MODIFY","lineNumber":118,"content":"\t\t\t\tcase \"field_engineer\": {","oldContent":"\t\t\t\tcase \"field_engineer\": {"},{"type":"DELETE","lineNumber":122,"oldContent":"\t\t\t\tcase \"noc_engineer\": {"},{"type":"MODIFY","lineNumber":124,"content":"\t\t\t\tcase \"noc_engineer\": {","oldContent":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_NOC_ENGINEER)"},{"type":"INSERT","lineNumber":125,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_NOC_ENGINEER)"},{"type":"DELETE","lineNumber":136,"oldContent":"\t\t//saving UserEntity to the database "},{"type":"DELETE","lineNumber":137,"oldContent":"\t\tuserRepository.save(user);"},{"type":"DELETE","lineNumber":138,"oldContent":"\t\treturn ResponseEntity.ok(new MessageResponse(\"User registered successfully!\"));"},{"type":"INSERT","lineNumber":136,"content":"\t\t\t\tcase \"manager\": {"},{"type":"INSERT","lineNumber":137,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_MANAGER)"},{"type":"INSERT","lineNumber":138,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role 'MANAGER' is not found.\"));"},{"type":"DELETE","lineNumber":142,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role 'NOC_ADMIN' is not found.\"));"},{"type":"MODIFY","lineNumber":142,"content":"\t\t\t\tcase \"team_lead\": {","oldContent":"\t\t\t\tcase \"noc_admin\": {"},{"type":"INSERT","lineNumber":143,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_TEAM_LEAD)"},{"type":"INSERT","lineNumber":144,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role 'TEAM_LEAD' is not found.\"));"},{"type":"DELETE","lineNumber":145,"oldContent":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":152,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":153,"content":"\t\t\t\t}"},{"type":"DELETE","lineNumber":153,"oldContent":""},{"type":"DELETE","lineNumber":154,"oldContent":"\t}"},{"type":"DELETE","lineNumber":155,"oldContent":"\t\t}"},{"type":"DELETE","lineNumber":156,"oldContent":"\t\t\tdefault: return backendRole; // fallback if unknown"},{"type":"INSERT","lineNumber":155,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_NOC_ADMIN)"},{"type":"INSERT","lineNumber":156,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role 'NOC_ADMIN' is not found.\"));"},{"type":"DELETE","lineNumber":163,"oldContent":""},{"type":"INSERT","lineNumber":165,"content":""},{"type":"DELETE","lineNumber":170,"oldContent":"\t}"},{"type":"INSERT","lineNumber":172,"content":""},{"type":"DELETE","lineNumber":181,"oldContent":"\t\t\tcase \"ROLE_TEAM_LEAD\": return \"Team Lead\";"},{"type":"DELETE","lineNumber":182,"oldContent":""},{"type":"INSERT","lineNumber":181,"content":"\t\t\tcase \"ROLE_TEAM_LEAD\": return \"TEAM_LEAD\";"},{"type":"INSERT","lineNumber":182,"content":"\t\t\tcase \"ROLE_MANAGER\": return \"Manager\";"},{"type":"INSERT","lineNumber":185,"content":"\t\t\tdefault: return backendRole; // fallback if unknown"},{"type":"INSERT","lineNumber":186,"content":"\t\t}"}]},{"timestamp":1761679582867,"changes":[{"type":"MODIFY","lineNumber":9,"content":"import com.capstone.tele_ticketing_backend_1.entities.ERole;","oldContent":"import com.prodapt.springsecurityusingjwtexample.security.payload.request.LoginRequest;"},{"type":"MODIFY","lineNumber":26,"content":"import org.springframework.security.crypto.password.PasswordEncoder;","oldContent":"import java.util.List;"},{"type":"INSERT","lineNumber":117,"content":"\t\t\t\t}"},{"type":"DELETE","lineNumber":118,"oldContent":"\t\t\t\tcase \"field_engineer\": {"},{"type":"INSERT","lineNumber":123,"content":"\t\t\t\t}"},{"type":"DELETE","lineNumber":125,"oldContent":"\t\t\t\t}"},{"type":"MODIFY","lineNumber":143,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_TEAM_LEAD)","oldContent":"}"},{"type":"MODIFY","lineNumber":145,"content":"\t\t\t\t\troles.add(foundRole);","oldContent":"\t\t\t\t}"},{"type":"MODIFY","lineNumber":151,"content":"\t\t\t\t\troles.add(foundRole);","oldContent":"\t\t\t\tcase \"noc_admin\": {"},{"type":"DELETE","lineNumber":153,"oldContent":""},{"type":"INSERT","lineNumber":154,"content":"\t\t\t\tcase \"noc_admin\": {"},{"type":"MODIFY","lineNumber":165,"content":"","oldContent":""},{"type":"INSERT","lineNumber":171,"content":"\t}"},{"type":"DELETE","lineNumber":172,"oldContent":"\t\t}"},{"type":"MODIFY","lineNumber":182,"content":"\t\t\tcase \"ROLE_MANAGER\": return \"MANAGER\";","oldContent":"\t\t\tcase \"ROLE_MANAGER\": return \"Manager\";"},{"type":"MODIFY","lineNumber":187,"content":"\t}","oldContent":"\t}"}]},{"timestamp":1761679592380,"changes":[{"type":"MODIFY","lineNumber":146,"content":"\t\t\t\t\tbreak;","oldContent":"\t\t\t\tcase \"noc_admin\": {"},{"type":"DELETE","lineNumber":149,"oldContent":""},{"type":"DELETE","lineNumber":150,"oldContent":"\t}"},{"type":"INSERT","lineNumber":149,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_CXO)"},{"type":"INSERT","lineNumber":150,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RuntimeException(\"Error: Role 'CXO' is not found.\"));"},{"type":"MODIFY","lineNumber":154,"content":"\t\t\t\tcase \"noc_admin\": {","oldContent":"\t\t\t\tcase \"noc_admin\": {"},{"type":"INSERT","lineNumber":164,"content":"\t\t});"},{"type":"DELETE","lineNumber":165,"oldContent":""},{"type":"MODIFY","lineNumber":178,"content":"\t\t\tcase \"ROLE_FIELD_ENGINEER\": return \"FIELD_ENGINEER\";","oldContent":"}"},{"type":"MODIFY","lineNumber":184,"content":"\t\t\tcase \"ROLE_NOC_ADMIN\": return \"NOC_ADMIN\";","oldContent":"}"},{"type":"INSERT","lineNumber":186,"content":"\t\t}"},{"type":"DELETE","lineNumber":187,"oldContent":"\t}"},{"type":"INSERT","lineNumber":188,"content":""},{"type":"INSERT","lineNumber":189,"content":"}"}]},{"timestamp":1761713222138,"changes":[{"type":"DELETE","lineNumber":140,"oldContent":"\t\tuserRepository.save(user);"},{"type":"DELETE","lineNumber":141,"oldContent":""},{"type":"INSERT","lineNumber":140,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":141,"content":"\t\t\t\t}"},{"type":"MODIFY","lineNumber":148,"content":"\t\t\t\tcase \"cxo\": {","oldContent":"\t\t\t\t}"},{"type":"INSERT","lineNumber":153,"content":"\t\t\t\t}"},{"type":"DELETE","lineNumber":154,"oldContent":"\t\t\t\tcase \"noc_admin\": {"},{"type":"DELETE","lineNumber":175,"oldContent":"\t\t\tcase \"ROLE_CUSTOMER\": return \"CUSTOMER\";"},{"type":"DELETE","lineNumber":176,"oldContent":"\t\t\tcase \"ROLE_AGENT\": return \"AGENT\";"},{"type":"DELETE","lineNumber":177,"oldContent":"\t\t\tcase \"ROLE_TRIAGE_OFFICER\": return \"TRIAGE_OFFICER\";"},{"type":"DELETE","lineNumber":178,"oldContent":"\t\t\tcase \"ROLE_FIELD_ENGINEER\": return \"FIELD_ENGINEER\";"},{"type":"DELETE","lineNumber":179,"oldContent":"\t\t\tcase \"ROLE_NOC_ENGINEER\": return \"NOC_ENGINEER\";"},{"type":"DELETE","lineNumber":180,"oldContent":"\t\t\tcase \"ROLE_L1_ENGINEER\": return \"L1_ENGINEER\";"},{"type":"DELETE","lineNumber":181,"oldContent":"\t\t\tcase \"ROLE_TEAM_LEAD\": return \"TEAM_LEAD\";"},{"type":"DELETE","lineNumber":182,"oldContent":"\t\t\tcase \"ROLE_MANAGER\": return \"MANAGER\";"},{"type":"INSERT","lineNumber":175,"content":"\t\t\tcase \"ROLE_CUSTOMER\": return \"Customer\";"},{"type":"INSERT","lineNumber":176,"content":"\t\t\tcase \"ROLE_AGENT\": return \"Agent\";"},{"type":"INSERT","lineNumber":177,"content":"\t\t\tcase \"ROLE_TRIAGE_OFFICER\": return \"Triage Officer\";"},{"type":"INSERT","lineNumber":178,"content":"\t\t\tcase \"ROLE_FIELD_ENGINEER\": return \"Field Engineer\";"},{"type":"INSERT","lineNumber":179,"content":"\t\t\tcase \"ROLE_NOC_ENGINEER\": return \"NOC Engineer\";"},{"type":"INSERT","lineNumber":180,"content":"\t\t\tcase \"ROLE_L1_ENGINEER\": return \"L1 Engineer\";"},{"type":"INSERT","lineNumber":181,"content":"\t\t\tcase \"ROLE_TEAM_LEAD\": return \"Team Lead\";"},{"type":"INSERT","lineNumber":182,"content":"\t\t\tcase \"ROLE_MANAGER\": return \"Manager\";"},{"type":"MODIFY","lineNumber":184,"content":"\t\t\tcase \"ROLE_NOC_ADMIN\": return \"NOC Admin\";","oldContent":"\t\t\tcase \"ROLE_NOC_ADMIN\": return \"NOC_ADMIN\";"}]},{"timestamp":1761715557241,"changes":[{"type":"DELETE","lineNumber":3,"oldContent":"import com.prodapt.springsecurityusingjwtexample.entities.ERole;"},{"type":"DELETE","lineNumber":4,"oldContent":"import com.prodapt.springsecurityusingjwtexample.entities.Role;"},{"type":"DELETE","lineNumber":5,"oldContent":"import com.prodapt.springsecurityusingjwtexample.entities.UserEntity;"},{"type":"DELETE","lineNumber":6,"oldContent":"import com.prodapt.springsecurityusingjwtexample.repositories.RoleRepository;"},{"type":"DELETE","lineNumber":7,"oldContent":"import com.prodapt.springsecurityusingjwtexample.repositories.UserRepository;"},{"type":"INSERT","lineNumber":3,"content":"import java.util.HashSet;"},{"type":"INSERT","lineNumber":4,"content":"import java.util.List;"},{"type":"INSERT","lineNumber":5,"content":"import java.util.Set;"},{"type":"INSERT","lineNumber":6,"content":"import java.util.stream.Collectors;"},{"type":"INSERT","lineNumber":7,"content":""},{"type":"MODIFY","lineNumber":20,"content":"import org.springframework.http.ResponseEntity;","oldContent":"import org.springframework.security.core.context.SecurityContextHolder;"},{"type":"MODIFY","lineNumber":54,"content":"","oldContent":"\t\t\t\tnew UsernamePasswordAuthenticationToken(loginRequest.getUsername(), "},{"type":"MODIFY","lineNumber":61,"content":"","oldContent":"\t\tList<String> roles = userDetails.getAuthorities().stream()"},{"type":"DELETE","lineNumber":65,"oldContent":"\t\treturn ResponseEntity.ok(new JwtResponse(jwt, "},{"type":"DELETE","lineNumber":66,"oldContent":"\t\t\t\t\t\t\t\t\t\t\t\t userDetails.getId(), "},{"type":"INSERT","lineNumber":65,"content":"\t\tUserDetailsImpl userDetails = (UserDetailsImpl) authentication.getPrincipal();"},{"type":"INSERT","lineNumber":66,"content":"\t\tList<String> roles = userDetails.getAuthorities().stream()"},{"type":"INSERT","lineNumber":85,"content":"\t\tSystem.out.println();"},{"type":"MODIFY","lineNumber":96,"content":"\t\tSet<String> strRoles = signUpRequest.getRole();","oldContent":"\t\t\t\t\t\t\t encoder.encode(signUpRequest.getPassword()));"},{"type":"DELETE","lineNumber":139,"oldContent":"\t\tuserRepository.save(user);"},{"type":"INSERT","lineNumber":140,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"MODIFY","lineNumber":148,"content":"\t\t\t\t}","oldContent":"\t}"},{"type":"DELETE","lineNumber":183,"oldContent":"}"},{"type":"INSERT","lineNumber":184,"content":"\t\t\tcase \"ROLE_CXO\": return \"CXO\";"},{"type":"INSERT","lineNumber":188,"content":"\t}"},{"type":"INSERT","lineNumber":189,"content":""}]},{"timestamp":1761715568638,"changes":[{"type":"MODIFY","lineNumber":21,"content":"import org.springframework.security.authentication.AuthenticationManager;","oldContent":"import org.springframework.security.crypto.password.PasswordEncoder;"},{"type":"MODIFY","lineNumber":30,"content":"import org.springframework.web.bind.annotation.RequestMapping;","oldContent":""},{"type":"MODIFY","lineNumber":32,"content":"","oldContent":"@CrossOrigin(origins = \"*\", maxAge = 3600)"},{"type":"MODIFY","lineNumber":39,"content":"public class AuthController {","oldContent":"\tUserRepository userRepository;"},{"type":"MODIFY","lineNumber":85,"content":"\t\tSystem.out.println(\"Signup request : \" + );","oldContent":"\t\tSystem.out.println();"},{"type":"DELETE","lineNumber":96,"oldContent":"\t\t\t\t\t\t\t encoder.encode(signUpRequest.getPassword()));"},{"type":"INSERT","lineNumber":97,"content":"\t\tSet<Role> roles = new HashSet<>();"},{"type":"DELETE","lineNumber":148,"oldContent":"\t}"},{"type":"INSERT","lineNumber":149,"content":"\t\t\t\tcase \"cxo\": {"},{"type":"DELETE","lineNumber":188,"oldContent":"}"},{"type":"INSERT","lineNumber":190,"content":"}"}]},{"timestamp":1761715572300,"changes":[{"type":"MODIFY","lineNumber":11,"content":"import com.capstone.tele_ticketing_backend_1.repo.RoleRepo;","oldContent":"import com.prodapt.springsecurityusingjwtexample.security.payload.response.JwtResponse;"},{"type":"DELETE","lineNumber":34,"oldContent":"public class AuthController {"},{"type":"INSERT","lineNumber":35,"content":""},{"type":"MODIFY","lineNumber":45,"content":"","oldContent":"\tPasswordEncoder encoder;"},{"type":"MODIFY","lineNumber":82,"content":"","oldContent":"\t\t\t\t\t.body(new MessageResponse(\"Error: Username is already taken!\"));"},{"type":"MODIFY","lineNumber":85,"content":"\t\tSystem.out.println(\"Signup request : \" + signUpRequest);","oldContent":"\t\tSystem.out.println(\"Signup request : \" + );"},{"type":"MODIFY","lineNumber":97,"content":"\t\tSet<Role> roles = new HashSet<>();","oldContent":"\t\tSet<Role> roles = new HashSet<>();"},{"type":"MODIFY","lineNumber":149,"content":"\t\t\t\tcase \"cxo\": {","oldContent":"\t\t\t\tcase \"cxo\": {"},{"type":"MODIFY","lineNumber":186,"content":"\t\t\tdefault: return backendRole; // fallback if unknown","oldContent":"}"},{"type":"MODIFY","lineNumber":190,"content":"}","oldContent":"}"}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/ERole.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/ERole.java","baseContent":"package com.capstone.tele_ticketing_backend_1.entities;\n\npublic enum ERole {\n    ROLE_CUSTOMER, ROLE_\n}\n","baseTimestamp":1761595430643,"deltas":[{"timestamp":1761595452976,"changes":[{"type":"MODIFY","lineNumber":3,"content":"    ROLE_CUSTOMER, ROLE_FIELDENGINEER, ROLE_NOCENGINEER, ROLE_","oldContent":"    ROLE_CUSTOMER, ROLE_"}]},{"timestamp":1761595463630,"changes":[{"type":"MODIFY","lineNumber":3,"content":"    ROLE_CUSTOMER, ROLE_FIELDENGINEER, ROLE_NOCENGINEER, ROLE_L1ENGINEER","oldContent":"    ROLE_CUSTOMER, ROLE_FIELDENGINEER, ROLE_NOCENGINEER, ROLE_"}]},{"timestamp":1761677078976,"changes":[{"type":"MODIFY","lineNumber":3,"content":"    ROLE_CUSTOMER,","oldContent":"    ROLE_CUSTOMER, ROLE_FIELDENGINEER, ROLE_NOCENGINEER, ROLE_L1ENGINEER"},{"type":"INSERT","lineNumber":4,"content":"    ROLE_AGENT,"},{"type":"INSERT","lineNumber":5,"content":"    ROLE_TRIAGE_OFFICER,"},{"type":"INSERT","lineNumber":6,"content":"    ROLE_FIELD_ENGINEER,"},{"type":"INSERT","lineNumber":7,"content":"    ROLE_NOC_ENGINEER,"},{"type":"INSERT","lineNumber":8,"content":"    ROLE_L1_ENGINEER,"},{"type":"INSERT","lineNumber":9,"content":"    ROLE_MANAGER,"},{"type":"INSERT","lineNumber":10,"content":"    ROLE_TEAM_LEAD,"},{"type":"INSERT","lineNumber":11,"content":"    ROLE_CXO,"},{"type":"INSERT","lineNumber":12,"content":"    ROLE_NOC_ADMIN"},{"type":"DELETE","lineNumber":5,"oldContent":""}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/service/UserDetailsImpl.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/service/UserDetailsImpl.java","baseContent":"package com.capstone.tele_ticketing_backend_1.security.service;\n\n\nimport com.fasterxml.jackson.annotation.JsonIgnore;\nimport com.prodapt.springsecurityusingjwtexample.entities.UserEntity;\nimport org.springframework.security.core.GrantedAuthority;\nimport org.springframework.security.core.authority.SimpleGrantedAuthority;\nimport org.springframework.security.core.userdetails.UserDetails;\n\nimport java.util.Collection;\nimport java.util.List;\nimport java.util.Objects;\nimport java.util.stream.Collectors;\n\n\n\npublic class UserDetailsImpl implements UserDetails {\n\tprivate static final long serialVersionUID = 1L;\n\n\tprivate Long id;\n\n\tprivate String username;\n\n\tprivate String email;\n\n\t@JsonIgnore\n\tprivate String password;\n\n\tprivate Collection<? extends GrantedAuthority> authorities;\n\n\tpublic UserDetailsImpl(Long id, String username, String email, String password,\n\t\t\tCollection<? extends GrantedAuthority> authorities) {\n\t\tthis.id = id;\n\t\tthis.username = username;\n\t\tthis.email = email;\n\t\tthis.password = password;\n\t\tthis.authorities = authorities;\n\t}\n\n\tpublic static UserDetailsImpl build(UserEntity user) {\n\t\tList<GrantedAuthority> authorities = user.getRoles().stream()\n\t\t\t\t.map(role -> new SimpleGrantedAuthority(role.getName().name()))\n\t\t\t\t.collect(Collectors.toList());\n\n\t\treturn new UserDetailsImpl(\n\t\t\t\tuser.getId(), \n\t\t\t\tuser.getUsername(), \n\t\t\t\tuser.getEmail(),\n\t\t\t\tuser.getPassword(), \n\t\t\t\tauthorities);\n\t}\n\n\t@Override\n\tpublic Collection<? extends GrantedAuthority> getAuthorities() {\n\t\treturn authorities;\n\t}\n\n\tpublic Long getId() {\n\t\treturn id;\n\t}\n\n\tpublic String getEmail() {\n\t\treturn email;\n\t}\n\n\t@Override\n\tpublic String getPassword() {\n\t\treturn password;\n\t}\n\n\t@Override\n\tpublic String getUsername() {\n\t\treturn username;\n\t}\n\n\t@Override\n\tpublic boolean isAccountNonExpired() {\n\t\treturn true;\n\t}\n\n\t@Override\n\tpublic boolean isAccountNonLocked() {\n\t\treturn true;\n\t}\n\n\t@Override\n\tpublic boolean isCredentialsNonExpired() {\n\t\treturn true;\n\t}\n\n\t@Override\n\tpublic boolean isEnabled() {\n\t\treturn true;\n\t}\n\n\t@Override\n\tpublic boolean equals(Object o) {\n\t\tif (this == o)\n\t\t\treturn true;\n\t\tif (o == null || getClass() != o.getClass())\n\t\t\treturn false;\n\t\tUserDetailsImpl user = (UserDetailsImpl) o;\n\t\treturn Objects.equals(id, user.id);\n\t}\n}\n","baseTimestamp":1761595687814,"deltas":[{"timestamp":1761629757280,"changes":[{"type":"MODIFY","lineNumber":6,"content":"import org.springframework.security.core.authority.SimpleGrantedAuthority;","oldContent":"import org.springframework.security.core.GrantedAuthority;"},{"type":"MODIFY","lineNumber":41,"content":"\t\t\t\tauthority);","oldContent":"\t\t\t\tthis.authorities);"},{"type":"MODIFY","lineNumber":66,"content":"\t}","oldContent":"\tpublic boolean isAccountNonExpired() {"},{"type":"INSERT","lineNumber":67,"content":""},{"type":"INSERT","lineNumber":68,"content":"\t@Override"},{"type":"INSERT","lineNumber":69,"content":"\tpublic boolean isAccountNonLocked() {"},{"type":"DELETE","lineNumber":70,"oldContent":""},{"type":"DELETE","lineNumber":72,"oldContent":"\t@Override"},{"type":"DELETE","lineNumber":74,"oldContent":"\tpublic boolean isAccountNonLocked() {"},{"type":"DELETE","lineNumber":94,"oldContent":"\t\treturn Objects.equals(id, user.id);"},{"type":"DELETE","lineNumber":95,"oldContent":"\t}"},{"type":"DELETE","lineNumber":96,"oldContent":"}"},{"type":"DELETE","lineNumber":97,"oldContent":""}]},{"timestamp":1761629762278,"changes":[{"type":"MODIFY","lineNumber":34,"content":"\tpublic static UserDetailsImpl build(AppUser user) {","oldContent":"\t\tthis.authorities = authorities;"},{"type":"MODIFY","lineNumber":39,"content":"\t\t\t\tuser.getUsername(),","oldContent":"\t\t\t\t.map(role -> new SimpleGrantedAuthority(role.getName().name()))"},{"type":"DELETE","lineNumber":69,"oldContent":"\t@Override"},{"type":"DELETE","lineNumber":70,"oldContent":"\tpublic boolean isAccountNonExpired() {"},{"type":"INSERT","lineNumber":72,"content":""},{"type":"INSERT","lineNumber":73,"content":"\t@Override"},{"type":"DELETE","lineNumber":94,"oldContent":""}]},{"timestamp":1761629776001,"changes":[{"type":"DELETE","lineNumber":40,"oldContent":"\t\t\t\tuser.getPassword(), "},{"type":"DELETE","lineNumber":41,"oldContent":"\t\t\t\tauthority);"},{"type":"INSERT","lineNumber":40,"content":"\t\t\t\tuser.getPassword(),"},{"type":"INSERT","lineNumber":41,"content":"\t\t\t\tauthorities);"},{"type":"INSERT","lineNumber":54,"content":"\tpublic String getPassword() {"},{"type":"INSERT","lineNumber":55,"content":"\t\treturn password;"},{"type":"DELETE","lineNumber":56,"oldContent":"\t}"},{"type":"DELETE","lineNumber":57,"oldContent":""},{"type":"DELETE","lineNumber":70,"oldContent":""},{"type":"MODIFY","lineNumber":72,"content":"","oldContent":"\t@Override"},{"type":"INSERT","lineNumber":73,"content":"\t@Override"},{"type":"MODIFY","lineNumber":86,"content":"\t\t\treturn true;","oldContent":"\t\treturn true;"},{"type":"MODIFY","lineNumber":88,"content":"\t\t\treturn false;","oldContent":""}]},{"timestamp":1761629819485,"changes":[{"type":"INSERT","lineNumber":36,"content":"\t\tCollection<? extends GrantedAuthority> authorities = "},{"type":"DELETE","lineNumber":44,"oldContent":"\t\t\t\tuser.getUsername(), "},{"type":"INSERT","lineNumber":45,"content":"\t@Override"},{"type":"DELETE","lineNumber":53,"oldContent":"\t}"},{"type":"INSERT","lineNumber":54,"content":"\t@Override"},{"type":"DELETE","lineNumber":55,"oldContent":""},{"type":"MODIFY","lineNumber":57,"content":"\t}","oldContent":"\tpublic Long getId() {"},{"type":"INSERT","lineNumber":58,"content":""},{"type":"INSERT","lineNumber":72,"content":"\t}"},{"type":"DELETE","lineNumber":73,"oldContent":"\t}"}]},{"timestamp":1761629826200,"changes":[{"type":"INSERT","lineNumber":12,"content":"import java.util.stream.Collectors;"},{"type":"MODIFY","lineNumber":37,"content":"\t\tCollection<? extends GrantedAuthority> authorities =","oldContent":"\t\tCollection<? extends GrantedAuthority> authorities = "},{"type":"INSERT","lineNumber":38,"content":"\t\t\t\tList<GrantedAuthority> authorities = user.getRoles().stream()"},{"type":"INSERT","lineNumber":39,"content":"\t\t\t\t\t\t.map(role -> new SimpleGrantedAuthority(role.getName().name()))"},{"type":"INSERT","lineNumber":40,"content":"\t\t\t\t\t\t.collect(Collectors.toList());"},{"type":"DELETE","lineNumber":72,"oldContent":""},{"type":"INSERT","lineNumber":77,"content":""},{"type":"DELETE","lineNumber":88,"oldContent":""},{"type":"INSERT","lineNumber":92,"content":"\t\tif (o == null || getClass() != o.getClass())"}]},{"timestamp":1761629832248,"changes":[{"type":"MODIFY","lineNumber":29,"content":"\t\tthis.id = id;","oldContent":"\tpublic UserDetailsImpl(Long id, String username, String email, String password,"},{"type":"DELETE","lineNumber":38,"oldContent":"\t\tCollection<? extends GrantedAuthority> authorities ="},{"type":"DELETE","lineNumber":40,"oldContent":"\t\treturn new UserDetailsImpl("},{"type":"DELETE","lineNumber":42,"oldContent":"\t\t\t\tuser.getId(), "},{"type":"INSERT","lineNumber":41,"content":""},{"type":"INSERT","lineNumber":42,"content":"\t\treturn new UserDetailsImpl("},{"type":"INSERT","lineNumber":43,"content":"\t\t\t\tuser.getId(), "},{"type":"MODIFY","lineNumber":73,"content":"\t@Override","oldContent":"\tpublic boolean isAccountNonExpired() {"},{"type":"INSERT","lineNumber":75,"content":"\t\treturn true;"},{"type":"DELETE","lineNumber":76,"oldContent":"\t}"},{"type":"INSERT","lineNumber":77,"content":""},{"type":"DELETE","lineNumber":80,"oldContent":""},{"type":"INSERT","lineNumber":92,"content":"\t\tif (o == null || getClass() != o.getClass())"},{"type":"DELETE","lineNumber":95,"oldContent":"\t\tif (o == null || getClass() != o.getClass())"}]},{"timestamp":1761629843613,"changes":[{"type":"MODIFY","lineNumber":37,"content":"\t\tCollection<? extends GrantedAuthority> authorities = Collections","oldContent":"\t\tCollection<? extends GrantedAuthority> authorities = "},{"type":"DELETE","lineNumber":39,"oldContent":""},{"type":"INSERT","lineNumber":40,"content":"\t\t\t\t\t\t.collect(Collectors.toList());"},{"type":"INSERT","lineNumber":41,"content":""},{"type":"DELETE","lineNumber":43,"oldContent":"\t\t\t\t\t\t.collect(Collectors.toList());"}]},{"timestamp":1761629853519,"changes":[{"type":"MODIFY","lineNumber":31,"content":"\t\tthis.password = password;","oldContent":"\t\tthis.id = id;"},{"type":"DELETE","lineNumber":38,"oldContent":"\t\t\t\tList<GrantedAuthority> authorities = user.getRoles().stream()"},{"type":"DELETE","lineNumber":39,"oldContent":"\t\t\t\t\t\t.collect(Collectors.toList());"},{"type":"INSERT","lineNumber":38,"content":"\t\t\t\tList<GrantedAuthority> authorities = user.getRole().stream()"},{"type":"INSERT","lineNumber":40,"content":"\t\t\t\t\t\t.collect(Collectors.toList());"},{"type":"MODIFY","lineNumber":51,"content":"\t\treturn authority;","oldContent":"\t\t\t\tuser.getPassword(), "}]},{"timestamp":1761629858816,"changes":[{"type":"MODIFY","lineNumber":21,"content":"","oldContent":"\tprivate String username;"},{"type":"MODIFY","lineNumber":30,"content":"\t\tthis.username = username;","oldContent":"\t\t\tCollection<? extends GrantedAuthority> authorities) {"},{"type":"MODIFY","lineNumber":34,"content":"","oldContent":"\t\tthis.password = password;"},{"type":"MODIFY","lineNumber":37,"content":"//\t\tCollection<? extends GrantedAuthority> authorities = Collections","oldContent":"\t\tCollection<? extends GrantedAuthority> authorities = Collections"},{"type":"MODIFY","lineNumber":40,"content":"\t\t\t\t\t\t.collect(Collectors.toList());","oldContent":"\t\t\t\t\t\t.collect(Collectors.toList());"},{"type":"MODIFY","lineNumber":56,"content":"\t}","oldContent":"\tpublic Collection<? extends GrantedAuthority> getAuthorities() {"},{"type":"MODIFY","lineNumber":76,"content":"\t}","oldContent":"\t\treturn true;"},{"type":"MODIFY","lineNumber":90,"content":"\t\tif (this == o)","oldContent":"\tpublic boolean isCredentialsNonExpired() {"}]},{"timestamp":1761630135876,"changes":[{"type":"MODIFY","lineNumber":38,"content":"\t\t\t\t\t\t.map(role -> new SimpleGrantedAuthority(role.getName().name()))","oldContent":"//\t\tCollection<? extends GrantedAuthority> authorities = Collections"},{"type":"DELETE","lineNumber":40,"oldContent":"\t\t\t\t\t\t.collect(Collectors.toList());"},{"type":"DELETE","lineNumber":47,"oldContent":"\t\treturn new UserDetailsImpl("},{"type":"INSERT","lineNumber":46,"content":"\t}"}]},{"timestamp":1761630150896,"changes":[{"type":"DELETE","lineNumber":13,"oldContent":"import java.util.Objects;"},{"type":"DELETE","lineNumber":14,"oldContent":"import java.util.stream.Collectors;"},{"type":"INSERT","lineNumber":13,"content":""},{"type":"INSERT","lineNumber":14,"content":""},{"type":"MODIFY","lineNumber":37,"content":"\t\tList<GrantedAuthority> authorities = user.getRole().stream()","oldContent":"//\t\tCollection<? extends GrantedAuthority> authorities = Collections"},{"type":"MODIFY","lineNumber":46,"content":"\t}","oldContent":"\t}"},{"type":"DELETE","lineNumber":98,"oldContent":"\t\t\treturn false;"},{"type":"DELETE","lineNumber":99,"oldContent":"\t\tUserDetailsImpl user = (UserDetailsImpl) o;"},{"type":"DELETE","lineNumber":100,"oldContent":"\t\treturn Objects.equals(id, user.id);"},{"type":"DELETE","lineNumber":101,"oldContent":"\t}"},{"type":"DELETE","lineNumber":102,"oldContent":"}"},{"type":"DELETE","lineNumber":103,"oldContent":""}]},{"timestamp":1761630226019,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":""},{"type":"MODIFY","lineNumber":9,"content":"import java.util.Collections;","oldContent":"import java.util.List;"},{"type":"DELETE","lineNumber":12,"oldContent":"import java.util.stream.Collectors;"},{"type":"DELETE","lineNumber":14,"oldContent":""},{"type":"DELETE","lineNumber":16,"oldContent":"\tprivate static final long serialVersionUID = 1L;"},{"type":"INSERT","lineNumber":13,"content":"    private static final long serialVersionUID = 1L;"},{"type":"DELETE","lineNumber":18,"oldContent":"\tprivate static final long serialVersionUID = 1L;"},{"type":"INSERT","lineNumber":15,"content":"    private Long id;"},{"type":"INSERT","lineNumber":16,"content":"    private String username;"},{"type":"DELETE","lineNumber":20,"oldContent":"\tprivate Long id;"},{"type":"INSERT","lineNumber":18,"content":"    @JsonIgnore"},{"type":"INSERT","lineNumber":19,"content":"    private String password;"},{"type":"DELETE","lineNumber":22,"oldContent":"\t@JsonIgnore"},{"type":"DELETE","lineNumber":23,"oldContent":"\tprivate String username;"},{"type":"INSERT","lineNumber":21,"content":"    private Collection<? extends GrantedAuthority> authorities;"},{"type":"DELETE","lineNumber":25,"oldContent":"\tprivate Collection<? extends GrantedAuthority> authorities;"},{"type":"INSERT","lineNumber":23,"content":"    public UserDetailsImpl(Long id, String username, String password,"},{"type":"INSERT","lineNumber":24,"content":"                           Collection<? extends GrantedAuthority> authorities) {"},{"type":"INSERT","lineNumber":25,"content":"        this.id = id;"},{"type":"INSERT","lineNumber":26,"content":"        this.username = username;"},{"type":"INSERT","lineNumber":27,"content":"        this.password = password;"},{"type":"INSERT","lineNumber":28,"content":"        this.authorities = authorities;"},{"type":"INSERT","lineNumber":29,"content":"    }"},{"type":"DELETE","lineNumber":27,"oldContent":"\tpublic UserDetailsImpl(Long id, String username, String password,"},{"type":"DELETE","lineNumber":28,"oldContent":"\t\t\t\t\t\t   Collection<? extends GrantedAuthority> authorities) {"},{"type":"DELETE","lineNumber":29,"oldContent":"\t\tthis.id = id;"},{"type":"DELETE","lineNumber":30,"oldContent":"\t\tthis.username = username;"},{"type":"DELETE","lineNumber":31,"oldContent":"\t\tthis.password = password;"},{"type":"DELETE","lineNumber":32,"oldContent":"\t\tthis.authorities = authorities;"},{"type":"DELETE","lineNumber":33,"oldContent":"\t\tthis.id = id;"},{"type":"INSERT","lineNumber":31,"content":"    // Build method to convert AppUser → UserDetailsImpl"},{"type":"INSERT","lineNumber":32,"content":"    public static UserDetailsImpl build(AppUser user) {"},{"type":"INSERT","lineNumber":33,"content":"        // Since user has a single Role"},{"type":"INSERT","lineNumber":34,"content":"        GrantedAuthority authority = new SimpleGrantedAuthority(user.getRole().getName().name());"},{"type":"DELETE","lineNumber":35,"oldContent":"\tpublic static UserDetailsImpl build(AppUser user) {"},{"type":"DELETE","lineNumber":36,"oldContent":"\t\tGrantedAuthority authority = new SimpleGrantedAuthority(user.getRole().getName().name());"},{"type":"DELETE","lineNumber":37,"oldContent":"\t\tList<GrantedAuthority> authorities = user.getRole().stream()"},{"type":"DELETE","lineNumber":38,"oldContent":"\t\t\t\t\t\t.map(role -> new SimpleGrantedAuthority(role.getName().name()))"},{"type":"DELETE","lineNumber":39,"oldContent":"\t\t\t\t\t\t.collect(Collectors.toList());"},{"type":"INSERT","lineNumber":36,"content":"        return new UserDetailsImpl("},{"type":"INSERT","lineNumber":37,"content":"                user.getId(),"},{"type":"INSERT","lineNumber":38,"content":"                user.getUsername(),"},{"type":"INSERT","lineNumber":39,"content":"                user.getPassword(),"},{"type":"INSERT","lineNumber":40,"content":"                Collections.singletonList(authority)"},{"type":"INSERT","lineNumber":41,"content":"        );"},{"type":"INSERT","lineNumber":42,"content":"    }"},{"type":"DELETE","lineNumber":41,"oldContent":"\t\treturn new UserDetailsImpl("},{"type":"DELETE","lineNumber":42,"oldContent":"\t\t\t\tuser.getId(), "},{"type":"DELETE","lineNumber":43,"oldContent":"\t\t\t\tuser.getUsername(),"},{"type":"DELETE","lineNumber":44,"oldContent":"\t\t\t\tuser.getPassword(),"},{"type":"DELETE","lineNumber":45,"oldContent":"\t}"},{"type":"DELETE","lineNumber":46,"oldContent":"\t}"},{"type":"INSERT","lineNumber":44,"content":"    @Override"},{"type":"INSERT","lineNumber":45,"content":"    public Collection<? extends GrantedAuthority> getAuthorities() {"},{"type":"INSERT","lineNumber":46,"content":"        return authorities;"},{"type":"INSERT","lineNumber":47,"content":"    }"},{"type":"DELETE","lineNumber":48,"oldContent":"\t@Override"},{"type":"DELETE","lineNumber":49,"oldContent":"\t\t\t\tuser.getId(), "},{"type":"DELETE","lineNumber":50,"oldContent":"\t\treturn authority;"},{"type":"DELETE","lineNumber":51,"oldContent":"\t}"},{"type":"INSERT","lineNumber":49,"content":"    public Long getId() {"},{"type":"INSERT","lineNumber":50,"content":"        return id;"},{"type":"INSERT","lineNumber":51,"content":"    }"},{"type":"DELETE","lineNumber":53,"oldContent":"\tpublic Long getId() {"},{"type":"DELETE","lineNumber":54,"oldContent":"\t\treturn id;"},{"type":"DELETE","lineNumber":55,"oldContent":"\t}"},{"type":"INSERT","lineNumber":53,"content":"    @Override"},{"type":"INSERT","lineNumber":54,"content":"    public String getPassword() {"},{"type":"INSERT","lineNumber":55,"content":"        return password;"},{"type":"INSERT","lineNumber":56,"content":"    }"},{"type":"DELETE","lineNumber":57,"oldContent":"\t@Override"},{"type":"DELETE","lineNumber":58,"oldContent":"\tpublic String getPassword() {"},{"type":"DELETE","lineNumber":59,"oldContent":"\t\treturn password;"},{"type":"DELETE","lineNumber":60,"oldContent":"\t}"},{"type":"INSERT","lineNumber":58,"content":"    @Override"},{"type":"INSERT","lineNumber":59,"content":"    public String getUsername() {"},{"type":"INSERT","lineNumber":60,"content":"        return username;"},{"type":"INSERT","lineNumber":61,"content":"    }"},{"type":"DELETE","lineNumber":62,"oldContent":"\t@Override"},{"type":"DELETE","lineNumber":63,"oldContent":"\tpublic String getUsername() {"},{"type":"DELETE","lineNumber":64,"oldContent":"\t\treturn username;"},{"type":"DELETE","lineNumber":65,"oldContent":"\t}"},{"type":"INSERT","lineNumber":63,"content":"    @Override"},{"type":"INSERT","lineNumber":64,"content":"    public boolean isAccountNonExpired() {"},{"type":"INSERT","lineNumber":65,"content":"        return true;"},{"type":"INSERT","lineNumber":66,"content":"    }"},{"type":"DELETE","lineNumber":67,"oldContent":"\t@Override"},{"type":"DELETE","lineNumber":68,"oldContent":"\tpublic boolean isAccountNonExpired() {"},{"type":"DELETE","lineNumber":69,"oldContent":"\t\treturn true;"},{"type":"DELETE","lineNumber":70,"oldContent":"\t}"},{"type":"INSERT","lineNumber":68,"content":"    @Override"},{"type":"INSERT","lineNumber":69,"content":"    public boolean isAccountNonLocked() {"},{"type":"INSERT","lineNumber":70,"content":"        return true;"},{"type":"INSERT","lineNumber":71,"content":"    }"},{"type":"DELETE","lineNumber":72,"oldContent":"\t@Override"},{"type":"DELETE","lineNumber":73,"oldContent":"\tpublic boolean isAccountNonLocked() {"},{"type":"DELETE","lineNumber":74,"oldContent":"\t\treturn true;"},{"type":"DELETE","lineNumber":75,"oldContent":"\t}"},{"type":"INSERT","lineNumber":73,"content":"    @Override"},{"type":"INSERT","lineNumber":74,"content":"    public boolean isCredentialsNonExpired() {"},{"type":"INSERT","lineNumber":75,"content":"        return true;"},{"type":"INSERT","lineNumber":76,"content":"    }"},{"type":"DELETE","lineNumber":77,"oldContent":"\t@Override"},{"type":"DELETE","lineNumber":78,"oldContent":"\tpublic boolean isCredentialsNonExpired() {"},{"type":"DELETE","lineNumber":79,"oldContent":"\t\treturn true;"},{"type":"DELETE","lineNumber":80,"oldContent":"\t}"},{"type":"INSERT","lineNumber":78,"content":"    @Override"},{"type":"INSERT","lineNumber":79,"content":"    public boolean isEnabled() {"},{"type":"INSERT","lineNumber":80,"content":"        return true;"},{"type":"INSERT","lineNumber":81,"content":"    }"},{"type":"DELETE","lineNumber":82,"oldContent":"\t@Override"},{"type":"DELETE","lineNumber":83,"oldContent":"\tpublic boolean isEnabled() {"},{"type":"DELETE","lineNumber":84,"oldContent":"\tpublic boolean isAccountNonExpired() {"},{"type":"DELETE","lineNumber":85,"oldContent":"\t}"},{"type":"DELETE","lineNumber":86,"oldContent":"\t@Override"},{"type":"DELETE","lineNumber":87,"oldContent":"\t\treturn true;"},{"type":"DELETE","lineNumber":88,"oldContent":""},{"type":"DELETE","lineNumber":89,"oldContent":"\t\tif (this == o)"},{"type":"DELETE","lineNumber":90,"oldContent":"\t\t\treturn true;"},{"type":"DELETE","lineNumber":91,"oldContent":"\t\tif (o == null || getClass() != o.getClass())"},{"type":"DELETE","lineNumber":92,"oldContent":"\t\t\treturn false;"},{"type":"DELETE","lineNumber":93,"oldContent":"\t\tUserDetailsImpl user = (UserDetailsImpl) o;"},{"type":"DELETE","lineNumber":94,"oldContent":"\t\treturn Objects.equals(id, user.id);"},{"type":"DELETE","lineNumber":95,"oldContent":"\t}"},{"type":"INSERT","lineNumber":83,"content":"    @Override"},{"type":"INSERT","lineNumber":84,"content":"    public boolean equals(Object o) {"},{"type":"INSERT","lineNumber":85,"content":"        if (this == o) return true;"},{"type":"INSERT","lineNumber":86,"content":"        if (o == null || getClass() != o.getClass()) return false;"},{"type":"INSERT","lineNumber":87,"content":"        UserDetailsImpl user = (UserDetailsImpl) o;"},{"type":"INSERT","lineNumber":88,"content":"        return Objects.equals(id, user.id);"},{"type":"INSERT","lineNumber":89,"content":"    }"}]},{"timestamp":1761634636981,"changes":[{"type":"INSERT","lineNumber":8,"content":"import java.util.Collection;"},{"type":"DELETE","lineNumber":11,"oldContent":"    private static final long serialVersionUID = 1L;"},{"type":"INSERT","lineNumber":12,"content":"import java.util.stream.Collectors;"},{"type":"DELETE","lineNumber":13,"oldContent":"    private Long id;"},{"type":"DELETE","lineNumber":15,"oldContent":"    private String username;"},{"type":"DELETE","lineNumber":16,"oldContent":"public class UserDetailsImpl implements UserDetails {"},{"type":"DELETE","lineNumber":17,"oldContent":"    @JsonIgnore"},{"type":"DELETE","lineNumber":18,"oldContent":"    private String password;"},{"type":"INSERT","lineNumber":15,"content":"\tprivate static final long serialVersionUID = 1L;"},{"type":"DELETE","lineNumber":20,"oldContent":"    private Collection<? extends GrantedAuthority> authorities;"},{"type":"INSERT","lineNumber":17,"content":"\tprivate Long id;"},{"type":"DELETE","lineNumber":22,"oldContent":"    public UserDetailsImpl(Long id, String username, String password,"},{"type":"DELETE","lineNumber":23,"oldContent":"                           Collection<? extends GrantedAuthority> authorities) {"},{"type":"INSERT","lineNumber":19,"content":"\tprivate String username;"},{"type":"DELETE","lineNumber":25,"oldContent":"        this.id = id;"},{"type":"DELETE","lineNumber":26,"oldContent":"        this.username = username;"},{"type":"INSERT","lineNumber":21,"content":"\tprivate String email;"},{"type":"DELETE","lineNumber":28,"oldContent":"        this.password = password;"},{"type":"DELETE","lineNumber":29,"oldContent":"        this.authorities = authorities;"},{"type":"DELETE","lineNumber":30,"oldContent":"    }"},{"type":"DELETE","lineNumber":31,"oldContent":"    // Build method to convert AppUser → UserDetailsImpl"},{"type":"DELETE","lineNumber":32,"oldContent":"    public static UserDetailsImpl build(AppUser user) {"},{"type":"DELETE","lineNumber":33,"oldContent":"        // Since user has a single Role"},{"type":"DELETE","lineNumber":34,"oldContent":"        GrantedAuthority authority = new SimpleGrantedAuthority(user.getRole().getName().name());"},{"type":"INSERT","lineNumber":23,"content":"\t@JsonIgnore"},{"type":"INSERT","lineNumber":24,"content":"\tprivate String password;"},{"type":"DELETE","lineNumber":36,"oldContent":"        return new UserDetailsImpl("},{"type":"DELETE","lineNumber":37,"oldContent":"                user.getId(),"},{"type":"DELETE","lineNumber":38,"oldContent":"                user.getUsername(),"},{"type":"DELETE","lineNumber":39,"oldContent":"                user.getPassword(),"},{"type":"DELETE","lineNumber":40,"oldContent":"                Collections.singletonList(authority)"},{"type":"INSERT","lineNumber":26,"content":"\tprivate Collection<? extends GrantedAuthority> authorities;"},{"type":"DELETE","lineNumber":42,"oldContent":"        );"},{"type":"DELETE","lineNumber":43,"oldContent":"    }"},{"type":"DELETE","lineNumber":44,"oldContent":"    @Override"},{"type":"DELETE","lineNumber":45,"oldContent":"    public Collection<? extends GrantedAuthority> getAuthorities() {"},{"type":"DELETE","lineNumber":46,"oldContent":"        return authorities;"},{"type":"DELETE","lineNumber":47,"oldContent":"    }"},{"type":"INSERT","lineNumber":28,"content":"\tpublic UserDetailsImpl(Long id, String username, String email, String password,"},{"type":"INSERT","lineNumber":29,"content":"\t\t\t\t\t\t   Collection<? extends GrantedAuthority> authorities) {"},{"type":"INSERT","lineNumber":30,"content":"\t\tthis.id = id;"},{"type":"INSERT","lineNumber":31,"content":"\t\tthis.username = username;"},{"type":"INSERT","lineNumber":32,"content":"\t\tthis.email = email;"},{"type":"INSERT","lineNumber":33,"content":"\t\tthis.password = password;"},{"type":"INSERT","lineNumber":34,"content":"\t\tthis.authorities = authorities;"},{"type":"INSERT","lineNumber":35,"content":"\t}"},{"type":"DELETE","lineNumber":49,"oldContent":"    public Long getId() {"},{"type":"DELETE","lineNumber":50,"oldContent":"        return id;"},{"type":"DELETE","lineNumber":51,"oldContent":"    }"},{"type":"INSERT","lineNumber":37,"content":"\tpublic static UserDetailsImpl build(UserEntity user) {"},{"type":"INSERT","lineNumber":38,"content":"\t\tList<GrantedAuthority> authorities = user.getRoles().stream()"},{"type":"INSERT","lineNumber":39,"content":"\t\t\t\t.map(role -> new SimpleGrantedAuthority(role.getName().name()))"},{"type":"INSERT","lineNumber":40,"content":"\t\t\t\t.collect(Collectors.toList());"},{"type":"DELETE","lineNumber":53,"oldContent":"    @Override"},{"type":"DELETE","lineNumber":54,"oldContent":"    public String getPassword() {"},{"type":"DELETE","lineNumber":55,"oldContent":"        return password;"},{"type":"DELETE","lineNumber":56,"oldContent":"    }"},{"type":"INSERT","lineNumber":42,"content":"\t\treturn new UserDetailsImpl("},{"type":"INSERT","lineNumber":43,"content":"\t\t\t\tuser.getId(),"},{"type":"INSERT","lineNumber":44,"content":"\t\t\t\tuser.getUsername(),"},{"type":"INSERT","lineNumber":45,"content":"\t\t\t\tuser.getEmail(),"},{"type":"INSERT","lineNumber":46,"content":"\t\t\t\tuser.getPassword(),"},{"type":"INSERT","lineNumber":47,"content":"\t\t\t\tauthorities);"},{"type":"INSERT","lineNumber":48,"content":"\t}"},{"type":"DELETE","lineNumber":58,"oldContent":"    @Override"},{"type":"DELETE","lineNumber":59,"oldContent":"    public String getUsername() {"},{"type":"DELETE","lineNumber":60,"oldContent":"        return username;"},{"type":"DELETE","lineNumber":61,"oldContent":"    }"},{"type":"INSERT","lineNumber":50,"content":"\t@Override"},{"type":"INSERT","lineNumber":51,"content":"\tpublic Collection<? extends GrantedAuthority> getAuthorities() {"},{"type":"INSERT","lineNumber":52,"content":"\t\treturn authorities;"},{"type":"INSERT","lineNumber":53,"content":"\t}"},{"type":"DELETE","lineNumber":63,"oldContent":"    @Override"},{"type":"DELETE","lineNumber":64,"oldContent":"    public boolean isAccountNonExpired() {"},{"type":"DELETE","lineNumber":65,"oldContent":"        return true;"},{"type":"DELETE","lineNumber":66,"oldContent":"    }"},{"type":"INSERT","lineNumber":55,"content":"\tpublic Long getId() {"},{"type":"INSERT","lineNumber":56,"content":"\t\treturn id;"},{"type":"INSERT","lineNumber":57,"content":"\t}"},{"type":"DELETE","lineNumber":68,"oldContent":"    @Override"},{"type":"DELETE","lineNumber":69,"oldContent":"    public boolean isAccountNonLocked() {"},{"type":"DELETE","lineNumber":70,"oldContent":"        return true;"},{"type":"DELETE","lineNumber":71,"oldContent":"    }"},{"type":"INSERT","lineNumber":59,"content":"\tpublic String getEmail() {"},{"type":"INSERT","lineNumber":60,"content":"\t\treturn email;"},{"type":"INSERT","lineNumber":61,"content":"\t}"},{"type":"DELETE","lineNumber":73,"oldContent":"    @Override"},{"type":"DELETE","lineNumber":74,"oldContent":"    public boolean isCredentialsNonExpired() {"},{"type":"DELETE","lineNumber":75,"oldContent":"        return true;"},{"type":"DELETE","lineNumber":76,"oldContent":"    }"},{"type":"INSERT","lineNumber":63,"content":"\t@Override"},{"type":"INSERT","lineNumber":64,"content":"\tpublic String getPassword() {"},{"type":"INSERT","lineNumber":65,"content":"\t\treturn password;"},{"type":"INSERT","lineNumber":66,"content":"\t}"},{"type":"DELETE","lineNumber":78,"oldContent":"    @Override"},{"type":"DELETE","lineNumber":79,"oldContent":"    public boolean isEnabled() {"},{"type":"DELETE","lineNumber":80,"oldContent":"        return true;"},{"type":"DELETE","lineNumber":81,"oldContent":"    }"},{"type":"INSERT","lineNumber":68,"content":"\t@Override"},{"type":"INSERT","lineNumber":69,"content":"\tpublic String getUsername() {"},{"type":"INSERT","lineNumber":70,"content":"\t\treturn username;"},{"type":"INSERT","lineNumber":71,"content":"\t}"},{"type":"DELETE","lineNumber":83,"oldContent":"    @Override"},{"type":"DELETE","lineNumber":84,"oldContent":"    public boolean equals(Object o) {"},{"type":"DELETE","lineNumber":85,"oldContent":"        if (this == o) return true;"},{"type":"DELETE","lineNumber":86,"oldContent":"        if (o == null || getClass() != o.getClass()) return false;"},{"type":"DELETE","lineNumber":87,"oldContent":"        UserDetailsImpl user = (UserDetailsImpl) o;"},{"type":"DELETE","lineNumber":88,"oldContent":"        return Objects.equals(id, user.id);"},{"type":"DELETE","lineNumber":89,"oldContent":"    }"},{"type":"INSERT","lineNumber":73,"content":"\t@Override"},{"type":"INSERT","lineNumber":74,"content":"\tpublic boolean isAccountNonExpired() {"},{"type":"INSERT","lineNumber":75,"content":"\t\treturn true;"},{"type":"INSERT","lineNumber":76,"content":"\t}"},{"type":"INSERT","lineNumber":77,"content":""},{"type":"INSERT","lineNumber":78,"content":"\t@Override"},{"type":"INSERT","lineNumber":79,"content":"\tpublic boolean isAccountNonLocked() {"},{"type":"INSERT","lineNumber":80,"content":"\t\treturn true;"},{"type":"INSERT","lineNumber":81,"content":"\t}"},{"type":"INSERT","lineNumber":82,"content":""},{"type":"INSERT","lineNumber":83,"content":"\t@Override"},{"type":"INSERT","lineNumber":84,"content":"\tpublic boolean isCredentialsNonExpired() {"},{"type":"INSERT","lineNumber":85,"content":"\t\treturn true;"},{"type":"INSERT","lineNumber":86,"content":"\t}"},{"type":"INSERT","lineNumber":87,"content":""},{"type":"INSERT","lineNumber":88,"content":"\t@Override"},{"type":"INSERT","lineNumber":89,"content":"\tpublic boolean isEnabled() {"},{"type":"INSERT","lineNumber":90,"content":"\t\treturn true;"},{"type":"INSERT","lineNumber":91,"content":"\t}"},{"type":"INSERT","lineNumber":92,"content":""},{"type":"INSERT","lineNumber":93,"content":"\t@Override"},{"type":"INSERT","lineNumber":94,"content":"\tpublic boolean equals(Object o) {"},{"type":"INSERT","lineNumber":95,"content":"\t\tif (this == o)"},{"type":"INSERT","lineNumber":96,"content":"\t\t\treturn true;"},{"type":"INSERT","lineNumber":97,"content":"\t\tif (o == null || getClass() != o.getClass())"},{"type":"INSERT","lineNumber":98,"content":"\t\t\treturn false;"},{"type":"INSERT","lineNumber":99,"content":"\t\tUserDetailsImpl user = (UserDetailsImpl) o;"},{"type":"INSERT","lineNumber":100,"content":"\t\treturn Objects.equals(id, user.id);"},{"type":"INSERT","lineNumber":101,"content":"\t}"}]},{"timestamp":1761634645837,"changes":[{"type":"INSERT","lineNumber":16,"content":""},{"type":"INSERT","lineNumber":18,"content":""},{"type":"DELETE","lineNumber":35,"oldContent":"\tpublic static UserDetailsImpl build(UserEntity user) {"},{"type":"INSERT","lineNumber":37,"content":"\tpublic static UserDetailsImpl build(AppUser user) {"},{"type":"DELETE","lineNumber":51,"oldContent":""},{"type":"INSERT","lineNumber":54,"content":""},{"type":"DELETE","lineNumber":76,"oldContent":""},{"type":"DELETE","lineNumber":82,"oldContent":""},{"type":"DELETE","lineNumber":91,"oldContent":"}"},{"type":"DELETE","lineNumber":93,"oldContent":"\t\treturn true;"},{"type":"DELETE","lineNumber":95,"oldContent":"\t}"},{"type":"DELETE","lineNumber":97,"oldContent":"\t\treturn Objects.equals(id, user.id);"},{"type":"DELETE","lineNumber":99,"oldContent":"\t\tUserDetailsImpl user = (UserDetailsImpl) o;"},{"type":"DELETE","lineNumber":101,"oldContent":"\t\t\treturn false;"},{"type":"INSERT","lineNumber":98,"content":"\t\t\treturn false;"},{"type":"INSERT","lineNumber":99,"content":"\t\tUserDetailsImpl user = (UserDetailsImpl) o;"},{"type":"INSERT","lineNumber":100,"content":"\t\treturn Objects.equals(id, user.id);"},{"type":"INSERT","lineNumber":101,"content":"\t}"},{"type":"INSERT","lineNumber":102,"content":"}"},{"type":"INSERT","lineNumber":103,"content":""}]},{"timestamp":1761634652836,"changes":[{"type":"INSERT","lineNumber":18,"content":""},{"type":"DELETE","lineNumber":20,"oldContent":""},{"type":"MODIFY","lineNumber":25,"content":"","oldContent":"\tprivate String email;"},{"type":"MODIFY","lineNumber":27,"content":"","oldContent":"\t@JsonIgnore"},{"type":"MODIFY","lineNumber":38,"content":"\t\tList<GrantedAuthority> authorities = user.getRoles().stream()","oldContent":"\t\tList<GrantedAuthority> authorities = user.getRoles().stream()"},{"type":"DELETE","lineNumber":45,"oldContent":"\t\t\t\tuser.getEmail(),"},{"type":"MODIFY","lineNumber":54,"content":"\tpublic Long getId() {","oldContent":"\tpublic Long getId() {"},{"type":"DELETE","lineNumber":58,"oldContent":"\t@Override"},{"type":"INSERT","lineNumber":57,"content":""},{"type":"DELETE","lineNumber":67,"oldContent":"\t\treturn email;"},{"type":"INSERT","lineNumber":66,"content":""},{"type":"MODIFY","lineNumber":94,"content":"\t\tif (this == o)","oldContent":"\t\t\treturn false;"},{"type":"INSERT","lineNumber":95,"content":"\t\t\treturn true;"},{"type":"INSERT","lineNumber":96,"content":"\t\tif (o == null || getClass() != o.getClass())"},{"type":"INSERT","lineNumber":97,"content":"\t\t\treturn false;"},{"type":"DELETE","lineNumber":98,"oldContent":"\t\tif (this == o)"},{"type":"DELETE","lineNumber":101,"oldContent":"\t\t\treturn true;"},{"type":"DELETE","lineNumber":103,"oldContent":"\t\tif (o == null || getClass() != o.getClass())"}]},{"timestamp":1761634661462,"changes":[{"type":"MODIFY","lineNumber":14,"content":"public class UserDetailsImpl implements UserDetails {","oldContent":""},{"type":"DELETE","lineNumber":32,"oldContent":"\t\tthis.email = email;"},{"type":"INSERT","lineNumber":36,"content":"\tpublic static UserDetailsImpl build(AppUser user) {"},{"type":"DELETE","lineNumber":38,"oldContent":"\t\tList<GrantedAuthority> authorities = user.getRoles().stream()"},{"type":"MODIFY","lineNumber":53,"content":"\tpublic Long getId() {","oldContent":"\tpublic Long getId() {"},{"type":"MODIFY","lineNumber":56,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":65,"content":"","oldContent":""},{"type":"INSERT","lineNumber":92,"content":"\tpublic boolean equals(Object o) {"},{"type":"DELETE","lineNumber":95,"oldContent":"\tpublic boolean equals(Object o) {"},{"type":"MODIFY","lineNumber":97,"content":"\t\tUserDetailsImpl user = (UserDetailsImpl) o;","oldContent":"\t\tUserDetailsImpl user = (UserDetailsImpl) o;"}]},{"timestamp":1761634663824,"changes":[{"type":"MODIFY","lineNumber":28,"content":"\tpublic UserDetailsImpl(Long id, String username, String password,","oldContent":"\tpublic UserDetailsImpl(Long id, String username, String email, String password,"},{"type":"MODIFY","lineNumber":36,"content":"\tpublic static UserDetailsImpl build(AppUser user) {","oldContent":"\tpublic static UserDetailsImpl build(AppUser user) {"},{"type":"MODIFY","lineNumber":53,"content":"\tpublic Long getId() {","oldContent":"\tpublic Long getId() {"},{"type":"MODIFY","lineNumber":56,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":65,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":92,"content":"\tpublic boolean equals(Object o) {","oldContent":"\tpublic boolean equals(Object o) {"},{"type":"MODIFY","lineNumber":97,"content":"\t\tUserDetailsImpl user = (UserDetailsImpl) o;","oldContent":"\t\tUserDetailsImpl user = (UserDetailsImpl) o;"}]},{"timestamp":1761635041604,"changes":[{"type":"DELETE","lineNumber":9,"oldContent":"import java.util.Collections;"},{"type":"INSERT","lineNumber":34,"content":""},{"type":"DELETE","lineNumber":36,"oldContent":"\tpublic static UserDetailsImpl build(AppUser user) {"},{"type":"INSERT","lineNumber":51,"content":""},{"type":"DELETE","lineNumber":53,"oldContent":"\tpublic Long getId() {"},{"type":"INSERT","lineNumber":54,"content":"\t}"},{"type":"DELETE","lineNumber":56,"oldContent":""},{"type":"INSERT","lineNumber":63,"content":"\t}"},{"type":"DELETE","lineNumber":65,"oldContent":""},{"type":"INSERT","lineNumber":90,"content":"\t@Override"},{"type":"DELETE","lineNumber":92,"oldContent":"\tpublic boolean equals(Object o) {"},{"type":"INSERT","lineNumber":95,"content":"\t\t\treturn false;"},{"type":"DELETE","lineNumber":97,"oldContent":"\t\tUserDetailsImpl user = (UserDetailsImpl) o;"}]},{"timestamp":1761678782297,"changes":[{"type":"DELETE","lineNumber":20,"oldContent":"\tprivate String email;"},{"type":"DELETE","lineNumber":21,"oldContent":""},{"type":"MODIFY","lineNumber":32,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":49,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":52,"content":"\t}","oldContent":"\t}"},{"type":"MODIFY","lineNumber":61,"content":"\t}","oldContent":"\t}"},{"type":"MODIFY","lineNumber":88,"content":"\t@Override","oldContent":"\t@Override"},{"type":"MODIFY","lineNumber":93,"content":"\t\t\treturn false;","oldContent":"\t\t\treturn false;"}]},{"timestamp":1761678788097,"changes":[{"type":"INSERT","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.entities.AppUser;"},{"type":"DELETE","lineNumber":3,"oldContent":"import com.prodapt.springsecurityusingjwtexample.entities.UserEntity;"},{"type":"DELETE","lineNumber":30,"oldContent":""},{"type":"DELETE","lineNumber":31,"oldContent":""},{"type":"INSERT","lineNumber":30,"content":"\t\tthis.authorities = authorities;"},{"type":"INSERT","lineNumber":32,"content":""},{"type":"DELETE","lineNumber":47,"oldContent":""},{"type":"DELETE","lineNumber":48,"oldContent":""},{"type":"INSERT","lineNumber":47,"content":"\t\treturn authorities;"},{"type":"DELETE","lineNumber":50,"oldContent":"\t}"},{"type":"DELETE","lineNumber":51,"oldContent":"\t}"},{"type":"DELETE","lineNumber":52,"oldContent":"\t\treturn id;"},{"type":"DELETE","lineNumber":54,"oldContent":"\tpublic String getEmail() {"},{"type":"DELETE","lineNumber":55,"oldContent":"\t\treturn email;"},{"type":"INSERT","lineNumber":50,"content":"\tpublic Long getId() {"},{"type":"INSERT","lineNumber":51,"content":"\t\treturn id;"},{"type":"DELETE","lineNumber":59,"oldContent":"\t}"},{"type":"DELETE","lineNumber":60,"oldContent":"\t}"},{"type":"INSERT","lineNumber":55,"content":"\tpublic String getPassword() {"},{"type":"INSERT","lineNumber":57,"content":"\t}"},{"type":"DELETE","lineNumber":86,"oldContent":"\t@Override"},{"type":"DELETE","lineNumber":87,"oldContent":"\t@Override"},{"type":"INSERT","lineNumber":82,"content":"\t}"},{"type":"INSERT","lineNumber":84,"content":"\t@Override"},{"type":"DELETE","lineNumber":91,"oldContent":"\t\t\treturn false;"},{"type":"DELETE","lineNumber":92,"oldContent":"\t\t\treturn false;"},{"type":"INSERT","lineNumber":87,"content":"\t\t\treturn true;"},{"type":"INSERT","lineNumber":89,"content":"\t\t\treturn false;"}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/service/UserDetailsServiceImpl.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/service/UserDetailsServiceImpl.java","baseContent":"package com.capstone.tele_ticketing_backend_1.security.service;\n\nimport com.capstone.tele_ticketing_backend_1.entities.AppUser;\nimport com.capstone.tele_ticketing_backend_1.repo.UserRepo;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.core.userdetails.UserDetailsService;\nimport org.springframework.security.core.userdetails.UsernameNotFoundException;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\n@Service\npublic class UserDetailsServiceImpl implements UserDetailsService {\n  @Autowired\n  private UserRepo userRepository;\n\n  @Override\n  @Transactional\n  public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n    AppUser user = userRepository.findByUsername(username)\n        .orElseThrow(() -> new UsernameNotFoundException(\"User Not Found with username: \" + username));\n\n    return UserDetailsImpl.build(user);\n  }\n}","baseTimestamp":1761626959741,"deltas":[{"timestamp":1761632031021,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.AppUser;"},{"type":"DELETE","lineNumber":3,"oldContent":"import com.capstone.tele_ticketing_backend_1.repo.UserRepo;"},{"type":"INSERT","lineNumber":2,"content":""},{"type":"INSERT","lineNumber":3,"content":"import com.prodapt.springsecurityusingjwtexample.entities.UserEntity;"},{"type":"INSERT","lineNumber":4,"content":"import com.prodapt.springsecurityusingjwtexample.repositories.UserRepository;"},{"type":"INSERT","lineNumber":5,"content":""},{"type":"INSERT","lineNumber":13,"content":"import com.capstone.tele_ticketing_backend_1.repo.UserRepo;"},{"type":"INSERT","lineNumber":14,"content":""},{"type":"INSERT","lineNumber":15,"content":""},{"type":"DELETE","lineNumber":19,"oldContent":"    AppUser user = userRepository.findByUsername(username)"},{"type":"INSERT","lineNumber":24,"content":"    UserEntity user = userRepository.findByUsername(username)"},{"type":"DELETE","lineNumber":22,"oldContent":"    return UserDetailsImpl.build(user);"},{"type":"INSERT","lineNumber":27,"content":"        return UserDetailsImpl.build(user);"},{"type":"INSERT","lineNumber":29,"content":""}]},{"timestamp":1761632035056,"changes":[{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.entities.AppUser;"},{"type":"DELETE","lineNumber":5,"oldContent":"import org.springframework.beans.factory.annotation.Autowired;"},{"type":"INSERT","lineNumber":7,"content":"import org.springframework.beans.factory.annotation.Autowired;"},{"type":"INSERT","lineNumber":14,"content":"import com.capstone.tele_ticketing_backend_1.repo.UserRepo;"},{"type":"INSERT","lineNumber":15,"content":""},{"type":"INSERT","lineNumber":16,"content":""},{"type":"DELETE","lineNumber":15,"oldContent":"import com.capstone.tele_ticketing_backend_1.repo.UserRepo;"},{"type":"DELETE","lineNumber":17,"oldContent":""},{"type":"DELETE","lineNumber":20,"oldContent":""},{"type":"INSERT","lineNumber":25,"content":"    AppUser user = userRepository.findByUsername(username)"},{"type":"INSERT","lineNumber":28,"content":"        return UserDetailsImpl.build(user);"},{"type":"DELETE","lineNumber":27,"oldContent":"    UserEntity user = userRepository.findByUsername(username)"},{"type":"DELETE","lineNumber":28,"oldContent":"}"},{"type":"DELETE","lineNumber":30,"oldContent":"        return UserDetailsImpl.build(user);"},{"type":"INSERT","lineNumber":31,"content":"}"}]},{"timestamp":1761632047760,"changes":[{"type":"DELETE","lineNumber":4,"oldContent":"import com.prodapt.springsecurityusingjwtexample.entities.UserEntity;"},{"type":"DELETE","lineNumber":5,"oldContent":"import com.prodapt.springsecurityusingjwtexample.repositories.UserRepository;"},{"type":"DELETE","lineNumber":14,"oldContent":"@Service"},{"type":"DELETE","lineNumber":16,"oldContent":"public class UserDetailsServiceImpl implements UserDetailsService {"},{"type":"INSERT","lineNumber":15,"content":"@Service"},{"type":"INSERT","lineNumber":16,"content":"public class UserDetailsServiceImpl implements UserDetailsService {"},{"type":"MODIFY","lineNumber":24,"content":"        .orElseThrow(() -> new UsernameNotFoundException(\"User Not Found with username: \" + username));","oldContent":"        .orElseThrow(() -> new UsernameNotFoundException(\"User Not Found with username: \" + username));"},{"type":"MODIFY","lineNumber":27,"content":"  }","oldContent":"  }"}]},{"timestamp":1761632071374,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":""},{"type":"DELETE","lineNumber":12,"oldContent":"@Service"},{"type":"MODIFY","lineNumber":14,"content":"@Service","oldContent":"public class UserDetailsServiceImpl implements UserDetailsService {"},{"type":"INSERT","lineNumber":15,"content":"public class UserDetailsServiceImpl implements UserDetailsService {"},{"type":"DELETE","lineNumber":22,"oldContent":"        .orElseThrow(() -> new UsernameNotFoundException(\"User Not Found with username: \" + username));"},{"type":"DELETE","lineNumber":23,"oldContent":"        .orElseThrow(() -> new UsernameNotFoundException(\"User Not Found with username: \" + username));"},{"type":"INSERT","lineNumber":21,"content":"  public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {"},{"type":"DELETE","lineNumber":25,"oldContent":"  }"},{"type":"DELETE","lineNumber":26,"oldContent":"  }"},{"type":"INSERT","lineNumber":23,"content":"        .orElseThrow(() -> new UsernameNotFoundException(\"User Not Found with username: \" + username));"},{"type":"INSERT","lineNumber":24,"content":""},{"type":"INSERT","lineNumber":26,"content":"  }"}]},{"timestamp":1761638994673,"changes":[{"type":"DELETE","lineNumber":12,"oldContent":"@Service"},{"type":"DELETE","lineNumber":13,"oldContent":"public class UserDetailsServiceImpl implements UserDetailsService {"},{"type":"INSERT","lineNumber":14,"content":"@Service"},{"type":"INSERT","lineNumber":15,"content":"public class UserDetailsServiceImpl implements UserDetailsService {"},{"type":"INSERT","lineNumber":19,"content":""},{"type":"DELETE","lineNumber":20,"oldContent":"  public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {"},{"type":"INSERT","lineNumber":22,"content":"  public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {"},{"type":"INSERT","lineNumber":23,"content":"    AppUser user = userRepository.findByUsername(username)"},{"type":"DELETE","lineNumber":24,"oldContent":"    AppUser user = userRepository.findByUsername(username)"},{"type":"DELETE","lineNumber":25,"oldContent":"  }"},{"type":"INSERT","lineNumber":27,"content":"  }"}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/payload/response/JwtResponse.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/payload/response/JwtResponse.java","baseContent":"package com.capstone.tele_ticketing_backend_1.security.payload.response;\n\nimport lombok.*;\nimport lombok.ToString.Exclude;\n\nimport java.util.List;\n\n@Getter\n@Setter\n@NoArgsConstructor\n@AllArgsConstructor\n@ToString\npublic class JwtResponse {\n\tprivate String accessToken;\n\tprivate String tokenType = \"Bearer\";\n\tprivate Long id;\n\tprivate String username;\n\t@Exclude\n\tprivate List<String> roles;\n\n\tpublic JwtResponse(String accessToken, Long id, String username, String email, List<String> roles) {\n\t\tthis.accessToken = accessToken;\n\t\tthis.id = id;\n\t\tthis.username = username;\n\t\tthis.email = email;\n\t\tthis.roles = roles;\n\t}\n}","baseTimestamp":1761628377267,"deltas":[{"timestamp":1761628391503,"changes":[{"type":"MODIFY","lineNumber":18,"content":"\tprivate String role;","oldContent":"\tprivate List<String> roles;"}]},{"timestamp":1761628398393,"changes":[{"type":"MODIFY","lineNumber":20,"content":"\tpublic JwtResponse(String accessToken, Long id, String username, List<String> roles) {","oldContent":"\tpublic JwtResponse(String accessToken, Long id, String username, String email, List<String> roles) {"}]},{"timestamp":1761628401391,"changes":[{"type":"MODIFY","lineNumber":20,"content":"\tpublic JwtResponse(String accessToken, Long id, String username) {","oldContent":"\tpublic JwtResponse(String accessToken, Long id, String username, List<String> roles) {"}]},{"timestamp":1761628407445,"changes":[{"type":"DELETE","lineNumber":24,"oldContent":"\t\tthis.email = email;"},{"type":"DELETE","lineNumber":25,"oldContent":"\t\tthis.roles = roles;"}]},{"timestamp":1761678702909,"changes":[{"type":"MODIFY","lineNumber":20,"content":"\tpublic JwtResponse(String accessToken, Long id, String username, String role) {","oldContent":"\tpublic JwtResponse(String accessToken, Long id, String username) {"},{"type":"INSERT","lineNumber":24,"content":"\t\tthis.role = role;"}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/payload/request/SignupRequest.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/payload/request/SignupRequest.java","baseContent":"package com.capstone.tele_ticketing_backend_1.security.payload.request;\n\nimport jakarta.validation.constraints.Email;\nimport jakarta.validation.constraints.NotBlank;\nimport jakarta.validation.constraints.Size;\nimport lombok.*;\n\nimport java.util.Set;\n\n@Getter\n@Setter\n@NoArgsConstructor\n@AllArgsConstructor\n@ToString\npublic class SignupRequest {\n\t@NotBlank\n\t@Size(min = 3, max = 20)\n\tprivate String username;\n\n\t@NotBlank\n\t@Size(max = 50)\n\t@Email\n\tprivate String email;\n\n\tprivate Set<String> role;\n\n\t@NotBlank\n\t@Size(min = 6, max = 40)\n\tprivate String password;\n\t\n\t@NotBlank\n\t@Size(max = 10)\n\tprivate String mobile;\n\t\n\n}","baseTimestamp":1761641428133,"deltas":[{"timestamp":1761641431651,"changes":[{"type":"DELETE","lineNumber":30,"oldContent":"\t@NotBlank"},{"type":"DELETE","lineNumber":31,"oldContent":"\t@Size(max = 10)"},{"type":"DELETE","lineNumber":32,"oldContent":"\tprivate String mobile;"},{"type":"DELETE","lineNumber":33,"oldContent":"\t"}]},{"timestamp":1761641434827,"changes":[{"type":"INSERT","lineNumber":18,"content":"\t"},{"type":"DELETE","lineNumber":19,"oldContent":"\t@NotBlank"},{"type":"DELETE","lineNumber":20,"oldContent":"\t@Size(max = 50)"},{"type":"DELETE","lineNumber":21,"oldContent":"\t@Email"},{"type":"DELETE","lineNumber":22,"oldContent":"\tprivate String email;"},{"type":"DELETE","lineNumber":23,"oldContent":""}]},{"timestamp":1761641440463,"changes":[{"type":"MODIFY","lineNumber":26,"content":"","oldContent":"\t"}]},{"timestamp":1761641510430,"changes":[{"type":"MODIFY","lineNumber":19,"content":"","oldContent":"\t"},{"type":"MODIFY","lineNumber":26,"content":"","oldContent":"\t"}]},{"timestamp":1761643398056,"changes":[{"type":"INSERT","lineNumber":19,"content":"\t@NotBlank"},{"type":"INSERT","lineNumber":20,"content":"\tprivate String fullname;"},{"type":"INSERT","lineNumber":22,"content":""},{"type":"DELETE","lineNumber":25,"oldContent":"\t"},{"type":"INSERT","lineNumber":29,"content":""}]},{"timestamp":1761643400079,"changes":[{"type":"MODIFY","lineNumber":21,"content":"\t","oldContent":""},{"type":"DELETE","lineNumber":24,"oldContent":""},{"type":"MODIFY","lineNumber":29,"content":"}","oldContent":"}"}]},{"timestamp":1761643498238,"changes":[{"type":"MODIFY","lineNumber":18,"content":"","oldContent":"\t"},{"type":"INSERT","lineNumber":20,"content":"\tprivate String fullname;"},{"type":"DELETE","lineNumber":21,"oldContent":"\t"},{"type":"MODIFY","lineNumber":29,"content":"}","oldContent":"}"}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/TestController.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/TestController.java","baseContent":"package com.capstone.tele_ticketing_backend_1.controller;\n\n\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n@RestController\npublic class TestController {\n    \n    @GetMapping(\"/\")\n}\n","baseTimestamp":1761645942288,"deltas":[{"timestamp":1761645965444,"changes":[{"type":"MODIFY","lineNumber":9,"content":"    @GetMapping(\"/greet\")","oldContent":"    @GetMapping(\"/\")"},{"type":"INSERT","lineNumber":10,"content":"    public String getGreet(){"},{"type":"INSERT","lineNumber":11,"content":"        return \"hello, working\";"},{"type":"INSERT","lineNumber":12,"content":"    }"}]},{"timestamp":1761646017335,"changes":[{"type":"MODIFY","lineNumber":8,"content":"","oldContent":"    "},{"type":"DELETE","lineNumber":11,"oldContent":"}"},{"type":"MODIFY","lineNumber":13,"content":"}","oldContent":""},{"type":"INSERT","lineNumber":14,"content":""}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/TicketCreationReq.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/TicketCreationReq.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\npublic class TicketCreationReqDTO {\n}\n","baseTimestamp":1761647744416,"deltas":[{"timestamp":1761647752583,"changes":[{"type":"INSERT","lineNumber":3,"content":"    @NotBlank(message = \"Ticket UID is required\")"},{"type":"INSERT","lineNumber":4,"content":"    @Size(max = 50, message = \"Ticket UID must not exceed 50 characters\")"},{"type":"INSERT","lineNumber":5,"content":"    private String ticketUid;"},{"type":"INSERT","lineNumber":6,"content":""},{"type":"INSERT","lineNumber":7,"content":"    @NotBlank(message = \"Title is required\")"},{"type":"INSERT","lineNumber":8,"content":"    private String title;"},{"type":"INSERT","lineNumber":9,"content":""},{"type":"INSERT","lineNumber":10,"content":"    private String description; // optional"},{"type":"INSERT","lineNumber":11,"content":""},{"type":"INSERT","lineNumber":12,"content":"    @NotBlank(message = \"Status is required\")"},{"type":"INSERT","lineNumber":13,"content":"    @Size(max = 50, message = \"Status must not exceed 50 characters\")"},{"type":"INSERT","lineNumber":14,"content":"    private String status;"},{"type":"INSERT","lineNumber":15,"content":""},{"type":"INSERT","lineNumber":16,"content":"    @NotBlank(message = \"Priority is required\")"},{"type":"INSERT","lineNumber":17,"content":"    @Size(max = 50, message = \"Priority must not exceed 50 characters\")"},{"type":"INSERT","lineNumber":18,"content":"    private String priority;"},{"type":"INSERT","lineNumber":19,"content":""},{"type":"INSERT","lineNumber":20,"content":"    @NotBlank(message = \"Severity is required\")"},{"type":"INSERT","lineNumber":21,"content":"    @Size(max = 50, message = \"Severity must not exceed 50 characters\")"},{"type":"INSERT","lineNumber":22,"content":"    private String severity;"},{"type":"INSERT","lineNumber":23,"content":""},{"type":"INSERT","lineNumber":24,"content":"    private String category; // optional"},{"type":"INSERT","lineNumber":25,"content":"    private String subCategory; // optional"},{"type":"INSERT","lineNumber":26,"content":"    private Integer slaDurationHours; // optional"},{"type":"INSERT","lineNumber":27,"content":""},{"type":"INSERT","lineNumber":28,"content":"    @NotNull(message = \"Customer ID is required\")"},{"type":"INSERT","lineNumber":29,"content":"    private Long customerId;"},{"type":"INSERT","lineNumber":30,"content":""},{"type":"INSERT","lineNumber":31,"content":"    @NotNull(message = \"Created By User ID is required\")"},{"type":"INSERT","lineNumber":32,"content":"    private Long createdById;"},{"type":"INSERT","lineNumber":33,"content":""},{"type":"INSERT","lineNumber":34,"content":"    // optional fields"},{"type":"INSERT","lineNumber":35,"content":"    private String issueDate; // can be sent as IS"}]},{"timestamp":1761647759379,"changes":[{"type":"INSERT","lineNumber":2,"content":"import jakarta.validation.constraints.NotBlank;"},{"type":"INSERT","lineNumber":3,"content":""},{"type":"DELETE","lineNumber":4,"oldContent":"}"},{"type":"DELETE","lineNumber":6,"oldContent":""},{"type":"DELETE","lineNumber":8,"oldContent":"    private String issueDate; // can be sent as IS"},{"type":"DELETE","lineNumber":10,"oldContent":"    // optional fields"},{"type":"DELETE","lineNumber":12,"oldContent":""},{"type":"DELETE","lineNumber":14,"oldContent":"    private Long createdById;"},{"type":"DELETE","lineNumber":16,"oldContent":"    @NotNull(message = \"Created By User ID is required\")"},{"type":"DELETE","lineNumber":19,"oldContent":""},{"type":"DELETE","lineNumber":20,"oldContent":"    private Long customerId;"},{"type":"DELETE","lineNumber":22,"oldContent":"    @NotNull(message = \"Customer ID is required\")"},{"type":"DELETE","lineNumber":24,"oldContent":""},{"type":"DELETE","lineNumber":26,"oldContent":"    private Integer slaDurationHours; // optional"},{"type":"DELETE","lineNumber":28,"oldContent":"    private String subCategory; // optional"},{"type":"DELETE","lineNumber":30,"oldContent":"    private String category; // optional"},{"type":"DELETE","lineNumber":32,"oldContent":""},{"type":"DELETE","lineNumber":34,"oldContent":"    private String severity;"},{"type":"DELETE","lineNumber":36,"oldContent":"    @Size(max = 50, message = \"Severity must not exceed 50 characters\")"},{"type":"INSERT","lineNumber":23,"content":"    @Size(max = 50, message = \"Severity must not exceed 50 characters\")"},{"type":"INSERT","lineNumber":24,"content":"    private String severity;"},{"type":"INSERT","lineNumber":25,"content":""},{"type":"INSERT","lineNumber":26,"content":"    private String category; // optional"},{"type":"INSERT","lineNumber":27,"content":"    private String subCategory; // optional"},{"type":"INSERT","lineNumber":28,"content":"    private Integer slaDurationHours; // optional"},{"type":"INSERT","lineNumber":29,"content":""},{"type":"INSERT","lineNumber":30,"content":"    @NotNull(message = \"Customer ID is required\")"},{"type":"INSERT","lineNumber":31,"content":"    private Long customerId;"},{"type":"INSERT","lineNumber":32,"content":""},{"type":"INSERT","lineNumber":33,"content":"    @NotNull(message = \"Created By User ID is required\")"},{"type":"INSERT","lineNumber":34,"content":"    private Long createdById;"},{"type":"INSERT","lineNumber":35,"content":""},{"type":"INSERT","lineNumber":36,"content":"    // optional fields"},{"type":"INSERT","lineNumber":37,"content":"    private String issueDate; // can be sent as IS"},{"type":"INSERT","lineNumber":38,"content":"}"},{"type":"INSERT","lineNumber":39,"content":""}]},{"timestamp":1761647763056,"changes":[{"type":"MODIFY","lineNumber":3,"content":"import jakarta.validation.constraints.Size;","oldContent":"public class TicketCreationReqDTO {"},{"type":"INSERT","lineNumber":5,"content":"public class TicketCreationReqDTO {"},{"type":"DELETE","lineNumber":15,"oldContent":"    @Size(max = 50, message = \"Severity must not exceed 50 characters\")"},{"type":"INSERT","lineNumber":17,"content":"    private String status;"},{"type":"INSERT","lineNumber":18,"content":""},{"type":"INSERT","lineNumber":19,"content":"    @NotBlank(message = \"Priority is required\")"},{"type":"INSERT","lineNumber":20,"content":"    @Size(max = 50, message = \"Priority must not exceed 50 characters\")"},{"type":"INSERT","lineNumber":21,"content":"    private String priority;"},{"type":"INSERT","lineNumber":22,"content":""},{"type":"INSERT","lineNumber":23,"content":"    @NotBlank(message = \"Severity is required\")"},{"type":"INSERT","lineNumber":24,"content":"    @Size(max = 50, message = \"Severity must not exceed 50 characters\")"},{"type":"DELETE","lineNumber":19,"oldContent":"    private String status;"},{"type":"DELETE","lineNumber":22,"oldContent":""},{"type":"DELETE","lineNumber":25,"oldContent":"    @NotBlank(message = \"Priority is required\")"},{"type":"DELETE","lineNumber":28,"oldContent":"    @Size(max = 50, message = \"Priority must not exceed 50 characters\")"},{"type":"DELETE","lineNumber":31,"oldContent":"    private String priority;"},{"type":"DELETE","lineNumber":34,"oldContent":""},{"type":"DELETE","lineNumber":37,"oldContent":"    @NotBlank(message = \"Severity is required\")"}]},{"timestamp":1761647766189,"changes":[{"type":"INSERT","lineNumber":5,"content":""},{"type":"DELETE","lineNumber":18,"oldContent":"    private String severity;"},{"type":"DELETE","lineNumber":20,"oldContent":""},{"type":"DELETE","lineNumber":23,"oldContent":"    private String category; // optional"},{"type":"DELETE","lineNumber":25,"oldContent":"    private String subCategory; // optional"},{"type":"DELETE","lineNumber":28,"oldContent":"    private Integer slaDurationHours; // optional"},{"type":"INSERT","lineNumber":26,"content":"    private String severity;"},{"type":"INSERT","lineNumber":28,"content":"    private String category; // optional"},{"type":"INSERT","lineNumber":29,"content":"    private String subCategory; // optional"},{"type":"INSERT","lineNumber":30,"content":"    private Integer slaDurationHours; // optional"},{"type":"INSERT","lineNumber":31,"content":""}]},{"timestamp":1761647771834,"changes":[{"type":"INSERT","lineNumber":4,"content":"import lombok.Data;"},{"type":"DELETE","lineNumber":5,"oldContent":""},{"type":"INSERT","lineNumber":6,"content":"@Data"},{"type":"DELETE","lineNumber":23,"oldContent":"    private String severity;"},{"type":"INSERT","lineNumber":26,"content":"    @Size(max = 50, message = \"Severity must not exceed 50 characters\")"},{"type":"INSERT","lineNumber":27,"content":"    private String severity;"},{"type":"INSERT","lineNumber":28,"content":""},{"type":"DELETE","lineNumber":28,"oldContent":"    @Size(max = 50, message = \"Severity must not exceed 50 characters\")"},{"type":"DELETE","lineNumber":31,"oldContent":""}]},{"timestamp":1761647796698,"changes":[{"type":"INSERT","lineNumber":3,"content":"import jakarta.validation.constraints.NotNull;"},{"type":"DELETE","lineNumber":27,"oldContent":"    private String category; // optional"},{"type":"MODIFY","lineNumber":30,"content":"    private String category; // optional","oldContent":"    private String subCategory; // optional"},{"type":"INSERT","lineNumber":31,"content":"    private String subCategory; // optional"}]},{"timestamp":1761648022282,"changes":[{"type":"INSERT","lineNumber":15,"content":"    "},{"type":"DELETE","lineNumber":16,"oldContent":"    private String description; // optional"},{"type":"DELETE","lineNumber":17,"oldContent":""},{"type":"DELETE","lineNumber":29,"oldContent":"    private String subCategory; // optional"},{"type":"INSERT","lineNumber":28,"content":""}]},{"timestamp":1761648039794,"changes":[{"type":"MODIFY","lineNumber":16,"content":"","oldContent":"    "},{"type":"MODIFY","lineNumber":28,"content":"","oldContent":""}]},{"timestamp":1761648935359,"changes":[{"type":"DELETE","lineNumber":9,"oldContent":"    @NotBlank(message = \"Ticket UID is required\")"},{"type":"DELETE","lineNumber":10,"oldContent":"    @Size(max = 50, message = \"Ticket UID must not exceed 50 characters\")"},{"type":"DELETE","lineNumber":11,"oldContent":"    private String ticketUid;"},{"type":"DELETE","lineNumber":15,"oldContent":"    "},{"type":"INSERT","lineNumber":13,"content":""},{"type":"INSERT","lineNumber":24,"content":"    private String severity;"},{"type":"DELETE","lineNumber":28,"oldContent":""}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/TicketController.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/TicketController.java","baseContent":"package com.capstone.tele_ticketing_backend_1.controller;\n\nimport org.springframework.web.bind.annotation.RestController;\n\n@RestController\npublic class TicketController {\n}\n","baseTimestamp":1761647829615,"deltas":[{"timestamp":1761647956646,"changes":[{"type":"INSERT","lineNumber":2,"content":"import org.springframework.web.bind.annotation.PostMapping;"}]}]},"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/UserNotFoundException.java":{"filePath":"D:/tele_ticketing_backend_1/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/UserNotFoundException.java","baseContent":"package com.capstone.tele_ticketing_backend_1;\n\npublic class UserNotFoundException extends RuntimeException {\n    public UserNotFoundException(String message) {\n        super(message);\n    }\n}\n","baseTimestamp":1761712194373,"deltas":[{"timestamp":1761721272200,"changes":[{"type":"MODIFY","lineNumber":0,"content":"package com.capstone.tele_ticketing_backend_1.exceptions;","oldContent":"package com.capstone.tele_ticketing_backend_1;"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/TicketActivity.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/TicketActivity.java","baseContent":"package com.capstone.tele_ticketing_backend_1.entities;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\nimport org.hibernate.annotations.CreationTimestamp;\n\nimport java.time.LocalDateTime;\n\n@Entity\n@Table(name = \"ticket_activities\")\n@Data\n@NoArgsConstructor\npublic class TicketActivity {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"ticket_id\", nullable = false)\n    private Ticket ticket;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"user_id\", nullable = false)\n    private AppUser user;\n\n    @Enumerated(EnumType.STRING) // Maps the Enum to a String column in the DB\n    @Column(name = \"activity_type\", nullable = false, length = 50)\n    private ActivityType activityType;\n\n    @Lob\n    @Column(name = \"activity_description\")\n    private String description;\n\n    @CreationTimestamp\n    @Column(name = \"created_at\", updatable = false)\n    private LocalDateTime createdAt;\n}","baseTimestamp":1761772111560,"deltas":[{"timestamp":1761781813033,"changes":[{"type":"INSERT","lineNumber":2,"content":""},{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.model.enums.ActivityType;"},{"type":"INSERT","lineNumber":4,"content":"import com.fasterxml.jackson.annotation.JsonBackReference;"},{"type":"INSERT","lineNumber":24,"content":"    @JsonBackReference"},{"type":"DELETE","lineNumber":27,"oldContent":"    @Enumerated(EnumType.STRING) // Maps the Enum to a String column in the DB"},{"type":"INSERT","lineNumber":31,"content":"    @Enumerated(EnumType.STRING)"}]},{"timestamp":1761781818385,"changes":[{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.entities.ActivityType;"},{"type":"INSERT","lineNumber":4,"content":"import com.fasterxml.jackson.annotation.JsonBackReference;"},{"type":"DELETE","lineNumber":4,"oldContent":"import com.capstone.tele_ticketing_backend_1.model.enums.ActivityType;"},{"type":"DELETE","lineNumber":6,"oldContent":"import com.fasterxml.jackson.annotation.JsonBackReference;"},{"type":"INSERT","lineNumber":24,"content":"    @JsonBackReference"},{"type":"DELETE","lineNumber":27,"oldContent":"    @JsonBackReference"},{"type":"INSERT","lineNumber":31,"content":"    @Enumerated(EnumType.STRING)"},{"type":"DELETE","lineNumber":34,"oldContent":"    @Enumerated(EnumType.STRING)"}]},{"timestamp":1761886832370,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":""},{"type":"MODIFY","lineNumber":4,"content":"import jakarta.persistence.*;","oldContent":"import jakarta.persistence.*;"},{"type":"INSERT","lineNumber":38,"content":"    // Dr. X's Addition: This flag will control visibility."},{"type":"INSERT","lineNumber":39,"content":"    // true = Only internal staff (engineers, triage, etc.) can see it."},{"type":"INSERT","lineNumber":40,"content":"    // false = Everyone, including the customer, can see it."},{"type":"INSERT","lineNumber":41,"content":"    @Column(name = \"is_internal_only\", nullable = false)"},{"type":"INSERT","lineNumber":42,"content":"    private boolean internalOnly = false;"},{"type":"INSERT","lineNumber":43,"content":""},{"type":"DELETE","lineNumber":42,"oldContent":"}"},{"type":"INSERT","lineNumber":47,"content":"}}"}]},{"timestamp":1761886848872,"changes":[{"type":"MODIFY","lineNumber":4,"content":"import jakarta.persistence.*;","oldContent":"import jakarta.persistence.*;"},{"type":"MODIFY","lineNumber":38,"content":"    // Dr. X's Addition: This flag will control visibility.","oldContent":"    // Dr. X's Addition: This flag will control visibility."},{"type":"DELETE","lineNumber":40,"oldContent":"    @CreationTimestamp"},{"type":"DELETE","lineNumber":42,"oldContent":"    @Column(name = \"created_at\", updatable = false)"},{"type":"DELETE","lineNumber":44,"oldContent":"    private LocalDateTime createdAt;"},{"type":"DELETE","lineNumber":47,"oldContent":"}}"},{"type":"INSERT","lineNumber":44,"content":"    @CreationTimestamp"},{"type":"INSERT","lineNumber":45,"content":"    @Column(name = \"created_at\", updatable = false)"},{"type":"INSERT","lineNumber":46,"content":"    private LocalDateTime createdAt;"},{"type":"INSERT","lineNumber":47,"content":"}"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/Ticket.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/Ticket.java","baseContent":"package com.capstone.tele_ticketing_backend_1.entities;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport lombok.EqualsAndHashCode;\nimport lombok.NoArgsConstructor;\nimport lombok.ToString;\nimport org.hibernate.annotations.CreationTimestamp;\nimport org.hibernate.annotations.UpdateTimestamp;\n\nimport java.time.LocalDateTime;\nimport java.util.HashSet;\nimport java.util.Set;\n\n\n@Entity\n@Table(name = \"tickets\")\n@Data\n@NoArgsConstructor\npublic class Ticket {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @Column(name = \"ticket_uid\", unique = true, length = 50, updatable = false)\n    private String ticketUid;\n\n    @Column(nullable = false)\n    private String title;\n\n    @Lob\n    private String description;\n\n    @Enumerated(EnumType.STRING)\n    @Column(length = 50, nullable = false)\n    private TicketStatus status;\n\n    @Enumerated(EnumType.STRING)\n    @Column(length = 50)\n    private TicketPriority priority;\n\n    @Enumerated(EnumType.STRING)\n    @Column(length = 50)\n    private TicketSeverity severity;\n\n    @Enumerated(EnumType.STRING)\n    @Column(nullable = false, length = 50)\n    private TicketCategory category;\n\n    // Dr. X's Note: The subCategory field has been removed as requested.\n\n    @Column(name = \"sla_duration_hours\")\n    private Integer slaDurationHours;\n\n    @Column(name = \"sla_breach_at\")\n    private LocalDateTime slaBreachAt;\n\n    // Dr. X's Note: Renamed 'customer' to 'createdFor' for clarity. This field indicates who the ticket is for.\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"created_for_user_id\", nullable = false)\n    private AppUser createdFor;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"created_by_user_id\", nullable = false)\n    private AppUser createdBy;\n\n    // Dr. X's Note: This new field tracks *who* made the assignment (e.g., a Triage Officer or Team Lead).\n    // This is nullable because a ticket is not assigned at the moment of creation.\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"assigned_by_user_id\")\n    private AppUser assignedBy;\n\n\n    // Dr. X's Note: Renamed 'assignedEngineers' to 'assignedTo'. This set represents the user or users currently responsible for the ticket.\n    @ManyToMany\n    @JoinTable(\n            name = \"ticket_assignments\",\n            joinColumns = @JoinColumn(name = \"ticket_id\"),\n            inverseJoinColumns = @JoinColumn(name = \"user_id\") // More generic name than 'engineer_id'\n    )\n    @ToString.Exclude\n    @EqualsAndHashCode.Exclude\n    private Set<AppUser> assignedTo = new HashSet<>();\n\n\n    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)\n    @ToString.Exclude\n    @EqualsAndHashCode.Exclude\n    private Set<TicketActivity> activities = new HashSet<>();\n\n    @OneToMany(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)\n    @ToString.Exclude\n    @EqualsAndHashCode.Exclude\n    private Set<Attachment> attachments = new HashSet<>();\n\n    @OneToOne(mappedBy = \"ticket\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)\n    @ToString.Exclude\n    @EqualsAndHashCode.Exclude\n    private Feedback feedback;\n\n    @CreationTimestamp\n    @Column(name = \"created_at\", updatable = false)\n    private LocalDateTime createdAt;\n\n    @UpdateTimestamp\n    @Column(name = \"updated_at\")\n    private LocalDateTime updatedAt;\n\n    @Column(name = \"resolved_at\")\n    private LocalDateTime resolvedAt;\n\n    @PrePersist\n    private void onPrePersist() {\n        if (this.ticketUid == null) {\n            this.ticketUid = \"TK-\" + System.currentTimeMillis();\n        }\n        if (this.status == null) {\n            this.status = TicketStatus.CREATED;\n        }\n    }\n}","baseTimestamp":1761776056693,"deltas":[{"timestamp":1761781730940,"changes":[{"type":"INSERT","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.model.enums.TicketCategory;"},{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.model.enums.TicketPriority;"},{"type":"INSERT","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.model.enums.TicketSeverity;"},{"type":"INSERT","lineNumber":5,"content":"import com.capstone.tele_ticketing_backend_1.model.enums.TicketStatus;"},{"type":"INSERT","lineNumber":6,"content":"import com.fasterxml.jackson.annotation.JsonManagedReference;"},{"type":"DELETE","lineNumber":14,"oldContent":""},{"type":"DELETE","lineNumber":50,"oldContent":"    // Dr. X's Note: The subCategory field has been removed as requested."},{"type":"DELETE","lineNumber":51,"oldContent":""},{"type":"DELETE","lineNumber":58,"oldContent":"    // Dr. X's Note: Renamed 'customer' to 'createdFor' for clarity. This field indicates who the ticket is for."},{"type":"DELETE","lineNumber":67,"oldContent":"    // Dr. X's Note: This new field tracks *who* made the assignment (e.g., a Triage Officer or Team Lead)."},{"type":"DELETE","lineNumber":68,"oldContent":"    // This is nullable because a ticket is not assigned at the moment of creation."},{"type":"DELETE","lineNumber":73,"oldContent":""},{"type":"DELETE","lineNumber":74,"oldContent":"    // Dr. X's Note: Renamed 'assignedEngineers' to 'assignedTo'. This set represents the user or users currently responsible for the ticket."},{"type":"DELETE","lineNumber":79,"oldContent":"            inverseJoinColumns = @JoinColumn(name = \"user_id\") // More generic name than 'engineer_id'"},{"type":"INSERT","lineNumber":76,"content":"            inverseJoinColumns = @JoinColumn(name = \"user_id\")"},{"type":"MODIFY","lineNumber":85,"content":"    @JsonManagedReference","oldContent":""},{"type":"INSERT","lineNumber":91,"content":"    @JsonManagedReference"},{"type":"INSERT","lineNumber":97,"content":"    @JsonManagedReference"},{"type":"INSERT","lineNumber":104,"content":""},{"type":"INSERT","lineNumber":105,"content":""}]},{"timestamp":1761781738866,"changes":[{"type":"DELETE","lineNumber":3,"oldContent":"import jakarta.persistence.*;"},{"type":"DELETE","lineNumber":5,"oldContent":"import lombok.Data;"},{"type":"DELETE","lineNumber":7,"oldContent":"import lombok.EqualsAndHashCode;"},{"type":"DELETE","lineNumber":9,"oldContent":"import lombok.NoArgsConstructor;"},{"type":"INSERT","lineNumber":7,"content":"import jakarta.persistence.*;"},{"type":"INSERT","lineNumber":8,"content":"import lombok.Data;"},{"type":"INSERT","lineNumber":9,"content":"import lombok.EqualsAndHashCode;"},{"type":"INSERT","lineNumber":10,"content":"import lombok.NoArgsConstructor;"},{"type":"DELETE","lineNumber":73,"oldContent":"            inverseJoinColumns = @JoinColumn(name = \"user_id\")"},{"type":"INSERT","lineNumber":76,"content":"            inverseJoinColumns = @JoinColumn(name = \"user_id\")"},{"type":"DELETE","lineNumber":82,"oldContent":"    @JsonManagedReference"},{"type":"INSERT","lineNumber":85,"content":"    @JsonManagedReference"},{"type":"DELETE","lineNumber":88,"oldContent":"    @JsonManagedReference"},{"type":"INSERT","lineNumber":91,"content":"    @JsonManagedReference"},{"type":"DELETE","lineNumber":95,"oldContent":"    @JsonManagedReference"},{"type":"INSERT","lineNumber":97,"content":"    @JsonManagedReference"}]},{"timestamp":1761781748655,"changes":[{"type":"MODIFY","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.entities.TicketCategory;","oldContent":"import com.capstone.tele_ticketing_backend_1.model.enums.TicketCategory;"},{"type":"INSERT","lineNumber":5,"content":"import com.capstone.tele_ticketing_backend_1.model.enums.TicketStatus;"},{"type":"INSERT","lineNumber":6,"content":"import com.fasterxml.jackson.annotation.JsonManagedReference;"},{"type":"DELETE","lineNumber":7,"oldContent":"import com.capstone.tele_ticketing_backend_1.model.enums.TicketStatus;"},{"type":"DELETE","lineNumber":10,"oldContent":"import com.fasterxml.jackson.annotation.JsonManagedReference;"},{"type":"MODIFY","lineNumber":76,"content":"            inverseJoinColumns = @JoinColumn(name = \"user_id\")","oldContent":"            inverseJoinColumns = @JoinColumn(name = \"user_id\")"},{"type":"MODIFY","lineNumber":85,"content":"    @JsonManagedReference","oldContent":"    @JsonManagedReference"},{"type":"MODIFY","lineNumber":91,"content":"    @JsonManagedReference","oldContent":"    @JsonManagedReference"},{"type":"MODIFY","lineNumber":97,"content":"    @JsonManagedReference","oldContent":"    @JsonManagedReference"}]},{"timestamp":1761781772699,"changes":[{"type":"MODIFY","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.entities.TicketPriority;","oldContent":"import com.capstone.tele_ticketing_backend_1.model.enums.TicketPriority;"},{"type":"MODIFY","lineNumber":7,"content":"import jakarta.persistence.*;","oldContent":"import jakarta.persistence.*;"},{"type":"INSERT","lineNumber":75,"content":"            joinColumns = @JoinColumn(name = \"ticket_id\"),"},{"type":"DELETE","lineNumber":76,"oldContent":"            inverseJoinColumns = @JoinColumn(name = \"user_id\")"},{"type":"INSERT","lineNumber":84,"content":"    @EqualsAndHashCode.Exclude"},{"type":"DELETE","lineNumber":85,"oldContent":"    @JsonManagedReference"},{"type":"INSERT","lineNumber":90,"content":"    @EqualsAndHashCode.Exclude"},{"type":"DELETE","lineNumber":91,"oldContent":"    @JsonManagedReference"},{"type":"INSERT","lineNumber":96,"content":"    @EqualsAndHashCode.Exclude"},{"type":"DELETE","lineNumber":97,"oldContent":"    @JsonManagedReference"}]},{"timestamp":1761781775557,"changes":[{"type":"MODIFY","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.entities.TicketSeverity;","oldContent":"import com.capstone.tele_ticketing_backend_1.model.enums.TicketSeverity;"},{"type":"INSERT","lineNumber":6,"content":"import com.fasterxml.jackson.annotation.JsonManagedReference;"},{"type":"DELETE","lineNumber":7,"oldContent":"import jakarta.persistence.*;"}]},{"timestamp":1761781778081,"changes":[{"type":"MODIFY","lineNumber":5,"content":"import com.capstone.tele_ticketing_backend_1.entities.TicketStatus;","oldContent":"import com.capstone.tele_ticketing_backend_1.model.enums.TicketStatus;"}]},{"timestamp":1761900429256,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.TicketCategory;"},{"type":"DELETE","lineNumber":3,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.TicketPriority;"},{"type":"DELETE","lineNumber":4,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.TicketSeverity;"},{"type":"DELETE","lineNumber":5,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.TicketStatus;"},{"type":"INSERT","lineNumber":2,"content":""}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/AppUser.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/AppUser.java","baseContent":"package com.capstone.tele_ticketing_backend_1.entities;\n\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport lombok.EqualsAndHashCode;\nimport lombok.NoArgsConstructor;\nimport lombok.ToString;\nimport org.hibernate.annotations.CreationTimestamp;\nimport org.hibernate.annotations.UpdateTimestamp;\nimport java.time.LocalDateTime;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Set;\n@Entity\n@Table(name = \"users\")\n@Data\n@NoArgsConstructor\npublic class AppUser {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @Column(unique = true, nullable = false, length = 100)\n    private String username;\n\n    @Column(nullable = false)\n    private String password;\n\n    @Column(name = \"full_name\", nullable = false)\n    private String fullName;\n\n    @ManyToMany(fetch = FetchType.EAGER) // Dr. X's Note: EAGER fetch for roles is often practical as you almost always need them for security checks.\n    @JoinTable(name = \"user_roles\", joinColumns = @JoinColumn(name = \"user_id\"), inverseJoinColumns = @JoinColumn(name = \"role_id\"))\n    private Set<Role> roles = new HashSet<>();\n\n    // Dr. X's Note: The complex self-referencing ManyToMany is now replaced by a simple, clean relationship to the new Team entity.\n    // This makes queries for team-based operations much more efficient and intuitive.\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"team_id\")\n    private Team team;\n\n    @ManyToMany(mappedBy = \"assignedEngineers\")\n    @ToString.Exclude\n    @EqualsAndHashCode.Exclude\n    private Set<Ticket> assignedTickets = new HashSet<>();\n\n    @CreationTimestamp\n    @Column(name = \"created_at\", updatable = false)\n    private LocalDateTime createdAt;\n\n    @UpdateTimestamp\n    @Column(name = \"updated_at\")\n    private LocalDateTime updatedAt;\n\n    public AppUser(String username, String password, String fullName ){\n        this.username = username;\n        this.password = password;\n        this.fullName = fullName;\n    }\n}","baseTimestamp":1761776101595,"deltas":[{"timestamp":1762143969474,"changes":[{"type":"MODIFY","lineNumber":11,"content":"import java.math.BigDecimal;","oldContent":"import java.math.BigDecimal;"},{"type":"MODIFY","lineNumber":16,"content":"@Entity","oldContent":"@Entity"},{"type":"MODIFY","lineNumber":18,"content":"// Dr. X's Fix: Replace @Data with specific annotations","oldContent":"@Data"},{"type":"INSERT","lineNumber":19,"content":"@Getter"},{"type":"INSERT","lineNumber":20,"content":"@Setter"},{"type":"INSERT","lineNumber":22,"content":"// This is the most critical change. It tells Lombok to ONLY use the 'id' field for equals and hashCode."},{"type":"INSERT","lineNumber":23,"content":"@EqualsAndHashCode(of = \"id\")"},{"type":"DELETE","lineNumber":30,"oldContent":"    private String password;"},{"type":"INSERT","lineNumber":35,"content":"    private String password;"},{"type":"DELETE","lineNumber":35,"oldContent":"    // Dr. X's Addition: Location fields for future analytics."},{"type":"INSERT","lineNumber":40,"content":"    // Dr. X's Addition: Location fields for future analytics."},{"type":"DELETE","lineNumber":38,"oldContent":"    @ManyToMany(fetch = FetchType.EAGER)"},{"type":"DELETE","lineNumber":40,"oldContent":"    @JoinTable(name = \"user_roles\", joinColumns = @JoinColumn(name = \"user_id\"), inverseJoinColumns = @JoinColumn(name = \"role_id\"))"},{"type":"DELETE","lineNumber":42,"oldContent":"    private Set<Role> roles = new HashSet<>();"},{"type":"DELETE","lineNumber":44,"oldContent":""},{"type":"DELETE","lineNumber":46,"oldContent":"    @ManyToOne(fetch = FetchType.LAZY)"},{"type":"DELETE","lineNumber":49,"oldContent":"    @JoinColumn(name = \"team_id\")"},{"type":"DELETE","lineNumber":52,"oldContent":"    private Team team;"},{"type":"DELETE","lineNumber":55,"oldContent":""},{"type":"MODIFY","lineNumber":59,"content":"    @ManyToMany(fetch = FetchType.EAGER)","oldContent":"    @OneToOne(mappedBy = \"teamLead\", fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":60,"content":"    @JoinTable(name = \"user_roles\", joinColumns = @JoinColumn(name = \"user_id\"), inverseJoinColumns = @JoinColumn(name = \"role_id\"))"},{"type":"INSERT","lineNumber":61,"content":"    private Set<Role> roles = new HashSet<>();"},{"type":"INSERT","lineNumber":62,"content":""},{"type":"INSERT","lineNumber":63,"content":"    @ManyToOne(fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":64,"content":"    @JoinColumn(name = \"team_id\")"},{"type":"INSERT","lineNumber":65,"content":"    @JsonBackReference(\"team-members\")"},{"type":"INSERT","lineNumber":66,"content":"    private Team team;"},{"type":"INSERT","lineNumber":67,"content":""},{"type":"INSERT","lineNumber":68,"content":"    @OneToOne(mappedBy = \"teamLead\", fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":69,"content":"    @JsonBackReference(\"team-lead\")"},{"type":"INSERT","lineNumber":73,"content":"    @ToString.Exclude"},{"type":"INSERT","lineNumber":74,"content":"    @EqualsAndHashCode.Exclude"},{"type":"INSERT","lineNumber":76,"content":"    private Set<Ticket> assignedTickets = new HashSet<>();"},{"type":"INSERT","lineNumber":77,"content":""},{"type":"INSERT","lineNumber":78,"content":"    @CreationTimestamp"},{"type":"DELETE","lineNumber":69,"oldContent":"    @JsonBackReference(\"team-members\")"},{"type":"DELETE","lineNumber":74,"oldContent":"    @JsonBackReference(\"team-lead\")"},{"type":"DELETE","lineNumber":78,"oldContent":"    @ToString.Exclude"},{"type":"INSERT","lineNumber":87,"content":"        this.username = username;"},{"type":"DELETE","lineNumber":80,"oldContent":"    @EqualsAndHashCode.Exclude"},{"type":"DELETE","lineNumber":83,"oldContent":"    private Set<Ticket> assignedTickets = new HashSet<>();"},{"type":"DELETE","lineNumber":85,"oldContent":""},{"type":"DELETE","lineNumber":86,"oldContent":"        this.username = username;"},{"type":"DELETE","lineNumber":87,"oldContent":"    @CreationTimestamp"}]},{"timestamp":1762143975238,"changes":[{"type":"DELETE","lineNumber":5,"oldContent":"import lombok.Data;"},{"type":"DELETE","lineNumber":6,"oldContent":"import lombok.EqualsAndHashCode;"},{"type":"DELETE","lineNumber":7,"oldContent":"import lombok.NoArgsConstructor;"},{"type":"DELETE","lineNumber":8,"oldContent":"import lombok.ToString;"},{"type":"INSERT","lineNumber":5,"content":"import lombok.*;"},{"type":"INSERT","lineNumber":7,"content":"import org.hibernate.annotations.UpdateTimestamp;"},{"type":"DELETE","lineNumber":11,"oldContent":"import java.math.BigDecimal;"},{"type":"INSERT","lineNumber":12,"content":""},{"type":"DELETE","lineNumber":16,"oldContent":"@Entity"},{"type":"DELETE","lineNumber":20,"oldContent":"@NoArgsConstructor"},{"type":"INSERT","lineNumber":18,"content":"@NoArgsConstructor"},{"type":"INSERT","lineNumber":19,"content":"// This is the most critical change. It tells Lombok to ONLY use the 'id' field for equals and hashCode."},{"type":"INSERT","lineNumber":20,"content":"@EqualsAndHashCode(of = \"id\")"},{"type":"DELETE","lineNumber":24,"oldContent":"// This is the most critical change. It tells Lombok to ONLY use the 'id' field for equals and hashCode."},{"type":"DELETE","lineNumber":26,"oldContent":"@EqualsAndHashCode(of = \"id\")"},{"type":"INSERT","lineNumber":32,"content":"    private String password;"},{"type":"DELETE","lineNumber":38,"oldContent":"    private String password;"},{"type":"INSERT","lineNumber":37,"content":"    // Dr. X's Addition: Location fields for future analytics."},{"type":"DELETE","lineNumber":42,"oldContent":"    // Dr. X's Addition: Location fields for future analytics."},{"type":"INSERT","lineNumber":52,"content":"    @Column(precision = 10, scale = 6)"},{"type":"INSERT","lineNumber":53,"content":"    private BigDecimal longitude;"},{"type":"INSERT","lineNumber":54,"content":"    // --- End of new fields ---"},{"type":"INSERT","lineNumber":55,"content":""},{"type":"DELETE","lineNumber":57,"oldContent":"    @OneToOne(mappedBy = \"teamLead\", fetch = FetchType.LAZY)"},{"type":"DELETE","lineNumber":59,"oldContent":"    private BigDecimal longitude;"},{"type":"DELETE","lineNumber":61,"oldContent":"    // --- End of new fields ---"},{"type":"DELETE","lineNumber":63,"oldContent":""},{"type":"DELETE","lineNumber":65,"oldContent":"    private Team ledTeam;"},{"type":"DELETE","lineNumber":67,"oldContent":""},{"type":"DELETE","lineNumber":69,"oldContent":"    @ManyToMany(mappedBy = \"assignedTo\")"},{"type":"DELETE","lineNumber":71,"oldContent":"    @JsonIgnore"},{"type":"DELETE","lineNumber":73,"oldContent":"    @Column(name = \"created_at\", updatable = false)"},{"type":"DELETE","lineNumber":75,"oldContent":"    private LocalDateTime createdAt;"},{"type":"INSERT","lineNumber":67,"content":"    private Team ledTeam;"},{"type":"DELETE","lineNumber":77,"oldContent":"    @UpdateTimestamp"},{"type":"INSERT","lineNumber":69,"content":"    @ManyToMany(mappedBy = \"assignedTo\")"},{"type":"DELETE","lineNumber":79,"oldContent":"    @Column(name = \"updated_at\")"},{"type":"DELETE","lineNumber":81,"oldContent":"    private LocalDateTime updatedAt;"},{"type":"INSERT","lineNumber":72,"content":"    @JsonIgnore"},{"type":"INSERT","lineNumber":75,"content":"    @CreationTimestamp"},{"type":"INSERT","lineNumber":76,"content":"    @Column(name = \"created_at\", updatable = false)"},{"type":"INSERT","lineNumber":77,"content":"    private LocalDateTime createdAt;"},{"type":"INSERT","lineNumber":79,"content":"    @UpdateTimestamp"},{"type":"INSERT","lineNumber":80,"content":"    @Column(name = \"updated_at\")"},{"type":"INSERT","lineNumber":81,"content":"    private LocalDateTime updatedAt;"},{"type":"INSERT","lineNumber":82,"content":""},{"type":"DELETE","lineNumber":86,"oldContent":"    @CreationTimestamp"},{"type":"INSERT","lineNumber":84,"content":"        this.username = username;"},{"type":"DELETE","lineNumber":91,"oldContent":"        this.username = username;"}]},{"timestamp":1762143977808,"changes":[{"type":"MODIFY","lineNumber":7,"content":"import org.hibernate.annotations.UpdateTimestamp;","oldContent":"import org.hibernate.annotations.UpdateTimestamp;"},{"type":"DELETE","lineNumber":9,"oldContent":""},{"type":"INSERT","lineNumber":12,"content":""},{"type":"DELETE","lineNumber":15,"oldContent":"@NoArgsConstructor"},{"type":"DELETE","lineNumber":17,"oldContent":"// This is the most critical change. It tells Lombok to ONLY use the 'id' field for equals and hashCode."},{"type":"DELETE","lineNumber":19,"oldContent":"@EqualsAndHashCode(of = \"id\")"},{"type":"INSERT","lineNumber":18,"content":"@NoArgsConstructor"},{"type":"INSERT","lineNumber":19,"content":"// This is the most critical change. It tells Lombok to ONLY use the 'id' field for equals and hashCode."},{"type":"INSERT","lineNumber":20,"content":"@EqualsAndHashCode(of = \"id\")"},{"type":"DELETE","lineNumber":29,"oldContent":"    private String password;"},{"type":"INSERT","lineNumber":32,"content":"    private String password;"},{"type":"DELETE","lineNumber":35,"oldContent":"    // Dr. X's Addition: Location fields for future analytics."},{"type":"INSERT","lineNumber":37,"content":"    // Dr. X's Addition: Location fields for future analytics."},{"type":"INSERT","lineNumber":50,"content":"    private BigDecimal latitude;"},{"type":"INSERT","lineNumber":51,"content":""},{"type":"DELETE","lineNumber":52,"oldContent":"    private BigDecimal latitude;"},{"type":"DELETE","lineNumber":55,"oldContent":""},{"type":"DELETE","lineNumber":63,"oldContent":"    private Team ledTeam;"},{"type":"DELETE","lineNumber":65,"oldContent":"    @ManyToMany(mappedBy = \"assignedTo\")"},{"type":"MODIFY","lineNumber":67,"content":"    private Team ledTeam;","oldContent":"    @JsonIgnore"},{"type":"INSERT","lineNumber":68,"content":""},{"type":"INSERT","lineNumber":69,"content":"    @ManyToMany(mappedBy = \"assignedTo\")"},{"type":"INSERT","lineNumber":70,"content":"    @ToString.Exclude"},{"type":"INSERT","lineNumber":71,"content":"    @EqualsAndHashCode.Exclude"},{"type":"INSERT","lineNumber":72,"content":"    @JsonIgnore"},{"type":"INSERT","lineNumber":73,"content":"    private Set<Ticket> assignedTickets = new HashSet<>();"},{"type":"INSERT","lineNumber":74,"content":""},{"type":"DELETE","lineNumber":72,"oldContent":""},{"type":"DELETE","lineNumber":74,"oldContent":"    @ToString.Exclude"},{"type":"INSERT","lineNumber":78,"content":""},{"type":"DELETE","lineNumber":77,"oldContent":"    @EqualsAndHashCode.Exclude"},{"type":"DELETE","lineNumber":80,"oldContent":"    private Set<Ticket> assignedTickets = new HashSet<>();"},{"type":"DELETE","lineNumber":81,"oldContent":""},{"type":"DELETE","lineNumber":82,"oldContent":"        this.username = username;"},{"type":"DELETE","lineNumber":83,"oldContent":""},{"type":"INSERT","lineNumber":84,"content":"        this.username = username;"}]},{"timestamp":1762143983834,"changes":[{"type":"INSERT","lineNumber":6,"content":"import org.hibernate.annotations.CreationTimestamp;"},{"type":"DELETE","lineNumber":7,"oldContent":"import org.hibernate.annotations.UpdateTimestamp;"},{"type":"MODIFY","lineNumber":12,"content":"","oldContent":""},{"type":"DELETE","lineNumber":15,"oldContent":"// Dr. X's Fix: Replace @Data with specific annotations"},{"type":"DELETE","lineNumber":16,"oldContent":"@NoArgsConstructor"},{"type":"DELETE","lineNumber":18,"oldContent":"// This is the most critical change. It tells Lombok to ONLY use the 'id' field for equals and hashCode."},{"type":"DELETE","lineNumber":19,"oldContent":"@EqualsAndHashCode(of = \"id\")"},{"type":"INSERT","lineNumber":17,"content":"@NoArgsConstructor"},{"type":"INSERT","lineNumber":18,"content":"@EqualsAndHashCode(of = \"id\")"},{"type":"MODIFY","lineNumber":30,"content":"    private String password;","oldContent":"    private String password;"},{"type":"MODIFY","lineNumber":35,"content":"    // Dr. X's Addition: Location fields for future analytics.","oldContent":"    // Dr. X's Addition: Location fields for future analytics."},{"type":"MODIFY","lineNumber":50,"content":"    @Column(precision = 10, scale = 6)","oldContent":"    @Column(precision = 10, scale = 6)"},{"type":"INSERT","lineNumber":63,"content":"    @OneToOne(mappedBy = \"teamLead\", fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":64,"content":"    @JsonBackReference(\"team-lead\")"},{"type":"DELETE","lineNumber":67,"oldContent":"    @OneToOne(mappedBy = \"teamLead\", fetch = FetchType.LAZY)"},{"type":"DELETE","lineNumber":69,"oldContent":"    @JsonBackReference(\"team-lead\")"},{"type":"DELETE","lineNumber":71,"oldContent":"    @CreationTimestamp"},{"type":"DELETE","lineNumber":73,"oldContent":"    @Column(name = \"created_at\", updatable = false)"},{"type":"INSERT","lineNumber":72,"content":""},{"type":"INSERT","lineNumber":73,"content":"    @CreationTimestamp"},{"type":"INSERT","lineNumber":74,"content":"    @Column(name = \"created_at\", updatable = false)"},{"type":"DELETE","lineNumber":80,"oldContent":""},{"type":"MODIFY","lineNumber":82,"content":"        this.username = username;","oldContent":"        this.username = username;"}]},{"timestamp":1762144011433,"changes":[{"type":"INSERT","lineNumber":11,"content":"import java.util.Set;"},{"type":"DELETE","lineNumber":12,"oldContent":""},{"type":"DELETE","lineNumber":15,"oldContent":"@NoArgsConstructor"},{"type":"MODIFY","lineNumber":17,"content":"@NoArgsConstructor","oldContent":"@EqualsAndHashCode(of = \"id\")"},{"type":"INSERT","lineNumber":18,"content":"@EqualsAndHashCode(of = \"id\")"},{"type":"DELETE","lineNumber":28,"oldContent":"    private String password;"},{"type":"DELETE","lineNumber":29,"oldContent":"    private String password;"},{"type":"INSERT","lineNumber":28,"content":"    @Column(nullable = false)"},{"type":"INSERT","lineNumber":30,"content":"    private String password;"},{"type":"DELETE","lineNumber":33,"oldContent":"    // Dr. X's Addition: Location fields for future analytics."},{"type":"DELETE","lineNumber":34,"oldContent":"    // Dr. X's Addition: Location fields for future analytics."},{"type":"INSERT","lineNumber":33,"content":"    private String fullName;"},{"type":"INSERT","lineNumber":35,"content":"    // Dr. X's Addition: Location fields for future analytics."},{"type":"DELETE","lineNumber":48,"oldContent":"    @Column(precision = 10, scale = 6)"},{"type":"DELETE","lineNumber":49,"oldContent":"    @Column(precision = 10, scale = 6)"},{"type":"INSERT","lineNumber":48,"content":"    private BigDecimal latitude;"},{"type":"INSERT","lineNumber":50,"content":"    @Column(precision = 10, scale = 6)"},{"type":"DELETE","lineNumber":61,"oldContent":"    @OneToOne(mappedBy = \"teamLead\", fetch = FetchType.LAZY)"},{"type":"MODIFY","lineNumber":63,"content":"    @OneToOne(mappedBy = \"teamLead\", fetch = FetchType.LAZY)","oldContent":"    @JsonBackReference(\"team-lead\")"},{"type":"INSERT","lineNumber":64,"content":"    @JsonBackReference(\"team-lead\")"},{"type":"DELETE","lineNumber":69,"oldContent":""},{"type":"DELETE","lineNumber":71,"oldContent":"    @CreationTimestamp"},{"type":"MODIFY","lineNumber":72,"content":"","oldContent":"    @Column(name = \"created_at\", updatable = false)"},{"type":"INSERT","lineNumber":73,"content":"    @CreationTimestamp"},{"type":"INSERT","lineNumber":74,"content":"    @Column(name = \"created_at\", updatable = false)"},{"type":"DELETE","lineNumber":80,"oldContent":"        this.username = username;"},{"type":"DELETE","lineNumber":81,"oldContent":"        this.username = username;"},{"type":"INSERT","lineNumber":80,"content":""},{"type":"INSERT","lineNumber":82,"content":"        this.username = username;"}]},{"timestamp":1762144016295,"changes":[{"type":"INSERT","lineNumber":16,"content":"@Setter"},{"type":"DELETE","lineNumber":18,"oldContent":"@Setter"},{"type":"MODIFY","lineNumber":30,"content":"    private String password;","oldContent":"    private String password;"},{"type":"MODIFY","lineNumber":35,"content":"    // Dr. X's Addition: Location fields for future analytics.","oldContent":"    // Dr. X's Addition: Location fields for future analytics."},{"type":"MODIFY","lineNumber":50,"content":"    @Column(precision = 10, scale = 6)","oldContent":"    @Column(precision = 10, scale = 6)"},{"type":"INSERT","lineNumber":56,"content":"    "},{"type":"INSERT","lineNumber":63,"content":""},{"type":"DELETE","lineNumber":64,"oldContent":""},{"type":"INSERT","lineNumber":71,"content":"    @JsonIgnore"},{"type":"INSERT","lineNumber":72,"content":"    private Set<Ticket> assignedTickets = new HashSet<>();"},{"type":"DELETE","lineNumber":72,"oldContent":"    @JsonIgnore"},{"type":"DELETE","lineNumber":74,"oldContent":"    private Set<Ticket> assignedTickets = new HashSet<>();"},{"type":"DELETE","lineNumber":81,"oldContent":"        this.username = username;"},{"type":"INSERT","lineNumber":83,"content":"        this.username = username;"}]},{"timestamp":1762144028180,"changes":[{"type":"INSERT","lineNumber":29,"content":"    @JsonIgnore"},{"type":"DELETE","lineNumber":30,"oldContent":"    private String password;"},{"type":"INSERT","lineNumber":34,"content":""},{"type":"DELETE","lineNumber":35,"oldContent":"    // Dr. X's Addition: Location fields for future analytics."},{"type":"INSERT","lineNumber":49,"content":""},{"type":"DELETE","lineNumber":50,"oldContent":"    @Column(precision = 10, scale = 6)"},{"type":"MODIFY","lineNumber":56,"content":"    @ToString.Exclude","oldContent":"    "},{"type":"MODIFY","lineNumber":64,"content":"    @OneToOne(mappedBy = \"teamLead\", fetch = FetchType.LAZY)","oldContent":"    @OneToOne(mappedBy = \"teamLead\", fetch = FetchType.LAZY)"},{"type":"DELETE","lineNumber":71,"oldContent":""},{"type":"MODIFY","lineNumber":73,"content":"","oldContent":"    @CreationTimestamp"},{"type":"INSERT","lineNumber":74,"content":"    @CreationTimestamp"}]},{"timestamp":1762144038003,"changes":[{"type":"DELETE","lineNumber":52,"oldContent":"    // --- End of new fields ---"},{"type":"INSERT","lineNumber":62,"content":""},{"type":"DELETE","lineNumber":64,"oldContent":"    @OneToOne(mappedBy = \"teamLead\", fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":71,"content":"    private Set<Ticket> assignedTickets = new HashSet<>();"},{"type":"DELETE","lineNumber":74,"oldContent":"    private Set<Ticket> assignedTickets = new HashSet<>();"}]},{"timestamp":1762144075021,"changes":[{"type":"MODIFY","lineNumber":62,"content":"","oldContent":""},{"type":"DELETE","lineNumber":70,"oldContent":"    private Set<Ticket> assignedTickets = new HashSet<>();"},{"type":"INSERT","lineNumber":71,"content":"    @ToString.Exclude"},{"type":"INSERT","lineNumber":72,"content":"    private Set<Ticket> assignedTickets = new HashSet<>();"}]},{"timestamp":1762144079221,"changes":[{"type":"INSERT","lineNumber":61,"content":"    private Team team;"},{"type":"DELETE","lineNumber":62,"oldContent":""},{"type":"DELETE","lineNumber":70,"oldContent":"    @ToString.Exclude"}]},{"timestamp":1762144083719,"changes":[{"type":"INSERT","lineNumber":65,"content":"    @ToString.Exclude"}]},{"timestamp":1762144092436,"changes":[{"type":"INSERT","lineNumber":61,"content":"    @ToString.Exclude"}]},{"timestamp":1762144119359,"changes":[{"type":"DELETE","lineNumber":45,"oldContent":"    // We use BigDecimal for latitude and longitude to ensure high precision,"},{"type":"DELETE","lineNumber":46,"oldContent":"    // which is a best practice for geographic coordinates."},{"type":"INSERT","lineNumber":45,"content":""}]},{"timestamp":1762144686838,"changes":[{"type":"INSERT","lineNumber":2,"content":""}]},{"timestamp":1762144689678,"changes":[{"type":"INSERT","lineNumber":3,"content":""},{"type":"DELETE","lineNumber":15,"oldContent":"import java.util.Set;"},{"type":"INSERT","lineNumber":16,"content":"@Table(name = \"users\")"},{"type":"DELETE","lineNumber":20,"oldContent":"@Data"},{"type":"DELETE","lineNumber":21,"oldContent":"@NoArgsConstructor"},{"type":"INSERT","lineNumber":28,"content":"    private String username;"},{"type":"INSERT","lineNumber":29,"content":""},{"type":"DELETE","lineNumber":32,"oldContent":"    @Column(nullable = false)"},{"type":"MODIFY","lineNumber":33,"content":"","oldContent":"    private String password;"},{"type":"INSERT","lineNumber":34,"content":"    @Column(name = \"full_name\", nullable = false)"},{"type":"DELETE","lineNumber":85,"oldContent":"    public AppUser(String username, String password, String fullName ){"},{"type":"DELETE","lineNumber":86,"oldContent":"        this.username = username;"},{"type":"DELETE","lineNumber":89,"oldContent":"    public AppUser(String username, String password, String fullName) {"},{"type":"DELETE","lineNumber":90,"oldContent":"        this.username = username;"},{"type":"INSERT","lineNumber":88,"content":"    }"},{"type":"INSERT","lineNumber":89,"content":"}"}]},{"timestamp":1762144695639,"changes":[{"type":"DELETE","lineNumber":3,"oldContent":""},{"type":"MODIFY","lineNumber":6,"content":"import lombok.EqualsAndHashCode;","oldContent":"import lombok.*;"},{"type":"INSERT","lineNumber":7,"content":"import lombok.Getter;"},{"type":"INSERT","lineNumber":8,"content":"import lombok.NoArgsConstructor;"},{"type":"INSERT","lineNumber":9,"content":"import lombok.Setter;"},{"type":"INSERT","lineNumber":10,"content":"import lombok.ToString;"},{"type":"DELETE","lineNumber":20,"oldContent":"@EqualsAndHashCode(of = \"id\")"},{"type":"INSERT","lineNumber":23,"content":"@EqualsAndHashCode(of = \"id\") // Solves the infinite loop by using only the ID for hashing."},{"type":"INSERT","lineNumber":24,"content":"public class AppUser {"},{"type":"DELETE","lineNumber":28,"oldContent":"    private String username;"},{"type":"DELETE","lineNumber":37,"oldContent":"    // Dr. X's Addition: Location fields for future analytics."},{"type":"INSERT","lineNumber":40,"content":"    // Location fields for future analytics"},{"type":"DELETE","lineNumber":47,"oldContent":""},{"type":"DELETE","lineNumber":56,"oldContent":"    @ToString.Exclude"},{"type":"INSERT","lineNumber":58,"content":"    @ToString.Exclude // Prevents loops in logging"},{"type":"DELETE","lineNumber":72,"oldContent":"    @EqualsAndHashCode.Exclude"},{"type":"INSERT","lineNumber":87,"content":"        this.password = password;"},{"type":"DELETE","lineNumber":88,"oldContent":"    }"}]},{"timestamp":1762159853893,"changes":[{"type":"INSERT","lineNumber":5,"content":"import jakarta.persistence.*;"},{"type":"DELETE","lineNumber":7,"oldContent":"import lombok.*;"},{"type":"DELETE","lineNumber":9,"oldContent":"import org.hibernate.annotations.CreationTimestamp;"},{"type":"MODIFY","lineNumber":11,"content":"import org.hibernate.annotations.CreationTimestamp;","oldContent":"import org.hibernate.annotations.UpdateTimestamp;"},{"type":"INSERT","lineNumber":12,"content":"import org.hibernate.annotations.UpdateTimestamp;"},{"type":"INSERT","lineNumber":23,"content":"@EqualsAndHashCode(of = \"id\") // This line prevents the infinite loop."},{"type":"INSERT","lineNumber":24,"content":"public class AppUser {"},{"type":"INSERT","lineNumber":25,"content":""},{"type":"DELETE","lineNumber":25,"oldContent":"@EqualsAndHashCode(of = \"id\") // Solves the infinite loop by using only the ID for hashing."},{"type":"DELETE","lineNumber":27,"oldContent":"public class AppUser {"},{"type":"DELETE","lineNumber":31,"oldContent":"    private String username;"},{"type":"DELETE","lineNumber":42,"oldContent":"    // Location fields for future analytics"},{"type":"INSERT","lineNumber":57,"content":"    @ToString.Exclude"},{"type":"DELETE","lineNumber":59,"oldContent":"    @ToString.Exclude // Prevents loops in logging"},{"type":"MODIFY","lineNumber":66,"content":"    @OneToOne(mappedby = \"teamLead\", fetch = FetchType.LAZY)","oldContent":"    @OneToOne(mappedBy = \"teamLead\", fetch = FetchType.LAZY)"},{"type":"MODIFY","lineNumber":71,"content":"    @ManyToMany(mappedby = \"assignedTo\")","oldContent":"    @ManyToMany(mappedBy = \"assignedTo\")"},{"type":"MODIFY","lineNumber":87,"content":"        this.fullName = fullName;","oldContent":"    }"}]},{"timestamp":1762159861505,"changes":[{"type":"INSERT","lineNumber":10,"content":"import lombok.ToString;"},{"type":"DELETE","lineNumber":12,"oldContent":"import lombok.ToString;"},{"type":"DELETE","lineNumber":24,"oldContent":""},{"type":"MODIFY","lineNumber":26,"content":"    @Id","oldContent":"    @Id"},{"type":"INSERT","lineNumber":28,"content":"    private Long id;"},{"type":"MODIFY","lineNumber":57,"content":"    @ToString.Exclude","oldContent":"    @ToString.Exclude"},{"type":"INSERT","lineNumber":65,"content":""},{"type":"DELETE","lineNumber":66,"oldContent":"    @OneToOne(mappedBy = \"teamLead\", fetch = FetchType.LAZY)"},{"type":"INSERT","lineNumber":70,"content":""},{"type":"DELETE","lineNumber":71,"oldContent":"    @ManyToMany(mappedBy = \"assignedTo\")"},{"type":"MODIFY","lineNumber":87,"content":"        this.fullName = fullName;","oldContent":"        this.fullName = fullName;"}]},{"timestamp":1762159974219,"changes":[{"type":"INSERT","lineNumber":3,"content":"import com.fasterxml.jackson.annotation.JsonBackReference;"},{"type":"INSERT","lineNumber":4,"content":"import com.fasterxml.jackson.annotation.JsonIgnore;"},{"type":"DELETE","lineNumber":5,"oldContent":"import jakarta.persistence.*;"},{"type":"DELETE","lineNumber":6,"oldContent":"import lombok.EqualsAndHashCode;"},{"type":"MODIFY","lineNumber":14,"content":"import java.time.LocalDateTime;","oldContent":"import java.util.List;"},{"type":"INSERT","lineNumber":15,"content":"import java.util.HashSet;"},{"type":"DELETE","lineNumber":16,"oldContent":"import java.util.Set;"},{"type":"MODIFY","lineNumber":26,"content":"    @Id","oldContent":"    @Id"},{"type":"INSERT","lineNumber":27,"content":"    @GeneratedValue(strategy = GenerationType.IDENTITY)"},{"type":"INSERT","lineNumber":29,"content":""},{"type":"INSERT","lineNumber":30,"content":"    @Column(unique = true, nullable = false, length = 100)"},{"type":"DELETE","lineNumber":31,"oldContent":"    private String password;"},{"type":"DELETE","lineNumber":32,"oldContent":""},{"type":"DELETE","lineNumber":33,"oldContent":"    @Column(nullable = false)"},{"type":"INSERT","lineNumber":56,"content":"    @JoinTable(name = \"user_roles\", joinColumns = @JoinColumn(name = \"user_id\"), inverseJoinColumns = @JoinColumn(name = \"role_id\"))"},{"type":"DELETE","lineNumber":57,"oldContent":"    @ToString.Exclude"},{"type":"MODIFY","lineNumber":66,"content":"    @OneToOne(mappedBy = \"teamLead\", fetch = FetchType.LAZY)","oldContent":"    @OneToOne(mappedby = \"teamLead\", fetch = FetchType.LAZY)"},{"type":"MODIFY","lineNumber":84,"content":"    public AppUser(String username, String password, String fullName) {","oldContent":"    @EqualsAndHashCode.Exclude"},{"type":"INSERT","lineNumber":86,"content":"        this.password = password;"},{"type":"DELETE","lineNumber":87,"oldContent":"        this.fullName = fullName;"},{"type":"INSERT","lineNumber":88,"content":"    }"},{"type":"INSERT","lineNumber":89,"content":"}"}]},{"timestamp":1762159977017,"changes":[{"type":"MODIFY","lineNumber":5,"content":"import jakarta.persistence.*;","oldContent":"import lombok.Data;"},{"type":"MODIFY","lineNumber":16,"content":"import java.util.Set;","oldContent":"@Table(name = \"users\")"},{"type":"INSERT","lineNumber":25,"content":""},{"type":"DELETE","lineNumber":26,"oldContent":"    @Id"},{"type":"INSERT","lineNumber":30,"content":"    @Column(unique = true, nullable = false, length = 100)"},{"type":"INSERT","lineNumber":31,"content":"    private String username;"},{"type":"DELETE","lineNumber":32,"oldContent":"    @Column(unique = true, nullable = false, length = 100)"},{"type":"DELETE","lineNumber":33,"oldContent":"    private String password;"},{"type":"MODIFY","lineNumber":71,"content":"    @ManyToMany(mappedBy = \"assignedTo\")","oldContent":"    @ManyToMany(mappedby = \"assignedTo\")"},{"type":"INSERT","lineNumber":89,"content":"}"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/Team.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/Team.java","baseContent":"package com.capstone.tele_ticketing_backend_1.entities;\n\n// File: com/example/ticketing/model/Team.java\npackage com.example.ticketing.model;\n\n@Entity\n@Table(name = \"teams\")\n@Data\n@NoArgsConstructor\npublic class Team {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @Column(unique = true, nullable = false)\n    private String name;\n\n    @OneToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"team_lead_id\")\n    private AppUser teamLead;\n\n    // Dr. X's Note: A team has many members. This relationship is now managed from the Team side.\n    @OneToMany(mappedBy = \"team\", fetch = FetchType.LAZY)\n    @ToString.Exclude\n    @EqualsAndHashCode.Exclude\n    private Set<AppUser> members = new HashSet<>();\n}\n","baseTimestamp":1761776125206,"deltas":[{"timestamp":1761776129813,"changes":[{"type":"MODIFY","lineNumber":4,"content":"import jakarta.persistence.GenerationType;package com.example.ticketing.model;","oldContent":"package com.example.ticketing.model;"},{"type":"INSERT","lineNumber":5,"content":""}]},{"timestamp":1761776134623,"changes":[{"type":"MODIFY","lineNumber":3,"content":"","oldContent":"package com.example.ticketing.model;"},{"type":"INSERT","lineNumber":4,"content":"import jakarta.persistence.Entity;"}]},{"timestamp":1761776140589,"changes":[{"type":"MODIFY","lineNumber":5,"content":"import jakarta.persistence.GenerationType;","oldContent":"import jakarta.persistence.GenerationType;package com.example.ticketing.model;"},{"type":"INSERT","lineNumber":6,"content":"import jakarta.persistence.Table;"},{"type":"INSERT","lineNumber":7,"content":"import lombok.Data;package com.example.ticketing.model;"}]},{"timestamp":1761776148244,"changes":[{"type":"INSERT","lineNumber":7,"content":"import lombok.Data;"},{"type":"INSERT","lineNumber":8,"content":"import lombok.NoArgsConstructor;package com.example.ticketing.model;"},{"type":"DELETE","lineNumber":8,"oldContent":"import lombok.Data;package com.example.ticketing.model;"}]},{"timestamp":1761776151380,"changes":[{"type":"MODIFY","lineNumber":9,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":17,"content":"    @GeneratedVale(strategy = GenerationType.IDENTITY)","oldContent":"    @GeneratedValue(strategy = GenerationType.IDENTITY)"}]},{"timestamp":1761776154915,"changes":[{"type":"INSERT","lineNumber":5,"content":"import jakarta.persistence.GeneratedValue;"},{"type":"INSERT","lineNumber":9,"content":"import lombok.NoArgsConstructor;package com.example.ticketing.model;"},{"type":"DELETE","lineNumber":9,"oldContent":""},{"type":"MODIFY","lineNumber":18,"content":"    @GeneratedValue(strategy = GenerationType.IDENTITY)","oldContent":"    @GeneratedVale(strategy = GenerationType.IDENTITY)"}]},{"timestamp":1761776161663,"changes":[{"type":"DELETE","lineNumber":4,"oldContent":"import jakarta.persistence.Entity;"},{"type":"DELETE","lineNumber":5,"oldContent":"import jakarta.persistence.GeneratedValue;"},{"type":"DELETE","lineNumber":6,"oldContent":"import jakarta.persistence.GenerationType;"},{"type":"DELETE","lineNumber":7,"oldContent":"import jakarta.persistence.Table;"},{"type":"INSERT","lineNumber":4,"content":"import jakarta.persistence.*;"},{"type":"DELETE","lineNumber":9,"oldContent":""},{"type":"INSERT","lineNumber":7,"content":""},{"type":"DELETE","lineNumber":18,"oldContent":"    @GeneratedVale(strategy = GenerationType.IDENTITY)"},{"type":"INSERT","lineNumber":16,"content":"    private Long id;"}]},{"timestamp":1761776171418,"changes":[{"type":"DELETE","lineNumber":5,"oldContent":""},{"type":"MODIFY","lineNumber":6,"content":"import lombok.NoArgsConstructor;","oldContent":"import lombok.NoArgsConstructor;package com.example.ticketing.model;"},{"type":"INSERT","lineNumber":7,"content":""},{"type":"DELETE","lineNumber":13,"oldContent":"    private Long id;"},{"type":"INSERT","lineNumber":16,"content":"    private Long id;"}]},{"timestamp":1761776178755,"changes":[{"type":"INSERT","lineNumber":5,"content":"import lombok.Data;"},{"type":"INSERT","lineNumber":7,"content":"import lombok.ToString;"},{"type":"DELETE","lineNumber":7,"oldContent":"import lombok.NoArgsConstructor;package com.example.ticketing.model;"},{"type":"DELETE","lineNumber":15,"oldContent":"    private Long id;"},{"type":"INSERT","lineNumber":17,"content":"    private Long id;"}]},{"timestamp":1761776186439,"changes":[{"type":"INSERT","lineNumber":6,"content":"import lombok.EqualsAndHashCode;"},{"type":"DELETE","lineNumber":7,"oldContent":""},{"type":"INSERT","lineNumber":9,"content":""}]},{"timestamp":1761776189092,"changes":[{"type":"INSERT","lineNumber":10,"content":"import java.util.Set;"},{"type":"INSERT","lineNumber":11,"content":""}]},{"timestamp":1761776192504,"changes":[{"type":"INSERT","lineNumber":10,"content":"import java.util.HashSet;"},{"type":"DELETE","lineNumber":11,"oldContent":"@Entity"},{"type":"INSERT","lineNumber":13,"content":"@Entity"}]},{"timestamp":1761776197080,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"// File: com/example/ticketing/model/Team.java"},{"type":"DELETE","lineNumber":3,"oldContent":""}]},{"timestamp":1761781986346,"changes":[{"type":"INSERT","lineNumber":2,"content":"import com.fasterxml.jackson.annotation.JsonManagedReference;"},{"type":"INSERT","lineNumber":25,"content":"    // Dr. X's Fix: Add @JsonManagedReference."},{"type":"INSERT","lineNumber":26,"content":"    // The Team is the \"parent\" and should be serialized with its lead."},{"type":"INSERT","lineNumber":29,"content":"    @JsonManagedReference(\"team-lead\") // Use a unique name to differentiate from the \"members\" reference"},{"type":"DELETE","lineNumber":28,"oldContent":"    // Dr. X's Note: A team has many members. This relationship is now managed from the Team side."},{"type":"INSERT","lineNumber":32,"content":"    // Dr. X's Fix: Add @JsonManagedReference."},{"type":"INSERT","lineNumber":33,"content":"    // The Team is the \"parent\" and should be serialized with its members."},{"type":"INSERT","lineNumber":37,"content":"    @JsonManagedReference(\"team-members\") // Use a unique name"},{"type":"DELETE","lineNumber":34,"oldContent":""}]},{"timestamp":1762144807359,"changes":[{"type":"INSERT","lineNumber":2,"content":""},{"type":"DELETE","lineNumber":4,"oldContent":"import lombok.Data;"},{"type":"INSERT","lineNumber":6,"content":"import lombok.Getter;"},{"type":"INSERT","lineNumber":8,"content":"import lombok.Setter;"},{"type":"DELETE","lineNumber":8,"oldContent":""},{"type":"DELETE","lineNumber":14,"oldContent":"@Data"},{"type":"INSERT","lineNumber":15,"content":"@Getter"},{"type":"INSERT","lineNumber":16,"content":"@Setter"},{"type":"INSERT","lineNumber":18,"content":"@EqualsAndHashCode(of = \"id\") // Solves the infinite loop by using only the ID for hashing."},{"type":"DELETE","lineNumber":26,"oldContent":"    // Dr. X's Fix: Add @JsonManagedReference."},{"type":"DELETE","lineNumber":28,"oldContent":"    // The Team is the \"parent\" and should be serialized with its lead."},{"type":"INSERT","lineNumber":30,"content":"    @JsonManagedReference(\"team-lead\")"},{"type":"INSERT","lineNumber":31,"content":"    @ToString.Exclude // Prevents loops in logging"},{"type":"DELETE","lineNumber":31,"oldContent":"    @JsonManagedReference(\"team-lead\") // Use a unique name to differentiate from the \"members\" reference"},{"type":"DELETE","lineNumber":34,"oldContent":"    @EqualsAndHashCode.Exclude"},{"type":"DELETE","lineNumber":35,"oldContent":"    // Dr. X's Fix: Add @JsonManagedReference."},{"type":"INSERT","lineNumber":36,"content":"    @JsonManagedReference(\"team-members\")"},{"type":"DELETE","lineNumber":37,"oldContent":"    // The Team is the \"parent\" and should be serialized with its members."},{"type":"DELETE","lineNumber":39,"oldContent":"    @JsonManagedReference(\"team-members\") // Use a unique name"}]},{"timestamp":1762144833552,"changes":[{"type":"MODIFY","lineNumber":9,"content":"import lombok.ToString;","oldContent":"import lombok.ToString;"},{"type":"MODIFY","lineNumber":17,"content":"@NoArgsConstructor","oldContent":"@NoArgsConstructor"},{"type":"INSERT","lineNumber":18,"content":"@EqualsAndHashCode(of = \"id\")"},{"type":"DELETE","lineNumber":20,"oldContent":"@EqualsAndHashCode(of = \"id\") // Solves the infinite loop by using only the ID for hashing."},{"type":"DELETE","lineNumber":30,"oldContent":"    private AppUser teamLead;"},{"type":"MODIFY","lineNumber":32,"content":"    private AppUser teamLead;","oldContent":""},{"type":"INSERT","lineNumber":33,"content":""}]},{"timestamp":1762144848111,"changes":[{"type":"INSERT","lineNumber":8,"content":"import lombok.Setter;"},{"type":"DELETE","lineNumber":9,"oldContent":"import lombok.ToString;"},{"type":"INSERT","lineNumber":16,"content":"@Setter"},{"type":"DELETE","lineNumber":17,"oldContent":"@NoArgsConstructor"},{"type":"INSERT","lineNumber":31,"content":"    @ToString.Exclude"},{"type":"DELETE","lineNumber":33,"oldContent":"    @ToString.Exclude // Prevents loops in logging"}]},{"timestamp":1762159911594,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":""},{"type":"MODIFY","lineNumber":17,"content":"@EqualsAndHashCode(of = \"id\") // This line prevents the infinite loop.","oldContent":"@EqualsAndHashCode(of = \"id\")"},{"type":"MODIFY","lineNumber":33,"content":"    @OneToMany(mappedby = \"team\", fetch = FetchType.LAZY)","oldContent":"    @OneToMany(mappedBy = \"team\", fetch = FetchType.LAZY)"}]},{"timestamp":1762159961618,"changes":[{"type":"INSERT","lineNumber":16,"content":"@NoArgsConstructor"},{"type":"DELETE","lineNumber":17,"oldContent":"@EqualsAndHashCode(of = \"id\")"},{"type":"INSERT","lineNumber":32,"content":""},{"type":"DELETE","lineNumber":33,"oldContent":"    @OneToMany(mappedBy = \"team\", fetch = FetchType.LAZY)"}]},{"timestamp":1762159967831,"changes":[{"type":"MODIFY","lineNumber":33,"content":"    @OneToMany(mappedBy = \"team\", fetch = FetchType.LAZY)","oldContent":"    @OneToMany(mappedby = \"team\", fetch = FetchType.LAZY)"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/TicketStatus.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/TicketStatus.java","baseContent":"package com.capstone.tele_ticketing_backend_1.entities;\n\npublic enum TicketStatus {\n    CREATED,       // Initial state after customer creation\n    AI_TRIAGED,    // AI has performed initial analysis\n    NEEDS_TRIAGING,// Ready for a human Triage Officer\n    ASSIGNED,      // Assigned to an engineer/team\n    IN_PROGRESS,   // Actively being worked on\n    FIXED,         // Engineer has implemented a fix\n    RESOLVED,      // Customer has confirmed the fix\n    REOPENED       // Customer has indicated the issue persists\n}","baseTimestamp":1761776256060},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/TicketSeverity.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/TicketSeverity.java","baseContent":"package com.capstone.tele_ticketing_backend_1.entities;\n\npublic enum TicketSeverity {\n    CRITICAL,\n    HIGH,\n    MEDIUM,\n    LOW,\n    TRIVIAL\n}\n","baseTimestamp":1761776278061},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/TicketCategory.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/TicketCategory.java","baseContent":"package com.capstone.tele_ticketing_backend_1.entities;\n\npublic enum TicketCategory {\n    NETWORK_CONNECTIVITY,\n    PERFORMANCE_ISSUE,\n    HARDWARE_FAILURE,\n    INFRASTRUCTURE_PROBLEM,\n    CONFIGURATION_REQUEST,\n    SECURITY_CONCERN,\n    SERVICE_OUTAGE,\n    OTHER\n}\n","baseTimestamp":1761776301625},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/TicketPriority.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/TicketPriority.java","baseContent":"package com.capstone.tele_ticketing_backend_1.entities;\n\npublic enum TicketPriority {\n    HIGH,\n    MEDIUM,\n    LOW\n}\n","baseTimestamp":1761776328293},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/exceptions/UserAlreadyExistsException.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/exceptions/UserAlreadyExistsException.java","baseContent":"package com.capstone.tele_ticketing_backend_1.exceptions;\n\npublic class UserAlreadyExistsException extends RuntimeException {\n    public UserAlreadyExistsException(String message) {\n        super(message);\n    }\n}\n","baseTimestamp":1761776963458},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/exceptions/RoleNotFoundException.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/exceptions/RoleNotFoundException.java","baseContent":"package com.capstone.tele_ticketing_backend_1.exceptions;\n\npublic class RoleNotFoundException extends RuntimeException {\n    public RoleNotFoundException(String message) {\n        super(message);\n    }\n}\n","baseTimestamp":1761776972771,"deltas":[{"timestamp":1762113324529,"changes":[{"type":"INSERT","lineNumber":2,"content":"import org.springframework.http.HttpStatus;"},{"type":"INSERT","lineNumber":3,"content":"import org.springframework.web.bind.annotation.ResponseStatus;"},{"type":"INSERT","lineNumber":4,"content":""},{"type":"INSERT","lineNumber":5,"content":"@ResponseStatus(HttpStatus.NOT_FOUND)"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/exceptions/GlobalExceptionHandler.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/exceptions/GlobalExceptionHandler.java","baseContent":"package com.capstone.tele_ticketing_backend_1.exceptions;\n\n// File: com/capstone/tele_ticketing_backend_1/exception/GlobalExceptionHandler.java\npackage com.capstone.tele_ticketing_backend_1.exception;\n\nimport com.capstone.tele_ticketing_backend_1.security.payload.response.MessageResponse;\nimport org.springframework.http.HttpStatus;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.ControllerAdvice;\nimport org.springframework.web.bind.annotation.ExceptionHandler;\nimport org.springframework.web.context.request.WebRequest;\n\n@ControllerAdvice\npublic class GlobalExceptionHandler {\n\n    // Dr. X's Note: Handles the case where a username is already taken.\n    // We return a 409 Conflict, which is more specific than a 400 Bad Request.\n    @ExceptionHandler(UserAlreadyExistsException.class)\n    public ResponseEntity<MessageResponse> handleUserAlreadyExistsException(UserAlreadyExistsException ex, WebRequest request) {\n        MessageResponse messageResponse = new MessageResponse(ex.getMessage());\n        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);\n    }\n\n    // Dr. X's Note: Handles when a role string is invalid or not found in the DB.\n    // This is a client error, so we return a 400 Bad Request.\n    @ExceptionHandler(RoleNotFoundException.class)\n    public ResponseEntity<MessageResponse> handleRoleNotFoundException(RoleNotFoundException ex, WebRequest request) {\n        MessageResponse messageResponse = new MessageResponse(ex.getMessage());\n        return new ResponseEntity<>(messageResponse, HttpStatus.BAD_REQUEST);\n    }\n\n    // Dr. X's Note: Handles when a user is looked up but not found.\n    // The correct response is a 404 Not Found.\n    @ExceptionHandler(UserNotFoundException.class)\n    public ResponseEntity<MessageResponse> handleUserNotFoundException(UserNotFoundException ex, WebRequest request) {\n        MessageResponse messageResponse = new MessageResponse(ex.getMessage());\n        return new ResponseEntity<>(messageResponse, HttpStatus.NOT_FOUND);\n    }\n}","baseTimestamp":1761777837286,"deltas":[{"timestamp":1761813901348,"changes":[{"type":"INSERT","lineNumber":14,"content":"@RestControllerAdvice"},{"type":"DELETE","lineNumber":15,"oldContent":"public class GlobalExceptionHandler {"},{"type":"MODIFY","lineNumber":38,"content":"","oldContent":"    @ExceptionHandler(UserAlreadyExistsException.class)"},{"type":"MODIFY","lineNumber":40,"content":"    public ResponseEntity<MessageResponse> handleTicketNotFoundException(UserAlreadyExistsException ex, WebRequest request) {","oldContent":"    public ResponseEntity<MessageResponse> handleUserAlreadyExistsException(UserAlreadyExistsException ex, WebRequest request) {"},{"type":"INSERT","lineNumber":47,"content":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"INSERT","lineNumber":48,"content":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);"},{"type":"DELETE","lineNumber":49,"oldContent":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"DELETE","lineNumber":52,"oldContent":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);"}]},{"timestamp":1761813908123,"changes":[{"type":"MODIFY","lineNumber":40,"content":"    public ResponseEntity<MessageResponse> handleTicketNotFoundException(Ticket ex, WebRequest request) {","oldContent":"    public ResponseEntity<MessageResponse> handleTicketNotFoundException(UserAlreadyExistsException ex, WebRequest request) {"},{"type":"MODIFY","lineNumber":49,"content":"    }","oldContent":"    }"}]},{"timestamp":1761813911301,"changes":[{"type":"MODIFY","lineNumber":40,"content":"    public ResponseEntity<MessageResponse> handleTicketNotFoundException(TicketNotFoundException ex, WebRequest request) {","oldContent":"    public ResponseEntity<MessageResponse> handleTicketNotFoundException(Ticket ex, WebRequest request) {"},{"type":"INSERT","lineNumber":48,"content":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);"},{"type":"DELETE","lineNumber":49,"oldContent":"    }"}]},{"timestamp":1761813928124,"changes":[{"type":"INSERT","lineNumber":51,"content":"    @ExceptionHandler(UserAlreadyExistsException.class)"},{"type":"INSERT","lineNumber":52,"content":"    public ResponseEntity<MessageResponse> handleUserAlreadyExistsException(UserAlreadyExistsException ex, WebRequest request) {"},{"type":"INSERT","lineNumber":53,"content":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"INSERT","lineNumber":54,"content":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);"},{"type":"INSERT","lineNumber":55,"content":"    }"}]},{"timestamp":1761813931458,"changes":[{"type":"DELETE","lineNumber":51,"oldContent":"    @ExceptionHandler(UserAlreadyExistsException.class)"},{"type":"MODIFY","lineNumber":51,"content":"    @ExceptionHandler(ForbiddenAccessException.class)","oldContent":"    @ExceptionHandler(RoleNotFoundException.class)"},{"type":"DELETE","lineNumber":54,"oldContent":"    public ResponseEntity<MessageResponse> handleRoleNotFoundException(RoleNotFoundException ex, WebRequest request) {"},{"type":"DELETE","lineNumber":56,"oldContent":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"INSERT","lineNumber":55,"content":"    }"},{"type":"INSERT","lineNumber":56,"content":"    @ExceptionHandler(RoleNotFoundException.class)"},{"type":"INSERT","lineNumber":57,"content":"    public ResponseEntity<MessageResponse> handleRoleNotFoundException(RoleNotFoundException ex, WebRequest request) {"},{"type":"INSERT","lineNumber":58,"content":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"DELETE","lineNumber":60,"oldContent":"    }"}]},{"timestamp":1761813935851,"changes":[{"type":"DELETE","lineNumber":52,"oldContent":"    public ResponseEntity<MessageResponse> handleUserAlreadyExistsException(UserAlreadyExistsException ex, WebRequest request) {"},{"type":"DELETE","lineNumber":53,"oldContent":"    }"},{"type":"INSERT","lineNumber":52,"content":"    public ResponseEntity<MessageResponse> handle(UserAlreadyExistsException ex, WebRequest request) {"},{"type":"INSERT","lineNumber":54,"content":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);"},{"type":"INSERT","lineNumber":55,"content":"    }"},{"type":"DELETE","lineNumber":57,"oldContent":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);"}]},{"timestamp":1761813940150,"changes":[{"type":"DELETE","lineNumber":52,"oldContent":"    public ResponseEntity<MessageResponse> handle(UserAlreadyExistsException ex, WebRequest request) {"},{"type":"DELETE","lineNumber":53,"oldContent":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);"},{"type":"INSERT","lineNumber":52,"content":"    public ResponseEntity<MessageResponse> handleForbiddenAccessException(UserAlreadyExistsException ex, WebRequest request) {"},{"type":"INSERT","lineNumber":54,"content":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);"}]},{"timestamp":1761813942874,"changes":[{"type":"DELETE","lineNumber":52,"oldContent":"    public ResponseEntity<MessageResponse> handleForbiddenAccessException(UserAlreadyExistsException ex, WebRequest request) {"},{"type":"DELETE","lineNumber":53,"oldContent":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);"},{"type":"INSERT","lineNumber":52,"content":"    public ResponseEntity<MessageResponse> handleForbiddenAccessException(ForbiddenAccessException ex, WebRequest request) {"},{"type":"INSERT","lineNumber":54,"content":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);"}]},{"timestamp":1761813963371,"changes":[{"type":"MODIFY","lineNumber":54,"content":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);","oldContent":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);"},{"type":"INSERT","lineNumber":62,"content":"    @ExceptionHandler(Inva.class)"},{"type":"INSERT","lineNumber":63,"content":"    public ResponseEntity<MessageResponse> handleForbiddenAccessException(ForbiddenAccessException ex, WebRequest request) {"},{"type":"INSERT","lineNumber":64,"content":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"INSERT","lineNumber":65,"content":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);"},{"type":"INSERT","lineNumber":66,"content":"    }"},{"type":"INSERT","lineNumber":67,"content":""}]},{"timestamp":1761813968309,"changes":[{"type":"DELETE","lineNumber":7,"oldContent":"import org.springframework.http.ResponseEntity;"},{"type":"DELETE","lineNumber":8,"oldContent":"import org.springframework.web.bind.annotation.RestControllerAdvice;"},{"type":"MODIFY","lineNumber":8,"content":"import org.springframework.web.bind.annotation.RestControllerAdvice;","oldContent":"import org.springframework.web.bind.annotation.ControllerAdvice;"},{"type":"INSERT","lineNumber":9,"content":"import org.springframework.web.context.request.WebRequest;"},{"type":"INSERT","lineNumber":10,"content":""},{"type":"MODIFY","lineNumber":16,"content":"","oldContent":"@ControllerAdvice"},{"type":"MODIFY","lineNumber":44,"content":"","oldContent":"        return new ResponseEntity<>(messageResponse, HttpStatus.BAD_REQUEST);"},{"type":"INSERT","lineNumber":53,"content":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"DELETE","lineNumber":54,"oldContent":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);"},{"type":"DELETE","lineNumber":62,"oldContent":"    @ExceptionHandler(Inva.class)"},{"type":"MODIFY","lineNumber":62,"content":"    @ExceptionHandler(InvalidTicketStatusException.class)","oldContent":"    @ExceptionHandler(UserNotFoundException.class)"},{"type":"DELETE","lineNumber":65,"oldContent":"    public ResponseEntity<MessageResponse> handleUserNotFoundException(UserNotFoundException ex, WebRequest request) {"},{"type":"DELETE","lineNumber":67,"oldContent":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"DELETE","lineNumber":69,"oldContent":"        return new ResponseEntity<>(messageResponse, HttpStatus.NOT_FOUND);"},{"type":"DELETE","lineNumber":71,"oldContent":"    }"},{"type":"INSERT","lineNumber":68,"content":"    @ExceptionHandler(UserNotFoundException.class)"},{"type":"INSERT","lineNumber":69,"content":"    public ResponseEntity<MessageResponse> handleUserNotFoundException(UserNotFoundException ex, WebRequest request) {"},{"type":"INSERT","lineNumber":70,"content":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"INSERT","lineNumber":71,"content":"        return new ResponseEntity<>(messageResponse, HttpStatus.NOT_FOUND);"},{"type":"INSERT","lineNumber":72,"content":"    }"},{"type":"DELETE","lineNumber":74,"oldContent":"}"},{"type":"DELETE","lineNumber":75,"oldContent":"}}"}]},{"timestamp":1761813991955,"changes":[{"type":"INSERT","lineNumber":7,"content":"import org.springframework.web.bind.annotation.ExceptionHandler;"},{"type":"MODIFY","lineNumber":9,"content":"import org.springframework.web.context.request.WebRequest;","oldContent":"import org.springframework.web.bind.annotation.ControllerAdvice;"},{"type":"DELETE","lineNumber":10,"oldContent":"import org.springframework.web.bind.annotation.ExceptionHandler;"},{"type":"MODIFY","lineNumber":63,"content":"    public ResponseEntity<MessageResponse> handle(ForbiddenAccessException ex, WebRequest request) {","oldContent":"    public ResponseEntity<MessageResponse> handleForbiddenAccessException(ForbiddenAccessException ex, WebRequest request) {"},{"type":"DELETE","lineNumber":65,"oldContent":"    @ExceptionHandler(UserNotFoundException.class)"},{"type":"INSERT","lineNumber":66,"content":"    }"},{"type":"INSERT","lineNumber":67,"content":""},{"type":"INSERT","lineNumber":68,"content":"    @ExceptionHandler(UserNotFoundException.class)"},{"type":"DELETE","lineNumber":69,"oldContent":"    }"},{"type":"DELETE","lineNumber":72,"oldContent":""}]},{"timestamp":1761813995550,"changes":[{"type":"DELETE","lineNumber":9,"oldContent":"import org.springframework.web.bind.annotation.ExceptionHandler;"},{"type":"INSERT","lineNumber":10,"content":""},{"type":"MODIFY","lineNumber":63,"content":"    public ResponseEntity<MessageResponse> handleInvalidTicketStatusException(ForbiddenAccessException ex, WebRequest request) {","oldContent":"    public ResponseEntity<MessageResponse> handle(ForbiddenAccessException ex, WebRequest request) {"},{"type":"MODIFY","lineNumber":66,"content":"    }","oldContent":"    }"},{"type":"MODIFY","lineNumber":69,"content":"    public ResponseEntity<MessageResponse> handleUserNotFoundException(UserNotFoundException ex, WebRequest request) {","oldContent":"    public ResponseEntity<MessageResponse> handleUserNotFoundException(UserNotFoundException ex, WebRequest request) {"}]},{"timestamp":1761814000874,"changes":[{"type":"MODIFY","lineNumber":10,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":63,"content":"    public ResponseEntity<MessageResponse> handleInvalidTicketStatusException(InvalidTicketStatusException ex, WebRequest request) {","oldContent":"    public ResponseEntity<MessageResponse> handleInvalidTicketStatusException(ForbiddenAccessException ex, WebRequest request) {"},{"type":"INSERT","lineNumber":65,"content":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);"},{"type":"DELETE","lineNumber":66,"oldContent":"    }"},{"type":"INSERT","lineNumber":68,"content":"    @ExceptionHandler(UserNotFoundException.class)"},{"type":"DELETE","lineNumber":69,"oldContent":"    public ResponseEntity<MessageResponse> handleUserNotFoundException(UserNotFoundException ex, WebRequest request) {"}]},{"timestamp":1762112926849,"changes":[{"type":"INSERT","lineNumber":9,"content":"import org.springframework.web.context.request.WebRequest;"},{"type":"DELETE","lineNumber":10,"oldContent":""},{"type":"INSERT","lineNumber":72,"content":"    }"},{"type":"INSERT","lineNumber":73,"content":""},{"type":"INSERT","lineNumber":74,"content":"    @ExceptionHandler(BadRequestException.class)"},{"type":"INSERT","lineNumber":75,"content":"    public ResponseEntity<MessageResponse> handleBadRequestException(BadRequestException ex, WebRequest request) {"},{"type":"INSERT","lineNumber":76,"content":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"INSERT","lineNumber":77,"content":"        return new ResponseEntity<>(messageResponse, HttpStatus.BAD_REQUEST);"},{"type":"INSERT","lineNumber":78,"content":"    }"},{"type":"INSERT","lineNumber":79,"content":"}"}]},{"timestamp":1762113230620,"changes":[{"type":"DELETE","lineNumber":73,"oldContent":"    }"},{"type":"DELETE","lineNumber":75,"oldContent":"}"},{"type":"DELETE","lineNumber":77,"oldContent":"}"},{"type":"MODIFY","lineNumber":78,"content":"    }","oldContent":"    }"},{"type":"INSERT","lineNumber":79,"content":"    "},{"type":"INSERT","lineNumber":80,"content":"    "},{"type":"INSERT","lineNumber":81,"content":"}"}]},{"timestamp":1762113236030,"changes":[{"type":"MODIFY","lineNumber":6,"content":"import org.springframework.web.bind.annotation.ControllerAdvice;","oldContent":""},{"type":"MODIFY","lineNumber":12,"content":"import java.util.Map;","oldContent":"import org.springframework.web.context.request.WebRequest;"},{"type":"DELETE","lineNumber":17,"oldContent":"    // Dr. X's Note: Handles the case where a username is already taken."},{"type":"DELETE","lineNumber":18,"oldContent":"    @ExceptionHandler(UserAlreadyExistsException.class)"},{"type":"DELETE","lineNumber":19,"oldContent":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"DELETE","lineNumber":20,"oldContent":"    }"},{"type":"INSERT","lineNumber":17,"content":"    // Dr. X's Fix: Add this new method to specifically handle validation errors."},{"type":"INSERT","lineNumber":18,"content":"    @ExceptionHandler(MethodArgumentNotValidException.class)"},{"type":"INSERT","lineNumber":19,"content":"    public ResponseEntity<Object> handleMethodArgumentNotValid(MethodArgumentNotValidException ex, WebRequest request) {"},{"type":"INSERT","lineNumber":20,"content":"        // Dr. X's Note: A world-class API returns a structured error response"},{"type":"INSERT","lineNumber":21,"content":"        // that tells the frontend exactly which fields are wrong."},{"type":"INSERT","lineNumber":22,"content":"        Map<String, String> errors = new HashMap<>();"},{"type":"INSERT","lineNumber":23,"content":"        ex.getBindingResult().getAllErrors().forEach((error) -> {"},{"type":"INSERT","lineNumber":24,"content":"            String fieldName = ((FieldError) error).getField();"},{"type":"INSERT","lineNumber":25,"content":"            String errorMessage = error.getDefaultMessage();"},{"type":"INSERT","lineNumber":26,"content":"            errors.put(fieldName, errorMessage);"},{"type":"INSERT","lineNumber":27,"content":"        });"},{"type":"DELETE","lineNumber":22,"oldContent":"    // Dr. X's Note: Handles when a role string is invalid or not found in the DB."},{"type":"DELETE","lineNumber":23,"oldContent":"    @ExceptionHandler(RoleNotFoundException.class)"},{"type":"DELETE","lineNumber":24,"oldContent":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"DELETE","lineNumber":25,"oldContent":"    }"},{"type":"DELETE","lineNumber":26,"oldContent":""},{"type":"DELETE","lineNumber":27,"oldContent":"    // Dr. X's Note: Handles when a user is looked up but not found."},{"type":"DELETE","lineNumber":28,"oldContent":"    @ExceptionHandler(UserNotFoundException.class)"},{"type":"DELETE","lineNumber":29,"oldContent":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"DELETE","lineNumber":30,"oldContent":"    }"},{"type":"INSERT","lineNumber":29,"content":"        // This is a much more useful error response for your frontend developers."},{"type":"INSERT","lineNumber":30,"content":"        Map<String, Object> body = new HashMap<>();"},{"type":"MODIFY","lineNumber":59,"content":"        return new ResponseEntity<>(messageResponse, HttpStatus.BAD_REQUEST);","oldContent":""},{"type":"MODIFY","lineNumber":70,"content":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());","oldContent":"}"},{"type":"INSERT","lineNumber":71,"content":"        return new ResponseEntity<>(messageResponse, HttpStatus.NOT_FOUND);"},{"type":"INSERT","lineNumber":73,"content":""},{"type":"INSERT","lineNumber":74,"content":"    @ExceptionHandler(BadRequestException.class)"},{"type":"INSERT","lineNumber":75,"content":"    public ResponseEntity<MessageResponse> handleBadRequestException(BadRequestException ex, WebRequest request) {"},{"type":"INSERT","lineNumber":76,"content":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"INSERT","lineNumber":77,"content":"        return new ResponseEntity<>(messageResponse, HttpStatus.BAD_REQUEST);"},{"type":"INSERT","lineNumber":81,"content":"    public ResponseEntity<MessageResponse> handleBadRequestException(BadRequestException ex, WebRequest request) {"},{"type":"INSERT","lineNumber":82,"content":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"INSERT","lineNumber":83,"content":"        return new ResponseEntity<>(messageResponse, HttpStatus.BAD_REQUEST);"},{"type":"DELETE","lineNumber":76,"oldContent":"    "},{"type":"DELETE","lineNumber":77,"oldContent":"    "},{"type":"INSERT","lineNumber":85,"content":"}"}]},{"timestamp":1762113242172,"changes":[{"type":"DELETE","lineNumber":1,"oldContent":""},{"type":"MODIFY","lineNumber":1,"content":"import com.capstone.tele_ticketing_backend_1.security.payload.response.MessageResponse;","oldContent":"package com.capstone.tele_ticketing_backend_1.exception;"},{"type":"INSERT","lineNumber":2,"content":"import org.springframework.http.HttpStatus;"},{"type":"MODIFY","lineNumber":11,"content":"import java.util.HashMap;","oldContent":"import org.springframework.web.context.request.WebRequest;"},{"type":"MODIFY","lineNumber":13,"content":"","oldContent":"@ControllerAdvice"},{"type":"DELETE","lineNumber":22,"oldContent":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);"},{"type":"INSERT","lineNumber":28,"content":""},{"type":"MODIFY","lineNumber":61,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":64,"content":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());","oldContent":"    }"},{"type":"DELETE","lineNumber":73,"oldContent":"    }"},{"type":"DELETE","lineNumber":75,"oldContent":""},{"type":"DELETE","lineNumber":77,"oldContent":"    @ExceptionHandler(BadRequestException.class)"},{"type":"INSERT","lineNumber":76,"content":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"INSERT","lineNumber":77,"content":"        return new ResponseEntity<>(messageResponse, HttpStatus.BAD_REQUEST);"},{"type":"INSERT","lineNumber":79,"content":""},{"type":"INSERT","lineNumber":80,"content":"    @ExceptionHandler(BadRequestException.class)"},{"type":"INSERT","lineNumber":81,"content":"    public ResponseEntity<MessageResponse> handle(BadRequestException ex, WebRequest request) {"},{"type":"INSERT","lineNumber":84,"content":"    }"},{"type":"DELETE","lineNumber":83,"oldContent":"        return new ResponseEntity<>(messageResponse, HttpStatus.BAD_REQUEST);"},{"type":"DELETE","lineNumber":84,"oldContent":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"DELETE","lineNumber":85,"oldContent":"    public ResponseEntity<MessageResponse> handleBadRequestException(BadRequestException ex, WebRequest request) {"}]},{"timestamp":1762113247063,"changes":[{"type":"MODIFY","lineNumber":2,"content":"import org.springframework.http.HttpStatus;","oldContent":"// File: com/capstone/tele_ticketing_backend_1/exception/GlobalExceptionHandler.java"},{"type":"DELETE","lineNumber":4,"oldContent":"package com.capstone.tele_ticketing_backend_1.exception;"},{"type":"DELETE","lineNumber":5,"oldContent":""},{"type":"INSERT","lineNumber":4,"content":"import org.springframework.validation.FieldError;"},{"type":"INSERT","lineNumber":5,"content":"import org.springframework.web.bind.MethodArgumentNotValidException;"},{"type":"MODIFY","lineNumber":28,"content":"","oldContent":""},{"type":"DELETE","lineNumber":32,"oldContent":"    // Dr. X's Note: Handles when a user is looked up but not found."},{"type":"DELETE","lineNumber":33,"oldContent":"    @ExceptionHandler(UserNotFoundException.class)"},{"type":"DELETE","lineNumber":34,"oldContent":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"DELETE","lineNumber":35,"oldContent":"        return new ResponseEntity<>(messageResponse, HttpStatus.NOT_FOUND);"},{"type":"DELETE","lineNumber":36,"oldContent":"}"},{"type":"INSERT","lineNumber":32,"content":"        body.put(\"errors\", errors);"},{"type":"INSERT","lineNumber":33,"content":""},{"type":"INSERT","lineNumber":34,"content":"        return new ResponseEntity<>(body, HttpStatus.BAD_REQUEST);"},{"type":"INSERT","lineNumber":35,"content":"    }"},{"type":"INSERT","lineNumber":36,"content":""},{"type":"MODIFY","lineNumber":46,"content":"    public ResponseEntity<MessageResponse> handleUserAlreadyExistsException(UserAlreadyExistsException ex, WebRequest request) {","oldContent":"    public ResponseEntity<MessageResponse> handleRoleNotFoundException(RoleNotFoundException ex, WebRequest request) {"},{"type":"MODIFY","lineNumber":58,"content":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());","oldContent":""},{"type":"MODIFY","lineNumber":60,"content":"    }","oldContent":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);"},{"type":"MODIFY","lineNumber":69,"content":"    public ResponseEntity<MessageResponse> handleUserNotFoundException(UserNotFoundException ex, WebRequest request) {","oldContent":"}"},{"type":"MODIFY","lineNumber":72,"content":"    }","oldContent":"        return new ResponseEntity<>(messageResponse, HttpStatus.BAD_REQUEST);"},{"type":"DELETE","lineNumber":74,"oldContent":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"DELETE","lineNumber":76,"oldContent":"        return new ResponseEntity<>(messageResponse, HttpStatus.BAD_REQUEST);"},{"type":"DELETE","lineNumber":78,"oldContent":""},{"type":"INSERT","lineNumber":76,"content":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"INSERT","lineNumber":77,"content":"        return new ResponseEntity<>(messageResponse, HttpStatus.BAD_REQUEST);"},{"type":"INSERT","lineNumber":79,"content":""},{"type":"INSERT","lineNumber":81,"content":"    public ResponseEntity<MessageResponse> handleResourceNotFoundException(BadRequestException ex, WebRequest request) {"},{"type":"DELETE","lineNumber":82,"oldContent":"    public ResponseEntity<MessageResponse> handle(BadRequestException ex, WebRequest request) {"},{"type":"DELETE","lineNumber":84,"oldContent":"        return new ResponseEntity<>(messageResponse, HttpStatus.BAD_REQUEST);"},{"type":"INSERT","lineNumber":85,"content":"}"}]},{"timestamp":1762113250168,"changes":[{"type":"MODIFY","lineNumber":3,"content":"import org.springframework.http.ResponseEntity;","oldContent":"package com.capstone.tele_ticketing_backend_1.exception;"},{"type":"INSERT","lineNumber":27,"content":"        });"},{"type":"DELETE","lineNumber":28,"oldContent":""},{"type":"MODIFY","lineNumber":31,"content":"        body.put(\"message\", \"Validation Failed\");","oldContent":"    // Dr. X's Note: Handles when a user is looked up but not found."},{"type":"INSERT","lineNumber":41,"content":"        MessageResponse messageResponse = new MessageResponse(ex.getMessage());"},{"type":"DELETE","lineNumber":42,"oldContent":"    public ResponseEntity<MessageResponse> handleUserAlreadyExistsException(UserAlreadyExistsException ex, WebRequest request) {"},{"type":"MODIFY","lineNumber":45,"content":"    @ExceptionHandler(UserAlreadyExistsException.class)","oldContent":"    public ResponseEntity<MessageResponse> handleRoleNotFoundException(RoleNotFoundException ex, WebRequest request) {"},{"type":"MODIFY","lineNumber":50,"content":"","oldContent":"    }"},{"type":"MODIFY","lineNumber":57,"content":"    public ResponseEntity<MessageResponse> handleRoleNotFoundException(RoleNotFoundException ex, WebRequest request) {","oldContent":""},{"type":"INSERT","lineNumber":67,"content":""},{"type":"DELETE","lineNumber":68,"oldContent":"}"},{"type":"INSERT","lineNumber":75,"content":"    public ResponseEntity<MessageResponse> handleBadRequestException(BadRequestException ex, WebRequest request) {"},{"type":"DELETE","lineNumber":77,"oldContent":"    public ResponseEntity<MessageResponse> handleBadRequestException(BadRequestException ex, WebRequest request) {"},{"type":"DELETE","lineNumber":78,"oldContent":""},{"type":"DELETE","lineNumber":80,"oldContent":"    @ExceptionHandler(BadRequestException.class)"},{"type":"INSERT","lineNumber":79,"content":""},{"type":"INSERT","lineNumber":80,"content":"    @ExceptionHandler(ResourceNotFoundException.class)"},{"type":"MODIFY","lineNumber":85,"content":"}","oldContent":"}"}]},{"timestamp":1762113253419,"changes":[{"type":"INSERT","lineNumber":15,"content":"public class GlobalExceptionHandler {"},{"type":"DELETE","lineNumber":16,"oldContent":""},{"type":"MODIFY","lineNumber":37,"content":"    // ... your other existing @ExceptionHandler methods ...","oldContent":"    }"},{"type":"MODIFY","lineNumber":42,"content":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);","oldContent":"    @ExceptionHandler(RoleNotFoundException.class)"},{"type":"DELETE","lineNumber":47,"oldContent":"    }"},{"type":"MODIFY","lineNumber":48,"content":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);","oldContent":"        return new ResponseEntity<>(messageResponse, HttpStatus.CONFLICT);"},{"type":"INSERT","lineNumber":49,"content":"    }"},{"type":"DELETE","lineNumber":55,"oldContent":""},{"type":"INSERT","lineNumber":56,"content":"    @ExceptionHandler(RoleNotFoundException.class)"},{"type":"MODIFY","lineNumber":68,"content":"    @ExceptionHandler(UserNotFoundException.class)","oldContent":"}"},{"type":"INSERT","lineNumber":78,"content":"    }"},{"type":"DELETE","lineNumber":79,"oldContent":"}"},{"type":"MODIFY","lineNumber":81,"content":"    public ResponseEntity<MessageResponse> handleResourceNotFoundException(ResourceNotFoundException ex, WebRequest request) {","oldContent":"    public ResponseEntity<MessageResponse> handleResourceNotFoundException(BadRequestException ex, WebRequest request) {"},{"type":"INSERT","lineNumber":84,"content":"    }"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/AuthController.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/AuthController.java","baseContent":"package com.capstone.tele_ticketing_backend_1.controller;\n\n\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Set;\nimport java.util.stream.Collectors;\n\nimport com.capstone.tele_ticketing_backend_1.entities.AppUser;\nimport com.capstone.tele_ticketing_backend_1.entities.ERole;\nimport com.capstone.tele_ticketing_backend_1.entities.Role;\nimport com.capstone.tele_ticketing_backend_1.repo.RoleRepo;\nimport com.capstone.tele_ticketing_backend_1.repo.UserRepo;\nimport com.capstone.tele_ticketing_backend_1.security.jwt.JwtUtils;\nimport com.capstone.tele_ticketing_backend_1.security.payload.request.LoginRequest;\nimport com.capstone.tele_ticketing_backend_1.security.payload.request.SignupRequest;\nimport com.capstone.tele_ticketing_backend_1.security.payload.response.JwtResponse;\nimport com.capstone.tele_ticketing_backend_1.security.payload.response.MessageResponse;\nimport com.capstone.tele_ticketing_backend_1.security.service.UserDetailsImpl;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.security.authentication.AuthenticationManager;\nimport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.core.GrantedAuthority;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.web.bind.annotation.CrossOrigin;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport jakarta.validation.Valid;\n\npackage com.capstone.tele_ticketing_backend_1.controller;\n\n// ... all your other imports\nimport com.capstone.tele_ticketing_backend_1.exception.RoleNotFoundException;\nimport com.capstone.tele_ticketing_backend_1.exception.UserAlreadyExistsException;\n\n@CrossOrigin(origins = \"*\", maxAge = 3600) // Dr. X's Warning: This is a critical security risk. Restrict this to your frontend's actual domain.\n@RestController\n@RequestMapping(\"/api/auth\")\npublic class AuthController {\n\t@Autowired\n\tAuthenticationManager authenticationManager;\n\n\t@Autowired\n\tUserRepo userRepository;\n\n\t@Autowired\n\tRoleRepo roleRepository;\n\n\t@Autowired\n\tPasswordEncoder encoder;\n\n\t@Autowired\n\tJwtUtils jwtUtils;\n\n\t@PostMapping(\"/signin\")\n\tpublic ResponseEntity<?> authenticateUser(@Valid @RequestBody LoginRequest loginRequest) {\n\t\t// ... This method's logic remains the same\n\t\tAuthentication authentication = authenticationManager.authenticate(\n\t\t\t\tnew UsernamePasswordAuthenticationToken(loginRequest.getUsername(),\n\t\t\t\t\t\tloginRequest.getPassword()));\n\n\t\tSecurityContextHolder.getContext().setAuthentication(authentication);\n\t\tString jwt = jwtUtils.generateJwtToken(authentication);\n\n\t\tUserDetailsImpl userDetails = (UserDetailsImpl) authentication.getPrincipal();\n\n\t\t// Dr. X's Note: I must strongly advise against using .findFirst().\n\t\t// It relies on non-guaranteed DB query ordering and can cause unpredictable permission changes.\n\t\t// The token should ideally contain all authorities.\n\t\tString firstAuthority = userDetails.getAuthorities().stream()\n\t\t\t\t.findFirst()\n\t\t\t\t.map(GrantedAuthority::getAuthority)\n\t\t\t\t.map(this::mapRoleToFrontend)\n\t\t\t\t.orElse(null);\n\n\n\t\treturn ResponseEntity.ok(new JwtResponse(jwt,\n\t\t\t\tuserDetails.getId(),\n\t\t\t\tuserDetails.getUsername(),\n\t\t\t\tfirstAuthority\n\t\t));\n\t}\n\n\t@PostMapping(\"/signup\")\n\tpublic ResponseEntity<?> registerUser(@Valid @RequestBody SignupRequest signUpRequest) {\n\t\t// Dr. X's Change: Instead of returning a ResponseEntity, we now throw our specific exception.\n\t\t// The GlobalExceptionHandler will catch this and return a 409 Conflict.\n\t\tif (userRepository.existsByUsername(signUpRequest.getUsername())) {\n\t\t\tthrow new UserAlreadyExistsException(\"Error: Username is already taken!\");\n\t\t}\n\n\t\t// Create new user's account\n\t\tAppUser user = new AppUser(signUpRequest.getUsername(),\n\t\t\t\tencoder.encode(signUpRequest.getPassword()), signUpRequest.getFullname());\n\n\t\tSet<String> strRoles = signUpRequest.getRole();\n\t\tSet<Role> roles = new HashSet<>();\n\n\t\tif (strRoles == null || strRoles.isEmpty()) {\n\t\t\tthrow new RoleNotFoundException(\"Error: Role must be provided.\");\n\t\t}\n\n\t\tstrRoles.forEach(role -> {\n\t\t\tswitch (role) {\n\t\t\t\tcase \"customer\": {\n\t\t\t\t\t// Dr. X's Change: Replaced RuntimeException with our specific, typed exception.\n\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_CUSTOMER)\n\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'CUSTOMER' is not found.\"));\n\t\t\t\t\troles.add(foundRole);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase \"agent\": {\n\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_AGENT)\n\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'AGENT' is not found.\"));\n\t\t\t\t\troles.add(foundRole);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t// ... Apply the same .orElseThrow(() -> new RoleNotFoundException(...)) pattern for ALL other roles ...\n\t\t\t\tcase \"triage_officer\": {\n\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_TRIAGE_OFFICER)\n\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'TRIAGE_OFFICER' is not found.\"));\n\t\t\t\t\troles.add(foundRole);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t// (and so on for field_engineer, noc_engineer, etc.)\n\t\t\t\tdefault:\n\t\t\t\t\t// Dr. X's Change: Handle invalid role strings with the correct exception.\n\t\t\t\t\tthrow new RoleNotFoundException(\"Error: Invalid role specified: \" + role);\n\t\t\t}\n\t\t});\n\n\t\tuser.setRoles(roles);\n\t\tuserRepository.save(user);\n\n\t\treturn ResponseEntity.ok(new MessageResponse(\"User registered successfully!\"));\n\t}\n\n\tprivate String mapRoleToFrontend(String backendRole) {\n\t\t// ... This method's logic remains the same\n\t\tswitch (backendRole) {\n\t\t\tcase \"ROLE_CUSTOMER\": return \"Customer\";\n\t\t\t// ... etc.\n\t\t\tdefault: return backendRole;\n\t\t}\n\t}\n}\n\n\tprivate String mapRoleToFrontend(String backendRole) {\n\t\tswitch (backendRole) {\n\t\t\tcase \"ROLE_CUSTOMER\": return \"Customer\";\n\t\t\tcase \"ROLE_AGENT\": return \"Agent\";\n\t\t\tcase \"ROLE_TRIAGE_OFFICER\": return \"Triage Officer\";\n\t\t\tcase \"ROLE_FIELD_ENGINEER\": return \"Field Engineer\";\n\t\t\tcase \"ROLE_NOC_ENGINEER\": return \"NOC Engineer\";\n\t\t\tcase \"ROLE_L1_ENGINEER\": return \"L1 Engineer\";\n\t\t\tcase \"ROLE_TEAM_LEAD\": return \"Team Lead\";\n\t\t\tcase \"ROLE_MANAGER\": return \"Manager\";\n\t\t\tcase \"ROLE_CXO\": return \"CXO\";\n\t\t\tcase \"ROLE_NOC_ADMIN\": return \"NOC Admin\";\n\t\t\tdefault: return backendRole; // fallback if unknown\n\t\t}\n\t}\n\n}","baseTimestamp":1761777896464,"deltas":[{"timestamp":1761777899616,"changes":[{"type":"DELETE","lineNumber":151,"oldContent":"}"}]},{"timestamp":1761777901715,"changes":[{"type":"MODIFY","lineNumber":150,"content":"\t","oldContent":"\t}"}]},{"timestamp":1761777911416,"changes":[{"type":"MODIFY","lineNumber":146,"content":"\t\t\tcase \"ROLE_CUSTOMER\":","oldContent":"\t\t\tcase \"ROLE_CUSTOMER\": return \"Customer\";"},{"type":"INSERT","lineNumber":147,"content":"\t\t\t\treturn \"Customer\";"},{"type":"DELETE","lineNumber":148,"oldContent":"\t\t\tdefault: return backendRole;"},{"type":"INSERT","lineNumber":149,"content":"\t\t\tdefault:"},{"type":"INSERT","lineNumber":150,"content":"\t\t\t\treturn backendRole;"},{"type":"DELETE","lineNumber":150,"oldContent":"\t"},{"type":"DELETE","lineNumber":152,"oldContent":"\tprivate String mapRoleToFrontend(String backendRole) {"},{"type":"DELETE","lineNumber":153,"oldContent":"\t\tswitch (backendRole) {"},{"type":"DELETE","lineNumber":154,"oldContent":"\t\t\tcase \"ROLE_CUSTOMER\": return \"Customer\";"},{"type":"DELETE","lineNumber":155,"oldContent":"\t\t\tcase \"ROLE_AGENT\": return \"Agent\";"},{"type":"DELETE","lineNumber":156,"oldContent":"\t\t\tcase \"ROLE_TRIAGE_OFFICER\": return \"Triage Officer\";"},{"type":"DELETE","lineNumber":157,"oldContent":"\t\t\tcase \"ROLE_FIELD_ENGINEER\": return \"Field Engineer\";"},{"type":"DELETE","lineNumber":158,"oldContent":"\t\t\tcase \"ROLE_NOC_ENGINEER\": return \"NOC Engineer\";"},{"type":"DELETE","lineNumber":159,"oldContent":"\t\t\tcase \"ROLE_L1_ENGINEER\": return \"L1 Engineer\";"},{"type":"DELETE","lineNumber":160,"oldContent":"\t\t\tcase \"ROLE_TEAM_LEAD\": return \"Team Lead\";"},{"type":"DELETE","lineNumber":161,"oldContent":"\t\t\tcase \"ROLE_MANAGER\": return \"Manager\";"},{"type":"DELETE","lineNumber":162,"oldContent":"\t\t\tcase \"ROLE_CXO\": return \"CXO\";"},{"type":"DELETE","lineNumber":163,"oldContent":"\t\t\tcase \"ROLE_NOC_ADMIN\": return \"NOC Admin\";"},{"type":"DELETE","lineNumber":164,"oldContent":"\t\t\tdefault: return backendRole; // fallback if unknown"},{"type":"INSERT","lineNumber":153,"content":""},{"type":"INSERT","lineNumber":154,"content":"\t\tprivate String mapRoleToFrontend (String backendRole){"},{"type":"INSERT","lineNumber":155,"content":"\t\t\tswitch (backendRole) {"},{"type":"INSERT","lineNumber":156,"content":"\t\t\t\tcase \"ROLE_CUSTOMER\":"},{"type":"INSERT","lineNumber":157,"content":"\t\t\t\t\treturn \"Customer\";"},{"type":"INSERT","lineNumber":158,"content":"\t\t\t\tcase \"ROLE_AGENT\":"},{"type":"INSERT","lineNumber":159,"content":"\t\t\t\t\treturn \"Agent\";"},{"type":"INSERT","lineNumber":160,"content":"\t\t\t\tcase \"ROLE_TRIAGE_OFFICER\":"},{"type":"INSERT","lineNumber":161,"content":"\t\t\t\t\treturn \"Triage Officer\";"},{"type":"INSERT","lineNumber":162,"content":"\t\t\t\tcase \"ROLE_FIELD_ENGINEER\":"},{"type":"INSERT","lineNumber":163,"content":"\t\t\t\t\treturn \"Field Engineer\";"},{"type":"INSERT","lineNumber":164,"content":"\t\t\t\tcase \"ROLE_NOC_ENGINEER\":"},{"type":"INSERT","lineNumber":165,"content":"\t\t\t\t\treturn \"NOC Engineer\";"},{"type":"INSERT","lineNumber":166,"content":"\t\t\t\tcase \"ROLE_L1_ENGINEER\":"},{"type":"INSERT","lineNumber":167,"content":"\t\t\t\t\treturn \"L1 Engineer\";"},{"type":"INSERT","lineNumber":168,"content":"\t\t\t\tcase \"ROLE_TEAM_LEAD\":"},{"type":"INSERT","lineNumber":169,"content":"\t\t\t\t\treturn \"Team Lead\";"},{"type":"INSERT","lineNumber":170,"content":"\t\t\t\tcase \"ROLE_MANAGER\":"},{"type":"INSERT","lineNumber":171,"content":"\t\t\t\t\treturn \"Manager\";"},{"type":"INSERT","lineNumber":172,"content":"\t\t\t\tcase \"ROLE_CXO\":"},{"type":"INSERT","lineNumber":173,"content":"\t\t\t\t\treturn \"CXO\";"},{"type":"INSERT","lineNumber":174,"content":"\t\t\t\tcase \"ROLE_NOC_ADMIN\":"},{"type":"INSERT","lineNumber":175,"content":"\t\t\t\t\treturn \"NOC Admin\";"},{"type":"INSERT","lineNumber":176,"content":"\t\t\t\tdefault:"},{"type":"INSERT","lineNumber":177,"content":"\t\t\t\t\treturn backendRole; // fallback if unknown"},{"type":"INSERT","lineNumber":178,"content":"\t\t\t}"},{"type":"DELETE","lineNumber":166,"oldContent":"\t}"},{"type":"INSERT","lineNumber":181,"content":"\t}"}]},{"timestamp":1761777922824,"changes":[{"type":"DELETE","lineNumber":35,"oldContent":"package com.capstone.tele_ticketing_backend_1.controller;"},{"type":"MODIFY","lineNumber":150,"content":"\t\t}","oldContent":"\t\t}"},{"type":"DELETE","lineNumber":166,"oldContent":"\t\t}"},{"type":"DELETE","lineNumber":169,"oldContent":""},{"type":"DELETE","lineNumber":171,"oldContent":"}"},{"type":"DELETE","lineNumber":173,"oldContent":"\t}"},{"type":"DELETE","lineNumber":175,"oldContent":"\t\t\t}"},{"type":"DELETE","lineNumber":177,"oldContent":"\t\t\t\t\treturn backendRole; // fallback if unknown"},{"type":"DELETE","lineNumber":179,"oldContent":"\t\t\t\tdefault:"},{"type":"DELETE","lineNumber":181,"oldContent":"\t\t\t\t\treturn \"NOC Admin\";"},{"type":"INSERT","lineNumber":174,"content":"\t\t\t\t\treturn \"NOC Admin\";"},{"type":"INSERT","lineNumber":175,"content":"\t\t\t\tdefault:"},{"type":"INSERT","lineNumber":176,"content":"\t\t\t\t\treturn backendRole; // fallback if unknown"},{"type":"INSERT","lineNumber":177,"content":"\t\t\t}"},{"type":"INSERT","lineNumber":178,"content":"\t\t}"},{"type":"INSERT","lineNumber":179,"content":""},{"type":"INSERT","lineNumber":180,"content":"\t}"},{"type":"INSERT","lineNumber":181,"content":"}"}]},{"timestamp":1761777927703,"changes":[{"type":"DELETE","lineNumber":37,"oldContent":"import com.capstone.tele_ticketing_backend_1.exception.RoleNotFoundException;"},{"type":"MODIFY","lineNumber":37,"content":"import com.capstone.tele_ticketing_backend_1.exceptions.RoleNotFoundException;","oldContent":"import com.capstone.tele_ticketing_backend_1.exception.UserAlreadyExistsException;"},{"type":"INSERT","lineNumber":38,"content":"import com.capstone.tele_ticketing_backend_1.exceptions.UserAlreadyExistsException;"},{"type":"MODIFY","lineNumber":150,"content":"\t\t}","oldContent":"\t\t}"},{"type":"MODIFY","lineNumber":170,"content":"\t\t\t\t\treturn \"Manager\";","oldContent":"\t\t\t\t\treturn \"NOC Admin\";"},{"type":"INSERT","lineNumber":171,"content":"\t\t\t\tcase \"ROLE_CXO\":"},{"type":"INSERT","lineNumber":172,"content":"\t\t\t\t\treturn \"CXO\";"},{"type":"INSERT","lineNumber":173,"content":"\t\t\t\tcase \"ROLE_NOC_ADMIN\":"},{"type":"INSERT","lineNumber":174,"content":"\t\t\t\t\treturn \"NOC Admin\";"},{"type":"DELETE","lineNumber":173,"oldContent":"\t\t\t\t\treturn \"Manager\";"},{"type":"DELETE","lineNumber":176,"oldContent":"\t\t\t\tcase \"ROLE_CXO\":"},{"type":"DELETE","lineNumber":179,"oldContent":"\t\t\t\t\treturn \"CXO\";"},{"type":"DELETE","lineNumber":181,"oldContent":"\t\t\t\tcase \"ROLE_NOC_ADMIN\":"}]},{"timestamp":1761777947798,"changes":[{"type":"MODIFY","lineNumber":38,"content":"import com.capstone.tele_ticketing_backend_1.exceptions.UserAlreadyExistsException;","oldContent":"import com.capstone.tele_ticketing_backend_1.exception.UserAlreadyExistsException;"},{"type":"MODIFY","lineNumber":140,"content":"\t","oldContent":"\t}"},{"type":"DELETE","lineNumber":142,"oldContent":"\tprivate String mapRoleToFrontend(String backendRole) {"},{"type":"DELETE","lineNumber":143,"oldContent":"\t\t// ... This method's logic remains the same"},{"type":"DELETE","lineNumber":144,"oldContent":"\t\tswitch (backendRole) {"},{"type":"DELETE","lineNumber":145,"oldContent":"\t\t\tcase \"ROLE_CUSTOMER\":"},{"type":"DELETE","lineNumber":146,"oldContent":"\t\t\t\treturn \"Customer\";"},{"type":"DELETE","lineNumber":147,"oldContent":"\t\t\t// ... etc."},{"type":"DELETE","lineNumber":148,"oldContent":"\t\t\tdefault:"},{"type":"DELETE","lineNumber":149,"oldContent":"\t\t}"},{"type":"DELETE","lineNumber":150,"oldContent":"\t\t}"},{"type":"DELETE","lineNumber":152,"oldContent":""},{"type":"DELETE","lineNumber":169,"oldContent":"\t\t\t\t\treturn \"NOC Admin\";"},{"type":"INSERT","lineNumber":159,"content":"\t\t\t\tcase \"ROLE_MANAGER\":"},{"type":"DELETE","lineNumber":172,"oldContent":"\t\t\t\tdefault:"},{"type":"DELETE","lineNumber":174,"oldContent":"\t\t\t\t\treturn backendRole; // fallback if unknown"},{"type":"INSERT","lineNumber":165,"content":"\t\t\t\tdefault:"},{"type":"INSERT","lineNumber":166,"content":"\t\t\t\t\treturn backendRole; // fallback if unknown"}]},{"timestamp":1761777950829,"changes":[{"type":"INSERT","lineNumber":140,"content":"\t}"},{"type":"DELETE","lineNumber":149,"oldContent":"\t\t\t\tcase \"ROLE_MANAGER\":"},{"type":"DELETE","lineNumber":156,"oldContent":"\t\t\t\tdefault:"},{"type":"DELETE","lineNumber":158,"oldContent":"\t\t\t\t\treturn backendRole; // fallback if unknown"},{"type":"INSERT","lineNumber":160,"content":"\t\t\t\tcase \"ROLE_MANAGER\":"},{"type":"INSERT","lineNumber":166,"content":"\t\t\t\tdefault:"},{"type":"INSERT","lineNumber":167,"content":"\t\t\t\t\treturn backendRole; // fallback if unknown"}]},{"timestamp":1761777956737,"changes":[{"type":"DELETE","lineNumber":158,"oldContent":"\t\t\t\tcase \"ROLE_MANAGER\":"},{"type":"INSERT","lineNumber":160,"content":"\t\t\t\tcase \"ROLE_MANAGER\":"},{"type":"MODIFY","lineNumber":166,"content":"\t\t\t\tdefault:","oldContent":"\t\t\t\tdefault:"},{"type":"DELETE","lineNumber":172,"oldContent":"}"}]},{"timestamp":1761777974882,"changes":[{"type":"DELETE","lineNumber":6,"oldContent":"import java.util.stream.Collectors;"},{"type":"MODIFY","lineNumber":159,"content":"\t\t\t\tcase \"ROLE_MANAGER\":","oldContent":"\t\t\t\tcase \"ROLE_MANAGER\":"},{"type":"INSERT","lineNumber":164,"content":"\t\t\t\t\treturn \"NOC Admin\";"},{"type":"DELETE","lineNumber":166,"oldContent":"\t\t\t\tdefault:"}]},{"timestamp":1761777977358,"changes":[{"type":"DELETE","lineNumber":4,"oldContent":"import java.util.List;"},{"type":"MODIFY","lineNumber":158,"content":"\t\t\t\tcase \"ROLE_MANAGER\":","oldContent":"\t\t\t\tcase \"ROLE_MANAGER\":"},{"type":"MODIFY","lineNumber":163,"content":"\t\t\t\t\treturn \"NOC Admin\";","oldContent":"\t\t\t\t\treturn \"NOC Admin\";"}]},{"timestamp":1761778051221,"changes":[{"type":"DELETE","lineNumber":139,"oldContent":"\t"},{"type":"INSERT","lineNumber":141,"content":""},{"type":"MODIFY","lineNumber":158,"content":"\t\t\t\tcase \"ROLE_MANAGER\":","oldContent":"\t\t\t\tcase \"ROLE_MANAGER\":"},{"type":"MODIFY","lineNumber":163,"content":"\t\t\t\t\treturn \"NOC Admin\";","oldContent":"\t\t\t\t\treturn \"NOC Admin\";"}]},{"timestamp":1761806712192,"changes":[{"type":"MODIFY","lineNumber":38,"content":"@CrossOrigin(origins = \"http://localhost:8080\", maxAge = 3600) // Dr. X's Warning: This is a critical security risk. Restrict this to your frontend's actual domain.","oldContent":"@CrossOrigin(origins = \"*\", maxAge = 3600) // Dr. X's Warning: This is a critical security risk. Restrict this to your frontend's actual domain."},{"type":"INSERT","lineNumber":157,"content":"\t\t\t\t\treturn \"Team Lead\";"},{"type":"DELETE","lineNumber":158,"oldContent":"\t\t\t\tcase \"ROLE_MANAGER\":"},{"type":"INSERT","lineNumber":162,"content":"\t\t\t\tcase \"ROLE_NOC_ADMIN\":"},{"type":"DELETE","lineNumber":163,"oldContent":"\t\t\t\t\treturn \"NOC Admin\";"}]},{"timestamp":1761807822453,"changes":[{"type":"MODIFY","lineNumber":40,"content":"@RequestMapping(\"/api/v1/auth\")","oldContent":"@RequestMapping(\"/api/auth\")"}]},{"timestamp":1761857500268,"changes":[{"type":"DELETE","lineNumber":108,"oldContent":"\t\t\t\t\t// Dr. X's Change: Replaced RuntimeException with our specific, typed exception."},{"type":"DELETE","lineNumber":120,"oldContent":"\t\t\t\t// ... Apply the same .orElseThrow(() -> new RoleNotFoundException(...)) pattern for ALL other roles ..."},{"type":"DELETE","lineNumber":127,"oldContent":"\t\t\t\t// (and so on for field_engineer, noc_engineer, etc.)"},{"type":"INSERT","lineNumber":125,"content":"\t\t\t\tcase \"field_engineer\": {"},{"type":"INSERT","lineNumber":126,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_FIELD_ENGINEER)"},{"type":"INSERT","lineNumber":127,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'FIELD_ENGINEER' is not found.\"));"},{"type":"INSERT","lineNumber":128,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":129,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":130,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":131,"content":"\t\t\t\tcase \"noc_engineer\": {"},{"type":"INSERT","lineNumber":132,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_NOC_ENGINEER)"},{"type":"INSERT","lineNumber":133,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'NOC_ENGINEER' is not found.\"));"},{"type":"INSERT","lineNumber":134,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":135,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":136,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":137,"content":"\t\t\t\tcase \"l1_engineer\": {"},{"type":"INSERT","lineNumber":138,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_L1_ENGINEER)"},{"type":"INSERT","lineNumber":139,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'L1_ENGINEER' is not found.\"));"},{"type":"INSERT","lineNumber":140,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":141,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":142,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":143,"content":"\t\t\t\tcase \"manager\": {"},{"type":"INSERT","lineNumber":144,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_MANAGER)"},{"type":"INSERT","lineNumber":145,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'MANAGER' is not found.\"));"},{"type":"INSERT","lineNumber":146,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":147,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":148,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":149,"content":"\t\t\t\tcase \"team_lead\": {"},{"type":"INSERT","lineNumber":150,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_TEAM_LEAD)"},{"type":"INSERT","lineNumber":151,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'TEAM_LEAD' is not found.\"));"},{"type":"INSERT","lineNumber":152,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":153,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":154,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":155,"content":"\t\t\t\tcase \"cxo\": {"},{"type":"INSERT","lineNumber":156,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_CXO)"},{"type":"INSERT","lineNumber":157,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'CXO' is not found.\"));"},{"type":"INSERT","lineNumber":158,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":159,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":160,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":161,"content":"\t\t\t\tcase \"noc_admin\": {"},{"type":"INSERT","lineNumber":162,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_NOC_ADMIN)"},{"type":"INSERT","lineNumber":163,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'NOC_ADMIN' is not found.\"));"},{"type":"INSERT","lineNumber":164,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":165,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":166,"content":"\t\t\t\t}"},{"type":"DELETE","lineNumber":129,"oldContent":"\t\t\t\t\t// Dr. X's Change: Handle invalid role strings with the correct exception."}]},{"timestamp":1762102203055,"changes":[{"type":"DELETE","lineNumber":3,"oldContent":"import java.util.HashSet;"},{"type":"DELETE","lineNumber":4,"oldContent":"import java.util.Set;"},{"type":"DELETE","lineNumber":6,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.AppUser;"},{"type":"DELETE","lineNumber":7,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.ERole;"},{"type":"DELETE","lineNumber":8,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.Role;"},{"type":"INSERT","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.entities.*;"},{"type":"INSERT","lineNumber":5,"content":"import com.capstone.tele_ticketing_backend_1.exceptions.RoleNotFoundException;"},{"type":"INSERT","lineNumber":6,"content":"import com.capstone.tele_ticketing_backend_1.exceptions.UserAlreadyExistsException;"},{"type":"INSERT","lineNumber":15,"content":"import com.capstone.tele_ticketing_backend_1.service.GeocodingService; // Dr. X's Addition: Import the new service"},{"type":"INSERT","lineNumber":16,"content":"import jakarta.validation.Valid;"},{"type":"DELETE","lineNumber":25,"oldContent":"import org.springframework.web.bind.annotation.CrossOrigin;"},{"type":"DELETE","lineNumber":26,"oldContent":"import org.springframework.web.bind.annotation.PostMapping;"},{"type":"DELETE","lineNumber":27,"oldContent":"import org.springframework.web.bind.annotation.RequestBody;"},{"type":"DELETE","lineNumber":28,"oldContent":"import org.springframework.web.bind.annotation.RequestMapping;"},{"type":"DELETE","lineNumber":29,"oldContent":"import org.springframework.web.bind.annotation.RestController;"},{"type":"INSERT","lineNumber":25,"content":"import org.springframework.web.bind.annotation.*;"},{"type":"DELETE","lineNumber":31,"oldContent":"import jakarta.validation.Valid;"},{"type":"INSERT","lineNumber":27,"content":"import java.util.HashSet;"},{"type":"INSERT","lineNumber":28,"content":"import java.util.Set;"},{"type":"DELETE","lineNumber":33,"oldContent":""},{"type":"DELETE","lineNumber":34,"oldContent":"// ... all your other imports"},{"type":"DELETE","lineNumber":35,"oldContent":"import com.capstone.tele_ticketing_backend_1.exceptions.RoleNotFoundException;"},{"type":"DELETE","lineNumber":36,"oldContent":"import com.capstone.tele_ticketing_backend_1.exceptions.UserAlreadyExistsException;"},{"type":"DELETE","lineNumber":37,"oldContent":""},{"type":"DELETE","lineNumber":38,"oldContent":"@CrossOrigin(origins = \"http://localhost:8080\", maxAge = 3600) // Dr. X's Warning: This is a critical security risk. Restrict this to your frontend's actual domain."},{"type":"INSERT","lineNumber":30,"content":"@CrossOrigin(origins = \"http://localhost:8080\", maxAge = 3600)"},{"type":"INSERT","lineNumber":34,"content":""},{"type":"INSERT","lineNumber":50,"content":"\t// Dr. X's Addition: Inject the GeocodingService."},{"type":"INSERT","lineNumber":51,"content":"\t@Autowired"},{"type":"INSERT","lineNumber":52,"content":"\tGeocodingService geocodingService;"},{"type":"INSERT","lineNumber":53,"content":""},{"type":"DELETE","lineNumber":59,"oldContent":"\t\t// ... This method's logic remains the same"},{"type":"INSERT","lineNumber":56,"content":"\t\t// This method remains unchanged."},{"type":"DELETE","lineNumber":66,"oldContent":""},{"type":"DELETE","lineNumber":69,"oldContent":"\t\t// Dr. X's Note: I must strongly advise against using .findFirst()."},{"type":"DELETE","lineNumber":70,"oldContent":"\t\t// It relies on non-guaranteed DB query ordering and can cause unpredictable permission changes."},{"type":"DELETE","lineNumber":71,"oldContent":"\t\t// The token should ideally contain all authorities."},{"type":"DELETE","lineNumber":72,"oldContent":"\t\tString firstAuthority = userDetails.getAuthorities().stream()"},{"type":"DELETE","lineNumber":73,"oldContent":"\t\t\t\t.findFirst()"},{"type":"DELETE","lineNumber":74,"oldContent":"\t\t\t\t.map(GrantedAuthority::getAuthority)"},{"type":"DELETE","lineNumber":75,"oldContent":"\t\t\t\t.map(this::mapRoleToFrontend)"},{"type":"DELETE","lineNumber":76,"oldContent":"\t\t\t\t.orElse(null);"},{"type":"INSERT","lineNumber":65,"content":"\t\t// ... mapping logic ..."},{"type":"DELETE","lineNumber":78,"oldContent":""},{"type":"DELETE","lineNumber":79,"oldContent":"\t\treturn ResponseEntity.ok(new JwtResponse(jwt,"},{"type":"DELETE","lineNumber":80,"oldContent":"\t\t\t\tuserDetails.getId(),"},{"type":"DELETE","lineNumber":81,"oldContent":"\t\t\t\tuserDetails.getUsername(),"},{"type":"DELETE","lineNumber":82,"oldContent":"\t\t\t\tfirstAuthority"},{"type":"DELETE","lineNumber":83,"oldContent":"\t\t));"},{"type":"INSERT","lineNumber":67,"content":"\t\treturn ResponseEntity.ok(new JwtResponse(jwt, userDetails.getId(), userDetails.getUsername(), \"ROLE_TEMP\"));"},{"type":"DELETE","lineNumber":88,"oldContent":"\t\t// Dr. X's Change: Instead of returning a ResponseEntity, we now throw our specific exception."},{"type":"DELETE","lineNumber":89,"oldContent":"\t\t// The GlobalExceptionHandler will catch this and return a 409 Conflict."},{"type":"INSERT","lineNumber":80,"content":"\t\t// Dr. X's Integration: Set location fields from the request and perform geocoding."},{"type":"INSERT","lineNumber":81,"content":"\t\tuser.setCity(signUpRequest.getCity());"},{"type":"INSERT","lineNumber":82,"content":"\t\tuser.setState(signUpRequest.getState());"},{"type":"INSERT","lineNumber":83,"content":"\t\tuser.setPostalCode(signUpRequest.getPostalCode());"},{"type":"INSERT","lineNumber":84,"content":""},{"type":"INSERT","lineNumber":85,"content":"\t\tif (signUpRequest.getCity() != null && signUpRequest.getPostalCode() != null) {"},{"type":"INSERT","lineNumber":86,"content":"\t\t\tCoordinates coords = geocodingService.getCoordinates("},{"type":"INSERT","lineNumber":87,"content":"\t\t\t\t\tsignUpRequest.getCity(),"},{"type":"INSERT","lineNumber":88,"content":"\t\t\t\t\tsignUpRequest.getState(),"},{"type":"INSERT","lineNumber":89,"content":"\t\t\t\t\tsignUpRequest.getPostalCode()"},{"type":"INSERT","lineNumber":90,"content":"\t\t\t);"},{"type":"INSERT","lineNumber":91,"content":"\t\t\tif (coords != null) {"},{"type":"INSERT","lineNumber":92,"content":"\t\t\t\tuser.setLatitude(coords.latitude());"},{"type":"INSERT","lineNumber":93,"content":"\t\t\t\tuser.setLongitude(coords.longitude());"},{"type":"INSERT","lineNumber":94,"content":"\t\t\t}"},{"type":"INSERT","lineNumber":95,"content":"\t\t}"},{"type":"INSERT","lineNumber":96,"content":"\t\t// --- End of new logic ---"},{"type":"INSERT","lineNumber":97,"content":""},{"type":"INSERT","lineNumber":105,"content":"\t\t// The existing switch statement for roles remains here..."},{"type":"DELETE","lineNumber":106,"oldContent":"\t\t\tswitch (role) {"},{"type":"DELETE","lineNumber":107,"oldContent":"\t\t\t\tcase \"customer\": {"},{"type":"DELETE","lineNumber":108,"oldContent":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_CUSTOMER)"},{"type":"DELETE","lineNumber":109,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'CUSTOMER' is not found.\"));"},{"type":"DELETE","lineNumber":110,"oldContent":"\t\t\t\t\troles.add(foundRole);"},{"type":"DELETE","lineNumber":111,"oldContent":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":112,"oldContent":"\t\t\t\t}"},{"type":"DELETE","lineNumber":113,"oldContent":"\t\t\t\tcase \"agent\": {"},{"type":"DELETE","lineNumber":114,"oldContent":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_AGENT)"},{"type":"DELETE","lineNumber":115,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'AGENT' is not found.\"));"},{"type":"DELETE","lineNumber":116,"oldContent":"\t\t\t\t\troles.add(foundRole);"},{"type":"DELETE","lineNumber":117,"oldContent":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":118,"oldContent":"\t\t\t\t}"},{"type":"DELETE","lineNumber":119,"oldContent":"\t\t\t\tcase \"triage_officer\": {"},{"type":"DELETE","lineNumber":120,"oldContent":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_TRIAGE_OFFICER)"},{"type":"DELETE","lineNumber":121,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'TRIAGE_OFFICER' is not found.\"));"},{"type":"DELETE","lineNumber":122,"oldContent":"\t\t\t\t\troles.add(foundRole);"},{"type":"DELETE","lineNumber":123,"oldContent":"\t\t\t\tcase \"field_engineer\": {"},{"type":"DELETE","lineNumber":124,"oldContent":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":125,"oldContent":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_FIELD_ENGINEER)"},{"type":"DELETE","lineNumber":126,"oldContent":"\t\t\t\t}"},{"type":"DELETE","lineNumber":127,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'FIELD_ENGINEER' is not found.\"));"},{"type":"DELETE","lineNumber":128,"oldContent":"\t\t\t\t\troles.add(foundRole);"},{"type":"DELETE","lineNumber":129,"oldContent":"\t\t\t\tdefault:"},{"type":"DELETE","lineNumber":130,"oldContent":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":131,"oldContent":"\t\t\t\t}"},{"type":"DELETE","lineNumber":132,"oldContent":"\t\t\t\t\tthrow new RoleNotFoundException(\"Error: Invalid role specified: \" + role);"},{"type":"DELETE","lineNumber":133,"oldContent":"\t\t\t\tcase \"noc_engineer\": {"},{"type":"DELETE","lineNumber":134,"oldContent":"\t\t\t}"},{"type":"DELETE","lineNumber":135,"oldContent":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_NOC_ENGINEER)"},{"type":"INSERT","lineNumber":107,"content":"\t\t\t// ... switch cases ..."},{"type":"DELETE","lineNumber":137,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'NOC_ENGINEER' is not found.\"));"},{"type":"DELETE","lineNumber":139,"oldContent":"\t\t\t\t\troles.add(foundRole);"},{"type":"DELETE","lineNumber":141,"oldContent":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":143,"oldContent":"\t\t\t\t}"},{"type":"DELETE","lineNumber":145,"oldContent":"\t\t\t\tcase \"l1_engineer\": {"},{"type":"DELETE","lineNumber":147,"oldContent":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_L1_ENGINEER)"},{"type":"DELETE","lineNumber":149,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'L1_ENGINEER' is not found.\"));"},{"type":"DELETE","lineNumber":151,"oldContent":"\t\t\t\t\troles.add(foundRole);"},{"type":"DELETE","lineNumber":152,"oldContent":""},{"type":"DELETE","lineNumber":153,"oldContent":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":154,"oldContent":""},{"type":"DELETE","lineNumber":155,"oldContent":"\t\t\t\t}"},{"type":"DELETE","lineNumber":156,"oldContent":"\t\tprivate String mapRoleToFrontend (String backendRole){"},{"type":"DELETE","lineNumber":157,"oldContent":"\t\t\t\tcase \"manager\": {"},{"type":"DELETE","lineNumber":158,"oldContent":"\t\t\tswitch (backendRole) {"},{"type":"DELETE","lineNumber":159,"oldContent":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_MANAGER)"},{"type":"DELETE","lineNumber":160,"oldContent":"\t\t\t\tcase \"ROLE_CUSTOMER\":"},{"type":"DELETE","lineNumber":161,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'MANAGER' is not found.\"));"},{"type":"DELETE","lineNumber":162,"oldContent":"\t\t\t\t\treturn \"Customer\";"},{"type":"DELETE","lineNumber":163,"oldContent":"\t\t\t\t\troles.add(foundRole);"},{"type":"DELETE","lineNumber":164,"oldContent":"\t\t\t\tcase \"ROLE_AGENT\":"},{"type":"DELETE","lineNumber":165,"oldContent":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":166,"oldContent":"\t\t\t\t\treturn \"Agent\";"},{"type":"DELETE","lineNumber":167,"oldContent":"\t\t\t\t}"},{"type":"DELETE","lineNumber":168,"oldContent":"\t\t\t\tcase \"ROLE_TRIAGE_OFFICER\":"},{"type":"DELETE","lineNumber":169,"oldContent":"\t\t\t\tcase \"team_lead\": {"},{"type":"DELETE","lineNumber":170,"oldContent":"\t\t\t\t\treturn \"Triage Officer\";"},{"type":"DELETE","lineNumber":171,"oldContent":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_TEAM_LEAD)"},{"type":"DELETE","lineNumber":172,"oldContent":"\t\t\t\tcase \"ROLE_FIELD_ENGINEER\":"},{"type":"DELETE","lineNumber":173,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'TEAM_LEAD' is not found.\"));"},{"type":"DELETE","lineNumber":174,"oldContent":"\t\t\t\t\treturn \"Field Engineer\";"},{"type":"DELETE","lineNumber":175,"oldContent":"\t\t\t\t\troles.add(foundRole);"},{"type":"DELETE","lineNumber":176,"oldContent":"\t\t\t\tcase \"ROLE_NOC_ENGINEER\":"},{"type":"DELETE","lineNumber":177,"oldContent":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":178,"oldContent":"\t\t\t\t\treturn \"NOC Engineer\";"},{"type":"DELETE","lineNumber":179,"oldContent":"\t\t\t\t}"},{"type":"DELETE","lineNumber":180,"oldContent":"\t\t\t\tcase \"ROLE_L1_ENGINEER\":"},{"type":"DELETE","lineNumber":181,"oldContent":"\t\t\t\tcase \"cxo\": {"},{"type":"DELETE","lineNumber":182,"oldContent":"\t\t\t\t\treturn \"L1 Engineer\";"},{"type":"DELETE","lineNumber":183,"oldContent":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_CXO)"},{"type":"DELETE","lineNumber":184,"oldContent":"\t\t\t\tcase \"ROLE_TEAM_LEAD\":"},{"type":"DELETE","lineNumber":185,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'CXO' is not found.\"));"},{"type":"DELETE","lineNumber":186,"oldContent":"\t\t\t\t\treturn \"Team Lead\";"},{"type":"DELETE","lineNumber":187,"oldContent":"\t\t\t\t\troles.add(foundRole);"},{"type":"DELETE","lineNumber":188,"oldContent":"\t\t\t\tcase \"ROLE_MANAGER\":"},{"type":"DELETE","lineNumber":189,"oldContent":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":190,"oldContent":"\t\t\t\t\treturn \"Manager\";"},{"type":"DELETE","lineNumber":191,"oldContent":"\t\t\t\t}"},{"type":"DELETE","lineNumber":192,"oldContent":"\t\t\t\tcase \"ROLE_CXO\":"},{"type":"DELETE","lineNumber":193,"oldContent":"\t\t\t\tcase \"noc_admin\": {"},{"type":"DELETE","lineNumber":194,"oldContent":"\t\t\t\t\treturn \"CXO\";"},{"type":"DELETE","lineNumber":195,"oldContent":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_NOC_ADMIN)"},{"type":"DELETE","lineNumber":196,"oldContent":"\t\t\t\tcase \"ROLE_NOC_ADMIN\":"},{"type":"DELETE","lineNumber":197,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'NOC_ADMIN' is not found.\"));"},{"type":"DELETE","lineNumber":198,"oldContent":"\t\t\t\t\treturn \"NOC Admin\";"},{"type":"DELETE","lineNumber":199,"oldContent":"\t\t\t\t\troles.add(foundRole);"},{"type":"DELETE","lineNumber":200,"oldContent":"\t\t\t\tdefault:"},{"type":"DELETE","lineNumber":201,"oldContent":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":202,"oldContent":"\t\t\t\t\treturn backendRole; // fallback if unknown"},{"type":"DELETE","lineNumber":203,"oldContent":"\t\t\t\t}"},{"type":"DELETE","lineNumber":204,"oldContent":"\t\t\t}"},{"type":"DELETE","lineNumber":205,"oldContent":"\t\t}"},{"type":"DELETE","lineNumber":206,"oldContent":""},{"type":"INSERT","lineNumber":116,"content":"\tprivate String mapRoleToFrontend (String backendRole){"},{"type":"INSERT","lineNumber":117,"content":"\t\t// This method remains unchanged."},{"type":"INSERT","lineNumber":118,"content":"\t\treturn \"ROLE_TEMP\";"},{"type":"INSERT","lineNumber":120,"content":"}"}]},{"timestamp":1762102213335,"changes":[{"type":"INSERT","lineNumber":3,"content":""},{"type":"INSERT","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.dto.Coordinates;"},{"type":"DELETE","lineNumber":5,"oldContent":""},{"type":"DELETE","lineNumber":13,"oldContent":"import com.capstone.tele_ticketing_backend_1.service.GeocodingService; // Dr. X's Addition: Import the new service"},{"type":"DELETE","lineNumber":15,"oldContent":"import jakarta.validation.Valid;"},{"type":"INSERT","lineNumber":16,"content":"import com.capstone.tele_ticketing_backend_1.service.GeocodingService; // Dr. X's Addition: Import the new service"},{"type":"INSERT","lineNumber":17,"content":"import jakarta.validation.Valid;"},{"type":"INSERT","lineNumber":27,"content":""},{"type":"DELETE","lineNumber":28,"oldContent":"@CrossOrigin(origins = \"http://localhost:8080\", maxAge = 3600)"},{"type":"DELETE","lineNumber":30,"oldContent":""},{"type":"MODIFY","lineNumber":31,"content":"@CrossOrigin(origins = \"http://localhost:8080\", maxAge = 3600)","oldContent":""},{"type":"INSERT","lineNumber":35,"content":""},{"type":"DELETE","lineNumber":43,"oldContent":"\t// Dr. X's Addition: Inject the GeocodingService."},{"type":"DELETE","lineNumber":46,"oldContent":"\t@Autowired"},{"type":"DELETE","lineNumber":47,"oldContent":"\tGeocodingService geocodingService;"},{"type":"DELETE","lineNumber":50,"oldContent":""},{"type":"DELETE","lineNumber":53,"oldContent":"\t\t// This method remains unchanged."},{"type":"INSERT","lineNumber":51,"content":"\t// Dr. X's Addition: Inject the GeocodingService."},{"type":"INSERT","lineNumber":52,"content":"\t@Autowired"},{"type":"INSERT","lineNumber":53,"content":"\tGeocodingService geocodingService;"},{"type":"INSERT","lineNumber":54,"content":""},{"type":"INSERT","lineNumber":57,"content":"\t\t// This method remains unchanged."},{"type":"DELETE","lineNumber":62,"oldContent":"\t\t// ... mapping logic ..."},{"type":"DELETE","lineNumber":64,"oldContent":"\t\treturn ResponseEntity.ok(new JwtResponse(jwt, userDetails.getId(), userDetails.getUsername(), \"ROLE_TEMP\"));"},{"type":"INSERT","lineNumber":66,"content":"\t\t// ... mapping logic ..."},{"type":"INSERT","lineNumber":68,"content":"\t\treturn ResponseEntity.ok(new JwtResponse(jwt, userDetails.getId(), userDetails.getUsername(), \"ROLE_TEMP\"));"},{"type":"INSERT","lineNumber":69,"content":"\t}"},{"type":"INSERT","lineNumber":70,"content":""},{"type":"INSERT","lineNumber":71,"content":"\t@PostMapping(\"/signup\")"},{"type":"INSERT","lineNumber":72,"content":"\tpublic ResponseEntity<?> registerUser(@Valid @RequestBody SignupRequest signUpRequest) {"},{"type":"INSERT","lineNumber":73,"content":"\t\tif (userRepository.existsByUsername(signUpRequest.getUsername())) {"},{"type":"INSERT","lineNumber":74,"content":"\t\t\tthrow new UserAlreadyExistsException(\"Error: Username is already taken!\");"},{"type":"INSERT","lineNumber":75,"content":"\t\t}"},{"type":"INSERT","lineNumber":76,"content":""},{"type":"INSERT","lineNumber":77,"content":"\t\t// Create new user's account"},{"type":"INSERT","lineNumber":78,"content":"\t\tAppUser user = new AppUser(signUpRequest.getUsername(),"},{"type":"INSERT","lineNumber":79,"content":"\t\t\t\tencoder.encode(signUpRequest.getPassword()), signUpRequest.getFullname());"},{"type":"INSERT","lineNumber":80,"content":""},{"type":"DELETE","lineNumber":73,"oldContent":"\t}"},{"type":"DELETE","lineNumber":75,"oldContent":""},{"type":"DELETE","lineNumber":77,"oldContent":"\t@PostMapping(\"/signup\")"},{"type":"DELETE","lineNumber":79,"oldContent":"\tpublic ResponseEntity<?> registerUser(@Valid @RequestBody SignupRequest signUpRequest) {"},{"type":"DELETE","lineNumber":83,"oldContent":"\t\tif (userRepository.existsByUsername(signUpRequest.getUsername())) {"},{"type":"DELETE","lineNumber":85,"oldContent":"\t\t\tthrow new UserAlreadyExistsException(\"Error: Username is already taken!\");"},{"type":"DELETE","lineNumber":87,"oldContent":"\t\t}"},{"type":"DELETE","lineNumber":89,"oldContent":""},{"type":"DELETE","lineNumber":91,"oldContent":"\t\t// Create new user's account"},{"type":"DELETE","lineNumber":93,"oldContent":"\t\tAppUser user = new AppUser(signUpRequest.getUsername(),"},{"type":"DELETE","lineNumber":95,"oldContent":"\t\t\t\tencoder.encode(signUpRequest.getPassword()), signUpRequest.getFullname());"},{"type":"DELETE","lineNumber":97,"oldContent":""},{"type":"DELETE","lineNumber":108,"oldContent":"\tprivate String mapRoleToFrontend (String backendRole){"},{"type":"DELETE","lineNumber":109,"oldContent":"\t\t// This method remains unchanged."},{"type":"DELETE","lineNumber":110,"oldContent":"\t\treturn \"ROLE_TEMP\";"},{"type":"DELETE","lineNumber":111,"oldContent":"}"},{"type":"INSERT","lineNumber":117,"content":"\tprivate String mapRoleToFrontend (String backendRole){"},{"type":"INSERT","lineNumber":118,"content":"\t\t// This method remains unchanged."},{"type":"INSERT","lineNumber":119,"content":"\t\treturn \"ROLE_TEMP\";"},{"type":"INSERT","lineNumber":121,"content":"}"}]},{"timestamp":1762102219486,"changes":[{"type":"MODIFY","lineNumber":5,"content":"import com.capstone.tele_ticketing_backend_1.entities.*;","oldContent":"import com.capstone.tele_ticketing_backend_1.entities.*;"},{"type":"MODIFY","lineNumber":16,"content":"import com.capstone.tele_ticketing_backend_1.service.GeocodingService; // Dr. X's Addition: Import the new service","oldContent":"import com.capstone.tele_ticketing_backend_1.service.GeocodingService; // Dr. X's Addition: Import the new service"},{"type":"DELETE","lineNumber":23,"oldContent":"import org.springframework.security.core.GrantedAuthority;"},{"type":"MODIFY","lineNumber":27,"content":"import java.util.HashSet;","oldContent":"import java.util.HashSet;"},{"type":"DELETE","lineNumber":48,"oldContent":"\t// Dr. X's Addition: Inject the GeocodingService."},{"type":"DELETE","lineNumber":50,"oldContent":"\t@Autowired"},{"type":"INSERT","lineNumber":49,"content":""},{"type":"INSERT","lineNumber":50,"content":"\t// Dr. X's Addition: Inject the GeocodingService."},{"type":"INSERT","lineNumber":51,"content":"\t@Autowired"},{"type":"DELETE","lineNumber":54,"oldContent":""},{"type":"INSERT","lineNumber":64,"content":""},{"type":"DELETE","lineNumber":67,"oldContent":""},{"type":"DELETE","lineNumber":69,"oldContent":"\t\t// Dr. X's Integration: Set location fields from the request and perform geocoding."},{"type":"DELETE","lineNumber":71,"oldContent":"\t\tuser.setCity(signUpRequest.getCity());"},{"type":"DELETE","lineNumber":73,"oldContent":"\t\tuser.setState(signUpRequest.getState());"},{"type":"DELETE","lineNumber":75,"oldContent":"\t\tuser.setPostalCode(signUpRequest.getPostalCode());"},{"type":"DELETE","lineNumber":77,"oldContent":""},{"type":"DELETE","lineNumber":80,"oldContent":"\t\tif (signUpRequest.getCity() != null && signUpRequest.getPostalCode() != null) {"},{"type":"DELETE","lineNumber":83,"oldContent":"\t\t\tCoordinates coords = geocodingService.getCoordinates("},{"type":"DELETE","lineNumber":86,"oldContent":"\t\t\t\t\tsignUpRequest.getCity(),"},{"type":"INSERT","lineNumber":80,"content":"\t\t// Dr. X's Integration: Set location fields from the request and perform geocoding."},{"type":"INSERT","lineNumber":81,"content":"\t\tuser.setCity(signUpRequest.getCity());"},{"type":"INSERT","lineNumber":82,"content":"\t\tuser.setState(signUpRequest.getState());"},{"type":"INSERT","lineNumber":83,"content":"\t\tuser.setPostalCode(signUpRequest.getPostalCode());"},{"type":"INSERT","lineNumber":84,"content":""},{"type":"INSERT","lineNumber":85,"content":"\t\tif (signUpRequest.getCity() != null && signUpRequest.getPostalCode() != null) {"},{"type":"INSERT","lineNumber":86,"content":"\t\t\tCoordinates coords = geocodingService.getCoordinates("},{"type":"INSERT","lineNumber":87,"content":"\t\t\t\t\tsignUpRequest.getCity(),"},{"type":"DELETE","lineNumber":114,"oldContent":"\tprivate String mapRoleToFrontend (String backendRole){"},{"type":"DELETE","lineNumber":116,"oldContent":"\t\t// This method remains unchanged."},{"type":"DELETE","lineNumber":118,"oldContent":"\t\treturn \"ROLE_TEMP\";"},{"type":"INSERT","lineNumber":116,"content":"\tprivate String mapRoleToFrontend (String backendRole){"},{"type":"INSERT","lineNumber":117,"content":"\t\t// This method remains unchanged."},{"type":"INSERT","lineNumber":118,"content":"\t\treturn \"ROLE_TEMP\";"}]},{"timestamp":1762111264185,"changes":[{"type":"DELETE","lineNumber":3,"oldContent":""},{"type":"DELETE","lineNumber":5,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.*;"},{"type":"DELETE","lineNumber":15,"oldContent":"import com.capstone.tele_ticketing_backend_1.service.GeocodingService; // Dr. X's Addition: Import the new service"},{"type":"DELETE","lineNumber":16,"oldContent":"import com.capstone.tele_ticketing_backend_1.service.GeocodingService; // Dr. X's Addition: Import the new service"},{"type":"INSERT","lineNumber":13,"content":"import com.capstone.tele_ticketing_backend_1.security.service.UserDetailsImpl;"},{"type":"INSERT","lineNumber":14,"content":"import com.capstone.tele_ticketing_backend_1.service.GeocodingService;"},{"type":"INSERT","lineNumber":21,"content":"import org.springframework.security.core.GrantedAuthority;"},{"type":"MODIFY","lineNumber":26,"content":"import java.util.HashSet;","oldContent":"import java.util.HashSet;"},{"type":"INSERT","lineNumber":27,"content":"import java.util.List;"},{"type":"INSERT","lineNumber":29,"content":"import java.util.stream.Collectors;"},{"type":"DELETE","lineNumber":47,"oldContent":""},{"type":"DELETE","lineNumber":49,"oldContent":"\t// Dr. X's Addition: Inject the GeocodingService."},{"type":"MODIFY","lineNumber":50,"content":"","oldContent":"\t@Autowired"},{"type":"INSERT","lineNumber":51,"content":"\t@Autowired"},{"type":"DELETE","lineNumber":55,"oldContent":"\tpublic ResponseEntity<?> authenticateUser(@Valid @RequestBody LoginRequest loginRequest) {"},{"type":"DELETE","lineNumber":56,"oldContent":"\t\t// This method remains unchanged."},{"type":"INSERT","lineNumber":55,"content":"\tpublic ResponseEntity<JwtResponse> authenticateUser(@Valid @RequestBody LoginRequest loginRequest) {"},{"type":"DELETE","lineNumber":58,"oldContent":"\t\t\t\tnew UsernamePasswordAuthenticationToken(loginRequest.getUsername(),"},{"type":"DELETE","lineNumber":59,"oldContent":"\t\t\t\t\t\tloginRequest.getPassword()));"},{"type":"INSERT","lineNumber":57,"content":"\t\t\t\tnew UsernamePasswordAuthenticationToken(loginRequest.getUsername(), loginRequest.getPassword())"},{"type":"INSERT","lineNumber":58,"content":"\t\t);"},{"type":"DELETE","lineNumber":63,"oldContent":""},{"type":"DELETE","lineNumber":65,"oldContent":"\t\t// ... mapping logic ..."},{"type":"DELETE","lineNumber":67,"oldContent":"\t\treturn ResponseEntity.ok(new JwtResponse(jwt, userDetails.getId(), userDetails.getUsername(), \"ROLE_TEMP\"));"},{"type":"INSERT","lineNumber":64,"content":"\t\tList<String> roles = userDetails.getAuthorities().stream()"},{"type":"INSERT","lineNumber":65,"content":"\t\t\t\t.map(GrantedAuthority::getAuthority)"},{"type":"INSERT","lineNumber":66,"content":"\t\t\t\t.collect(Collectors.toList());"},{"type":"INSERT","lineNumber":67,"content":""},{"type":"INSERT","lineNumber":68,"content":"\t\treturn ResponseEntity.ok(new JwtResponse(jwt,"},{"type":"INSERT","lineNumber":69,"content":"\t\t\t\tuserDetails.getId(),"},{"type":"INSERT","lineNumber":70,"content":"\t\t\t\tuserDetails.getUsername(),"},{"type":"INSERT","lineNumber":71,"content":"\t\t\t\troles"},{"type":"INSERT","lineNumber":72,"content":"\t\t));"},{"type":"DELETE","lineNumber":71,"oldContent":"\tpublic ResponseEntity<?> registerUser(@Valid @RequestBody SignupRequest signUpRequest) {"},{"type":"INSERT","lineNumber":76,"content":"\tpublic ResponseEntity<MessageResponse> registerUser(@Valid @RequestBody SignupRequest signUpRequest) {"},{"type":"DELETE","lineNumber":74,"oldContent":"\t\t// Dr. X's Integration: Set location fields from the request and perform geocoding."},{"type":"DELETE","lineNumber":75,"oldContent":"\t\tuser.setCity(signUpRequest.getCity());"},{"type":"DELETE","lineNumber":77,"oldContent":"\t\tuser.setState(signUpRequest.getState());"},{"type":"INSERT","lineNumber":81,"content":"\t\tAppUser user = new AppUser("},{"type":"INSERT","lineNumber":82,"content":"\t\t\t\tsignUpRequest.getUsername(),"},{"type":"INSERT","lineNumber":83,"content":"\t\t\t\tencoder.encode(signUpRequest.getPassword()),"},{"type":"INSERT","lineNumber":84,"content":"\t\t\t\tsignUpRequest.getFullname()"},{"type":"INSERT","lineNumber":85,"content":"\t\t);"},{"type":"INSERT","lineNumber":86,"content":""},{"type":"INSERT","lineNumber":87,"content":"\t\t// Set location fields and geocode the address"},{"type":"INSERT","lineNumber":88,"content":"\t\tuser.setCity(signUpRequest.getCity());"},{"type":"INSERT","lineNumber":89,"content":"\t\tuser.setState(signUpRequest.getState());"},{"type":"DELETE","lineNumber":81,"oldContent":"\t\t// Create new user's account"},{"type":"DELETE","lineNumber":83,"oldContent":"\t\tAppUser user = new AppUser(signUpRequest.getUsername(),"},{"type":"DELETE","lineNumber":86,"oldContent":"\t\t\t\tencoder.encode(signUpRequest.getPassword()), signUpRequest.getFullname());"},{"type":"DELETE","lineNumber":87,"oldContent":""},{"type":"DELETE","lineNumber":96,"oldContent":"\t\t// --- End of new logic ---"},{"type":"DELETE","lineNumber":105,"oldContent":"\t\t// The existing switch statement for roles remains here..."},{"type":"DELETE","lineNumber":107,"oldContent":"\t\t\t// ... switch cases ..."},{"type":"INSERT","lineNumber":112,"content":"\t\t\tswitch (role) {"},{"type":"INSERT","lineNumber":113,"content":"\t\t\t\tcase \"customer\": {"},{"type":"INSERT","lineNumber":114,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_CUSTOMER)"},{"type":"INSERT","lineNumber":115,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'CUSTOMER' is not found.\"));"},{"type":"INSERT","lineNumber":116,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":117,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":118,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":119,"content":"\t\t\t\tcase \"agent\": {"},{"type":"INSERT","lineNumber":120,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_AGENT)"},{"type":"INSERT","lineNumber":121,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'AGENT' is not found.\"));"},{"type":"INSERT","lineNumber":122,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":123,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":124,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":125,"content":"\t\t\t\tcase \"triage_officer\": {"},{"type":"INSERT","lineNumber":126,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_TRIAGE_OFFICER)"},{"type":"INSERT","lineNumber":127,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'TRIAGE_OFFICER' is not found.\"));"},{"type":"INSERT","lineNumber":128,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":129,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":130,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":131,"content":"\t\t\t\tcase \"field_engineer\": {"},{"type":"INSERT","lineNumber":132,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_FIELD_ENGINEER)"},{"type":"INSERT","lineNumber":133,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'FIELD_ENGINEER' is not found.\"));"},{"type":"INSERT","lineNumber":134,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":135,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":136,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":137,"content":"\t\t\t\tcase \"noc_engineer\": {"},{"type":"INSERT","lineNumber":138,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_NOC_ENGINEER)"},{"type":"INSERT","lineNumber":139,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'NOC_ENGINEER' is not found.\"));"},{"type":"INSERT","lineNumber":140,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":141,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":142,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":143,"content":"\t\t\t\tcase \"l1_engineer\": {"},{"type":"INSERT","lineNumber":144,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_L1_ENGINEER)"},{"type":"INSERT","lineNumber":145,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'L1_ENGINEER' is not found.\"));"},{"type":"INSERT","lineNumber":146,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":147,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":148,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":149,"content":"\t\t\t\tcase \"manager\": {"},{"type":"INSERT","lineNumber":150,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_MANAGER)"},{"type":"INSERT","lineNumber":151,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'MANAGER' is not found.\"));"},{"type":"INSERT","lineNumber":152,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":153,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":154,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":155,"content":"\t\t\t\tcase \"team_lead\": {"},{"type":"INSERT","lineNumber":156,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_TEAM_LEAD)"},{"type":"INSERT","lineNumber":157,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'TEAM_LEAD' is not found.\"));"},{"type":"INSERT","lineNumber":158,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":159,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":160,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":161,"content":"\t\t\t\tcase \"cxo\": {"},{"type":"INSERT","lineNumber":162,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_CXO)"},{"type":"INSERT","lineNumber":163,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'CXO' is not found.\"));"},{"type":"INSERT","lineNumber":164,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":165,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":166,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":167,"content":"\t\t\t\tcase \"noc_admin\": {"},{"type":"INSERT","lineNumber":168,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_NOC_ADMIN)"},{"type":"INSERT","lineNumber":169,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'NOC_ADMIN' is not found.\"));"},{"type":"INSERT","lineNumber":170,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":171,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":172,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":173,"content":"\t\t\t\tdefault:"},{"type":"INSERT","lineNumber":174,"content":"\t\t\t\t\tthrow new RoleNotFoundException(\"Error: Invalid role specified: \" + role);"},{"type":"INSERT","lineNumber":175,"content":"\t\t\t}"},{"type":"DELETE","lineNumber":114,"oldContent":"\tprivate String mapRoleToFrontend (String backendRole){"},{"type":"DELETE","lineNumber":115,"oldContent":"\t\t// This method remains unchanged."},{"type":"DELETE","lineNumber":117,"oldContent":"\t\treturn \"ROLE_TEMP\";"},{"type":"DELETE","lineNumber":118,"oldContent":""},{"type":"DELETE","lineNumber":119,"oldContent":"\t}"}]},{"timestamp":1762111276889,"changes":[{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.dto.Coordinates;"},{"type":"DELETE","lineNumber":11,"oldContent":"import com.capstone.tele_ticketing_backend_1.security.service.UserDetailsImpl;"},{"type":"MODIFY","lineNumber":14,"content":"import com.capstone.tele_ticketing_backend_1.security.service.UserDetailsImpl;","oldContent":"import com.capstone.tele_ticketing_backend_1.service.GeocodingService;"},{"type":"INSERT","lineNumber":15,"content":"import com.capstone.tele_ticketing_backend_1.service.GeocodingService;"},{"type":"DELETE","lineNumber":19,"oldContent":"import org.springframework.security.core.GrantedAuthority;"},{"type":"INSERT","lineNumber":22,"content":"import org.springframework.security.core.GrantedAuthority;"},{"type":"INSERT","lineNumber":26,"content":""},{"type":"DELETE","lineNumber":27,"oldContent":""},{"type":"INSERT","lineNumber":50,"content":"\tJwtUtils jwtUtils;"},{"type":"DELETE","lineNumber":51,"oldContent":"\tJwtUtils jwtUtils;"},{"type":"DELETE","lineNumber":56,"oldContent":"\t\t\t\tnew UsernamePasswordAuthenticationToken(loginRequest.getUsername(), loginRequest.getPassword())"},{"type":"INSERT","lineNumber":58,"content":"\t\t\t\tnew UsernamePasswordAuthenticationToken(loginRequest.getUsername(), loginRequest.getPassword())"},{"type":"DELETE","lineNumber":62,"oldContent":"\t\tList<String> roles = userDetails.getAuthorities().stream()"},{"type":"INSERT","lineNumber":64,"content":""},{"type":"INSERT","lineNumber":65,"content":"\t\tList<String> roles = userDetails.getAuthorities().stream()"},{"type":"DELETE","lineNumber":67,"oldContent":""},{"type":"DELETE","lineNumber":69,"oldContent":"\t}"},{"type":"DELETE","lineNumber":71,"oldContent":""},{"type":"DELETE","lineNumber":73,"oldContent":"\t@PostMapping(\"/signup\")"},{"type":"INSERT","lineNumber":74,"content":"\t}"},{"type":"INSERT","lineNumber":75,"content":""},{"type":"INSERT","lineNumber":76,"content":"\t@PostMapping(\"/signup\")"},{"type":"INSERT","lineNumber":77,"content":"\tpublic ResponseEntity<MessageResponse> registerUser(@Valid @RequestBody SignupRequest signUpRequest) {"},{"type":"DELETE","lineNumber":78,"oldContent":"\tpublic ResponseEntity<MessageResponse> registerUser(@Valid @RequestBody SignupRequest signUpRequest) {"},{"type":"DELETE","lineNumber":81,"oldContent":"\t\tuser.setPostalCode(signUpRequest.getPostalCode());"},{"type":"DELETE","lineNumber":82,"oldContent":""},{"type":"DELETE","lineNumber":85,"oldContent":"\t\tif (signUpRequest.getCity() != null && signUpRequest.getPostalCode() != null) {"},{"type":"DELETE","lineNumber":88,"oldContent":"\t\t\tCoordinates coords = geocodingService.getCoordinates("},{"type":"DELETE","lineNumber":90,"oldContent":"\t\t\t\t\tsignUpRequest.getCity(),"},{"type":"DELETE","lineNumber":94,"oldContent":"\t\t\t\t\tsignUpRequest.getState(),"},{"type":"INSERT","lineNumber":91,"content":"\t\tuser.setPostalCode(signUpRequest.getPostalCode());"},{"type":"INSERT","lineNumber":92,"content":""},{"type":"INSERT","lineNumber":93,"content":"\t\tif (signUpRequest.getCity() != null && signUpRequest.getPostalCode() != null) {"},{"type":"INSERT","lineNumber":94,"content":"\t\t\tCoordinates coords = geocodingService.getCoordinates("},{"type":"INSERT","lineNumber":95,"content":"\t\t\t\t\tsignUpRequest.getCity(),"},{"type":"INSERT","lineNumber":96,"content":"\t\t\t\t\tsignUpRequest.getState(),"},{"type":"DELETE","lineNumber":112,"oldContent":"\t\t});"},{"type":"DELETE","lineNumber":113,"oldContent":""},{"type":"DELETE","lineNumber":114,"oldContent":"\t\tuser.setRoles(roles);"},{"type":"DELETE","lineNumber":115,"oldContent":"\t\tuserRepository.save(user);"},{"type":"DELETE","lineNumber":117,"oldContent":""},{"type":"DELETE","lineNumber":119,"oldContent":"\t\treturn ResponseEntity.ok(new MessageResponse(\"User registered successfully!\"));"},{"type":"DELETE","lineNumber":123,"oldContent":"\t}"},{"type":"DELETE","lineNumber":128,"oldContent":"}"},{"type":"DELETE","lineNumber":130,"oldContent":"\t\t\t}"},{"type":"DELETE","lineNumber":132,"oldContent":"\t\t\t\t\tthrow new RoleNotFoundException(\"Error: Invalid role specified: \" + role);"},{"type":"DELETE","lineNumber":134,"oldContent":"\t\t\t\tdefault:"},{"type":"DELETE","lineNumber":136,"oldContent":"\t\t\t\t}"},{"type":"DELETE","lineNumber":138,"oldContent":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":140,"oldContent":"\t\t\t\t\troles.add(foundRole);"},{"type":"DELETE","lineNumber":142,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'NOC_ADMIN' is not found.\"));"},{"type":"DELETE","lineNumber":144,"oldContent":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_NOC_ADMIN)"},{"type":"DELETE","lineNumber":146,"oldContent":"\t\t\t\tcase \"noc_admin\": {"},{"type":"DELETE","lineNumber":148,"oldContent":"\t\t\t\t}"},{"type":"DELETE","lineNumber":150,"oldContent":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":152,"oldContent":"\t\t\t\t\troles.add(foundRole);"},{"type":"DELETE","lineNumber":154,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'CXO' is not found.\"));"},{"type":"DELETE","lineNumber":156,"oldContent":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_CXO)"},{"type":"DELETE","lineNumber":158,"oldContent":"\t\t\t\tcase \"cxo\": {"},{"type":"DELETE","lineNumber":160,"oldContent":"\t\t\t\t}"},{"type":"DELETE","lineNumber":162,"oldContent":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":164,"oldContent":"\t\t\t\t\troles.add(foundRole);"},{"type":"DELETE","lineNumber":166,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'TEAM_LEAD' is not found.\"));"},{"type":"DELETE","lineNumber":168,"oldContent":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_TEAM_LEAD)"},{"type":"DELETE","lineNumber":170,"oldContent":"\t\t\t\tcase \"team_lead\": {"},{"type":"DELETE","lineNumber":172,"oldContent":"\t\t\t\t}"},{"type":"DELETE","lineNumber":174,"oldContent":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":176,"oldContent":"\t\t\t\t\troles.add(foundRole);"},{"type":"DELETE","lineNumber":178,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'MANAGER' is not found.\"));"},{"type":"DELETE","lineNumber":180,"oldContent":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_MANAGER)"},{"type":"INSERT","lineNumber":149,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":151,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_MANAGER)"},{"type":"INSERT","lineNumber":152,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'MANAGER' is not found.\"));"},{"type":"INSERT","lineNumber":153,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":154,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":156,"content":"\t\t\t\tcase \"team_lead\": {"},{"type":"INSERT","lineNumber":157,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_TEAM_LEAD)"},{"type":"INSERT","lineNumber":158,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'TEAM_LEAD' is not found.\"));"},{"type":"INSERT","lineNumber":159,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":160,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":161,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":162,"content":"\t\t\t\tcase \"cxo\": {"},{"type":"INSERT","lineNumber":163,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_CXO)"},{"type":"INSERT","lineNumber":164,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'CXO' is not found.\"));"},{"type":"INSERT","lineNumber":165,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":166,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":167,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":168,"content":"\t\t\t\tcase \"noc_admin\": {"},{"type":"INSERT","lineNumber":169,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_NOC_ADMIN)"},{"type":"INSERT","lineNumber":170,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'NOC_ADMIN' is not found.\"));"},{"type":"INSERT","lineNumber":171,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":172,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":173,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":174,"content":"\t\t\t\tdefault:"},{"type":"INSERT","lineNumber":175,"content":"\t\t\t\t\tthrow new RoleNotFoundException(\"Error: Invalid role specified: \" + role);"},{"type":"INSERT","lineNumber":176,"content":"\t\t\t}"},{"type":"INSERT","lineNumber":177,"content":"\t\t});"},{"type":"INSERT","lineNumber":178,"content":""},{"type":"INSERT","lineNumber":179,"content":"\t\tuser.setRoles(roles);"},{"type":"INSERT","lineNumber":180,"content":"\t\tuserRepository.save(user);"},{"type":"INSERT","lineNumber":181,"content":""},{"type":"INSERT","lineNumber":182,"content":"\t\treturn ResponseEntity.ok(new MessageResponse(\"User registered successfully!\"));"},{"type":"INSERT","lineNumber":183,"content":"\t}"},{"type":"INSERT","lineNumber":184,"content":"}"}]},{"timestamp":1762111306942,"changes":[{"type":"MODIFY","lineNumber":13,"content":"import com.capstone.tele_ticketing_backend_1.security.payload.response.MessageResponse;","oldContent":"import com.capstone.tele_ticketing_backend_1.service.GeocodingService;"},{"type":"MODIFY","lineNumber":27,"content":"import java.util.HashSet;","oldContent":"import java.util.HashSet;"},{"type":"MODIFY","lineNumber":51,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":66,"content":"\t\t\t\t.map(GrantedAuthority::getAuthority)","oldContent":"\t\t\t\t.map(GrantedAuthority::getAuthority)"},{"type":"INSERT","lineNumber":72,"content":"\t\t\t\troles.toString()"},{"type":"INSERT","lineNumber":73,"content":"\t\t));"},{"type":"DELETE","lineNumber":73,"oldContent":"\t\t\t\troles"},{"type":"DELETE","lineNumber":75,"oldContent":"\t\t));"},{"type":"MODIFY","lineNumber":78,"content":"\t\tif (userRepository.existsByUsername(signUpRequest.getUsername())) {","oldContent":"\t\tif (userRepository.existsByUsername(signUpRequest.getUsername())) {"},{"type":"DELETE","lineNumber":87,"oldContent":"\t\tuser.setPostalCode(signUpRequest.getPostalCode());"},{"type":"DELETE","lineNumber":89,"oldContent":""},{"type":"MODIFY","lineNumber":90,"content":"\t\tuser.setState(signUpRequest.getState());","oldContent":"\t\tif (signUpRequest.getCity() != null && signUpRequest.getPostalCode() != null) {"},{"type":"INSERT","lineNumber":91,"content":"\t\tuser.setPostalCode(signUpRequest.getPostalCode());"},{"type":"INSERT","lineNumber":92,"content":""},{"type":"INSERT","lineNumber":93,"content":"\t\tif (signUpRequest.getCity() != null && signUpRequest.getPostalCode() != null) {"},{"type":"DELETE","lineNumber":95,"oldContent":"\t\tuser.setState(signUpRequest.getState());"},{"type":"DELETE","lineNumber":132,"oldContent":"\t\t\t\t}"},{"type":"DELETE","lineNumber":134,"oldContent":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_MANAGER)"},{"type":"DELETE","lineNumber":136,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'MANAGER' is not found.\"));"},{"type":"DELETE","lineNumber":137,"oldContent":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":135,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":137,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":138,"content":"\t\t\t\tcase \"noc_engineer\": {"},{"type":"INSERT","lineNumber":139,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_NOC_ENGINEER)"},{"type":"INSERT","lineNumber":140,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'NOC_ENGINEER' is not found.\"));"},{"type":"INSERT","lineNumber":142,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":143,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":144,"content":"\t\t\t\tcase \"l1_engineer\": {"},{"type":"INSERT","lineNumber":145,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_L1_ENGINEER)"},{"type":"INSERT","lineNumber":146,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'L1_ENGINEER' is not found.\"));"},{"type":"INSERT","lineNumber":147,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":148,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":149,"content":"\t\t\t\t}"},{"type":"INSERT","lineNumber":150,"content":"\t\t\t\tcase \"manager\": {"},{"type":"INSERT","lineNumber":151,"content":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_MANAGER)"},{"type":"INSERT","lineNumber":152,"content":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'MANAGER' is not found.\"));"},{"type":"INSERT","lineNumber":153,"content":"\t\t\t\t\troles.add(foundRole);"},{"type":"INSERT","lineNumber":154,"content":"\t\t\t\t\tbreak;"},{"type":"INSERT","lineNumber":155,"content":"\t\t\t\t}"},{"type":"DELETE","lineNumber":143,"oldContent":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":146,"oldContent":"\t\t\t\t}"},{"type":"DELETE","lineNumber":149,"oldContent":"\t\t\t\tcase \"noc_engineer\": {"},{"type":"DELETE","lineNumber":152,"oldContent":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_NOC_ENGINEER)"},{"type":"DELETE","lineNumber":155,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'NOC_ENGINEER' is not found.\"));"},{"type":"DELETE","lineNumber":158,"oldContent":"\t\t\t\t\troles.add(foundRole);"},{"type":"DELETE","lineNumber":161,"oldContent":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":164,"oldContent":"\t\t\t\t}"},{"type":"DELETE","lineNumber":167,"oldContent":"\t\t\t\tcase \"l1_engineer\": {"},{"type":"DELETE","lineNumber":170,"oldContent":"\t\t\t\t\tRole foundRole = roleRepository.findByName(ERole.ROLE_L1_ENGINEER)"},{"type":"DELETE","lineNumber":173,"oldContent":"\t\t\t\t\t\t\t.orElseThrow(() -> new RoleNotFoundException(\"Error: Role 'L1_ENGINEER' is not found.\"));"},{"type":"DELETE","lineNumber":176,"oldContent":"\t\t\t\t\troles.add(foundRole);"},{"type":"DELETE","lineNumber":179,"oldContent":"\t\t\t\t\tbreak;"},{"type":"DELETE","lineNumber":181,"oldContent":"\t\t\t\tcase \"manager\": {"},{"type":"DELETE","lineNumber":183,"oldContent":"\t\t\t\t}"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/CreateTicketRequestDto.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/CreateTicketRequestDto.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\n// File: com/capstone/tele_ticketing_backend_1/dtos/CreateTicketRequestDto.java\npackage com.capstone.tele_ticketing_backend_1.dtos;\n\nimport com.capstone.tele_ticketing_backend_1.model.enums.TicketCategory;\nimport jakarta.validation.constraints.NotBlank;\nimport jakarta.validation.constraints.NotNull;\nimport jakarta.validation.constraints.Size;\nimport lombok.Data;\n\nimport java.util.List;\n\n@Data\npublic class CreateTicketRequestDto {\n\n    // Dr. X's Note: Every ticket must have a title.\n    @NotBlank(message = \"Title cannot be blank\")\n    @Size(min = 5, max = 100, message = \"Title must be between 5 and 100 characters\")\n    private String title;\n\n    // Dr. X's Note: A detailed description is essential for diagnosis.\n    @NotBlank(message = \"Description cannot be blank\")\n    @Size(min = 10, max = 5000, message = \"Description must be between 10 and 5000 characters\")\n    private String description;\n\n    // Dr. X's Note: The customer must categorize their issue.\n    // We use the Enum to ensure they can only send valid categories.\n    @NotNull(message = \"Category cannot be null\")\n    private TicketCategory category;\n\n    // Dr. X's Note: As discussed, we'll accept a list of strings for dummy attachment URLs for now.\n    // This can be an empty list if there are no attachments.\n    private List<String> attachments;\n\n    // IMPORTANT: Notice what is NOT here.\n    // The DTO does not contain 'status', 'priority', 'severity', or 'assignedTo'.\n    // Those fields are set by the *system* or by *privileged users* (like a Triage Officer),\n    // never by the customer creating the ticket. This is a critical security and design principle.\n}","baseTimestamp":1761780063868,"deltas":[{"timestamp":1761780067079,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"// File: com/capstone/tele_ticketing_backend_1/dtos/CreateTicketRequestDto.java"},{"type":"DELETE","lineNumber":3,"oldContent":"package com.capstone.tele_ticketing_backend_1.dtos;"}]},{"timestamp":1761780071003,"changes":[{"type":"MODIFY","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.entities.enums.TicketCategory;","oldContent":"import com.capstone.tele_ticketing_backend_1.model.enums.TicketCategory;"}]},{"timestamp":1761780076254,"changes":[{"type":"MODIFY","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.entities.TicketCategory;","oldContent":"import com.capstone.tele_ticketing_backend_1.entities.enums.TicketCategory;"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/FeedbackRequestDto.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/FeedbackRequestDto.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\nimport jakarta.validation.constraints.Max;\nimport jakarta.validation.constraints.Min;\nimport jakarta.validation.constraints.NotNull;\nimport lombok.Data;\n\n@Data\npublic class FeedbackRequestDto {\n\n    @NotNull(message = \"Rating cannot be null\")\n    @Min(value = 1, message = \"Rating must be at least 1\")\n    @Max(value = 5, message = \"Rating must be at most 5\")\n    private Integer rating;\n\n    private String comment;\n}","baseTimestamp":1761780216352},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/TicketSummaryDto.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/TicketSummaryDto.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\nimport com.capstone.tele_ticketing_backend_1.model.enums.TicketStatus;\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\nimport java.time.LocalDateTime;\n\n@Data\n@NoArgsConstructor\n@AllArgsConstructor\npublic class TicketSummaryDto {\n    private Long id;\n    private String ticketUid;\n    private String title;\n    private TicketStatus status;\n    private LocalDateTime createdAt;\n}\n","baseTimestamp":1761780242142,"deltas":[{"timestamp":1761780247831,"changes":[{"type":"MODIFY","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.entities.enums.TicketStatus;","oldContent":"import com.capstone.tele_ticketing_backend_1.model.enums.TicketStatus;"}]},{"timestamp":1761780250604,"changes":[{"type":"MODIFY","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.entities.TicketStatus;","oldContent":"import com.capstone.tele_ticketing_backend_1.entities.enums.TicketStatus;"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/exceptions/TicketNotFoundException.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/exceptions/TicketNotFoundException.java","baseContent":"package com.capstone.tele_ticketing_backend_1.exceptions;\n\npublic class TicketNotFoundException extends RuntimeException {\n    public TicketNotFoundException(String message) {\n        super(message);\n    }\n}\n","baseTimestamp":1761780267577,"deltas":[{"timestamp":1761780275822,"changes":[{"type":"INSERT","lineNumber":2,"content":"import org.springframework.http.HttpStatus;"},{"type":"INSERT","lineNumber":3,"content":"import org.springframework.web.bind.annotation.ResponseStatus;"},{"type":"INSERT","lineNumber":4,"content":""},{"type":"INSERT","lineNumber":5,"content":"@ResponseStatus(HttpStatus.NOT_FOUND)"},{"type":"DELETE","lineNumber":7,"oldContent":""}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/exceptions/InvalidTicketStatusException.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/exceptions/InvalidTicketStatusException.java","baseContent":"package com.capstone.tele_ticketing_backend_1.exceptions;\n\npublic class InvalidTicketStatusException extends RuntimeException {\n    public InvalidTicketStatusException(String message) {\n        super(message);\n    }\n}\n","baseTimestamp":1761780288177},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/exceptions/ForbiddenAccessException.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/exceptions/ForbiddenAccessException.java","baseContent":"package com.capstone.tele_ticketing_backend_1.exceptions;\n\npublic class ForbiddenAccessException extends RuntimeException {\n    public ForbiddenAccessException(String message) {\n        super(message);\n    }\n}\n","baseTimestamp":1761780307783},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/repo/TicketRepo.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/repo/TicketRepo.java","baseContent":"package com.capstone.tele_ticketing_backend_1.repo;\n\npublic interface TicketRepo {\n}\n","baseTimestamp":1761780329894,"deltas":[{"timestamp":1761780339255,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"public interface TicketRepo {"},{"type":"DELETE","lineNumber":3,"oldContent":"}"},{"type":"INSERT","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.entities.AppUser;"},{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.entities.Ticket;"},{"type":"INSERT","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.model.enums.TicketStatus;"},{"type":"INSERT","lineNumber":5,"content":"import org.springframework.data.jpa.repository.JpaRepository;"},{"type":"INSERT","lineNumber":6,"content":"import org.springframework.stereotype.Repository;"},{"type":"INSERT","lineNumber":8,"content":"import java.util.List;"},{"type":"INSERT","lineNumber":9,"content":""},{"type":"INSERT","lineNumber":10,"content":"@Repository"},{"type":"INSERT","lineNumber":11,"content":"public interface TicketRepo extends JpaRepository<Ticket, Long> {"},{"type":"INSERT","lineNumber":12,"content":""},{"type":"INSERT","lineNumber":13,"content":"    // Dr. X's Note: This query finds all tickets created FOR a specific user that have one of the given statuses."},{"type":"INSERT","lineNumber":14,"content":"    // This is exactly what we need for the \"my active tickets\" endpoint."},{"type":"INSERT","lineNumber":15,"content":"    List<Ticket> findAllByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"INSERT","lineNumber":16,"content":""},{"type":"INSERT","lineNumber":17,"content":"    // Dr. X's Note: This finds all tickets FOR a user with the specific status 'FIXED'."},{"type":"INSERT","lineNumber":18,"content":"    // This will serve the \"my feedback tickets\" endpoint."},{"type":"INSERT","lineNumber":19,"content":"    List<Ticket> findAllByCreatedForAndStatus(AppUser user, TicketStatus status);"},{"type":"INSERT","lineNumber":20,"content":"}"}]},{"timestamp":1761780346959,"changes":[{"type":"DELETE","lineNumber":4,"oldContent":"import com.capstone.tele_ticketing_backend_1.model.enums.TicketStatus;"},{"type":"DELETE","lineNumber":5,"oldContent":""},{"type":"INSERT","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.entities.TicketStatus;"},{"type":"DELETE","lineNumber":7,"oldContent":"}"},{"type":"DELETE","lineNumber":9,"oldContent":"    List<Ticket> findAllByCreatedForAndStatus(AppUser user, TicketStatus status);"},{"type":"DELETE","lineNumber":10,"oldContent":"    // This will serve the \"my feedback tickets\" endpoint."},{"type":"INSERT","lineNumber":7,"content":""},{"type":"DELETE","lineNumber":12,"oldContent":"    // Dr. X's Note: This finds all tickets FOR a user with the specific status 'FIXED'."},{"type":"DELETE","lineNumber":14,"oldContent":""},{"type":"DELETE","lineNumber":16,"oldContent":"    List<Ticket> findAllByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"DELETE","lineNumber":18,"oldContent":"    // This is exactly what we need for the \"my active tickets\" endpoint."},{"type":"INSERT","lineNumber":14,"content":"    // This is exactly what we need for the \"my active tickets\" endpoint."},{"type":"INSERT","lineNumber":15,"content":"    List<Ticket> findAllByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"INSERT","lineNumber":16,"content":""},{"type":"INSERT","lineNumber":17,"content":"    // Dr. X's Note: This finds all tickets FOR a user with the specific status 'FIXED'."},{"type":"INSERT","lineNumber":18,"content":"    // This will serve the \"my feedback tickets\" endpoint."},{"type":"INSERT","lineNumber":19,"content":"    List<Ticket> findAllByCreatedForAndStatus(AppUser user, TicketStatus status);"},{"type":"INSERT","lineNumber":20,"content":"}"}]},{"timestamp":1761801661507,"changes":[{"type":"MODIFY","lineNumber":7,"content":"","oldContent":""},{"type":"INSERT","lineNumber":10,"content":"@Repository"},{"type":"INSERT","lineNumber":11,"content":"public interface TicketRepo extends JpaRepository<Ticket, Long> {"},{"type":"INSERT","lineNumber":12,"content":""},{"type":"INSERT","lineNumber":13,"content":"    // Dr. X's Note: This query finds all tickets created FOR a specific user that have one of the given statuses."},{"type":"DELETE","lineNumber":12,"oldContent":"@Repository"},{"type":"DELETE","lineNumber":15,"oldContent":"public interface TicketRepo extends JpaRepository<Ticket, Long> {"},{"type":"INSERT","lineNumber":21,"content":"    // In: com/capstone/tele_ticketing_backend_1/repo/TicketRepo.java"},{"type":"INSERT","lineNumber":22,"content":""},{"type":"INSERT","lineNumber":23,"content":"// ... existing methods ..."},{"type":"INSERT","lineNumber":24,"content":""},{"type":"INSERT","lineNumber":25,"content":"    // Dr. X's Note: This query finds all tickets CREATED BY a specific user (our agent)"},{"type":"INSERT","lineNumber":26,"content":"// that have one of the given statuses."},{"type":"INSERT","lineNumber":27,"content":"    List<Ticket> findAllByCreatedByAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"DELETE","lineNumber":20,"oldContent":"    // Dr. X's Note: This query finds all tickets created FOR a specific user that have one of the given statuses."}]},{"timestamp":1761856725344,"changes":[{"type":"INSERT","lineNumber":6,"content":"import org.springframework.stereotype.Repository;"},{"type":"DELETE","lineNumber":7,"oldContent":""},{"type":"DELETE","lineNumber":11,"oldContent":"    // This is exactly what we need for the \"my active tickets\" endpoint."},{"type":"DELETE","lineNumber":13,"oldContent":"    List<Ticket> findAllByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"INSERT","lineNumber":14,"content":"    // This is exactly what we need for the \"my active tickets\" endpoint."},{"type":"INSERT","lineNumber":15,"content":"    List<Ticket> findAllByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"DELETE","lineNumber":21,"oldContent":"}"},{"type":"DELETE","lineNumber":23,"oldContent":"    List<Ticket> findAllByCreatedByAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"DELETE","lineNumber":25,"oldContent":"// that have one of the given statuses."},{"type":"INSERT","lineNumber":24,"content":""},{"type":"INSERT","lineNumber":26,"content":"// that have one of the given statuses."},{"type":"INSERT","lineNumber":27,"content":"    List<Ticket> findAllByCreatedByAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"INSERT","lineNumber":29,"content":"    List<Ticket> findAllByStatusIn(List<TicketStatus> statuses);"},{"type":"INSERT","lineNumber":30,"content":"}"}]},{"timestamp":1761857998096,"changes":[{"type":"DELETE","lineNumber":12,"oldContent":"    // This is exactly what we need for the \"my active tickets\" endpoint."},{"type":"MODIFY","lineNumber":14,"content":"    // This is exactly what we need for the \"my active tickets\" endpoint.","oldContent":"    List<Ticket> findAllByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"INSERT","lineNumber":15,"content":"    List<Ticket> findAllByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"INSERT","lineNumber":23,"content":"// ... existing methods ..."},{"type":"INSERT","lineNumber":25,"content":"    // Dr. X's Note: This query finds all tickets CREATED BY a specific user (our agent)"},{"type":"DELETE","lineNumber":25,"oldContent":"// ... existing methods ..."},{"type":"DELETE","lineNumber":27,"oldContent":"    // Dr. X's Note: This query finds all tickets CREATED BY a specific user (our agent)"},{"type":"INSERT","lineNumber":30,"content":"    List<Ticket> findAllByAssignedToContainsAndStatusIn(AppUser user, List<TicketStatus> statuses);"}]},{"timestamp":1761894864773,"changes":[{"type":"INSERT","lineNumber":13,"content":"    // Dr. X's Note: This query finds all tickets created FOR a specific user that have one of the given statuses."},{"type":"DELETE","lineNumber":15,"oldContent":"    // Dr. X's Note: This query finds all tickets created FOR a specific user that have one of the given statuses."},{"type":"MODIFY","lineNumber":26,"content":"// that have one of the given statuses.","oldContent":"// that have one of the given statuses."},{"type":"INSERT","lineNumber":31,"content":""},{"type":"INSERT","lineNumber":32,"content":"    long countByCreatedForAndStatus(AppUser user, TicketStatus status);"},{"type":"INSERT","lineNumber":33,"content":""},{"type":"INSERT","lineNumber":34,"content":"    // Efficiently counts tickets for a user with any of the given statuses."},{"type":"INSERT","lineNumber":35,"content":"    long countByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);"}]},{"timestamp":1761908729228,"changes":[{"type":"INSERT","lineNumber":25,"content":"    // Dr. X's Note: This query finds all tickets CREATED BY a specific user (our agent)"},{"type":"DELETE","lineNumber":26,"oldContent":"// that have one of the given statuses."},{"type":"DELETE","lineNumber":32,"oldContent":"}"},{"type":"MODIFY","lineNumber":35,"content":"    long countByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);","oldContent":"    long countByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"INSERT","lineNumber":36,"content":""},{"type":"INSERT","lineNumber":37,"content":"    long countByCreatedByAndStatus(AppUser user, TicketStatus status);"},{"type":"INSERT","lineNumber":38,"content":""},{"type":"INSERT","lineNumber":39,"content":"    // Efficiently counts tickets CREATED BY a user with any of the given statuses."},{"type":"INSERT","lineNumber":40,"content":"    long countByCreatedByAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"INSERT","lineNumber":41,"content":"}"}]},{"timestamp":1762027636682,"changes":[{"type":"DELETE","lineNumber":33,"oldContent":"    long countByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"MODIFY","lineNumber":35,"content":"    long countByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);","oldContent":"    long countByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"INSERT","lineNumber":36,"content":""},{"type":"DELETE","lineNumber":38,"oldContent":"}"},{"type":"MODIFY","lineNumber":40,"content":"    long countByCreatedByAndStatusIn(AppUser user, List<TicketStatus> statuses);","oldContent":"    long countByCreatedByAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"INSERT","lineNumber":41,"content":""},{"type":"INSERT","lineNumber":42,"content":"    // Finds all tickets CREATED BY a user with a specific status."},{"type":"INSERT","lineNumber":43,"content":"    List<Ticket> findAllByCreatedByAndStatus(AppUser user, TicketStatus status);"},{"type":"INSERT","lineNumber":44,"content":"}"}]},{"timestamp":1762097784203,"changes":[{"type":"DELETE","lineNumber":33,"oldContent":"    long countByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"MODIFY","lineNumber":35,"content":"    long countByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);","oldContent":"    long countByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"INSERT","lineNumber":36,"content":""},{"type":"INSERT","lineNumber":39,"content":"    // Efficiently counts tickets CREATED BY a user with any of the given statuses."},{"type":"DELETE","lineNumber":41,"oldContent":"    // Efficiently counts tickets CREATED BY a user with any of the given statuses."},{"type":"DELETE","lineNumber":43,"oldContent":"}"},{"type":"INSERT","lineNumber":44,"content":""},{"type":"INSERT","lineNumber":45,"content":"    @Query(\"SELECT DISTINCT t FROM Ticket t JOIN t.assignedTo a WHERE a.team.id = :teamId AND t.status IN :statuses\")"},{"type":"INSERT","lineNumber":46,"content":"    List<Ticket> findTicketsByTeamAndStatus(@Param(\"teamId\") Long teamId, @Param(\"statuses\") List<TicketStatus> statuses);"},{"type":"INSERT","lineNumber":47,"content":""},{"type":"INSERT","lineNumber":48,"content":"    // Finds tickets for a team that are at SLA risk."},{"type":"INSERT","lineNumber":49,"content":"    @Query(\"SELECT DISTINCT t FROM Ticket t JOIN t.assignedTo a WHERE a.team.id = :teamId AND t.status NOT IN ('RESOLVED', 'FIXED') AND t.slaBreachAt BETWEEN :now AND :slaRiskThreshold\")"},{"type":"INSERT","lineNumber":50,"content":"    List<Ticket> findSlaRiskTicketsByTeam(@Param(\"teamId\") Long teamId, @Param(\"now\") LocalDateTime now, @Param(\"slaRiskThreshold\") LocalDateTime slaRiskThreshold);"},{"type":"INSERT","lineNumber":51,"content":"}"}]},{"timestamp":1762097790365,"changes":[{"type":"INSERT","lineNumber":8,"content":"import java.time.LocalDateTime;"},{"type":"DELETE","lineNumber":33,"oldContent":"    long countByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"DELETE","lineNumber":34,"oldContent":"    long countByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"INSERT","lineNumber":36,"content":"    long countByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"INSERT","lineNumber":37,"content":""},{"type":"DELETE","lineNumber":43,"oldContent":""},{"type":"INSERT","lineNumber":45,"content":""},{"type":"DELETE","lineNumber":46,"oldContent":"}"},{"type":"DELETE","lineNumber":48,"oldContent":"    List<Ticket> findSlaRiskTicketsByTeam(@Param(\"teamId\") Long teamId, @Param(\"now\") LocalDateTime now, @Param(\"slaRiskThreshold\") LocalDateTime slaRiskThreshold);"},{"type":"MODIFY","lineNumber":50,"content":"    @Query(\"SELECT DISTINCT t FROM Ticket t JOIN t.assignedTo a WHERE a.team.id = :teamId AND t.status NOT IN ('RESOLVED', 'FIXED') AND t.slaBreachAt BETWEEN :now AND :slaRiskThreshold\")","oldContent":"    @Query(\"SELECT DISTINCT t FROM Ticket t JOIN t.assignedTo a WHERE a.team.id = :teamId AND t.status NOT IN ('RESOLVED', 'FIXED') AND t.slaBreachAt BETWEEN :now AND :slaRiskThreshold\")"},{"type":"INSERT","lineNumber":51,"content":"    List<Ticket> findSlaRiskTicketsByTeam(@Param(\"teamId\") Long teamId, @Param(\"now\") LocalDateTime now, @Param(\"slaRiskThreshold\") LocalDateTime slaRiskThreshold);"},{"type":"INSERT","lineNumber":52,"content":"}"}]},{"timestamp":1762097794608,"changes":[{"type":"INSERT","lineNumber":6,"content":"import org.springframework.data.repository.query.Param;"},{"type":"DELETE","lineNumber":35,"oldContent":"    long countByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"INSERT","lineNumber":37,"content":"    long countByCreatedForAndStatusIn(AppUser user, List<TicketStatus> statuses);"},{"type":"INSERT","lineNumber":50,"content":"    // Finds tickets for a team that are at SLA risk."},{"type":"DELETE","lineNumber":51,"oldContent":"    // Finds tickets for a team that are at SLA risk."}]},{"timestamp":1762097803939,"changes":[{"type":"INSERT","lineNumber":6,"content":"import org.springframework.data.jpa.repository.Query;"},{"type":"DELETE","lineNumber":50,"oldContent":"    @Query(\"SELECT DISTINCT t FROM Ticket t JOIN t.assignedTo a WHERE a.team.id = :teamId AND t.status NOT IN ('RESOLVED', 'FIXED') AND t.slaBreachAt BETWEEN :now AND :slaRiskThreshold\")"},{"type":"INSERT","lineNumber":52,"content":"    @Query(\"SELECT DISTINCT t FROM Ticket t JOIN t.assignedTo a WHERE a.team.id = :teamId AND t.status NOT IN ('RESOLVED', 'FIXED') AND t.slaBreachAt BETWEEN :now AND :slaRiskThreshold\")"}]},{"timestamp":1762097814667,"changes":[{"type":"MODIFY","lineNumber":51,"content":"","oldContent":"    // Finds tickets for a team that are at SLA risk."}]},{"timestamp":1762147020527,"changes":[{"type":"INSERT","lineNumber":54,"content":"    "},{"type":"INSERT","lineNumber":55,"content":"    "}]},{"timestamp":1762147024193,"changes":[{"type":"INSERT","lineNumber":54,"content":""},{"type":"DELETE","lineNumber":56,"oldContent":"    "}]},{"timestamp":1762147055081,"changes":[{"type":"MODIFY","lineNumber":14,"content":"public interface TicketRepo extends JpaRepository<Ticket, Long>, JpaSpecificationExecutor<Ticket> {","oldContent":"public interface TicketRepo extends JpaRepository<Ticket, Long> {"}]},{"timestamp":1762147057623,"changes":[{"type":"INSERT","lineNumber":6,"content":"import org.springframework.data.jpa.repository.JpaSpecificationExecutor;"}]},{"timestamp":1762147062319,"changes":[{"type":"DELETE","lineNumber":16,"oldContent":""},{"type":"DELETE","lineNumber":17,"oldContent":"    // Dr. X's Note: This query finds all tickets created FOR a specific user that have one of the given statuses."},{"type":"DELETE","lineNumber":18,"oldContent":"    // This is exactly what we need for the \"my active tickets\" endpoint."},{"type":"INSERT","lineNumber":16,"content":"    "},{"type":"DELETE","lineNumber":56,"oldContent":"    "},{"type":"INSERT","lineNumber":54,"content":""}]},{"timestamp":1762147144652,"changes":[{"type":"MODIFY","lineNumber":16,"content":"","oldContent":"    "},{"type":"DELETE","lineNumber":52,"oldContent":""},{"type":"INSERT","lineNumber":54,"content":""}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/CustomerTicketService.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/CustomerTicketService.java","baseContent":"// File: com/capstone/tele_ticketing_backend_1/service/CustomerTicketService.java\npackage com.capstone.tele_ticketing_backend_1.service;\n\nimport com.capstone.tele_ticketing_backend_1.dtos.CreateTicketRequestDto;\nimport com.capstone.tele_ticketing_backend_1.dtos.FeedbackRequestDto;\nimport com.capstone.tele_ticketing_backend_1.dtos.TicketSummaryDto;\nimport com.capstone.tele_ticketing_backend_1.entities.*;\nimport com.capstone.tele_ticketing_backend_1.exception.*;\nimport com.capstone.tele_ticketing_backend_1.model.enums.TicketStatus;\nimport com.capstone.tele_ticketing_backend_1.repo.TicketRepo;\nimport com.capstone.tele_ticketing_backend_1.repo.UserRepo;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport java.time.LocalDateTime;\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n@Service\npublic class CustomerTicketService {\n\n    @Autowired\n    private TicketRepo ticketRepo;\n\n    @Autowired\n    private UserRepo userRepo;\n\n    @Transactional\n    public Ticket createTicket(CreateTicketRequestDto dto, String username) {\n        AppUser user = userRepo.findByUsername(username)\n                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));\n\n        Ticket ticket = new Ticket();\n        ticket.setTitle(dto.getTitle());\n        ticket.setDescription(dto.getDescription());\n        ticket.setCategory(dto.getCategory());\n\n        // Dr. X's Note: System-controlled fields. A customer cannot set these.\n        ticket.setStatus(TicketStatus.CREATED);\n        ticket.setCreatedBy(user);\n        ticket.setCreatedFor(user); // Customer creates the ticket for themselves.\n\n        if (dto.getAttachments() != null && !dto.getAttachments().isEmpty()) {\n            dto.getAttachments().forEach(attUrl -> {\n                Attachment attachment = new Attachment();\n                attachment.setFilePath(attUrl); // Dummy URL\n                attachment.setFileName(\"attachment_\" + System.currentTimeMillis());\n                attachment.setTicket(ticket);\n                ticket.getAttachments().add(attachment);\n            });\n        }\n\n        return ticketRepo.save(ticket);\n    }\n\n    public List<TicketSummaryDto> getCustomerActiveTickets(String username) {\n        AppUser user = userRepo.findByUsername(username)\n                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));\n\n        List<TicketStatus> activeStatuses = Arrays.asList(\n                TicketStatus.CREATED,\n                TicketStatus.ASSIGNED,\n                TicketStatus.IN_PROGRESS,\n                TicketStatus.NEEDS_TRIAGING,\n                TicketStatus.REOPENED\n        );\n\n        List<Ticket> tickets = ticketRepo.findAllByCreatedForAndStatusIn(user, activeStatuses);\n\n        // Dr. X's Note: Map entities to DTOs to control what data is exposed to the client.\n        return tickets.stream()\n                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))\n                .collect(Collectors.toList());\n    }\n\n    public List<TicketSummaryDto> getCustomerFeedbackTickets(String username) {\n        AppUser user = userRepo.findByUsername(username)\n                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));\n\n        List<Ticket> tickets = ticketRepo.findAllByCreatedForAndStatus(user, TicketStatus.FIXED);\n\n        return tickets.stream()\n                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))\n                .collect(Collectors.toList());\n    }\n\n    @Transactional\n    public Ticket addFeedback(Long ticketId, FeedbackRequestDto dto, String username) {\n        AppUser user = userRepo.findByUsername(username)\n                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));\n\n        Ticket ticket = ticketRepo.findById(ticketId)\n                .orElseThrow(() -> new TicketNotFoundException(\"Ticket not found with id: \" + ticketId));\n\n        // Security Check: Ensure the user owns this ticket.\n        if (!ticket.getCreatedFor().getId().equals(user.getId())) {\n            throw new ForbiddenAccessException(\"You are not authorized to add feedback to this ticket.\");\n        }\n\n        // State Check: Ensure the ticket is in the correct status.\n        if (ticket.getStatus() != TicketStatus.FIXED) {\n            throw new InvalidTicketStatusException(\"Feedback can only be added to tickets with status FIXED.\");\n        }\n\n        Feedback feedback = new Feedback();\n        feedback.setRating(dto.getRating());\n        feedback.setComment(dto.getComment());\n        feedback.setUser(user);\n        feedback.setTicket(ticket);\n        ticket.setFeedback(feedback);\n\n        // Business Logic: Resolve or Reopen based on rating.\n        if (dto.getRating() > 2) {\n            ticket.setStatus(TicketStatus.RESOLVED);\n            ticket.setResolvedAt(LocalDateTime.now());\n        } else {\n            ticket.setStatus(TicketStatus.REOPENED);\n        }\n\n        return ticketRepo.save(ticket);\n    }\n}","baseTimestamp":1761780366060,"deltas":[{"timestamp":1761780379686,"changes":[{"type":"DELETE","lineNumber":3,"oldContent":"import com.capstone.tele_ticketing_backend_1.dtos.CreateTicketRequestDto;"},{"type":"DELETE","lineNumber":4,"oldContent":"import com.capstone.tele_ticketing_backend_1.dtos.FeedbackRequestDto;"},{"type":"DELETE","lineNumber":5,"oldContent":"import com.capstone.tele_ticketing_backend_1.dtos.TicketSummaryDto;"},{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.dto.CreateTicketRequestDto;"},{"type":"INSERT","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.dto.FeedbackRequestDto;"},{"type":"INSERT","lineNumber":5,"content":"import com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;"}]},{"timestamp":1761780384587,"changes":[{"type":"MODIFY","lineNumber":7,"content":"import com.capstone.tele_ticketing_backend_1.exceptions.*;","oldContent":"import com.capstone.tele_ticketing_backend_1.exception.*;"}]},{"timestamp":1761780390268,"changes":[{"type":"MODIFY","lineNumber":8,"content":"import com.capstone.tele_ticketing_backend_1.entities.TicketStatus;","oldContent":"import com.capstone.tele_ticketing_backend_1.model.enums.TicketStatus;"}]},{"timestamp":1761887477438,"changes":[{"type":"INSERT","lineNumber":14,"content":"import com.capstone.tele_ticketing_backend_1.dto.CreateTicketRequestDto;"},{"type":"INSERT","lineNumber":15,"content":"import com.capstone.tele_ticketing_backend_1.dto.FeedbackRequestDto;"},{"type":"INSERT","lineNumber":16,"content":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto; // Import DTO"},{"type":"INSERT","lineNumber":17,"content":"import com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;"},{"type":"INSERT","lineNumber":18,"content":"import com.capstone.tele_ticketing_backend_1.dto.UserSummaryDto;   // Import DTO"},{"type":"INSERT","lineNumber":19,"content":"import com.capstone.tele_ticketing_backend_1.entities.*;"},{"type":"INSERT","lineNumber":20,"content":"import com.capstone.tele_ticketing_backend_1.exceptions.*;"}]},{"timestamp":1761887491768,"changes":[{"type":"DELETE","lineNumber":15,"oldContent":""},{"type":"DELETE","lineNumber":17,"oldContent":"import java.time.LocalDateTime;"},{"type":"DELETE","lineNumber":19,"oldContent":"import java.util.Arrays;"},{"type":"DELETE","lineNumber":21,"oldContent":"import java.util.List;"},{"type":"DELETE","lineNumber":23,"oldContent":"import java.util.stream.Collectors;"},{"type":"DELETE","lineNumber":25,"oldContent":""},{"type":"INSERT","lineNumber":21,"content":""},{"type":"INSERT","lineNumber":22,"content":"import java.time.LocalDateTime;"},{"type":"INSERT","lineNumber":23,"content":"import java.util.Arrays;"},{"type":"INSERT","lineNumber":24,"content":"import java.util.List;"},{"type":"INSERT","lineNumber":25,"content":"import java.util.stream.Collectors;"},{"type":"INSERT","lineNumber":26,"content":""},{"type":"INSERT","lineNumber":36,"content":"    @Autowired"},{"type":"INSERT","lineNumber":37,"content":"    private TicketService ticketService;"},{"type":"INSERT","lineNumber":38,"content":""}]},{"timestamp":1761887528616,"changes":[{"type":"INSERT","lineNumber":18,"content":"import com.capstone.tele_ticketing_backend_1.dto.UserSummaryDto;   // Import DTO"},{"type":"INSERT","lineNumber":19,"content":"import com.capstone.tele_ticketing_backend_1.entities.*;"},{"type":"INSERT","lineNumber":20,"content":"import com.capstone.tele_ticketing_backend_1.exceptions.*;"},{"type":"DELETE","lineNumber":20,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.UserSummaryDto;   // Import DTO"},{"type":"DELETE","lineNumber":23,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.*;"},{"type":"DELETE","lineNumber":26,"oldContent":"import com.capstone.tele_ticketing_backend_1.exceptions.*;"},{"type":"DELETE","lineNumber":37,"oldContent":"    @Transactional"},{"type":"MODIFY","lineNumber":39,"content":"    @Transactional","oldContent":"    public Ticket createTicket(CreateTicketRequestDto dto, String username) {"},{"type":"INSERT","lineNumber":40,"content":"    public Ticket createTicket(CreateTicketRequestDto dto, String username) {"},{"type":"MODIFY","lineNumber":99,"content":"    public TicketDetailDto addFeedback(Long ticketId, FeedbackRequestDto dto, String username) {","oldContent":"    public Ticket addFeedback(Long ticketId, FeedbackRequestDto dto, String username) {"},{"type":"MODIFY","lineNumber":108,"content":"            throw new AuthorizationException(\"You are not authorized to add feedback to this ticket.\");","oldContent":"            throw new ForbiddenAccessException(\"You are not authorized to add feedback to this ticket.\");"},{"type":"MODIFY","lineNumber":131,"content":"        Ticket savedTicket = ticketRepo.save(ticket);","oldContent":"        return ticketRepo.save(ticket);"},{"type":"INSERT","lineNumber":132,"content":""},{"type":"INSERT","lineNumber":133,"content":"        // Dr. X's Fix: Call the central mapper from TicketService before returning."},{"type":"INSERT","lineNumber":134,"content":"        // This solves the lazy loading exception permanently for this endpoint."},{"type":"INSERT","lineNumber":135,"content":"        return ticketService.mapTicketToDetailDto(savedTicket);"}]},{"timestamp":1761887539702,"changes":[{"type":"DELETE","lineNumber":14,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.CreateTicketRequestDto;"},{"type":"DELETE","lineNumber":15,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.FeedbackRequestDto;"},{"type":"DELETE","lineNumber":19,"oldContent":""},{"type":"DELETE","lineNumber":21,"oldContent":"import java.time.LocalDateTime;"},{"type":"INSERT","lineNumber":19,"content":""},{"type":"INSERT","lineNumber":20,"content":"import java.time.LocalDateTime;"},{"type":"INSERT","lineNumber":36,"content":""},{"type":"DELETE","lineNumber":40,"oldContent":""},{"type":"DELETE","lineNumber":133,"oldContent":"    }"},{"type":"MODIFY","lineNumber":134,"content":"    }","oldContent":"}"},{"type":"INSERT","lineNumber":135,"content":"}"}]},{"timestamp":1761887552367,"changes":[{"type":"DELETE","lineNumber":14,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto; // Import DTO"},{"type":"DELETE","lineNumber":15,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;"},{"type":"DELETE","lineNumber":16,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.UserSummaryDto;   // Import DTO"},{"type":"INSERT","lineNumber":14,"content":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;"},{"type":"DELETE","lineNumber":19,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.*;"},{"type":"DELETE","lineNumber":20,"oldContent":"import com.capstone.tele_ticketing_backend_1.exceptions.*;"},{"type":"DELETE","lineNumber":34,"oldContent":""},{"type":"INSERT","lineNumber":32,"content":""},{"type":"DELETE","lineNumber":131,"oldContent":"    }"},{"type":"DELETE","lineNumber":132,"oldContent":"}"},{"type":"DELETE","lineNumber":133,"oldContent":"}"},{"type":"INSERT","lineNumber":127,"content":"        // Dr. X's Fix: Call the central mapper from TicketService before returning."},{"type":"INSERT","lineNumber":130,"content":"    }"},{"type":"INSERT","lineNumber":131,"content":"}"}]},{"timestamp":1761892517691,"changes":[{"type":"DELETE","lineNumber":28,"oldContent":""},{"type":"INSERT","lineNumber":32,"content":""},{"type":"INSERT","lineNumber":33,"content":"    @Autowired"},{"type":"INSERT","lineNumber":34,"content":"    private ActivityLogService activityLogService;"},{"type":"INSERT","lineNumber":35,"content":""},{"type":"DELETE","lineNumber":123,"oldContent":"        // Dr. X's Fix: Call the central mapper from TicketService before returning."},{"type":"DELETE","lineNumber":127,"oldContent":"    }"},{"type":"DELETE","lineNumber":129,"oldContent":"}"},{"type":"INSERT","lineNumber":130,"content":"        // Dr. X's Fix: Call the central mapper from TicketService before returning."},{"type":"INSERT","lineNumber":133,"content":"    }"},{"type":"INSERT","lineNumber":134,"content":"}"}]},{"timestamp":1761892532849,"changes":[{"type":"MODIFY","lineNumber":32,"content":"","oldContent":""},{"type":"DELETE","lineNumber":34,"oldContent":"    @Transactional"},{"type":"MODIFY","lineNumber":36,"content":"","oldContent":"    public Ticket createTicket(CreateTicketRequestDto dto, String username) {"},{"type":"INSERT","lineNumber":37,"content":"    @Transactional"},{"type":"INSERT","lineNumber":38,"content":"    public TicketDetailDto createTicket(CreateTicketRequestDto dto, String username) {"},{"type":"INSERT","lineNumber":46,"content":"        ticket.setStatus(TicketStatus.CREATED);"},{"type":"INSERT","lineNumber":47,"content":"        ticket.setCreatedBy(user);"},{"type":"INSERT","lineNumber":48,"content":"        ticket.setCreatedFor(user);"},{"type":"INSERT","lineNumber":50,"content":"        if (dto.getAttachments() != null && !dto.getAttachments().isEmpty()) {"},{"type":"INSERT","lineNumber":51,"content":"            dto.getAttachments().forEach(attUrl -> {"},{"type":"INSERT","lineNumber":52,"content":"                Attachment attachment = new Attachment();"},{"type":"INSERT","lineNumber":53,"content":"                attachment.setFilePath(attUrl);"},{"type":"INSERT","lineNumber":54,"content":"                attachment.setFileName(\"attachment_\" + System.currentTimeMillis());"},{"type":"INSERT","lineNumber":55,"content":"                attachment.setTicket(ticket);"},{"type":"INSERT","lineNumber":56,"content":"                ticket.getAttachments().add(attachment);"},{"type":"INSERT","lineNumber":57,"content":"            });"},{"type":"INSERT","lineNumber":58,"content":"        }"},{"type":"INSERT","lineNumber":59,"content":""},{"type":"INSERT","lineNumber":60,"content":"        Ticket savedTicket = ticketRepo.save(ticket);"},{"type":"INSERT","lineNumber":61,"content":""},{"type":"INSERT","lineNumber":62,"content":"        // Dr. X's Addition: Create a public log entry for the ticket creation."},{"type":"INSERT","lineNumber":63,"content":"        activityLogService.createLog(savedTicket, user, ActivityType.CREATION, \"Ticket was created.\", false);"},{"type":"INSERT","lineNumber":64,"content":""},{"type":"INSERT","lineNumber":65,"content":"        return ticketService.mapTicketToDetailDto(savedTicket);"},{"type":"INSERT","lineNumber":66,"content":"    }"},{"type":"INSERT","lineNumber":67,"content":""},{"type":"INSERT","lineNumber":68,"content":"    @Transactional"},{"type":"INSERT","lineNumber":69,"content":"    public TicketDetailDto addFeedback(Long ticketId, FeedbackRequestDto dto, String username) {"},{"type":"INSERT","lineNumber":70,"content":"        AppUser user = userRepo.findByUsername(username)"},{"type":"INSERT","lineNumber":71,"content":"                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));"},{"type":"INSERT","lineNumber":72,"content":""},{"type":"INSERT","lineNumber":73,"content":"        Ticket ticket = ticketRepo.findById(ticketId)"},{"type":"INSERT","lineNumber":74,"content":"                .orElseThrow(() -> new TicketNotFoundException(\"Ticket not found with id: \" + ticketId));"},{"type":"INSERT","lineNumber":75,"content":""},{"type":"INSERT","lineNumber":76,"content":"        // ... security and state checks ..."},{"type":"INSERT","lineNumber":77,"content":"        if (!ticket.getCreatedFor().getId().equals(user.getId())) {"},{"type":"INSERT","lineNumber":78,"content":"            throw new AuthorizationException(\"You are not authorized to add feedback to this ticket.\");"},{"type":"INSERT","lineNumber":79,"content":"        }"},{"type":"INSERT","lineNumber":80,"content":"        if (ticket.getStatus() != TicketStatus.FIXED) {"},{"type":"INSERT","lineNumber":81,"content":"            throw new InvalidTicketStatusException(\"Feedback can only be added to tickets with status FIXED.\");"},{"type":"INSERT","lineNumber":82,"content":"        }"},{"type":"INSERT","lineNumber":83,"content":""},{"type":"INSERT","lineNumber":84,"content":"        Feedback feedback = new Feedback();"},{"type":"INSERT","lineNumber":85,"content":"        feedback.setRating(dto.getRating());"},{"type":"INSERT","lineNumber":86,"content":"        feedback.setComment(dto.getComment());"},{"type":"INSERT","lineNumber":87,"content":"        feedback.setUser(user);"},{"type":"INSERT","lineNumber":88,"content":"        feedback.setTicket(ticket);"},{"type":"INSERT","lineNumber":89,"content":"        ticket.setFeedback(feedback);"},{"type":"INSERT","lineNumber":90,"content":""},{"type":"INSERT","lineNumber":91,"content":"        if (dto.getRating() > 2) {"},{"type":"INSERT","lineNumber":92,"content":"            ticket.setStatus(TicketStatus.RESOLVED);"},{"type":"INSERT","lineNumber":93,"content":"            ticket.setResolvedAt(LocalDateTime.now());"},{"type":"INSERT","lineNumber":94,"content":"            // Dr. X's Addition: Create a public log for resolution."},{"type":"INSERT","lineNumber":95,"content":"            activityLogService.createLog(ticket, user, ActivityType.RESOLUTION, \"Customer confirmed the fix. Ticket resolved.\", false);"},{"type":"INSERT","lineNumber":96,"content":"        } else {"},{"type":"INSERT","lineNumber":97,"content":"            ticket.setStatus(TicketStatus.REOPENED);"},{"type":"INSERT","lineNumber":98,"content":"            // Dr. X's Addition: Create a public log for reopening."},{"type":"INSERT","lineNumber":99,"content":"            activityLogService.createLog(ticket, user, ActivityType.REOPENED, \"Customer reopened the ticket. Rating: \" + dto.getRating() + \" star(s).\", false);"},{"type":"INSERT","lineNumber":100,"content":"        }"},{"type":"INSERT","lineNumber":101,"content":""},{"type":"INSERT","lineNumber":102,"content":"        Ticket savedTicket = ticketRepo.save(ticket);"},{"type":"INSERT","lineNumber":103,"content":"        return ticketService.mapTicketToDetailDto(savedTicket);"},{"type":"INSERT","lineNumber":104,"content":"    }"},{"type":"INSERT","lineNumber":105,"content":"    @Transactional"},{"type":"INSERT","lineNumber":106,"content":"    public Ticket createTicket(CreateTicketRequestDto dto, String username) {"},{"type":"INSERT","lineNumber":107,"content":"        AppUser user = userRepo.findByUsername(username)"},{"type":"INSERT","lineNumber":108,"content":"                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));"},{"type":"INSERT","lineNumber":109,"content":""},{"type":"INSERT","lineNumber":110,"content":"        Ticket ticket = new Ticket();"},{"type":"INSERT","lineNumber":111,"content":"        ticket.setTitle(dto.getTitle());"},{"type":"INSERT","lineNumber":112,"content":"        ticket.setDescription(dto.getDescription());"},{"type":"INSERT","lineNumber":113,"content":"        ticket.setCategory(dto.getCategory());"},{"type":"INSERT","lineNumber":114,"content":""},{"type":"DELETE","lineNumber":133,"oldContent":"}"},{"type":"INSERT","lineNumber":203,"content":"}"}]},{"timestamp":1761892547353,"changes":[{"type":"INSERT","lineNumber":31,"content":"    private TicketService ticketService;"},{"type":"DELETE","lineNumber":32,"oldContent":""},{"type":"MODIFY","lineNumber":37,"content":"    @Transactional","oldContent":"    @Transactional"},{"type":"DELETE","lineNumber":46,"oldContent":""},{"type":"DELETE","lineNumber":48,"oldContent":"        // Dr. X's Note: System-controlled fields. A customer cannot set these."},{"type":"DELETE","lineNumber":50,"oldContent":"        ticket.setStatus(TicketStatus.CREATED);"},{"type":"DELETE","lineNumber":52,"oldContent":"        ticket.setCreatedBy(user);"},{"type":"DELETE","lineNumber":53,"oldContent":"        ticket.setCreatedFor(user); // Customer creates the ticket for themselves."},{"type":"DELETE","lineNumber":54,"oldContent":"        if (dto.getAttachments() != null && !dto.getAttachments().isEmpty()) {"},{"type":"DELETE","lineNumber":56,"oldContent":"            dto.getAttachments().forEach(attUrl -> {"},{"type":"DELETE","lineNumber":58,"oldContent":"                Attachment attachment = new Attachment();"},{"type":"DELETE","lineNumber":60,"oldContent":"                attachment.setFilePath(attUrl);"},{"type":"INSERT","lineNumber":53,"content":"                attachment.setFilePath(attUrl);"},{"type":"DELETE","lineNumber":63,"oldContent":"                attachment.setFilePath(attUrl); // Dummy URL"},{"type":"DELETE","lineNumber":65,"oldContent":"                attachment.setFileName(\"attachment_\" + System.currentTimeMillis());"},{"type":"DELETE","lineNumber":67,"oldContent":"                attachment.setTicket(ticket);"},{"type":"DELETE","lineNumber":69,"oldContent":"                ticket.getAttachments().add(attachment);"},{"type":"DELETE","lineNumber":71,"oldContent":"            });"},{"type":"DELETE","lineNumber":73,"oldContent":"        }"},{"type":"DELETE","lineNumber":76,"oldContent":""},{"type":"DELETE","lineNumber":77,"oldContent":"        return ticketRepo.save(ticket);"},{"type":"DELETE","lineNumber":79,"oldContent":"    }"},{"type":"DELETE","lineNumber":82,"oldContent":""},{"type":"DELETE","lineNumber":83,"oldContent":"    public List<TicketSummaryDto> getCustomerActiveTickets(String username) {"},{"type":"DELETE","lineNumber":85,"oldContent":"        AppUser user = userRepo.findByUsername(username)"},{"type":"DELETE","lineNumber":87,"oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));"},{"type":"DELETE","lineNumber":89,"oldContent":""},{"type":"DELETE","lineNumber":91,"oldContent":"        List<TicketStatus> activeStatuses = Arrays.asList("},{"type":"DELETE","lineNumber":93,"oldContent":"                TicketStatus.CREATED,"},{"type":"DELETE","lineNumber":95,"oldContent":"                TicketStatus.ASSIGNED,"},{"type":"DELETE","lineNumber":97,"oldContent":"                TicketStatus.IN_PROGRESS,"},{"type":"DELETE","lineNumber":99,"oldContent":"                TicketStatus.NEEDS_TRIAGING,"},{"type":"DELETE","lineNumber":101,"oldContent":"                TicketStatus.REOPENED"},{"type":"DELETE","lineNumber":103,"oldContent":"        );"},{"type":"DELETE","lineNumber":105,"oldContent":""},{"type":"DELETE","lineNumber":107,"oldContent":"        List<Ticket> tickets = ticketRepo.findAllByCreatedForAndStatusIn(user, activeStatuses);"},{"type":"DELETE","lineNumber":109,"oldContent":""},{"type":"DELETE","lineNumber":111,"oldContent":"        // Dr. X's Note: Map entities to DTOs to control what data is exposed to the client."},{"type":"DELETE","lineNumber":113,"oldContent":"        return tickets.stream()"},{"type":"DELETE","lineNumber":115,"oldContent":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"DELETE","lineNumber":117,"oldContent":"                .collect(Collectors.toList());"},{"type":"DELETE","lineNumber":119,"oldContent":"    }"},{"type":"DELETE","lineNumber":121,"oldContent":""},{"type":"DELETE","lineNumber":123,"oldContent":"    public List<TicketSummaryDto> getCustomerFeedbackTickets(String username) {"},{"type":"DELETE","lineNumber":125,"oldContent":"        AppUser user = userRepo.findByUsername(username)"},{"type":"DELETE","lineNumber":127,"oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));"},{"type":"DELETE","lineNumber":129,"oldContent":""},{"type":"DELETE","lineNumber":131,"oldContent":"        List<Ticket> tickets = ticketRepo.findAllByCreatedForAndStatus(user, TicketStatus.FIXED);"},{"type":"INSERT","lineNumber":91,"content":"        if (dto.getRating() > 2) {"},{"type":"INSERT","lineNumber":92,"content":"            ticket.setStatus(TicketStatus.RESOLVED);"},{"type":"INSERT","lineNumber":93,"content":"            ticket.setResolvedAt(LocalDateTime.now());"},{"type":"INSERT","lineNumber":94,"content":"            // Dr. X's Addition: Create a public log for resolution."},{"type":"INSERT","lineNumber":95,"content":"            activityLogService.createLog(ticket, user, ActivityType.RESOLUTION, \"Customer confirmed the fix. Ticket resolved.\", false);"},{"type":"INSERT","lineNumber":96,"content":"        } else {"},{"type":"INSERT","lineNumber":97,"content":"            ticket.setStatus(TicketStatus.REOPENED);"},{"type":"INSERT","lineNumber":98,"content":"            // Dr. X's Addition: Create a public log for reopening."},{"type":"INSERT","lineNumber":99,"content":"            activityLogService.createLog(ticket, user, ActivityType.REOPENED, \"Customer reopened the ticket. Rating: \" + dto.getRating() + \" star(s).\", false);"},{"type":"INSERT","lineNumber":100,"content":"        }"},{"type":"INSERT","lineNumber":102,"content":"        Ticket savedTicket = ticketRepo.save(ticket);"},{"type":"INSERT","lineNumber":103,"content":"        return ticketService.mapTicketToDetailDto(savedTicket);"},{"type":"INSERT","lineNumber":104,"content":"    }"},{"type":"INSERT","lineNumber":105,"content":""},{"type":"INSERT","lineNumber":106,"content":"    public List<TicketSummaryDto> getCustomerActiveTickets(String username) {"},{"type":"INSERT","lineNumber":107,"content":"        AppUser user = userRepo.findByUsername(username)"},{"type":"INSERT","lineNumber":108,"content":"                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));"},{"type":"INSERT","lineNumber":109,"content":""},{"type":"INSERT","lineNumber":110,"content":"        List<TicketStatus> activeStatuses = Arrays.asList("},{"type":"INSERT","lineNumber":111,"content":"                TicketStatus.CREATED,"},{"type":"INSERT","lineNumber":112,"content":"                TicketStatus.ASSIGNED,"},{"type":"INSERT","lineNumber":113,"content":"                TicketStatus.IN_PROGRESS,"},{"type":"INSERT","lineNumber":114,"content":"                TicketStatus.NEEDS_TRIAGING,"},{"type":"INSERT","lineNumber":115,"content":"                TicketStatus.REOPENED"},{"type":"INSERT","lineNumber":116,"content":"        );"},{"type":"INSERT","lineNumber":117,"content":""},{"type":"INSERT","lineNumber":118,"content":"        List<Ticket> tickets = ticketRepo.findAllByCreatedForAndStatusIn(user, activeStatuses);"},{"type":"INSERT","lineNumber":119,"content":""},{"type":"INSERT","lineNumber":120,"content":"        // Dr. X's Note: Map entities to DTOs to control what data is exposed to the client."},{"type":"DELETE","lineNumber":136,"oldContent":"        if (dto.getRating() > 2) {"},{"type":"DELETE","lineNumber":138,"oldContent":"            ticket.setStatus(TicketStatus.RESOLVED);"},{"type":"DELETE","lineNumber":140,"oldContent":"            ticket.setResolvedAt(LocalDateTime.now());"},{"type":"DELETE","lineNumber":142,"oldContent":"            // Dr. X's Addition: Create a public log for resolution."},{"type":"DELETE","lineNumber":144,"oldContent":"            activityLogService.createLog(ticket, user, ActivityType.RESOLUTION, \"Customer confirmed the fix. Ticket resolved.\", false);"},{"type":"INSERT","lineNumber":126,"content":"    public List<TicketSummaryDto> getCustomerFeedbackTickets(String username) {"},{"type":"INSERT","lineNumber":127,"content":"        AppUser user = userRepo.findByUsername(username)"},{"type":"INSERT","lineNumber":128,"content":"                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));"},{"type":"INSERT","lineNumber":129,"content":""},{"type":"INSERT","lineNumber":130,"content":"        List<Ticket> tickets = ticketRepo.findAllByCreatedForAndStatus(user, TicketStatus.FIXED);"},{"type":"INSERT","lineNumber":131,"content":""},{"type":"INSERT","lineNumber":132,"content":"        return tickets.stream()"},{"type":"INSERT","lineNumber":133,"content":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"INSERT","lineNumber":134,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":135,"content":"    }"},{"type":"INSERT","lineNumber":136,"content":""},{"type":"DELETE","lineNumber":146,"oldContent":"        } else {"},{"type":"DELETE","lineNumber":148,"oldContent":"            ticket.setStatus(TicketStatus.REOPENED);"},{"type":"DELETE","lineNumber":150,"oldContent":"            // Dr. X's Addition: Create a public log for reopening."},{"type":"DELETE","lineNumber":152,"oldContent":"            activityLogService.createLog(ticket, user, ActivityType.REOPENED, \"Customer reopened the ticket. Rating: \" + dto.getRating() + \" star(s).\", false);"},{"type":"DELETE","lineNumber":154,"oldContent":"        }"},{"type":"DELETE","lineNumber":156,"oldContent":""},{"type":"DELETE","lineNumber":158,"oldContent":"        Ticket savedTicket = ticketRepo.save(ticket);"},{"type":"DELETE","lineNumber":160,"oldContent":"        return ticketService.mapTicketToDetailDto(savedTicket);"},{"type":"DELETE","lineNumber":162,"oldContent":"    }"},{"type":"DELETE","lineNumber":164,"oldContent":"    @Transactional"},{"type":"DELETE","lineNumber":166,"oldContent":"    public Ticket createTicket(CreateTicketRequestDto dto, String username) {"},{"type":"DELETE","lineNumber":168,"oldContent":"        AppUser user = userRepo.findByUsername(username)"},{"type":"DELETE","lineNumber":170,"oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));"},{"type":"DELETE","lineNumber":172,"oldContent":""},{"type":"DELETE","lineNumber":174,"oldContent":"        Ticket ticket = new Ticket();"},{"type":"DELETE","lineNumber":176,"oldContent":"        ticket.setTitle(dto.getTitle());"},{"type":"DELETE","lineNumber":178,"oldContent":"        ticket.setDescription(dto.getDescription());"},{"type":"DELETE","lineNumber":180,"oldContent":"        ticket.setCategory(dto.getCategory());"},{"type":"DELETE","lineNumber":182,"oldContent":""}]},{"timestamp":1761892555781,"changes":[{"type":"INSERT","lineNumber":36,"content":""},{"type":"DELETE","lineNumber":37,"oldContent":"    @Transactional"},{"type":"DELETE","lineNumber":49,"oldContent":"                attachment.setFilePath(attUrl);"},{"type":"INSERT","lineNumber":53,"content":"                attachment.setFilePath(attUrl);"},{"type":"INSERT","lineNumber":69,"content":"    public TicketDetailDto addFeedback(Long ticketId, FeedbackRequestDto dto, String username) {"},{"type":"INSERT","lineNumber":70,"content":"        AppUser user = userRepo.findByUsername(username)"},{"type":"INSERT","lineNumber":71,"content":"                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));"},{"type":"INSERT","lineNumber":72,"content":""},{"type":"INSERT","lineNumber":73,"content":"        Ticket ticket = ticketRepo.findById(ticketId)"},{"type":"INSERT","lineNumber":74,"content":"                .orElseThrow(() -> new TicketNotFoundException(\"Ticket not found with id: \" + ticketId));"},{"type":"INSERT","lineNumber":75,"content":""},{"type":"INSERT","lineNumber":76,"content":"        // ... security and state checks ..."},{"type":"INSERT","lineNumber":77,"content":"        if (!ticket.getCreatedFor().getId().equals(user.getId())) {"},{"type":"INSERT","lineNumber":78,"content":"            throw new AuthorizationException(\"You are not authorized to add feedback to this ticket.\");"},{"type":"INSERT","lineNumber":79,"content":"        }"},{"type":"INSERT","lineNumber":80,"content":"        if (ticket.getStatus() != TicketStatus.FIXED) {"},{"type":"INSERT","lineNumber":81,"content":"            throw new InvalidTicketStatusException(\"Feedback can only be added to tickets with status FIXED.\");"},{"type":"INSERT","lineNumber":82,"content":"        }"},{"type":"INSERT","lineNumber":83,"content":""},{"type":"INSERT","lineNumber":84,"content":"        Feedback feedback = new Feedback();"},{"type":"INSERT","lineNumber":85,"content":"        feedback.setRating(dto.getRating());"},{"type":"INSERT","lineNumber":86,"content":"        feedback.setComment(dto.getComment());"},{"type":"INSERT","lineNumber":87,"content":"        feedback.setUser(user);"},{"type":"INSERT","lineNumber":88,"content":"        feedback.setTicket(ticket);"},{"type":"INSERT","lineNumber":89,"content":"        ticket.setFeedback(feedback);"},{"type":"INSERT","lineNumber":90,"content":""},{"type":"DELETE","lineNumber":71,"oldContent":"    public TicketDetailDto addFeedback(Long ticketId, FeedbackRequestDto dto, String username) {"},{"type":"DELETE","lineNumber":74,"oldContent":"        AppUser user = userRepo.findByUsername(username)"},{"type":"DELETE","lineNumber":77,"oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));"},{"type":"DELETE","lineNumber":80,"oldContent":""},{"type":"DELETE","lineNumber":83,"oldContent":"        Ticket ticket = ticketRepo.findById(ticketId)"},{"type":"INSERT","lineNumber":101,"content":""},{"type":"DELETE","lineNumber":85,"oldContent":"                .orElseThrow(() -> new TicketNotFoundException(\"Ticket not found with id: \" + ticketId));"},{"type":"DELETE","lineNumber":89,"oldContent":""},{"type":"DELETE","lineNumber":91,"oldContent":"        // ... security and state checks ..."},{"type":"DELETE","lineNumber":94,"oldContent":"        if (!ticket.getCreatedFor().getId().equals(user.getId())) {"},{"type":"DELETE","lineNumber":97,"oldContent":"            throw new AuthorizationException(\"You are not authorized to add feedback to this ticket.\");"},{"type":"DELETE","lineNumber":100,"oldContent":"        }"},{"type":"DELETE","lineNumber":103,"oldContent":"        if (ticket.getStatus() != TicketStatus.FIXED) {"},{"type":"DELETE","lineNumber":106,"oldContent":"            throw new InvalidTicketStatusException(\"Feedback can only be added to tickets with status FIXED.\");"},{"type":"DELETE","lineNumber":109,"oldContent":"        }"},{"type":"INSERT","lineNumber":121,"content":"        return tickets.stream()"},{"type":"INSERT","lineNumber":122,"content":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"INSERT","lineNumber":123,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":124,"content":"    }"},{"type":"DELETE","lineNumber":113,"oldContent":"        Feedback feedback = new Feedback();"},{"type":"DELETE","lineNumber":114,"oldContent":"        feedback.setRating(dto.getRating());"},{"type":"DELETE","lineNumber":116,"oldContent":"        feedback.setComment(dto.getComment());"},{"type":"DELETE","lineNumber":119,"oldContent":"        feedback.setUser(user);"},{"type":"DELETE","lineNumber":122,"oldContent":"        feedback.setTicket(ticket);"},{"type":"DELETE","lineNumber":125,"oldContent":"        ticket.setFeedback(feedback);"},{"type":"DELETE","lineNumber":127,"oldContent":""},{"type":"DELETE","lineNumber":129,"oldContent":""},{"type":"DELETE","lineNumber":131,"oldContent":"        return tickets.stream()"},{"type":"DELETE","lineNumber":132,"oldContent":""},{"type":"DELETE","lineNumber":133,"oldContent":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"DELETE","lineNumber":134,"oldContent":"                .collect(Collectors.toList());"},{"type":"DELETE","lineNumber":135,"oldContent":"    }"},{"type":"DELETE","lineNumber":136,"oldContent":""},{"type":"DELETE","lineNumber":137,"oldContent":"    @Transactional"},{"type":"DELETE","lineNumber":138,"oldContent":"    public TicketDetailDto addFeedback(Long ticketId, FeedbackRequestDto dto, String username) {"},{"type":"DELETE","lineNumber":139,"oldContent":"        AppUser user = userRepo.findByUsername(username)"},{"type":"DELETE","lineNumber":140,"oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));"},{"type":"DELETE","lineNumber":141,"oldContent":""},{"type":"DELETE","lineNumber":142,"oldContent":"        Ticket ticket = ticketRepo.findById(ticketId)"},{"type":"DELETE","lineNumber":143,"oldContent":"                .orElseThrow(() -> new TicketNotFoundException(\"Ticket not found with id: \" + ticketId));"},{"type":"DELETE","lineNumber":144,"oldContent":""},{"type":"DELETE","lineNumber":145,"oldContent":"        // Security Check: Ensure the user owns this ticket."},{"type":"DELETE","lineNumber":146,"oldContent":"        if (!ticket.getCreatedFor().getId().equals(user.getId())) {"},{"type":"DELETE","lineNumber":147,"oldContent":"            throw new AuthorizationException(\"You are not authorized to add feedback to this ticket.\");"},{"type":"DELETE","lineNumber":148,"oldContent":"        }"},{"type":"DELETE","lineNumber":149,"oldContent":""},{"type":"DELETE","lineNumber":150,"oldContent":"        // State Check: Ensure the ticket is in the correct status."},{"type":"DELETE","lineNumber":151,"oldContent":"        if (ticket.getStatus() != TicketStatus.FIXED) {"},{"type":"DELETE","lineNumber":152,"oldContent":"            throw new InvalidTicketStatusException(\"Feedback can only be added to tickets with status FIXED.\");"},{"type":"DELETE","lineNumber":153,"oldContent":"        }"},{"type":"DELETE","lineNumber":154,"oldContent":""},{"type":"DELETE","lineNumber":155,"oldContent":"        Feedback feedback = new Feedback();"},{"type":"DELETE","lineNumber":156,"oldContent":"        feedback.setRating(dto.getRating());"},{"type":"DELETE","lineNumber":157,"oldContent":"        feedback.setComment(dto.getComment());"},{"type":"DELETE","lineNumber":158,"oldContent":"        feedback.setUser(user);"},{"type":"DELETE","lineNumber":159,"oldContent":"        feedback.setTicket(ticket);"},{"type":"DELETE","lineNumber":160,"oldContent":"        ticket.setFeedback(feedback);"},{"type":"DELETE","lineNumber":161,"oldContent":""},{"type":"DELETE","lineNumber":162,"oldContent":"        // Business Logic: Resolve or Reopen based on rating."},{"type":"DELETE","lineNumber":163,"oldContent":"        if (dto.getRating() > 2) {"},{"type":"DELETE","lineNumber":164,"oldContent":"            ticket.setStatus(TicketStatus.RESOLVED);"},{"type":"DELETE","lineNumber":165,"oldContent":"            ticket.setResolvedAt(LocalDateTime.now());"},{"type":"DELETE","lineNumber":166,"oldContent":"        } else {"},{"type":"DELETE","lineNumber":167,"oldContent":"            ticket.setStatus(TicketStatus.REOPENED);"},{"type":"DELETE","lineNumber":168,"oldContent":"        }"},{"type":"DELETE","lineNumber":169,"oldContent":""},{"type":"DELETE","lineNumber":170,"oldContent":"        Ticket savedTicket = ticketRepo.save(ticket);"},{"type":"DELETE","lineNumber":171,"oldContent":""},{"type":"DELETE","lineNumber":172,"oldContent":"        // Dr. X's Fix: Call the central mapper from TicketService before returning."},{"type":"DELETE","lineNumber":173,"oldContent":"        // This solves the lazy loading exception permanently for this endpoint."},{"type":"DELETE","lineNumber":174,"oldContent":"        return ticketService.mapTicketToDetailDto(savedTicket);"},{"type":"DELETE","lineNumber":175,"oldContent":"    }"}]},{"timestamp":1761899683815,"changes":[{"type":"INSERT","lineNumber":36,"content":"    @Autowired"},{"type":"INSERT","lineNumber":37,"content":"    private TicketActivityRepo activityRepo;"},{"type":"INSERT","lineNumber":39,"content":""},{"type":"DELETE","lineNumber":52,"oldContent":"                attachment.setFilePath(attUrl);"},{"type":"INSERT","lineNumber":56,"content":"                attachment.setFilePath(attUrl);"},{"type":"DELETE","lineNumber":70,"oldContent":"        if (dto.getRating() > 2) {"},{"type":"DELETE","lineNumber":72,"oldContent":"            ticket.setStatus(TicketStatus.RESOLVED);"},{"type":"DELETE","lineNumber":75,"oldContent":"            ticket.setResolvedAt(LocalDateTime.now());"},{"type":"DELETE","lineNumber":77,"oldContent":"            // Dr. X's Addition: Create a public log for resolution."},{"type":"DELETE","lineNumber":80,"oldContent":"            activityLogService.createLog(ticket, user, ActivityType.RESOLUTION, \"Customer confirmed the fix. Ticket resolved.\", false);"},{"type":"DELETE","lineNumber":82,"oldContent":"        } else {"},{"type":"DELETE","lineNumber":85,"oldContent":"            ticket.setStatus(TicketStatus.REOPENED);"},{"type":"DELETE","lineNumber":87,"oldContent":"            // Dr. X's Addition: Create a public log for reopening."},{"type":"DELETE","lineNumber":90,"oldContent":"            activityLogService.createLog(ticket, user, ActivityType.REOPENED, \"Customer reopened the ticket. Rating: \" + dto.getRating() + \" star(s).\", false);"},{"type":"DELETE","lineNumber":92,"oldContent":"        }"},{"type":"DELETE","lineNumber":95,"oldContent":"        Ticket savedTicket = ticketRepo.save(ticket);"},{"type":"DELETE","lineNumber":98,"oldContent":"        return ticketService.mapTicketToDetailDto(savedTicket);"},{"type":"DELETE","lineNumber":100,"oldContent":"    }"},{"type":"DELETE","lineNumber":102,"oldContent":""},{"type":"INSERT","lineNumber":94,"content":"        if (dto.getRating() > 2) {"},{"type":"INSERT","lineNumber":95,"content":"            ticket.setStatus(TicketStatus.RESOLVED);"},{"type":"INSERT","lineNumber":96,"content":"            ticket.setResolvedAt(LocalDateTime.now());"},{"type":"INSERT","lineNumber":97,"content":"            // Dr. X's Addition: Create a public log for resolution."},{"type":"INSERT","lineNumber":98,"content":"            activityLogService.createLog(ticket, user, ActivityType.RESOLUTION, \"Customer confirmed the fix. Ticket resolved.\", false);"},{"type":"INSERT","lineNumber":99,"content":"        } else {"},{"type":"INSERT","lineNumber":100,"content":"            ticket.setStatus(TicketStatus.REOPENED);"},{"type":"INSERT","lineNumber":101,"content":"            // Dr. X's Addition: Create a public log for reopening."},{"type":"INSERT","lineNumber":102,"content":"            activityLogService.createLog(ticket, user, ActivityType.REOPENED, \"Customer reopened the ticket. Rating: \" + dto.getRating() + \" star(s).\", false);"},{"type":"INSERT","lineNumber":103,"content":"        }"},{"type":"INSERT","lineNumber":104,"content":""},{"type":"INSERT","lineNumber":105,"content":"        Ticket savedTicket = ticketRepo.save(ticket);"},{"type":"INSERT","lineNumber":106,"content":"        return ticketService.mapTicketToDetailDto(savedTicket);"},{"type":"INSERT","lineNumber":107,"content":"    }"},{"type":"INSERT","lineNumber":108,"content":""},{"type":"DELETE","lineNumber":112,"oldContent":""},{"type":"INSERT","lineNumber":124,"content":"        return tickets.stream()"},{"type":"INSERT","lineNumber":125,"content":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"INSERT","lineNumber":126,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":127,"content":"    }"},{"type":"DELETE","lineNumber":126,"oldContent":"        return tickets.stream()"},{"type":"DELETE","lineNumber":128,"oldContent":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"DELETE","lineNumber":129,"oldContent":"                .collect(Collectors.toList());"},{"type":"DELETE","lineNumber":131,"oldContent":"    }"}]},{"timestamp":1761899686990,"changes":[{"type":"INSERT","lineNumber":9,"content":"import com.capstone.tele_ticketing_backend_1.repo.TicketActivityRepo;"},{"type":"DELETE","lineNumber":37,"oldContent":""},{"type":"INSERT","lineNumber":39,"content":""},{"type":"INSERT","lineNumber":40,"content":""},{"type":"DELETE","lineNumber":41,"oldContent":""},{"type":"INSERT","lineNumber":57,"content":"                attachment.setFilePath(attUrl);"},{"type":"DELETE","lineNumber":58,"oldContent":"                attachment.setFilePath(attUrl);"},{"type":"DELETE","lineNumber":87,"oldContent":"        if (dto.getRating() > 2) {"},{"type":"INSERT","lineNumber":89,"content":"        feedback.setRating(dto.getRating());"},{"type":"INSERT","lineNumber":90,"content":"        feedback.setComment(dto.getComment());"},{"type":"INSERT","lineNumber":91,"content":"        feedback.setUser(user);"},{"type":"INSERT","lineNumber":92,"content":"        feedback.setTicket(ticket);"},{"type":"INSERT","lineNumber":93,"content":"        ticket.setFeedback(feedback);"},{"type":"INSERT","lineNumber":94,"content":""},{"type":"INSERT","lineNumber":95,"content":"        if (dto.getRating() > 2) {"},{"type":"DELETE","lineNumber":91,"oldContent":"        feedback.setRating(dto.getRating());"},{"type":"DELETE","lineNumber":93,"oldContent":"        feedback.setComment(dto.getComment());"},{"type":"DELETE","lineNumber":96,"oldContent":"        feedback.setUser(user);"},{"type":"DELETE","lineNumber":99,"oldContent":"        feedback.setTicket(ticket);"},{"type":"DELETE","lineNumber":102,"oldContent":"        ticket.setFeedback(feedback);"},{"type":"DELETE","lineNumber":104,"oldContent":""},{"type":"DELETE","lineNumber":106,"oldContent":"    public List<TicketSummaryDto> getCustomerActiveTickets(String username) {"},{"type":"DELETE","lineNumber":108,"oldContent":"        AppUser user = userRepo.findByUsername(username)"},{"type":"INSERT","lineNumber":109,"content":""},{"type":"INSERT","lineNumber":110,"content":"    public List<TicketSummaryDto> getCustomerActiveTickets(String username) {"},{"type":"INSERT","lineNumber":111,"content":"        AppUser user = userRepo.findByUsername(username)"},{"type":"DELETE","lineNumber":112,"oldContent":""},{"type":"INSERT","lineNumber":125,"content":"        return tickets.stream()"},{"type":"INSERT","lineNumber":126,"content":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"INSERT","lineNumber":127,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":128,"content":"    }"},{"type":"DELETE","lineNumber":127,"oldContent":"        return tickets.stream()"},{"type":"DELETE","lineNumber":129,"oldContent":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"DELETE","lineNumber":131,"oldContent":"                .collect(Collectors.toList());"},{"type":"DELETE","lineNumber":132,"oldContent":"    }"}]},{"timestamp":1761899701571,"changes":[{"type":"MODIFY","lineNumber":41,"content":"    @Transactional","oldContent":"    @Transactional"},{"type":"MODIFY","lineNumber":58,"content":"                attachment.setFileName(\"attachment_\" + System.currentTimeMillis());","oldContent":"                attachment.setFileName(\"attachment_\" + System.currentTimeMillis());"},{"type":"DELETE","lineNumber":90,"oldContent":"            ticket.setStatus(TicketStatus.RESOLVED);"},{"type":"DELETE","lineNumber":92,"oldContent":"            ticket.setResolvedAt(LocalDateTime.now());"},{"type":"DELETE","lineNumber":95,"oldContent":"            // Dr. X's Addition: Create a public log for resolution."},{"type":"DELETE","lineNumber":98,"oldContent":"            activityLogService.createLog(ticket, user, ActivityType.RESOLUTION, \"Customer confirmed the fix. Ticket resolved.\", false);"},{"type":"INSERT","lineNumber":96,"content":"            ticket.setStatus(TicketStatus.RESOLVED);"},{"type":"INSERT","lineNumber":97,"content":"            ticket.setResolvedAt(LocalDateTime.now());"},{"type":"INSERT","lineNumber":98,"content":"            // Dr. X's Addition: Create a public log for resolution."},{"type":"INSERT","lineNumber":99,"content":"            activityLogService.createLog(ticket, user, ActivityType.RESOLUTION, \"Customer confirmed the fix. Ticket resolved.\", false);"},{"type":"MODIFY","lineNumber":109,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":112,"content":"                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));","oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));"},{"type":"DELETE","lineNumber":125,"oldContent":""},{"type":"DELETE","lineNumber":127,"oldContent":"    public List<TicketSummaryDto> getCustomerFeedbackTickets(String username) {"},{"type":"MODIFY","lineNumber":129,"content":"","oldContent":"        AppUser user = userRepo.findByUsername(username)"},{"type":"INSERT","lineNumber":130,"content":"    public List<TicketSummaryDto> getCustomerFeedbackTickets(String username) {"},{"type":"INSERT","lineNumber":131,"content":"        AppUser user = userRepo.findByUsername(username)"},{"type":"INSERT","lineNumber":140,"content":""},{"type":"INSERT","lineNumber":141,"content":"    @Transactional(readOnly = true)"},{"type":"INSERT","lineNumber":142,"content":"    public List<NotificationDto> getNotifications(String username) {"},{"type":"INSERT","lineNumber":143,"content":"        AppUser user = userRepo.findByUsername(username)"},{"type":"INSERT","lineNumber":144,"content":"                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));"},{"type":"INSERT","lineNumber":145,"content":""},{"type":"INSERT","lineNumber":146,"content":"        List<TicketActivity> activities = activityRepo.findAllByTicket_CreatedForAndInternalOnlyFalseOrderByCreatedAtDesc(user);"},{"type":"INSERT","lineNumber":147,"content":""},{"type":"INSERT","lineNumber":148,"content":"        return activities.stream()"},{"type":"INSERT","lineNumber":149,"content":"                .map(activity -> new NotificationDto("},{"type":"INSERT","lineNumber":150,"content":"                        activity.getId(),"},{"type":"INSERT","lineNumber":151,"content":"                        activity.getTicket().getTicketUid(),"},{"type":"INSERT","lineNumber":152,"content":"                        activity.getTicket().getTitle(),"},{"type":"INSERT","lineNumber":153,"content":"                        activity.getDescription(),"},{"type":"INSERT","lineNumber":154,"content":"                        activity.getActivityType().name(),"},{"type":"INSERT","lineNumber":155,"content":"                        activity.getCreatedAt()"},{"type":"INSERT","lineNumber":156,"content":"                ))"},{"type":"INSERT","lineNumber":157,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":158,"content":"    }"}]},{"timestamp":1761899705762,"changes":[{"type":"DELETE","lineNumber":3,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.CreateTicketRequestDto;"},{"type":"DELETE","lineNumber":4,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.FeedbackRequestDto;"},{"type":"DELETE","lineNumber":5,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;"},{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.dto.*;"},{"type":"DELETE","lineNumber":15,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;"},{"type":"INSERT","lineNumber":37,"content":""},{"type":"DELETE","lineNumber":41,"oldContent":"    @Transactional"},{"type":"INSERT","lineNumber":54,"content":"                attachment.setFilePath(attUrl);"},{"type":"DELETE","lineNumber":58,"oldContent":"                attachment.setFileName(\"attachment_\" + System.currentTimeMillis());"},{"type":"DELETE","lineNumber":93,"oldContent":"            ticket.setStatus(TicketStatus.RESOLVED);"},{"type":"DELETE","lineNumber":95,"oldContent":"            ticket.setResolvedAt(LocalDateTime.now());"},{"type":"INSERT","lineNumber":92,"content":"        if (dto.getRating() > 2) {"},{"type":"INSERT","lineNumber":93,"content":"            ticket.setStatus(TicketStatus.RESOLVED);"},{"type":"INSERT","lineNumber":94,"content":"            ticket.setResolvedAt(LocalDateTime.now());"},{"type":"DELETE","lineNumber":99,"oldContent":"        if (dto.getRating() > 2) {"},{"type":"INSERT","lineNumber":105,"content":"    }"},{"type":"DELETE","lineNumber":109,"oldContent":""},{"type":"INSERT","lineNumber":108,"content":"        AppUser user = userRepo.findByUsername(username)"},{"type":"DELETE","lineNumber":112,"oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));"},{"type":"INSERT","lineNumber":124,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":125,"content":"    }"},{"type":"DELETE","lineNumber":129,"oldContent":"                .collect(Collectors.toList());"},{"type":"DELETE","lineNumber":131,"oldContent":"    }"},{"type":"DELETE","lineNumber":141,"oldContent":"}"},{"type":"DELETE","lineNumber":143,"oldContent":"    }"},{"type":"DELETE","lineNumber":145,"oldContent":"                .collect(Collectors.toList());"},{"type":"DELETE","lineNumber":147,"oldContent":"                ))"},{"type":"DELETE","lineNumber":149,"oldContent":"                        activity.getCreatedAt()"},{"type":"DELETE","lineNumber":151,"oldContent":"                        activity.getActivityType().name(),"},{"type":"DELETE","lineNumber":153,"oldContent":"                        activity.getDescription(),"},{"type":"DELETE","lineNumber":155,"oldContent":"                        activity.getTicket().getTitle(),"},{"type":"DELETE","lineNumber":157,"oldContent":"                        activity.getTicket().getTicketUid(),"},{"type":"INSERT","lineNumber":148,"content":"                        activity.getTicket().getTicketUid(),"},{"type":"INSERT","lineNumber":149,"content":"                        activity.getTicket().getTitle(),"},{"type":"INSERT","lineNumber":150,"content":"                        activity.getDescription(),"},{"type":"INSERT","lineNumber":151,"content":"                        activity.getActivityType().name(),"},{"type":"INSERT","lineNumber":152,"content":"                        activity.getCreatedAt()"},{"type":"INSERT","lineNumber":153,"content":"                ))"},{"type":"INSERT","lineNumber":154,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":155,"content":"    }"},{"type":"INSERT","lineNumber":156,"content":"}"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/CustomerController.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/CustomerController.java","baseContent":"package com.capstone.tele_ticketing_backend_1.controller;\n\n// File: com/capstone/tele_ticketing_backend_1/controller/CustomerController.java\npackage com.capstone.tele_ticketing_backend_1.controller;\n\nimport com.capstone.tele_ticketing_backend_1.dtos.CreateTicketRequestDto;\nimport com.capstone.tele_ticketing_backend_1.dtos.FeedbackRequestDto;\nimport com.capstone.tele_ticketing_backend_1.dtos.TicketSummaryDto;\nimport com.capstone.tele_ticketing_backend_1.entities.Ticket;\nimport com.capstone.tele_ticketing_backend_1.service.CustomerTicketService;\nimport jakarta.validation.Valid;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.HttpStatus;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.security.access.prepost.PreAuthorize;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.web.bind.annotation.*;\n\nimport java.util.List;\n\n@RestController\n@RequestMapping(\"/api/v1/customer\")\n@PreAuthorize(\"hasRole('CUSTOMER')\") // Dr. X's Note: Secures all endpoints in this controller.\npublic class CustomerController {\n\n    @Autowired\n    private CustomerTicketService customerTicketService;\n\n    @PostMapping(\"/tickets\")\n    public ResponseEntity<Ticket> createTicket(@Valid @RequestBody CreateTicketRequestDto createTicketRequestDto) {\n        String username = SecurityContextHolder.getContext().getAuthentication().getName();\n        Ticket createdTicket = customerTicketService.createTicket(createTicketRequestDto, username);\n        return new ResponseEntity<>(createdTicket, HttpStatus.CREATED);\n    }\n\n    @GetMapping(\"/tickets/active\")\n    public ResponseEntity<List<TicketSummaryDto>> getActiveTickets() {\n        String username = SecurityContextHolder.getContext().getAuthentication().getName();\n        List<TicketSummaryDto> tickets = customerTicketService.getCustomerActiveTickets(username);\n        return ResponseEntity.ok(tickets);\n    }\n\n    @GetMapping(\"/tickets/feedback-pending\")\n    public ResponseEntity<List<TicketSummaryDto>> getFeedbackPendingTickets() {\n        String username = SecurityContextHolder.getContext().getAuthentication().getName();\n        List<TicketSummaryDto> tickets = customerTicketService.getCustomerFeedbackTickets(username);\n        return ResponseEntity.ok(tickets);\n    }\n\n    @PostMapping(\"/tickets/{id}/feedback\")\n    public ResponseEntity<Ticket> addFeedback(@PathVariable Long id, @Valid @RequestBody FeedbackRequestDto feedbackRequestDto) {\n        String username = SecurityContextHolder.getContext().getAuthentication().getName();\n        Ticket updatedTicket = customerTicketService.addFeedback(id, feedbackRequestDto, username);\n        return ResponseEntity.ok(updatedTicket);\n    }\n}\n","baseTimestamp":1761780417834,"deltas":[{"timestamp":1761780422645,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"// File: com/capstone/tele_ticketing_backend_1/controller/CustomerController.java"},{"type":"DELETE","lineNumber":3,"oldContent":"package com.capstone.tele_ticketing_backend_1.controller;"}]},{"timestamp":1761780428963,"changes":[{"type":"DELETE","lineNumber":3,"oldContent":"import com.capstone.tele_ticketing_backend_1.dtos.CreateTicketRequestDto;"},{"type":"DELETE","lineNumber":4,"oldContent":"import com.capstone.tele_ticketing_backend_1.dtos.FeedbackRequestDto;"},{"type":"DELETE","lineNumber":5,"oldContent":"import com.capstone.tele_ticketing_backend_1.dtos.TicketSummaryDto;"},{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.dto.CreateTicketRequestDto;"},{"type":"INSERT","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.dto.FeedbackRequestDto;"},{"type":"INSERT","lineNumber":5,"content":"import com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;"}]},{"timestamp":1761780465017,"changes":[{"type":"MODIFY","lineNumber":20,"content":"@PreAuthorize(\"hasRole('CUSTOMER')\")","oldContent":"@PreAuthorize(\"hasRole('CUSTOMER')\") // Dr. X's Note: Secures all endpoints in this controller."},{"type":"INSERT","lineNumber":21,"content":"@CrossOrigin(origins = \"*\", maxAge = 3600) // Dr. X's Note: Secures all endpoints in this controller."}]},{"timestamp":1761780603598,"changes":[{"type":"DELETE","lineNumber":20,"oldContent":"@PreAuthorize(\"hasRole('CUSTOMER')\")"}]},{"timestamp":1761887582728,"changes":[{"type":"INSERT","lineNumber":16,"content":"import com.capstone.tele_ticketing_backend_1.dto.CreateTicketRequestDto;"},{"type":"INSERT","lineNumber":17,"content":"import com.capstone.tele_ticketing_backend_1.dto.FeedbackRequestDto;"},{"type":"INSERT","lineNumber":18,"content":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto; // Import DTO"},{"type":"INSERT","lineNumber":19,"content":"import com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;"},{"type":"INSERT","lineNumber":20,"content":"import com.capstone.tele_ticketing_backend_1.entities.Ticket;"},{"type":"INSERT","lineNumber":21,"content":"import com.capstone.tele_ticketing_backend_1.service.CustomerTicketService;"},{"type":"INSERT","lineNumber":22,"content":""}]},{"timestamp":1761887613250,"changes":[{"type":"DELETE","lineNumber":17,"oldContent":"import java.util.List;"},{"type":"DELETE","lineNumber":19,"oldContent":""},{"type":"DELETE","lineNumber":21,"oldContent":"@RestController"},{"type":"DELETE","lineNumber":23,"oldContent":"@RequestMapping(\"/api/v1/customer\")"},{"type":"DELETE","lineNumber":25,"oldContent":"@CrossOrigin(origins = \"*\", maxAge = 3600) // Dr. X's Note: Secures all endpoints in this controller."},{"type":"DELETE","lineNumber":27,"oldContent":"public class CustomerController {"},{"type":"INSERT","lineNumber":23,"content":"import java.util.List;"},{"type":"INSERT","lineNumber":25,"content":"@RestController"},{"type":"INSERT","lineNumber":26,"content":"@RequestMapping(\"/api/v1/customer\")"},{"type":"INSERT","lineNumber":27,"content":"@CrossOrigin(origins = \"*\", maxAge = 3600) // Dr. X's Note: Secures all endpoints in this controller."},{"type":"INSERT","lineNumber":28,"content":"public class CustomerController {"},{"type":"INSERT","lineNumber":29,"content":""},{"type":"MODIFY","lineNumber":55,"content":"    public ResponseEntity<TicketDetailDto> addFeedback(@PathVariable Long id, @Valid @RequestBody FeedbackRequestDto feedbackRequestDto) {","oldContent":"    public ResponseEntity<Ticket> addFeedback(@PathVariable Long id, @Valid @RequestBody FeedbackRequestDto feedbackRequestDto) {"},{"type":"MODIFY","lineNumber":57,"content":"","oldContent":"        Ticket updatedTicket = customerTicketService.addFeedback(id, feedbackRequestDto, username);"},{"type":"INSERT","lineNumber":58,"content":"        // The service now returns a safe DTO object."},{"type":"INSERT","lineNumber":59,"content":"        TicketDetailDto updatedTicket = customerTicketService.addFeedback(id, feedbackRequestDto, username);"},{"type":"INSERT","lineNumber":60,"content":""}]},{"timestamp":1761887647797,"changes":[{"type":"DELETE","lineNumber":18,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto; // Import DTO"},{"type":"MODIFY","lineNumber":18,"content":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;","oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;"},{"type":"INSERT","lineNumber":19,"content":""},{"type":"MODIFY","lineNumber":21,"content":"","oldContent":"import com.capstone.tele_ticketing_backend_1.entities.Ticket;"},{"type":"DELETE","lineNumber":24,"oldContent":"import com.capstone.tele_ticketing_backend_1.service.CustomerTicketService;"},{"type":"DELETE","lineNumber":28,"oldContent":""},{"type":"DELETE","lineNumber":29,"oldContent":""},{"type":"DELETE","lineNumber":59,"oldContent":"        return ResponseEntity.ok(updatedTicket);"},{"type":"DELETE","lineNumber":61,"oldContent":"    }"},{"type":"INSERT","lineNumber":58,"content":"        return ResponseEntity.ok(updatedTicket);"},{"type":"INSERT","lineNumber":59,"content":"    }"}]},{"timestamp":1761887651406,"changes":[{"type":"DELETE","lineNumber":15,"oldContent":""},{"type":"DELETE","lineNumber":16,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.CreateTicketRequestDto;"},{"type":"DELETE","lineNumber":17,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.FeedbackRequestDto;"},{"type":"DELETE","lineNumber":19,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;"},{"type":"INSERT","lineNumber":16,"content":""},{"type":"DELETE","lineNumber":55,"oldContent":"        return ResponseEntity.ok(updatedTicket);"},{"type":"DELETE","lineNumber":57,"oldContent":"    }"},{"type":"INSERT","lineNumber":55,"content":"        return ResponseEntity.ok(updatedTicket);"},{"type":"INSERT","lineNumber":56,"content":"    }"}]},{"timestamp":1761887654085,"changes":[{"type":"DELETE","lineNumber":12,"oldContent":"import org.springframework.security.access.prepost.PreAuthorize;"},{"type":"MODIFY","lineNumber":15,"content":"","oldContent":""},{"type":"DELETE","lineNumber":52,"oldContent":"        return ResponseEntity.ok(updatedTicket);"},{"type":"DELETE","lineNumber":53,"oldContent":"    }"},{"type":"INSERT","lineNumber":54,"content":"        return ResponseEntity.ok(updatedTicket);"},{"type":"INSERT","lineNumber":55,"content":"    }"}]},{"timestamp":1761893515558,"changes":[{"type":"MODIFY","lineNumber":15,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":29,"content":"        TicketDetailDto createdTicket = customerTicketService.createTicket(createTicketRequestDto, username);","oldContent":"        Ticket createdTicket = customerTicketService.createTicket(createTicketRequestDto, username);"},{"type":"DELETE","lineNumber":51,"oldContent":"        return ResponseEntity.ok(updatedTicket);"},{"type":"DELETE","lineNumber":53,"oldContent":"    }"},{"type":"INSERT","lineNumber":54,"content":"        return ResponseEntity.ok(updatedTicket);"},{"type":"INSERT","lineNumber":55,"content":"    }"}]},{"timestamp":1761893521779,"changes":[{"type":"INSERT","lineNumber":14,"content":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;"},{"type":"DELETE","lineNumber":15,"oldContent":""},{"type":"MODIFY","lineNumber":27,"content":"    public ResponseEntity<TicketDetailDto> createTicket(@Valid @RequestBody CreateTicketRequestDto createTicketRequestDto) {","oldContent":"    public ResponseEntity<Ticket> createTicket(@Valid @RequestBody CreateTicketRequestDto createTicketRequestDto) {"},{"type":"DELETE","lineNumber":52,"oldContent":"        return ResponseEntity.ok(updatedTicket);"},{"type":"MODIFY","lineNumber":54,"content":"        return ResponseEntity.ok(updatedTicket);","oldContent":"    }"},{"type":"INSERT","lineNumber":55,"content":"    }"}]},{"timestamp":1761893574520,"changes":[{"type":"DELETE","lineNumber":6,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.Ticket;"},{"type":"INSERT","lineNumber":52,"content":""},{"type":"DELETE","lineNumber":55,"oldContent":""}]},{"timestamp":1761899726279,"changes":[{"type":"MODIFY","lineNumber":52,"content":"","oldContent":""},{"type":"INSERT","lineNumber":55,"content":""},{"type":"INSERT","lineNumber":56,"content":"    "}]},{"timestamp":1761899932201,"changes":[{"type":"INSERT","lineNumber":51,"content":"        TicketDetailDto updatedTicket = customerTicketService.addFeedback(id, feedbackRequestDto, username);"},{"type":"DELETE","lineNumber":52,"oldContent":""},{"type":"MODIFY","lineNumber":56,"content":"    @GetMapping(\"/notifications\")","oldContent":"}"},{"type":"INSERT","lineNumber":57,"content":"    public ResponseEntity<List<NotificationDto>> getNotifications() {"},{"type":"INSERT","lineNumber":58,"content":"        String username = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"INSERT","lineNumber":59,"content":"        return ResponseEntity.ok(customerTicketService.getNotifications(username));"},{"type":"INSERT","lineNumber":60,"content":"    }"},{"type":"INSERT","lineNumber":61,"content":""},{"type":"INSERT","lineNumber":63,"content":"}"}]},{"timestamp":1761899936743,"changes":[{"type":"DELETE","lineNumber":3,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.CreateTicketRequestDto;"},{"type":"DELETE","lineNumber":4,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.FeedbackRequestDto;"},{"type":"DELETE","lineNumber":5,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;"},{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.dto.*;"},{"type":"DELETE","lineNumber":13,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;"},{"type":"DELETE","lineNumber":58,"oldContent":"    "},{"type":"DELETE","lineNumber":60,"oldContent":""},{"type":"DELETE","lineNumber":62,"oldContent":"}"},{"type":"INSERT","lineNumber":59,"content":""},{"type":"INSERT","lineNumber":60,"content":"}"},{"type":"INSERT","lineNumber":61,"content":""}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/config/WebSecurityConfig.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/config/WebSecurityConfig.java","baseContent":"package com.capstone.tele_ticketing_backend_1.security.config;\n\n\nimport com.capstone.tele_ticketing_backend_1.security.jwt.AuthEntryPointJwt;\nimport com.capstone.tele_ticketing_backend_1.security.jwt.AuthTokenFilter;\nimport com.capstone.tele_ticketing_backend_1.security.service.UserDetailsServiceImpl;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.authentication.AuthenticationManager;\nimport org.springframework.security.authentication.dao.DaoAuthenticationProvider;\nimport org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;\nimport org.springframework.security.config.http.SessionCreationPolicy;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.security.web.SecurityFilterChain;\nimport org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;\n\n@Configuration\n@EnableWebSecurity \npublic class WebSecurityConfig { \n\t@Autowired\n\tprivate UserDetailsServiceImpl userDetailsService;\n\n\t@Autowired\n\tprivate AuthEntryPointJwt unauthorizedHandler;\n\n\t@Bean\n\tpublic AuthTokenFilter authenticationJwtTokenFilter() {\n\t\treturn new AuthTokenFilter();\n\t}\n\n\n\n\t@Bean\n\tpublic DaoAuthenticationProvider authenticationProvider() {\n\t\tDaoAuthenticationProvider authProvider = new DaoAuthenticationProvider();\n\n\t\tauthProvider.setUserDetailsService(userDetailsService);\n\t\tauthProvider.setPasswordEncoder(passwordEncoder());\n\n\t\treturn authProvider;\n\t}\n\n\t@Bean\n\tpublic AuthenticationManager authenticationManager(AuthenticationConfiguration authConfig) throws Exception {\n\t\treturn authConfig.getAuthenticationManager();\n\t}\n\n\t@Bean\n\tpublic PasswordEncoder passwordEncoder() {\n\t\treturn new BCryptPasswordEncoder();\n\t}\n\n\tpublic final static String[] PUBLIC_REQUEST_MATCHERS = { \"/api/test/all\",\"/api/auth/**\", \"/api-docs/**\", \"/swagger-ui/**\",\"/v3/api-docs/**\" };\n\n\t@Bean\n\tpublic SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n\t\t//http.cors(AbstractHttpConfigurer :: disable).csrf(AbstractHttpConfigurer::disable)\n\t\thttp.csrf(AbstractHttpConfigurer::disable)\n\t\t\t\t.authorizeHttpRequests(req -> req.requestMatchers(PUBLIC_REQUEST_MATCHERS).permitAll()\n\t\t\t\t\t\t//.requestMatchers(\"/api/toyandbooklibapp/**\").permitAll())\n\t\t\t\t\t\t\t\t.requestMatchers(\"/greet\").hasRole(\"CUSTOMER\")\n\t\t\t\t\t\t.requestMatchers(\"/api/test/user\").hasRole(\"USER\")\n\t\t\t\t\t\t.requestMatchers(\"/api/test/parent\").hasRole(\"PARENT\")\n\t\t\t\t\t\t.requestMatchers(\"/api/test/admin\").hasRole(\"ADMIN\")\n\t\t\t\t\t\t)\n\t\t\t\t\n\t\t\t\t\t\t//.anyRequest().authenticated())http://localhost:8080/api/test/\n\t\t\t\t.exceptionHandling(exception -> exception.authenticationEntryPoint(unauthorizedHandler))\n\t\t\t\t.sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))\n\t\t\t\t.authenticationProvider(authenticationProvider())\n\t\t\t\t.addFilterBefore(authenticationJwtTokenFilter(), UsernamePasswordAuthenticationFilter.class);\n\t\treturn http.build();\n\t}\n}","baseTimestamp":1761780627423,"deltas":[{"timestamp":1761815599497,"changes":[{"type":"MODIFY","lineNumber":63,"content":"\tpublic final static String[] PUBLIC_REQUEST_MATCHERS = { \"/api/test/all\",\"/api/v1/auth/**\", \"/api-docs/**\", \"/swagger-ui/**\",\"/v3/api-docs/**\" };","oldContent":"\tpublic final static String[] PUBLIC_REQUEST_MATCHERS = { \"/api/test/all\",\"/api/auth/**\", \"/api-docs/**\", \"/swagger-ui/**\",\"/v3/api-docs/**\" };"},{"type":"MODIFY","lineNumber":69,"content":"\t\t\t\thttp.csrf(AbstractHttpConfigurer::disable)","oldContent":"\t\t\t\t.csrf(AbstractHttpConfigurer::disable)"}]},{"timestamp":1761815638572,"changes":[{"type":"DELETE","lineNumber":86,"oldContent":"\t\t\t\t.exceptionHandling(exception -> exception.authenticationEntryPoint(unauthorizedHandler))"},{"type":"DELETE","lineNumber":87,"oldContent":"\t\t\t\t.sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))"},{"type":"DELETE","lineNumber":88,"oldContent":"\t\t\t\t.authenticationProvider(authenticationProvider())"},{"type":"DELETE","lineNumber":89,"oldContent":"\t\t\t\t.addFilterBefore(authenticationJwtTokenFilter(), UsernamePasswordAuthenticationFilter.class);"},{"type":"INSERT","lineNumber":86,"content":"\t\t\t\t\t\t.exceptionHandling(exception -> exception.authenticationEntryPoint(unauthorizedHandler))"},{"type":"INSERT","lineNumber":87,"content":"\t\t\t\t\t\t.sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))"},{"type":"INSERT","lineNumber":88,"content":"\t\t\t\t\t\t.authenticationProvider(authenticationProvider())"},{"type":"INSERT","lineNumber":89,"content":"\t\t\t\t\t\t.addFilterBefore(authenticationJwtTokenFilter(), UsernamePasswordAuthenticationFilter.class);"}]},{"timestamp":1761815664863,"changes":[{"type":"MODIFY","lineNumber":68,"content":"\t\thttp.cors(cors -> cors.configurationSource(corsConfigurationSource())","oldContent":"\t\thttp.cors(cors -> cors.configurationSource(corsConfigurationSource());"}]},{"timestamp":1761815674118,"changes":[{"type":"DELETE","lineNumber":20,"oldContent":""},{"type":"DELETE","lineNumber":21,"oldContent":"@EnableWebSecurity "},{"type":"INSERT","lineNumber":20,"content":"import org.springframework.web.cors.CorsConfiguration;"},{"type":"INSERT","lineNumber":21,"content":"import org.springframework.web.cors.CorsConfigurationSource;"},{"type":"INSERT","lineNumber":28,"content":"@EnableWebSecurity "},{"type":"INSERT","lineNumber":29,"content":"public class WebSecurityConfig { "},{"type":"INSERT","lineNumber":30,"content":"\t@Autowired"},{"type":"DELETE","lineNumber":60,"oldContent":"\tpublic final static String[] PUBLIC_REQUEST_MATCHERS = { \"/api/test/all\",\"/api/auth/**\", \"/api-docs/**\", \"/swagger-ui/**\",\"/v3/api-docs/**\" };"},{"type":"DELETE","lineNumber":61,"oldContent":""},{"type":"DELETE","lineNumber":62,"oldContent":"\t@Bean"},{"type":"MODIFY","lineNumber":64,"content":"","oldContent":"\t\t//http.cors(AbstractHttpConfigurer :: disable).csrf(AbstractHttpConfigurer::disable)"},{"type":"DELETE","lineNumber":66,"oldContent":"\t\thttp.csrf(AbstractHttpConfigurer::disable)"},{"type":"DELETE","lineNumber":67,"oldContent":"\t\t\t\t.authorizeHttpRequests(req -> req.requestMatchers(PUBLIC_REQUEST_MATCHERS).permitAll()"},{"type":"DELETE","lineNumber":68,"oldContent":"\t\thttp.cors(cors -> cors.configurationSource(corsConfigurationSource())"},{"type":"INSERT","lineNumber":66,"content":"\t@Bean"},{"type":"INSERT","lineNumber":67,"content":"\tpublic SecurityFilterChain filterChain(HttpSecurity http) throws Exception {"},{"type":"INSERT","lineNumber":68,"content":"\t\thttp.cors(cors -> cors.configurationSource(corsConfigurationSource()))"},{"type":"MODIFY","lineNumber":98,"content":"\t\tconfiguration.setAllowedOrigins(List.of(\"http://localhost:8080\"));","oldContent":"}"},{"type":"DELETE","lineNumber":109,"oldContent":"}"},{"type":"DELETE","lineNumber":110,"oldContent":"\t}"},{"type":"INSERT","lineNumber":109,"content":""},{"type":"INSERT","lineNumber":110,"content":"\t\tUrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();"},{"type":"INSERT","lineNumber":112,"content":"\t\treturn source;"}]},{"timestamp":1761815678145,"changes":[{"type":"MODIFY","lineNumber":23,"content":"","oldContent":"@EnableWebSecurity "},{"type":"DELETE","lineNumber":29,"oldContent":"\tprivate UserDetailsServiceImpl userDetailsService;"},{"type":"INSERT","lineNumber":30,"content":"\t@Autowired"},{"type":"INSERT","lineNumber":31,"content":"\tprivate UserDetailsServiceImpl userDetailsService;"},{"type":"DELETE","lineNumber":33,"oldContent":"\t@Autowired"},{"type":"MODIFY","lineNumber":69,"content":"\t\t\t\t.csrf(AbstractHttpConfigurer::disable)","oldContent":"\t\t\t\thttp.csrf(AbstractHttpConfigurer::disable)"}]},{"timestamp":1761856821249,"changes":[{"type":"MODIFY","lineNumber":22,"content":"import org.springframework.web.cors.UrlBasedCorsConfigurationSource;","oldContent":"@EnableWebSecurity "},{"type":"MODIFY","lineNumber":30,"content":"\t@Autowired","oldContent":"\t@Autowired"},{"type":"INSERT","lineNumber":77,"content":"\t\t\t\t\t\t.requestMatchers(\"/api/v1/triage/**\").hasRole(\"TRIAGE_OFFICER\")"},{"type":"DELETE","lineNumber":93,"oldContent":"\t\t// Rule 3: THIS IS THE MOST IMPORTANT PART."},{"type":"INSERT","lineNumber":94,"content":"\t@Bean"},{"type":"INSERT","lineNumber":95,"content":"\tCorsConfigurationSource corsConfigurationSource() {"},{"type":"INSERT","lineNumber":96,"content":"\t\tCorsConfiguration configuration = new CorsConfiguration();"},{"type":"DELETE","lineNumber":95,"oldContent":"\t\tconfiguration.setAllowedMethods(Arrays.asList(\"GET\", \"POST\", \"PUT\", \"PATCH\", \"DELETE\", \"OPTIONS\"));"},{"type":"DELETE","lineNumber":96,"oldContent":"\t\t// Rule 2: Allow standard HTTP methods."},{"type":"DELETE","lineNumber":97,"oldContent":""},{"type":"INSERT","lineNumber":98,"content":"\t\t// Rule 1: Allow requests from your React app's origin."},{"type":"DELETE","lineNumber":100,"oldContent":"\t\t// You must explicitly allow the 'Authorization' and 'Content-Type' headers."},{"type":"INSERT","lineNumber":101,"content":"\t\t// Rule 2: Allow standard HTTP methods."},{"type":"INSERT","lineNumber":102,"content":"\t\tconfiguration.setAllowedMethods(Arrays.asList(\"GET\", \"POST\", \"PUT\", \"PATCH\", \"DELETE\", \"OPTIONS\"));"},{"type":"INSERT","lineNumber":103,"content":""},{"type":"DELETE","lineNumber":103,"oldContent":"}"},{"type":"INSERT","lineNumber":106,"content":"\t\tconfiguration.setAllowedHeaders(Arrays.asList(\"Authorization\", \"Content-Type\", \"X-Requested-With\"));"},{"type":"INSERT","lineNumber":107,"content":""},{"type":"INSERT","lineNumber":108,"content":"\t\t// Rule 4: Allow credentials (cookies, etc.) if needed in the future."},{"type":"INSERT","lineNumber":109,"content":"\t\tconfiguration.setAllowCredentials(true);"},{"type":"INSERT","lineNumber":110,"content":""},{"type":"INSERT","lineNumber":111,"content":"\t\tUrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();"},{"type":"INSERT","lineNumber":112,"content":"\t\tsource.registerCorsConfiguration(\"/**\", configuration); // Apply this configuration to all paths."},{"type":"INSERT","lineNumber":113,"content":"\t\treturn source;"},{"type":"DELETE","lineNumber":106,"oldContent":"\t}"},{"type":"DELETE","lineNumber":107,"oldContent":"}"},{"type":"DELETE","lineNumber":108,"oldContent":"\t\treturn source;"},{"type":"DELETE","lineNumber":109,"oldContent":""}]},{"timestamp":1761858187622,"changes":[{"type":"INSERT","lineNumber":29,"content":"public class WebSecurityConfig { "},{"type":"DELETE","lineNumber":30,"oldContent":"\t@Autowired"},{"type":"INSERT","lineNumber":78,"content":"\t\t\t\t\t\t.requestMatchers(\"/api/v1/engineer/**\").hasAnyRole(\"L1_ENGINEER\", \"NOC_ENGINEER\", \"FIELD_ENGINEER\")"},{"type":"INSERT","lineNumber":79,"content":"\t\t\t\t\t\t.requestMatchers(\"/api/v1/users/engineers\").hasRole(\"TRIAGE_OFFICER\")"},{"type":"DELETE","lineNumber":95,"oldContent":"\t\t// You must explicitly allow the 'Authorization' and 'Content-Type' headers."},{"type":"INSERT","lineNumber":99,"content":""},{"type":"DELETE","lineNumber":100,"oldContent":"}"},{"type":"INSERT","lineNumber":102,"content":""},{"type":"DELETE","lineNumber":102,"oldContent":"\t\tUrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();"},{"type":"DELETE","lineNumber":105,"oldContent":""},{"type":"DELETE","lineNumber":106,"oldContent":"\t\tsource.registerCorsConfiguration(\"/**\", configuration); // Apply this configuration to all paths."},{"type":"DELETE","lineNumber":107,"oldContent":"\t\tUrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();"},{"type":"INSERT","lineNumber":106,"content":"\t\t// Rule 3: THIS IS THE MOST IMPORTANT PART."},{"type":"INSERT","lineNumber":107,"content":"\t\t// You must explicitly allow the 'Authorization' and 'Content-Type' headers."},{"type":"INSERT","lineNumber":111,"content":"\t\tconfiguration.setAllowCredentials(true);"},{"type":"INSERT","lineNumber":112,"content":""},{"type":"INSERT","lineNumber":113,"content":"\t\tUrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();"},{"type":"INSERT","lineNumber":114,"content":"\t\tsource.registerCorsConfiguration(\"/**\", configuration); // Apply this configuration to all paths."},{"type":"INSERT","lineNumber":115,"content":"\t\treturn source;"},{"type":"INSERT","lineNumber":116,"content":"\t}"},{"type":"INSERT","lineNumber":117,"content":"}"}]},{"timestamp":1761862739773,"changes":[{"type":"MODIFY","lineNumber":25,"content":"import java.util.List;","oldContent":"\t@Autowired"},{"type":"MODIFY","lineNumber":32,"content":"","oldContent":"\tprivate AuthEntryPointJwt unauthorizedHandler;"},{"type":"INSERT","lineNumber":34,"content":"\tprivate AuthEntryPointJwt unauthorizedHandler;"},{"type":"INSERT","lineNumber":35,"content":""},{"type":"DELETE","lineNumber":61,"oldContent":"\tpublic final static String[] PUBLIC_REQUEST_MATCHERS = { \"/api/test/all\",\"/api/auth/**\", \"/api-docs/**\", \"/swagger-ui/**\",\"/v3/api-docs/**\" };"},{"type":"DELETE","lineNumber":62,"oldContent":""},{"type":"DELETE","lineNumber":79,"oldContent":""},{"type":"INSERT","lineNumber":80,"content":"\t\t\t\t\t\t.requestMatchers(\"/api/v1/tickets/**\").authenticated()"},{"type":"INSERT","lineNumber":81,"content":""},{"type":"INSERT","lineNumber":100,"content":""},{"type":"INSERT","lineNumber":102,"content":"\t\tconfiguration.setAllowedOrigins(List.of(\"http://localhost:8080\"));"},{"type":"DELETE","lineNumber":101,"oldContent":"\t\treturn source;"},{"type":"DELETE","lineNumber":103,"oldContent":""},{"type":"DELETE","lineNumber":105,"oldContent":"\t\tconfiguration.setAllowCredentials(true);"},{"type":"INSERT","lineNumber":106,"content":""},{"type":"DELETE","lineNumber":108,"oldContent":"}"},{"type":"DELETE","lineNumber":109,"oldContent":"\t}"},{"type":"DELETE","lineNumber":110,"oldContent":"\t\treturn source;"},{"type":"INSERT","lineNumber":109,"content":"\t\tconfiguration.setAllowedHeaders(Arrays.asList(\"Authorization\", \"Content-Type\", \"X-Requested-With\"));"},{"type":"INSERT","lineNumber":110,"content":""},{"type":"INSERT","lineNumber":111,"content":"\t\t// Rule 4: Allow credentials (cookies, etc.) if needed in the future."},{"type":"DELETE","lineNumber":112,"oldContent":"\t\tsource.registerCorsConfiguration(\"/**\", configuration); // Apply this configuration to all paths."},{"type":"INSERT","lineNumber":115,"content":"\t\tsource.registerCorsConfiguration(\"/**\", configuration); // Apply this configuration to all paths."},{"type":"INSERT","lineNumber":116,"content":"\t\treturn source;"},{"type":"INSERT","lineNumber":117,"content":"\t}"},{"type":"INSERT","lineNumber":118,"content":"}"}]},{"timestamp":1761909461288,"changes":[{"type":"MODIFY","lineNumber":24,"content":"import java.util.Arrays;","oldContent":"\t@Autowired"},{"type":"MODIFY","lineNumber":27,"content":"@Configuration","oldContent":"\t@Autowired"},{"type":"DELETE","lineNumber":35,"oldContent":"\tpublic AuthTokenFilter authenticationJwtTokenFilter() {"},{"type":"INSERT","lineNumber":36,"content":"\t@Bean"},{"type":"INSERT","lineNumber":37,"content":"\tpublic AuthTokenFilter authenticationJwtTokenFilter() {"},{"type":"DELETE","lineNumber":62,"oldContent":"\tpublic final static String[] PUBLIC_REQUEST_MATCHERS = { \"/api/test/all\",\"/api/auth/**\", \"/api-docs/**\", \"/swagger-ui/**\",\"/v3/api-docs/**\" };"},{"type":"MODIFY","lineNumber":80,"content":"\t\t\t\t\t\t.requestMatchers(\"/api/v1/tickets/**\").authenticated()","oldContent":"\t\t\t\t\t\t.requestMatchers(\"/api/v1/tickets/**\").authenticated()"},{"type":"INSERT","lineNumber":81,"content":"\t\t\t\t\t\t"},{"type":"INSERT","lineNumber":95,"content":""},{"type":"DELETE","lineNumber":95,"oldContent":"}"},{"type":"DELETE","lineNumber":96,"oldContent":"\t\treturn source;"},{"type":"INSERT","lineNumber":97,"content":"\t}"},{"type":"DELETE","lineNumber":100,"oldContent":"\t\t// Rule 1: Allow requests from your React app's origin."},{"type":"MODIFY","lineNumber":102,"content":"\t\t// Rule 1: Allow requests from your React app's origin.","oldContent":""},{"type":"INSERT","lineNumber":104,"content":""},{"type":"DELETE","lineNumber":113,"oldContent":"}"},{"type":"MODIFY","lineNumber":114,"content":"","oldContent":"\t}"},{"type":"INSERT","lineNumber":115,"content":"\t\tUrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();"},{"type":"INSERT","lineNumber":118,"content":"\t}"},{"type":"INSERT","lineNumber":119,"content":"}"}]},{"timestamp":1761909464191,"changes":[{"type":"MODIFY","lineNumber":36,"content":"\t@Bean","oldContent":"\t@Bean"},{"type":"INSERT","lineNumber":79,"content":"\t\t\t\t\t\t.requestMatchers(\"/api/v1/users/engineers\").hasRole(\"TRIAGE_OFFICER\")"},{"type":"DELETE","lineNumber":80,"oldContent":"\t\t\t\t\t\t.requestMatchers(\"/api/v1/tickets/**\").authenticated()"},{"type":"MODIFY","lineNumber":81,"content":"\t\t\t\t\t\t.requestMatchers(\"/api/v1/users/customers\").hasRole(\"AGENT\")","oldContent":"\t\t\t\t\t\t"},{"type":"MODIFY","lineNumber":96,"content":"\t\treturn http.build();","oldContent":"\t\treturn source;"},{"type":"MODIFY","lineNumber":113,"content":"\t\tconfiguration.setAllowCredentials(true);","oldContent":"}"},{"type":"MODIFY","lineNumber":116,"content":"\t\tsource.registerCorsConfiguration(\"/**\", configuration); // Apply this configuration to all paths.","oldContent":"}"},{"type":"INSERT","lineNumber":117,"content":"\t\treturn source;"},{"type":"INSERT","lineNumber":119,"content":"}"}]},{"timestamp":1762098392148,"changes":[{"type":"INSERT","lineNumber":35,"content":""},{"type":"DELETE","lineNumber":36,"oldContent":"\t@Bean"},{"type":"INSERT","lineNumber":83,"content":"\t\t\t\t\t\t.requestMatchers(\"/api/v1/engineer/**\").hasAnyRole(\"L1_ENGINEER\", \"NOC_ENGINEER\", \"FIELD_ENGINEER\")"},{"type":"INSERT","lineNumber":84,"content":""},{"type":"INSERT","lineNumber":85,"content":"\t\t\t\t\t\t// Dr. X's Addition: Add the new rule for the Team Lead."},{"type":"INSERT","lineNumber":86,"content":"\t\t\t\t\t\t.requestMatchers(\"/api/v1/team-lead/**\").hasRole(\"TEAM_LEAD\")"},{"type":"DELETE","lineNumber":95,"oldContent":"\t\treturn source;"},{"type":"INSERT","lineNumber":99,"content":""}]},{"timestamp":1762098400767,"changes":[{"type":"MODIFY","lineNumber":83,"content":"\t\t\t\t\t\t// Dr. X's Addition: Add the new rule for the Team Lead.","oldContent":"\t\t\t\t\t\t.requestMatchers(\"/api/v1/engineer/**\").hasAnyRole(\"L1_ENGINEER\", \"NOC_ENGINEER\", \"FIELD_ENGINEER\")"},{"type":"INSERT","lineNumber":84,"content":"\t\t\t\t\t\t.requestMatchers(\"/api/v1/team-lead/**\").hasRole(\"TEAM_LEAD\")"},{"type":"DELETE","lineNumber":85,"oldContent":""},{"type":"DELETE","lineNumber":87,"oldContent":"\t\t\t\t\t\t// Dr. X's Addition: Add the new rule for the Team Lead."},{"type":"DELETE","lineNumber":89,"oldContent":"\t\t\t\t\t\t.requestMatchers(\"/api/v1/team-lead/**\").hasRole(\"TEAM_LEAD\")"},{"type":"DELETE","lineNumber":92,"oldContent":"}"},{"type":"INSERT","lineNumber":90,"content":"\t\t\t\t\t\t// This is our security default-deny policy. It prevents accidentally exposing new endpoints."},{"type":"INSERT","lineNumber":97,"content":""},{"type":"DELETE","lineNumber":102,"oldContent":""}]},{"timestamp":1762146813375,"changes":[{"type":"DELETE","lineNumber":86,"oldContent":"\t\t\t\t\t\t// .requestMatchers(\"/api/v1/triage/**\").hasRole(\"TRIAGE_OFFICER\")"},{"type":"DELETE","lineNumber":87,"oldContent":"\t\t\t\t\t\t// .requestMatchers(\"/api/v1/engineer/**\").hasAnyRole(\"FIELD_ENGINEER\", \"NOC_ENGINEER\", \"L1_ENGINEER\")"},{"type":"DELETE","lineNumber":88,"oldContent":"\t\t\t\t\t\t// This is our security default-deny policy. It prevents accidentally exposing new endpoints."},{"type":"DELETE","lineNumber":89,"oldContent":""},{"type":"DELETE","lineNumber":90,"oldContent":"\t\t\t\t\t\t// Rule 3: This is the most important rule. Any request that doesn't match the rules above MUST be authenticated."},{"type":"INSERT","lineNumber":86,"content":"\t\t\t"},{"type":"DELETE","lineNumber":95,"oldContent":""},{"type":"INSERT","lineNumber":93,"content":""}]},{"timestamp":1762146817331,"changes":[{"type":"DELETE","lineNumber":85,"oldContent":"\t\t\t\t\t\t// Dr. X's Note: As we build more controllers, we will add their rules here. For example:"},{"type":"DELETE","lineNumber":89,"oldContent":""},{"type":"INSERT","lineNumber":92,"content":""}]},{"timestamp":1762146820105,"changes":[{"type":"DELETE","lineNumber":83,"oldContent":"\t\t\t\t\t\t// Dr. X's Addition: Add the new rule for the Team Lead."},{"type":"MODIFY","lineNumber":91,"content":"","oldContent":""}]},{"timestamp":1762146853442,"changes":[{"type":"DELETE","lineNumber":73,"oldContent":""},{"type":"DELETE","lineNumber":74,"oldContent":"\t\t\t\t\t\t// Rule 2: Only users with the 'CUSTOMER' role can access customer-specific endpoints."},{"type":"DELETE","lineNumber":89,"oldContent":""},{"type":"DELETE","lineNumber":90,"oldContent":""},{"type":"INSERT","lineNumber":87,"content":"\t\t\t\t\t\t.authenticationProvider(authenticationProvider())"},{"type":"INSERT","lineNumber":89,"content":""}]},{"timestamp":1762146873691,"changes":[{"type":"MODIFY","lineNumber":65,"content":"\t// In your SecurityConfig class","oldContent":"\t\t\t\t\t\t\t\t.requestMatchers(\"/greet\").hasRole(\"CUSTOMER\")"},{"type":"MODIFY","lineNumber":70,"content":"\t\t\t\t// Dr. X's Note: We are defining the authorization rules here.","oldContent":"\t\t\t\t"},{"type":"MODIFY","lineNumber":73,"content":"\t\t\t\t\t\t.requestMatchers(\"/api/v1/customer/**\").hasRole(\"CUSTOMER\")","oldContent":"\t\t\t\t.addFilterBefore(authenticationJwtTokenFilter(), UsernamePasswordAuthenticationFilter.class);"},{"type":"MODIFY","lineNumber":82,"content":"","oldContent":"\t\t\t"},{"type":"DELETE","lineNumber":85,"oldContent":"\t\t\t\t\t\t.authenticationProvider(authenticationProvider())"},{"type":"INSERT","lineNumber":87,"content":"\t\t\t\t\t\t.authenticationProvider(authenticationProvider())"},{"type":"INSERT","lineNumber":88,"content":"\t\t\t\t\t\t.addFilterBefore(authenticationJwtTokenFilter(), UsernamePasswordAuthenticationFilter.class);"},{"type":"DELETE","lineNumber":89,"oldContent":"\t\treturn source;"},{"type":"MODIFY","lineNumber":100,"content":"\t\tconfiguration.setAllowedMethods(Arrays.asList(\"GET\", \"POST\", \"PUT\", \"PATCH\", \"DELETE\", \"OPTIONS\"));","oldContent":"}"},{"type":"INSERT","lineNumber":112,"content":"\t}"}]},{"timestamp":1762147389321,"changes":[{"type":"MODIFY","lineNumber":72,"content":"\t\t\t\t\t\trequestMatchers(PUBLIC_REQUEST_MATCHERS).permitAll()","oldContent":"\t\t\t\t.exceptionHandling(exception -> exception.authenticationEntryPoint(unauthorizedHandler))"},{"type":"INSERT","lineNumber":82,"content":"\t\t\t\t\t\t.requestMatchers(\"/api/v1/manager/**\").hasRole(\"MANAGER\")"},{"type":"DELETE","lineNumber":84,"oldContent":"\t\t\t\t\t\t.addFilterBefore(authenticationJwtTokenFilter(), UsernamePasswordAuthenticationFilter.class);"},{"type":"INSERT","lineNumber":85,"content":"\t\t\t\t)"},{"type":"DELETE","lineNumber":86,"oldContent":"\t\t\t\t\t\t.authenticationProvider(authenticationProvider())"},{"type":"INSERT","lineNumber":88,"content":"\t\t\t\t\t\t.authenticationProvider(authenticationProvider())"},{"type":"INSERT","lineNumber":114,"content":"}"}]},{"timestamp":1762160467141,"changes":[{"type":"MODIFY","lineNumber":71,"content":"\t\t\t\t.authorizeHttpRequests(auth -> auth.","oldContent":"\t\t\t\t\t\t//.anyRequest().authenticated())http://localhost:8080/api/test/"},{"type":"INSERT","lineNumber":83,"content":"\t\t\t\t\t\t.requestMatchers(\"/api/v1/teams/**\").hasRole(\"MANAGER\")"},{"type":"MODIFY","lineNumber":85,"content":"\t\t\t\t\t\t.anyRequest().authenticated()","oldContent":"\t\t\t\t\t\t.authenticationProvider(authenticationProvider())"},{"type":"DELETE","lineNumber":87,"oldContent":"\t\treturn source;"},{"type":"INSERT","lineNumber":88,"content":"\t\t\t\t\t\t.sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))"},{"type":"DELETE","lineNumber":100,"oldContent":"}"},{"type":"INSERT","lineNumber":101,"content":"\t\t// Rule 2: Allow standard HTTP methods."}]},{"timestamp":1762168512026,"changes":[{"type":"INSERT","lineNumber":84,"content":"\t\t\t\t\t\t.requestMatchers(\"/api/v1/users/cities\").hasRole(\"MANAGER\")"},{"type":"DELETE","lineNumber":85,"oldContent":"\t\t\t\t\t\t.sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))"},{"type":"MODIFY","lineNumber":87,"content":"\t\t\t\t)","oldContent":"\t\treturn source;"},{"type":"INSERT","lineNumber":88,"content":"\t\t\t\t\t\t.exceptionHandling(exception -> exception.authenticationEntryPoint(unauthorizedHandler))"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/TestRoute.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/TestRoute.java","baseContent":"package com.capstone.tele_ticketing_backend_1.controller;\n\n\nimport org.springframework.web.bind.annotation.RestController;\n\n@RestController\npublic class TestRoute {\n}\n","baseTimestamp":1761780897253,"deltas":[{"timestamp":1761780922760,"changes":[{"type":"INSERT","lineNumber":3,"content":"import org.springframework.web.bind.annotation.GetMapping;"},{"type":"INSERT","lineNumber":8,"content":"    @GetMapping(\"/greet\")"},{"type":"INSERT","lineNumber":9,"content":"    private String geetti(){"},{"type":"INSERT","lineNumber":10,"content":"        return \"helo man\";"},{"type":"INSERT","lineNumber":11,"content":"    }"}]},{"timestamp":1761780938356,"changes":[{"type":"INSERT","lineNumber":6,"content":""},{"type":"DELETE","lineNumber":8,"oldContent":"}"},{"type":"DELETE","lineNumber":10,"oldContent":""},{"type":"MODIFY","lineNumber":12,"content":"    }","oldContent":"    }"},{"type":"INSERT","lineNumber":13,"content":"}"},{"type":"INSERT","lineNumber":14,"content":""}]},{"timestamp":1761780942973,"changes":[{"type":"INSERT","lineNumber":8,"content":""},{"type":"INSERT","lineNumber":9,"content":""},{"type":"INSERT","lineNumber":13,"content":"        return \"helo man\";"},{"type":"DELETE","lineNumber":13,"oldContent":"        return \"helo man\";"}]},{"timestamp":1761780952936,"changes":[{"type":"INSERT","lineNumber":3,"content":"import org.springframework.web.bind.annotation.CrossOrigin;"},{"type":"DELETE","lineNumber":8,"oldContent":""},{"type":"INSERT","lineNumber":9,"content":"@CrossOrigin(origins = \"*\", maxAge = 3600)"},{"type":"DELETE","lineNumber":10,"oldContent":""},{"type":"INSERT","lineNumber":13,"content":"        return \"helo man\";"},{"type":"DELETE","lineNumber":15,"oldContent":"        return \"helo man\";"}]},{"timestamp":1761781048364,"changes":[{"type":"MODIFY","lineNumber":11,"content":"    @GetMapping(\"/greeti\")","oldContent":"    @GetMapping(\"/greet\")"}]},{"timestamp":1761814513965,"changes":[{"type":"INSERT","lineNumber":5,"content":"import org.springframework.web.bind.annotation.RequestMapping;"},{"type":"INSERT","lineNumber":11,"content":"@RequestMapping(\"/api/v1\")"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/Attachment.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/Attachment.java","baseContent":"package com.capstone.tele_ticketing_backend_1.entities;\n\nimport com.fasterxml.jackson.annotation.JsonBackReference;\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\nimport org.hibernate.annotations.CreationTimestamp;\n\nimport java.time.LocalDateTime;\n\n@Entity\n@Table(name = \"attachments\")\n@Data\n@NoArgsConstructor\npublic class Attachment {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"ticket_id\", nullable = false)\n    @JsonBackReference\n    private Ticket ticket;\n\n    @Column(name = \"file_path\", nullable = false)\n    private String filePath;\n\n    @Column(name = \"file_name\", nullable = false)\n    private String fileName;\n\n    @CreationTimestamp\n    @Column(name = \"uploaded_at\", updatable = false)\n    private LocalDateTime uploadedAt;\n}","baseTimestamp":1761781802896},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/Feedback.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/entities/Feedback.java","baseContent":"package com.capstone.tele_ticketing_backend_1.entities;\n\nimport com.fasterxml.jackson.annotation.JsonBackReference;\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\nimport org.hibernate.annotations.CreationTimestamp;\n\nimport java.time.LocalDateTime;\n\n@Entity\n@Table(name = \"feedback\")\n@Data\n@NoArgsConstructor\npublic class Feedback {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @OneToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"ticket_id\", nullable = false)\n    @JsonBackReference\n    private Ticket ticket;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"user_id\", nullable = false)\n    private AppUser user;\n\n    @Column(nullable = false)\n    private Integer rating;\n\n    @Lob\n    private String comment;\n\n    @CreationTimestamp\n    @Column(name = \"created_at\", updatable = false)\n    private LocalDateTime createdAt;\n}","baseTimestamp":1761781833015},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/AgentCreateTicketRequestDto.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/AgentCreateTicketRequestDto.java","baseContent":"// File: com/capstone/tele_ticketing_backend_1/dtos/AgentCreateTicketRequestDto.java\npackage com.capstone.tele_ticketing_backend_1.dtos;\n\nimport com.capstone.tele_ticketing_backend_1.entities.TicketCategory;\nimport jakarta.validation.constraints.NotBlank;\nimport jakarta.validation.constraints.NotNull;\nimport jakarta.validation.constraints.Size;\nimport lombok.Data;\n\nimport java.util.List;\n\n@Data\npublic class AgentCreateTicketRequestDto {\n\n    // Dr. X's Note: This is the critical new field. The agent must specify the customer.\n    @NotBlank(message = \"Customer username cannot be blank\")\n    private String customerUsername;\n\n    @NotBlank(message = \"Title cannot be blank\")\n    @Size(min = 5, max = 100, message = \"Title must be between 5 and 100 characters\")\n    private String title;\n\n    @NotBlank(message = \"Description cannot be blank\")\n    @Size(min = 10, max = 5000, message = \"Description must be between 10 and 5000 characters\")\n    private String description;\n\n    @NotNull(message = \"Category cannot be null\")\n    private TicketCategory category;\n\n    private List<String> attachments;\n}","baseTimestamp":1761801318194,"deltas":[{"timestamp":1761801322137,"changes":[{"type":"DELETE","lineNumber":1,"oldContent":"package com.capstone.tele_ticketing_backend_1.dtos;"},{"type":"INSERT","lineNumber":2,"content":""}]},{"timestamp":1761801327730,"changes":[{"type":"INSERT","lineNumber":1,"content":"package com.capstone.tele_ticketing_backend_1.dtos;"},{"type":"DELETE","lineNumber":2,"oldContent":""}]},{"timestamp":1761801329908,"changes":[{"type":"DELETE","lineNumber":0,"oldContent":"// File: com/capstone/tele_ticketing_backend_1/dtos/AgentCreateTicketRequestDto.java"},{"type":"MODIFY","lineNumber":0,"content":"package com.capstone.tele_ticketing_backend_1.dto;","oldContent":"package com.capstone.tele_ticketing_backend_1.dtos;"},{"type":"DELETE","lineNumber":3,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.TicketCategory;"},{"type":"DELETE","lineNumber":4,"oldContent":"import jakarta.validation.constraints.NotBlank;"},{"type":"DELETE","lineNumber":5,"oldContent":"import jakarta.validation.constraints.NotNull;"},{"type":"DELETE","lineNumber":6,"oldContent":"import jakarta.validation.constraints.Size;"},{"type":"DELETE","lineNumber":7,"oldContent":"import lombok.Data;"},{"type":"DELETE","lineNumber":8,"oldContent":""},{"type":"DELETE","lineNumber":9,"oldContent":"import java.util.List;"},{"type":"DELETE","lineNumber":10,"oldContent":""},{"type":"DELETE","lineNumber":11,"oldContent":"@Data"},{"type":"DELETE","lineNumber":13,"oldContent":""},{"type":"DELETE","lineNumber":14,"oldContent":"    // Dr. X's Note: This is the critical new field. The agent must specify the customer."},{"type":"DELETE","lineNumber":15,"oldContent":"    @NotBlank(message = \"Customer username cannot be blank\")"},{"type":"DELETE","lineNumber":16,"oldContent":"    private String customerUsername;"},{"type":"DELETE","lineNumber":17,"oldContent":""},{"type":"DELETE","lineNumber":18,"oldContent":"    @NotBlank(message = \"Title cannot be blank\")"},{"type":"DELETE","lineNumber":19,"oldContent":"    @Size(min = 5, max = 100, message = \"Title must be between 5 and 100 characters\")"},{"type":"DELETE","lineNumber":20,"oldContent":"    private String title;"},{"type":"DELETE","lineNumber":21,"oldContent":""},{"type":"DELETE","lineNumber":22,"oldContent":"    @NotBlank(message = \"Description cannot be blank\")"},{"type":"DELETE","lineNumber":23,"oldContent":"    @Size(min = 10, max = 5000, message = \"Description must be between 10 and 5000 characters\")"},{"type":"DELETE","lineNumber":24,"oldContent":"    private String description;"},{"type":"DELETE","lineNumber":25,"oldContent":""},{"type":"DELETE","lineNumber":26,"oldContent":"    @NotNull(message = \"Category cannot be null\")"},{"type":"DELETE","lineNumber":27,"oldContent":"    private TicketCategory category;"},{"type":"DELETE","lineNumber":28,"oldContent":""},{"type":"DELETE","lineNumber":29,"oldContent":"    private List<String> attachments;"},{"type":"INSERT","lineNumber":4,"content":""}]},{"timestamp":1761801334328,"changes":[{"type":"INSERT","lineNumber":2,"content":"// File: com/capstone/tele_ticketing_backend_1/dtos/AgentCreateTicketRequestDto.java"},{"type":"INSERT","lineNumber":3,"content":"package com.capstone.tele_ticketing_backend_1.dtos;"},{"type":"INSERT","lineNumber":5,"content":"import com.capstone.tele_ticketing_backend_1.entities.TicketCategory;"},{"type":"INSERT","lineNumber":6,"content":"import jakarta.validation.constraints.NotBlank;"},{"type":"INSERT","lineNumber":7,"content":"import jakarta.validation.constraints.NotNull;"},{"type":"INSERT","lineNumber":8,"content":"import jakarta.validation.constraints.Size;"},{"type":"INSERT","lineNumber":9,"content":"import lombok.Data;"},{"type":"INSERT","lineNumber":10,"content":""},{"type":"INSERT","lineNumber":11,"content":"import java.util.List;"},{"type":"INSERT","lineNumber":12,"content":""},{"type":"INSERT","lineNumber":13,"content":"@Data"},{"type":"INSERT","lineNumber":15,"content":""},{"type":"INSERT","lineNumber":16,"content":"    // Dr. X's Note: This is the critical new field. The agent must specify the customer."},{"type":"INSERT","lineNumber":17,"content":"    @NotBlank(message = \"Customer username cannot be blank\")"},{"type":"INSERT","lineNumber":18,"content":"    private String customerUsername;"},{"type":"INSERT","lineNumber":19,"content":""},{"type":"INSERT","lineNumber":20,"content":"    @NotBlank(message = \"Title cannot be blank\")"},{"type":"INSERT","lineNumber":21,"content":"    @Size(min = 5, max = 100, message = \"Title must be between 5 and 100 characters\")"},{"type":"INSERT","lineNumber":22,"content":"    private String title;"},{"type":"INSERT","lineNumber":23,"content":""},{"type":"INSERT","lineNumber":24,"content":"    @NotBlank(message = \"Description cannot be blank\")"},{"type":"INSERT","lineNumber":25,"content":"    @Size(min = 10, max = 5000, message = \"Description must be between 10 and 5000 characters\")"},{"type":"INSERT","lineNumber":26,"content":"    private String description;"},{"type":"INSERT","lineNumber":27,"content":""},{"type":"INSERT","lineNumber":28,"content":"    @NotNull(message = \"Category cannot be null\")"},{"type":"INSERT","lineNumber":29,"content":"    private TicketCategory category;"},{"type":"INSERT","lineNumber":30,"content":""},{"type":"INSERT","lineNumber":31,"content":"    private List<String> attachments;"},{"type":"INSERT","lineNumber":33,"content":""}]},{"timestamp":1761801337104,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"// File: com/capstone/tele_ticketing_backend_1/dtos/AgentCreateTicketRequestDto.java"},{"type":"DELETE","lineNumber":4,"oldContent":"package com.capstone.tele_ticketing_backend_1.dtos;"},{"type":"DELETE","lineNumber":5,"oldContent":"public class AgentCreateTicketRequestDto {"},{"type":"DELETE","lineNumber":6,"oldContent":"}"},{"type":"DELETE","lineNumber":8,"oldContent":""},{"type":"DELETE","lineNumber":10,"oldContent":"    private List<String> attachments;"},{"type":"DELETE","lineNumber":12,"oldContent":""},{"type":"DELETE","lineNumber":14,"oldContent":"    private TicketCategory category;"},{"type":"DELETE","lineNumber":16,"oldContent":"    @NotNull(message = \"Category cannot be null\")"},{"type":"DELETE","lineNumber":18,"oldContent":""},{"type":"DELETE","lineNumber":20,"oldContent":"    private String description;"},{"type":"DELETE","lineNumber":22,"oldContent":"    @Size(min = 10, max = 5000, message = \"Description must be between 10 and 5000 characters\")"},{"type":"DELETE","lineNumber":24,"oldContent":"    @NotBlank(message = \"Description cannot be blank\")"},{"type":"INSERT","lineNumber":12,"content":"public class AgentCreateTicketRequestDto {"},{"type":"DELETE","lineNumber":26,"oldContent":""},{"type":"DELETE","lineNumber":27,"oldContent":"    private String title;"},{"type":"DELETE","lineNumber":29,"oldContent":"    @Size(min = 5, max = 100, message = \"Title must be between 5 and 100 characters\")"},{"type":"DELETE","lineNumber":31,"oldContent":"    @NotBlank(message = \"Title cannot be blank\")"},{"type":"INSERT","lineNumber":18,"content":"    @NotBlank(message = \"Title cannot be blank\")"},{"type":"INSERT","lineNumber":19,"content":"    @Size(min = 5, max = 100, message = \"Title must be between 5 and 100 characters\")"},{"type":"INSERT","lineNumber":20,"content":"    private String title;"},{"type":"INSERT","lineNumber":21,"content":""},{"type":"INSERT","lineNumber":22,"content":"    @NotBlank(message = \"Description cannot be blank\")"},{"type":"INSERT","lineNumber":23,"content":"    @Size(min = 10, max = 5000, message = \"Description must be between 10 and 5000 characters\")"},{"type":"INSERT","lineNumber":24,"content":"    private String description;"},{"type":"INSERT","lineNumber":25,"content":""},{"type":"INSERT","lineNumber":26,"content":"    @NotNull(message = \"Category cannot be null\")"},{"type":"INSERT","lineNumber":27,"content":"    private TicketCategory category;"},{"type":"INSERT","lineNumber":28,"content":""},{"type":"INSERT","lineNumber":29,"content":"    private List<String> attachments;"},{"type":"INSERT","lineNumber":30,"content":"}"},{"type":"INSERT","lineNumber":31,"content":""}]},{"timestamp":1761801440989,"changes":[{"type":"DELETE","lineNumber":6,"oldContent":"public class AgentCreateTicketRequestDto {"},{"type":"INSERT","lineNumber":9,"content":"import java.util.List;"},{"type":"INSERT","lineNumber":10,"content":""},{"type":"INSERT","lineNumber":11,"content":"@Data"},{"type":"INSERT","lineNumber":12,"content":"public class AgentCreateTicketRequestDto {"},{"type":"INSERT","lineNumber":13,"content":""},{"type":"INSERT","lineNumber":14,"content":"    @NotBlank(message = \"Customer username cannot be blank\")"},{"type":"INSERT","lineNumber":15,"content":"    private String customerUsername;"},{"type":"INSERT","lineNumber":16,"content":""},{"type":"DELETE","lineNumber":12,"oldContent":"import java.util.List;"},{"type":"DELETE","lineNumber":15,"oldContent":""},{"type":"DELETE","lineNumber":18,"oldContent":"@Data"},{"type":"DELETE","lineNumber":21,"oldContent":""},{"type":"DELETE","lineNumber":25,"oldContent":"    // Dr. X's Note: This is the critical new field. The agent must specify the customer."},{"type":"DELETE","lineNumber":28,"oldContent":"    @NotBlank(message = \"Customer username cannot be blank\")"},{"type":"DELETE","lineNumber":30,"oldContent":"    private String customerUsername;"},{"type":"DELETE","lineNumber":31,"oldContent":""}]},{"timestamp":1761801450204,"changes":[{"type":"INSERT","lineNumber":8,"content":""},{"type":"DELETE","lineNumber":10,"oldContent":""},{"type":"DELETE","lineNumber":11,"oldContent":"    @NotBlank(message = \"Title cannot be blank\")"},{"type":"DELETE","lineNumber":13,"oldContent":"    @Size(min = 5, max = 100, message = \"Title must be between 5 and 100 characters\")"},{"type":"DELETE","lineNumber":15,"oldContent":""},{"type":"DELETE","lineNumber":16,"oldContent":"    private String title;"},{"type":"INSERT","lineNumber":13,"content":"    "},{"type":"DELETE","lineNumber":18,"oldContent":""},{"type":"INSERT","lineNumber":17,"content":"    @NotBlank(message = \"Title cannot be blank\")"},{"type":"INSERT","lineNumber":18,"content":"    @Size(min = 5, max = 100, message = \"Title must be between 5 and 100 characters\")"},{"type":"INSERT","lineNumber":19,"content":"    private String title;"},{"type":"INSERT","lineNumber":20,"content":""}]},{"timestamp":1761801643428,"changes":[{"type":"DELETE","lineNumber":12,"oldContent":"    "},{"type":"DELETE","lineNumber":14,"oldContent":"    @NotBlank(message = \"Title cannot be blank\")"},{"type":"INSERT","lineNumber":13,"content":""},{"type":"INSERT","lineNumber":15,"content":"    private String customerUsername;"},{"type":"INSERT","lineNumber":16,"content":""},{"type":"INSERT","lineNumber":17,"content":"    @NotBlank(message = \"Title cannot be blank\")"},{"type":"DELETE","lineNumber":18,"oldContent":"    private String customerUsername;"},{"type":"DELETE","lineNumber":20,"oldContent":""}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/AgentTicketService.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/AgentTicketService.java","baseContent":"package com.capstone.tele_ticketing_backend_1.service;\n\n// File: com/capstone/tele_ticketing_backend_1/service/AgentTicketService.java\npackage com.capstone.tele_ticketing_backend_1.service;\n\nimport com.capstone.tele_ticketing_backend_1.dtos.AgentCreateTicketRequestDto;\nimport com.capstone.tele_ticketing_backend_1.dtos.TicketSummaryDto;\nimport com.capstone.tele_ticketing_backend_1.entities.AppUser;\nimport com.capstone.tele_ticketing_backend_1.entities.Attachment;\nimport com.capstone.tele_ticketing_backend_1.entities.Ticket;\nimport com.capstone.tele_ticketing_backend_1.exception.UserNotFoundException;\nimport com.capstone.tele_ticketing_backend_1.model.enums.TicketStatus;\nimport com.capstone.tele_ticketing_backend_1.repo.TicketRepo;\nimport com.capstone.tele_ticketing_backend_1.repo.UserRepo;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n@Service\npublic class AgentTicketService {\n\n    @Autowired\n    private TicketRepo ticketRepo;\n\n    @Autowired\n    private UserRepo userRepo;\n\n    @Transactional\n    public Ticket createTicketForCustomer(AgentCreateTicketRequestDto dto, String agentUsername) {\n        // Dr. X's Note: Here we fetch two users: the agent and the customer.\n        AppUser agent = userRepo.findByUsername(agentUsername)\n                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));\n\n        AppUser customer = userRepo.findByUsername(dto.getCustomerUsername())\n                .orElseThrow(() -> new UserNotFoundException(\"Customer not found: \" + dto.getCustomerUsername()));\n\n        Ticket ticket = new Ticket();\n        ticket.setTitle(dto.getTitle());\n        ticket.setDescription(dto.getDescription());\n        ticket.setCategory(dto.getCategory());\n        ticket.setStatus(TicketStatus.CREATED);\n\n        // This is the key business logic for an agent-created ticket.\n        ticket.setCreatedBy(agent);\n        ticket.setCreatedFor(customer);\n\n        if (dto.getAttachments() != null && !dto.getAttachments().isEmpty()) {\n            dto.getAttachments().forEach(attUrl -> {\n                Attachment attachment = new Attachment();\n                attachment.setFilePath(attUrl);\n                attachment.setFileName(\"attachment_\" + System.currentTimeMillis());\n                attachment.setTicket(ticket);\n                ticket.getAttachments().add(attachment);\n            });\n        }\n\n        return ticketRepo.save(ticket);\n    }\n\n    public List<TicketSummaryDto> getAgentCreatedTickets(String agentUsername) {\n        AppUser agent = userRepo.findByUsername(agentUsername)\n                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));\n\n        List<TicketStatus> activeStatuses = Arrays.asList(\n                TicketStatus.CREATED,\n                TicketStatus.ASSIGNED,\n                TicketStatus.IN_PROGRESS,\n                TicketStatus.NEEDS_TRIAGING,\n                TicketStatus.REOPENED,\n                TicketStatus.FIXED,\n                TicketStatus.RESOLVED\n        );\n\n        // We use our new repository method here.\n        List<Ticket> tickets = ticketRepo.findAllByCreatedByAndStatusIn(agent, activeStatuses);\n\n        return tickets.stream()\n                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))\n                .collect(Collectors.toList());\n    }\n}\n","baseTimestamp":1761801689986,"deltas":[{"timestamp":1761893152437,"changes":[{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;"},{"type":"DELETE","lineNumber":27,"oldContent":"    private ActivityLogService activityLogService;"},{"type":"DELETE","lineNumber":29,"oldContent":""},{"type":"INSERT","lineNumber":30,"content":"    private ActivityLogService activityLogService;"},{"type":"INSERT","lineNumber":31,"content":""},{"type":"MODIFY","lineNumber":33,"content":"    public TicketDetailDto createTicketForCustomer(AgentCreateTicketRequestDto dto, String agentUsername) {","oldContent":"    public Ticket createTicketForCustomer(AgentCreateTicketRequestDto dto, String agentUsername) {"},{"type":"DELETE","lineNumber":59,"oldContent":""},{"type":"DELETE","lineNumber":61,"oldContent":"        // As per our established pattern, we return a DTO to prevent lazy loading exceptions."},{"type":"DELETE","lineNumber":63,"oldContent":"    public List<TicketSummaryDto> getAgentCreatedTickets(String agentUsername) {"},{"type":"INSERT","lineNumber":62,"content":"        // As per our established pattern, we return a DTO to prevent lazy loading exceptions."},{"type":"INSERT","lineNumber":65,"content":""},{"type":"INSERT","lineNumber":66,"content":"    public List<TicketSummaryDto> getAgentCreatedTickets(String agentUsername) {"}]},{"timestamp":1761893164964,"changes":[{"type":"DELETE","lineNumber":3,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;"},{"type":"MODIFY","lineNumber":29,"content":"    private ActivityLogService activityLogService;","oldContent":"    private ActivityLogService activityLogService;"},{"type":"DELETE","lineNumber":34,"oldContent":"    public TicketDetailDto createTicketForCustomer(AgentCreateTicketRequestDto dto, String agentUsername) {"},{"type":"INSERT","lineNumber":33,"content":"        AppUser agent = userRepo.findByUsername(agentUsername)"},{"type":"MODIFY","lineNumber":61,"content":"        // As per our established pattern, we return a DTO to prevent lazy loading exceptions.","oldContent":"        // As per our established pattern, we return a DTO to prevent lazy loading exceptions."},{"type":"MODIFY","lineNumber":64,"content":"","oldContent":""}]},{"timestamp":1761893183288,"changes":[{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;"},{"type":"DELETE","lineNumber":28,"oldContent":"    private ActivityLogService activityLogService;"},{"type":"INSERT","lineNumber":30,"content":"    private ActivityLogService activityLogService;"},{"type":"INSERT","lineNumber":33,"content":"    public TicketDetailDto createTicketForCustomer(AgentCreateTicketRequestDto dto, String agentUsername) {"},{"type":"DELETE","lineNumber":33,"oldContent":"    public Ticket createTicketForCustomer(AgentCreateTicketRequestDto dto, String agentUsername) {"},{"type":"DELETE","lineNumber":60,"oldContent":"        // As per our established pattern, we return a DTO to prevent lazy loading exceptions."},{"type":"INSERT","lineNumber":62,"content":"        // As per our established pattern, we return a DTO to prevent lazy loading exceptions."},{"type":"DELETE","lineNumber":63,"oldContent":""},{"type":"INSERT","lineNumber":65,"content":""}]},{"timestamp":1762024865918,"changes":[{"type":"INSERT","lineNumber":32,"content":"    @Autowired"},{"type":"INSERT","lineNumber":33,"content":"    private TicketActivityRepo activityRepo;"},{"type":"INSERT","lineNumber":34,"content":""},{"type":"DELETE","lineNumber":33,"oldContent":"        AppUser agent = userRepo.findByUsername(agentUsername)"},{"type":"INSERT","lineNumber":37,"content":"        AppUser agent = userRepo.findByUsername(agentUsername)"}]},{"timestamp":1762024869933,"changes":[{"type":"INSERT","lineNumber":7,"content":"import com.capstone.tele_ticketing_backend_1.repo.TicketActivityRepo;"},{"type":"DELETE","lineNumber":33,"oldContent":"    @Transactional"},{"type":"INSERT","lineNumber":36,"content":"    @Transactional"},{"type":"INSERT","lineNumber":38,"content":"        AppUser agent = userRepo.findByUsername(agentUsername)"},{"type":"DELETE","lineNumber":39,"oldContent":"        AppUser agent = userRepo.findByUsername(agentUsername)"}]},{"timestamp":1762024890910,"changes":[{"type":"MODIFY","lineNumber":39,"content":"                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));","oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));"},{"type":"INSERT","lineNumber":91,"content":""},{"type":"INSERT","lineNumber":92,"content":"    @Transactional(readOnly = true)"},{"type":"INSERT","lineNumber":93,"content":"    public List<TicketSummaryDto> getAgentActiveTickets(String agentUsername) {"},{"type":"INSERT","lineNumber":94,"content":"        AppUser agent = userRepo.findByUsername(agentUsername)"},{"type":"INSERT","lineNumber":95,"content":"                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));"},{"type":"INSERT","lineNumber":96,"content":""},{"type":"INSERT","lineNumber":97,"content":"        List<TicketStatus> activeStatuses = List.of("},{"type":"INSERT","lineNumber":98,"content":"                TicketStatus.CREATED, TicketStatus.ASSIGNED,"},{"type":"INSERT","lineNumber":99,"content":"                TicketStatus.IN_PROGRESS, TicketStatus.NEEDS_TRIAGING, TicketStatus.REOPENED"},{"type":"INSERT","lineNumber":100,"content":"        );"},{"type":"INSERT","lineNumber":101,"content":""},{"type":"INSERT","lineNumber":102,"content":"        List<Ticket> tickets = ticketRepo.findAllByCreatedByAndStatusIn(agent, activeStatuses);"},{"type":"INSERT","lineNumber":103,"content":""},{"type":"INSERT","lineNumber":104,"content":"        return tickets.stream()"},{"type":"INSERT","lineNumber":105,"content":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"INSERT","lineNumber":106,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":107,"content":"    }"},{"type":"INSERT","lineNumber":108,"content":""},{"type":"INSERT","lineNumber":109,"content":"    // Dr. X's Addition: Method to get all notifications relevant to the agent."},{"type":"INSERT","lineNumber":110,"content":"    @Transactional(readOnly = true)"},{"type":"INSERT","lineNumber":111,"content":"    public List<NotificationDto> getNotifications(String agentUsername) {"},{"type":"INSERT","lineNumber":112,"content":"        AppUser agent = userRepo.findByUsername(agentUsername)"},{"type":"INSERT","lineNumber":113,"content":"                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));"},{"type":"INSERT","lineNumber":114,"content":""},{"type":"INSERT","lineNumber":115,"content":"        List<TicketActivity> activities = activityRepo.findAllByTicket_CreatedByAndInternalOnlyFalseOrderByCreatedAtDesc(agent);"},{"type":"INSERT","lineNumber":116,"content":""},{"type":"INSERT","lineNumber":117,"content":"        return activities.stream()"},{"type":"INSERT","lineNumber":118,"content":"                .map(activity -> new NotificationDto("},{"type":"INSERT","lineNumber":119,"content":"                        activity.getId(),"},{"type":"INSERT","lineNumber":120,"content":"                        activity.getTicket().getTicketUid(),"},{"type":"INSERT","lineNumber":121,"content":"                        activity.getTicket().getTitle(),"},{"type":"INSERT","lineNumber":122,"content":"                        activity.getDescription(),"},{"type":"INSERT","lineNumber":123,"content":"                        activity.getActivityType().name(),"},{"type":"INSERT","lineNumber":124,"content":"                        activity.getCreatedAt()"},{"type":"INSERT","lineNumber":125,"content":"                ))"},{"type":"INSERT","lineNumber":126,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":127,"content":"    }"}]},{"timestamp":1762024897695,"changes":[{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.dto.NotificationDto;"},{"type":"INSERT","lineNumber":39,"content":"        AppUser agent = userRepo.findByUsername(agentUsername)"},{"type":"DELETE","lineNumber":39,"oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));"},{"type":"DELETE","lineNumber":92,"oldContent":"}"},{"type":"DELETE","lineNumber":94,"oldContent":""},{"type":"DELETE","lineNumber":96,"oldContent":"    }"},{"type":"DELETE","lineNumber":98,"oldContent":"                .collect(Collectors.toList());"},{"type":"DELETE","lineNumber":100,"oldContent":"                ))"},{"type":"DELETE","lineNumber":102,"oldContent":"                        activity.getCreatedAt()"},{"type":"DELETE","lineNumber":104,"oldContent":"                        activity.getActivityType().name(),"},{"type":"DELETE","lineNumber":106,"oldContent":"                        activity.getDescription(),"},{"type":"DELETE","lineNumber":108,"oldContent":"                        activity.getTicket().getTitle(),"},{"type":"DELETE","lineNumber":110,"oldContent":"                        activity.getTicket().getTicketUid(),"},{"type":"DELETE","lineNumber":112,"oldContent":"                        activity.getId(),"},{"type":"DELETE","lineNumber":114,"oldContent":"                .map(activity -> new NotificationDto("},{"type":"DELETE","lineNumber":116,"oldContent":"        return activities.stream()"},{"type":"DELETE","lineNumber":118,"oldContent":""},{"type":"DELETE","lineNumber":120,"oldContent":"        List<TicketActivity> activities = activityRepo.findAllByTicket_CreatedByAndInternalOnlyFalseOrderByCreatedAtDesc(agent);"},{"type":"DELETE","lineNumber":122,"oldContent":""},{"type":"DELETE","lineNumber":124,"oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));"},{"type":"DELETE","lineNumber":126,"oldContent":"        AppUser agent = userRepo.findByUsername(agentUsername)"},{"type":"DELETE","lineNumber":128,"oldContent":"    public List<NotificationDto> getNotifications(String agentUsername) {"},{"type":"INSERT","lineNumber":112,"content":"    public List<NotificationDto> getNotifications(String agentUsername) {"},{"type":"INSERT","lineNumber":113,"content":"        AppUser agent = userRepo.findByUsername(agentUsername)"},{"type":"INSERT","lineNumber":114,"content":"                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));"},{"type":"INSERT","lineNumber":115,"content":""},{"type":"INSERT","lineNumber":116,"content":"        List<TicketActivity> activities = activityRepo.findAllByTicket_CreatedByAndInternalOnlyFalseOrderByCreatedAtDesc(agent);"},{"type":"INSERT","lineNumber":117,"content":""},{"type":"INSERT","lineNumber":118,"content":"        return activities.stream()"},{"type":"INSERT","lineNumber":119,"content":"                .map(activity -> new NotificationDto("},{"type":"INSERT","lineNumber":120,"content":"                        activity.getId(),"},{"type":"INSERT","lineNumber":121,"content":"                        activity.getTicket().getTicketUid(),"},{"type":"INSERT","lineNumber":122,"content":"                        activity.getTicket().getTitle(),"},{"type":"INSERT","lineNumber":123,"content":"                        activity.getDescription(),"},{"type":"INSERT","lineNumber":124,"content":"                        activity.getActivityType().name(),"},{"type":"INSERT","lineNumber":125,"content":"                        activity.getCreatedAt()"},{"type":"INSERT","lineNumber":126,"content":"                ))"},{"type":"INSERT","lineNumber":127,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":128,"content":"    }"},{"type":"INSERT","lineNumber":129,"content":"}"},{"type":"INSERT","lineNumber":130,"content":""}]},{"timestamp":1762026153299,"changes":[{"type":"DELETE","lineNumber":9,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.Ticket;"},{"type":"DELETE","lineNumber":10,"oldContent":"import com.capstone.tele_ticketing_backend_1.exception.UserNotFoundException;"},{"type":"DELETE","lineNumber":11,"oldContent":"import com.capstone.tele_ticketing_backend_1.model.enums.TicketStatus;"},{"type":"INSERT","lineNumber":14,"content":"import com.capstone.tele_ticketing_backend_1.dto.AgentFeedbackDto;"},{"type":"INSERT","lineNumber":15,"content":"import com.capstone.tele_ticketing_backend_1.repo.FeedbackRepo;"},{"type":"INSERT","lineNumber":28,"content":"    private UserRepo userRepo;"},{"type":"INSERT","lineNumber":29,"content":""},{"type":"INSERT","lineNumber":30,"content":"    @Autowired"},{"type":"DELETE","lineNumber":39,"oldContent":"    public Ticket createTicketForCustomer(AgentCreateTicketRequestDto dto, String agentUsername) {"},{"type":"DELETE","lineNumber":41,"oldContent":"        // Dr. X's Note: Here we fetch two users: the agent and the customer."},{"type":"DELETE","lineNumber":42,"oldContent":"        AppUser agent = userRepo.findByUsername(agentUsername)"},{"type":"INSERT","lineNumber":49,"content":"        ticket.setDescription(dto.getDescription());"},{"type":"INSERT","lineNumber":50,"content":"        ticket.setCategory(dto.getCategory());"},{"type":"DELETE","lineNumber":51,"oldContent":""},{"type":"DELETE","lineNumber":52,"oldContent":"        // This is the key business logic for an agent-created ticket."},{"type":"INSERT","lineNumber":61,"content":"                ticket.getAttachments().add(attachment);"},{"type":"INSERT","lineNumber":62,"content":"            });"},{"type":"INSERT","lineNumber":63,"content":"        }"},{"type":"DELETE","lineNumber":72,"oldContent":"    }"},{"type":"DELETE","lineNumber":73,"oldContent":""},{"type":"DELETE","lineNumber":74,"oldContent":"    public List<TicketSummaryDto> getAgentCreatedTickets(String agentUsername) {"},{"type":"INSERT","lineNumber":91,"content":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"INSERT","lineNumber":92,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":93,"content":"    }"},{"type":"INSERT","lineNumber":105,"content":"        List<Ticket> tickets = ticketRepo.findAllByCreatedByAndStatusIn(agent, activeStatuses);"},{"type":"INSERT","lineNumber":106,"content":""},{"type":"INSERT","lineNumber":107,"content":"        return tickets.stream()"},{"type":"INSERT","lineNumber":108,"content":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"INSERT","lineNumber":109,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":110,"content":"    }"},{"type":"INSERT","lineNumber":111,"content":""},{"type":"INSERT","lineNumber":112,"content":"    // Dr. X's Addition: Method to get all notifications relevant to the agent."},{"type":"INSERT","lineNumber":113,"content":"    @Transactional(readOnly = true)"},{"type":"DELETE","lineNumber":105,"oldContent":"        List<Ticket> tickets = ticketRepo.findAllByCreatedByAndStatusIn(agent, activeStatuses);"},{"type":"DELETE","lineNumber":108,"oldContent":""},{"type":"DELETE","lineNumber":111,"oldContent":"        return tickets.stream()"},{"type":"DELETE","lineNumber":114,"oldContent":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"DELETE","lineNumber":117,"oldContent":"                .collect(Collectors.toList());"},{"type":"DELETE","lineNumber":120,"oldContent":"    }"},{"type":"DELETE","lineNumber":123,"oldContent":""},{"type":"DELETE","lineNumber":126,"oldContent":"    // Dr. X's Addition: Method to get all notifications relevant to the agent."},{"type":"DELETE","lineNumber":129,"oldContent":"    @Transactional(readOnly = true)"},{"type":"DELETE","lineNumber":131,"oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));"},{"type":"DELETE","lineNumber":132,"oldContent":"    public List<NotificationDto> getNotifications(String agentUsername) {"},{"type":"DELETE","lineNumber":133,"oldContent":"        AppUser agent = userRepo.findByUsername(agentUsername)"}]},{"timestamp":1762026163020,"changes":[{"type":"DELETE","lineNumber":11,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.AgentFeedbackDto;"},{"type":"MODIFY","lineNumber":14,"content":"import com.capstone.tele_ticketing_backend_1.dto.AgentFeedbackDto;","oldContent":"import com.capstone.tele_ticketing_backend_1.repo.FeedbackRepo;"},{"type":"INSERT","lineNumber":15,"content":"import com.capstone.tele_ticketing_backend_1.repo.FeedbackRepo;"},{"type":"MODIFY","lineNumber":28,"content":"    private UserRepo userRepo;","oldContent":"    private UserRepo userRepo;"},{"type":"MODIFY","lineNumber":31,"content":"    private TicketService ticketService;","oldContent":"    private TicketService ticketService;"},{"type":"INSERT","lineNumber":39,"content":"    @Autowired"},{"type":"INSERT","lineNumber":40,"content":"    private FeedbackRepo feedbackRepo;"},{"type":"INSERT","lineNumber":41,"content":""},{"type":"DELETE","lineNumber":48,"oldContent":"        ticket.setDescription(dto.getDescription());"},{"type":"INSERT","lineNumber":52,"content":"        ticket.setDescription(dto.getDescription());"},{"type":"DELETE","lineNumber":60,"oldContent":"                ticket.getAttachments().add(attachment);"},{"type":"INSERT","lineNumber":64,"content":"                ticket.getAttachments().add(attachment);"},{"type":"DELETE","lineNumber":63,"oldContent":"        Ticket savedTicket = ticketRepo.save(ticket);"},{"type":"INSERT","lineNumber":67,"content":"        Ticket savedTicket = ticketRepo.save(ticket);"},{"type":"DELETE","lineNumber":90,"oldContent":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"INSERT","lineNumber":94,"content":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"DELETE","lineNumber":93,"oldContent":""},{"type":"INSERT","lineNumber":97,"content":""},{"type":"DELETE","lineNumber":105,"oldContent":"    public List<NotificationDto> getNotifications(String agentUsername) {"},{"type":"DELETE","lineNumber":106,"oldContent":"        AppUser agent = userRepo.findByUsername(agentUsername)"},{"type":"DELETE","lineNumber":109,"oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));"},{"type":"DELETE","lineNumber":111,"oldContent":""},{"type":"DELETE","lineNumber":114,"oldContent":"        List<TicketActivity> activities = activityRepo.findAllByTicket_CreatedByAndInternalOnlyFalseOrderByCreatedAtDesc(agent);"},{"type":"DELETE","lineNumber":117,"oldContent":""},{"type":"DELETE","lineNumber":119,"oldContent":"        return activities.stream()"},{"type":"INSERT","lineNumber":117,"content":"    public List<NotificationDto> getNotifications(String agentUsername) {"},{"type":"INSERT","lineNumber":118,"content":"        AppUser agent = userRepo.findByUsername(agentUsername)"},{"type":"INSERT","lineNumber":119,"content":"                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));"},{"type":"INSERT","lineNumber":120,"content":""},{"type":"INSERT","lineNumber":121,"content":"        List<TicketActivity> activities = activityRepo.findAllByTicket_CreatedByAndInternalOnlyFalseOrderByCreatedAtDesc(agent);"},{"type":"INSERT","lineNumber":122,"content":""},{"type":"INSERT","lineNumber":123,"content":"        return activities.stream()"}]},{"timestamp":1762026177297,"changes":[{"type":"MODIFY","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.dto.AgentCreateTicketRequestDto;","oldContent":"// File: com/capstone/tele_ticketing_backend_1/service/AgentTicketService.java"},{"type":"MODIFY","lineNumber":12,"content":"import org.springframework.stereotype.Service;","oldContent":"import com.capstone.tele_ticketing_backend_1.repo.FeedbackRepo;"},{"type":"INSERT","lineNumber":13,"content":"import org.springframework.transaction.annotation.Transactional;"},{"type":"DELETE","lineNumber":15,"oldContent":"import org.springframework.transaction.annotation.Transactional;"},{"type":"INSERT","lineNumber":27,"content":"    @Autowired"},{"type":"DELETE","lineNumber":28,"oldContent":"    private UserRepo userRepo;"},{"type":"INSERT","lineNumber":30,"content":"    @Autowired"},{"type":"DELETE","lineNumber":31,"oldContent":"    private TicketService ticketService;"},{"type":"DELETE","lineNumber":40,"oldContent":"    @Transactional"},{"type":"MODIFY","lineNumber":42,"content":"    @Transactional","oldContent":"    public TicketDetailDto createTicketForCustomer(AgentCreateTicketRequestDto dto, String agentUsername) {"},{"type":"INSERT","lineNumber":43,"content":"    public TicketDetailDto createTicketForCustomer(AgentCreateTicketRequestDto dto, String agentUsername) {"},{"type":"INSERT","lineNumber":52,"content":"        ticket.setDescription(dto.getDescription());"},{"type":"DELETE","lineNumber":54,"oldContent":"        ticket.setDescription(dto.getDescription());"},{"type":"MODIFY","lineNumber":65,"content":"            });","oldContent":"            });"},{"type":"INSERT","lineNumber":67,"content":"        Ticket savedTicket = ticketRepo.save(ticket);"},{"type":"DELETE","lineNumber":69,"oldContent":"        Ticket savedTicket = ticketRepo.save(ticket);"},{"type":"MODIFY","lineNumber":95,"content":"                .collect(Collectors.toList());","oldContent":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":97,"content":""},{"type":"DELETE","lineNumber":99,"oldContent":""},{"type":"INSERT","lineNumber":115,"content":"    // Dr. X's Addition: Method to get all notifications relevant to the agent."},{"type":"INSERT","lineNumber":116,"content":"    @Transactional(readOnly = true)"},{"type":"DELETE","lineNumber":117,"oldContent":"    // Dr. X's Addition: Method to get all notifications relevant to the agent."},{"type":"DELETE","lineNumber":120,"oldContent":"    @Transactional(readOnly = true)"},{"type":"DELETE","lineNumber":122,"oldContent":"                .map(activity -> new NotificationDto("},{"type":"MODIFY","lineNumber":124,"content":"                .map(activity -> new NotificationDto(","oldContent":"                        activity.getId(),"},{"type":"INSERT","lineNumber":125,"content":"                        activity.getId(),"},{"type":"INSERT","lineNumber":134,"content":""},{"type":"INSERT","lineNumber":135,"content":"    @Transactional(readOnly = true)"},{"type":"INSERT","lineNumber":136,"content":"    public List<AgentFeedbackDto> getFeedbackOnCreatedTickets(String agentUsername) {"},{"type":"INSERT","lineNumber":137,"content":"        AppUser agent = userRepo.findByUsername(agentUsername)"},{"type":"INSERT","lineNumber":138,"content":"                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));"},{"type":"INSERT","lineNumber":139,"content":""},{"type":"INSERT","lineNumber":140,"content":"        List<Feedback> feedbacks = feedbackRepo.findAllByTicket_CreatedByOrderByCreatedAtDesc(agent);"},{"type":"INSERT","lineNumber":141,"content":""},{"type":"INSERT","lineNumber":142,"content":"        return feedbacks.stream()"},{"type":"INSERT","lineNumber":143,"content":"                .map(feedback -> new AgentFeedbackDto("},{"type":"INSERT","lineNumber":144,"content":"                        feedback.getId(),"},{"type":"INSERT","lineNumber":145,"content":"                        feedback.getTicket().getTicketUid(),"},{"type":"INSERT","lineNumber":146,"content":"                        feedback.getTicket().getTitle(),"},{"type":"INSERT","lineNumber":147,"content":"                        feedback.getUser().getFullName(), // The user who left the feedback"},{"type":"INSERT","lineNumber":148,"content":"                        feedback.getRating(),"},{"type":"INSERT","lineNumber":149,"content":"                        feedback.getComment(),"},{"type":"INSERT","lineNumber":150,"content":"                        feedback.getCreatedAt()"},{"type":"INSERT","lineNumber":151,"content":"                ))"},{"type":"INSERT","lineNumber":152,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":153,"content":"    }"}]},{"timestamp":1762027046285,"changes":[{"type":"MODIFY","lineNumber":5,"content":"import com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;","oldContent":"package com.capstone.tele_ticketing_backend_1.service;"},{"type":"INSERT","lineNumber":41,"content":""},{"type":"DELETE","lineNumber":43,"oldContent":""},{"type":"INSERT","lineNumber":64,"content":"                ticket.getAttachments().add(attachment);"},{"type":"DELETE","lineNumber":65,"oldContent":"            });"},{"type":"INSERT","lineNumber":94,"content":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"DELETE","lineNumber":95,"oldContent":"                .collect(Collectors.toList());"},{"type":"MODIFY","lineNumber":117,"content":"    public List<NotificationDto> getNotifications(String agentUsername) {","oldContent":"    public List<NotificationDto> getNotifications(String agentUsername) {"},{"type":"INSERT","lineNumber":123,"content":"        return activities.stream()"},{"type":"DELETE","lineNumber":125,"oldContent":"        return activities.stream()"},{"type":"DELETE","lineNumber":135,"oldContent":"}"},{"type":"DELETE","lineNumber":137,"oldContent":""},{"type":"DELETE","lineNumber":139,"oldContent":"    }"},{"type":"DELETE","lineNumber":141,"oldContent":"                .collect(Collectors.toList());"},{"type":"DELETE","lineNumber":143,"oldContent":"                ))"},{"type":"DELETE","lineNumber":145,"oldContent":"                        feedback.getCreatedAt()"},{"type":"DELETE","lineNumber":147,"oldContent":"                        feedback.getComment(),"},{"type":"DELETE","lineNumber":149,"oldContent":"                        feedback.getRating(),"},{"type":"DELETE","lineNumber":151,"oldContent":"                        feedback.getUser().getFullName(), // The user who left the feedback"},{"type":"DELETE","lineNumber":153,"oldContent":"                        feedback.getTicket().getTitle(),"},{"type":"INSERT","lineNumber":146,"content":"                        feedback.getTicket().getTitle(),"},{"type":"INSERT","lineNumber":147,"content":"                        feedback.getUser().getFullName(), // The user who left the feedback"},{"type":"INSERT","lineNumber":148,"content":"                        feedback.getRating(),"},{"type":"INSERT","lineNumber":149,"content":"                        feedback.getComment(),"},{"type":"INSERT","lineNumber":150,"content":"                        feedback.getCreatedAt()"},{"type":"INSERT","lineNumber":151,"content":"                ))"},{"type":"INSERT","lineNumber":152,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":153,"content":"    }"},{"type":"INSERT","lineNumber":154,"content":"    @Transactional"},{"type":"INSERT","lineNumber":155,"content":"    public TicketDetailDto addFeedbackForCustomer(Long ticketId, FeedbackRequestDto dto, String agentUsername) {"},{"type":"INSERT","lineNumber":156,"content":"        AppUser agent = userRepo.findByUsername(agentUsername)"},{"type":"INSERT","lineNumber":157,"content":"                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));"},{"type":"INSERT","lineNumber":158,"content":""},{"type":"INSERT","lineNumber":159,"content":"        Ticket ticket = ticketRepo.findById(ticketId)"},{"type":"INSERT","lineNumber":160,"content":"                .orElseThrow(() -> new TicketNotFoundException(\"Ticket not found with id: \" + ticketId));"},{"type":"INSERT","lineNumber":161,"content":""},{"type":"INSERT","lineNumber":162,"content":"        // Dr. X's Note: THIS IS THE NEW, CRITICAL SECURITY CHECK."},{"type":"INSERT","lineNumber":163,"content":"        // We verify that the logged-in agent is the one who CREATED the ticket."},{"type":"INSERT","lineNumber":164,"content":"        if (!ticket.getCreatedBy().getId().equals(agent.getId())) {"},{"type":"INSERT","lineNumber":165,"content":"            throw new AuthorizationException(\"You are not authorized to add feedback to this ticket.\");"},{"type":"INSERT","lineNumber":166,"content":"        }"},{"type":"INSERT","lineNumber":167,"content":""},{"type":"INSERT","lineNumber":168,"content":"        // State Check: Ensure the ticket is in the correct status."},{"type":"INSERT","lineNumber":169,"content":"        if (ticket.getStatus() != TicketStatus.FIXED) {"},{"type":"INSERT","lineNumber":170,"content":"            throw new InvalidTicketStatusException(\"Feedback can only be added to tickets with status FIXED.\");"},{"type":"INSERT","lineNumber":171,"content":"        }"},{"type":"INSERT","lineNumber":172,"content":""},{"type":"INSERT","lineNumber":173,"content":"        // The customer for whom the ticket was created."},{"type":"INSERT","lineNumber":174,"content":"        AppUser customer = ticket.getCreatedFor();"},{"type":"INSERT","lineNumber":175,"content":""},{"type":"INSERT","lineNumber":176,"content":"        Feedback feedback = new Feedback();"},{"type":"INSERT","lineNumber":177,"content":"        feedback.setRating(dto.getRating());"},{"type":"INSERT","lineNumber":178,"content":"        feedback.setComment(dto.getComment());"},{"type":"INSERT","lineNumber":179,"content":"        feedback.setTicket(ticket);"},{"type":"INSERT","lineNumber":180,"content":""},{"type":"INSERT","lineNumber":181,"content":"        // Data Integrity: The feedback is FROM the customer, even if submitted by the agent."},{"type":"INSERT","lineNumber":182,"content":"        feedback.setUser(customer);"},{"type":"INSERT","lineNumber":183,"content":""},{"type":"INSERT","lineNumber":184,"content":"        ticket.setFeedback(feedback);"},{"type":"INSERT","lineNumber":185,"content":""},{"type":"INSERT","lineNumber":186,"content":"        // Same business logic as before."},{"type":"INSERT","lineNumber":187,"content":"        if (dto.getRating() > 2) {"},{"type":"INSERT","lineNumber":188,"content":"            ticket.setStatus(TicketStatus.RESOLVED);"},{"type":"INSERT","lineNumber":189,"content":"            ticket.setResolvedAt(LocalDateTime.now());"},{"type":"INSERT","lineNumber":190,"content":"            // Log this action clearly for auditing."},{"type":"INSERT","lineNumber":191,"content":"            activityLogService.createLog(ticket, agent, ActivityType.RESOLUTION, \"Agent submitted a positive feedback rating (\" + dto.getRating() + \" stars) on behalf of the customer. Ticket resolved.\", false);"},{"type":"INSERT","lineNumber":192,"content":"        } else {"},{"type":"INSERT","lineNumber":193,"content":"            ticket.setStatus(TicketStatus.REOPENED);"},{"type":"INSERT","lineNumber":194,"content":"            activityLogService.createLog(ticket, agent, ActivityType.REOPENED, \"Agent submitted a negative feedback rating (\" + dto.getRating() + \" stars) on behalf of the customer. Ticket reopened.\", false);"},{"type":"INSERT","lineNumber":195,"content":"        }"},{"type":"INSERT","lineNumber":196,"content":""},{"type":"INSERT","lineNumber":197,"content":"        Ticket savedTicket = ticketRepo.save(ticket);"},{"type":"INSERT","lineNumber":198,"content":"        return ticketService.mapTicketToDetailDto(savedTicket);"},{"type":"INSERT","lineNumber":199,"content":"    }"},{"type":"INSERT","lineNumber":200,"content":"}"},{"type":"INSERT","lineNumber":201,"content":""}]},{"timestamp":1762027053581,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.AgentCreateTicketRequestDto;"},{"type":"DELETE","lineNumber":3,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.NotificationDto;"},{"type":"DELETE","lineNumber":4,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;"},{"type":"DELETE","lineNumber":5,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;"},{"type":"INSERT","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.dto.*;"},{"type":"DELETE","lineNumber":7,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.AppUser;"},{"type":"INSERT","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.exceptions.UserNotFoundException;"},{"type":"DELETE","lineNumber":14,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.AgentFeedbackDto;"},{"type":"INSERT","lineNumber":112,"content":"    @Transactional(readOnly = true)"},{"type":"DELETE","lineNumber":117,"oldContent":"    public List<NotificationDto> getNotifications(String agentUsername) {"},{"type":"DELETE","lineNumber":140,"oldContent":"                        feedback.getTicket().getTitle(),"},{"type":"INSERT","lineNumber":137,"content":""},{"type":"INSERT","lineNumber":138,"content":"        return feedbacks.stream()"},{"type":"INSERT","lineNumber":139,"content":"                .map(feedback -> new AgentFeedbackDto("},{"type":"INSERT","lineNumber":140,"content":"                        feedback.getId(),"},{"type":"INSERT","lineNumber":141,"content":"                        feedback.getTicket().getTicketUid(),"},{"type":"INSERT","lineNumber":142,"content":"                        feedback.getTicket().getTitle(),"},{"type":"DELETE","lineNumber":144,"oldContent":""},{"type":"DELETE","lineNumber":147,"oldContent":"        return feedbacks.stream()"},{"type":"DELETE","lineNumber":150,"oldContent":"                .map(feedback -> new AgentFeedbackDto("},{"type":"DELETE","lineNumber":153,"oldContent":"                        feedback.getId(),"},{"type":"DELETE","lineNumber":155,"oldContent":"                        feedback.getTicket().getTicketUid(),"},{"type":"DELETE","lineNumber":157,"oldContent":""},{"type":"DELETE","lineNumber":159,"oldContent":"}"},{"type":"DELETE","lineNumber":161,"oldContent":"    }"},{"type":"DELETE","lineNumber":163,"oldContent":"        return ticketService.mapTicketToDetailDto(savedTicket);"},{"type":"DELETE","lineNumber":165,"oldContent":"        Ticket savedTicket = ticketRepo.save(ticket);"},{"type":"DELETE","lineNumber":167,"oldContent":""},{"type":"DELETE","lineNumber":169,"oldContent":"        }"},{"type":"DELETE","lineNumber":171,"oldContent":"            activityLogService.createLog(ticket, agent, ActivityType.REOPENED, \"Agent submitted a negative feedback rating (\" + dto.getRating() + \" stars) on behalf of the customer. Ticket reopened.\", false);"},{"type":"DELETE","lineNumber":173,"oldContent":"            ticket.setStatus(TicketStatus.REOPENED);"},{"type":"DELETE","lineNumber":175,"oldContent":"        } else {"},{"type":"DELETE","lineNumber":177,"oldContent":"            activityLogService.createLog(ticket, agent, ActivityType.RESOLUTION, \"Agent submitted a positive feedback rating (\" + dto.getRating() + \" stars) on behalf of the customer. Ticket resolved.\", false);"},{"type":"DELETE","lineNumber":179,"oldContent":"            // Log this action clearly for auditing."},{"type":"DELETE","lineNumber":181,"oldContent":"            ticket.setResolvedAt(LocalDateTime.now());"},{"type":"DELETE","lineNumber":183,"oldContent":"            ticket.setStatus(TicketStatus.RESOLVED);"},{"type":"DELETE","lineNumber":185,"oldContent":"        if (dto.getRating() > 2) {"},{"type":"DELETE","lineNumber":187,"oldContent":"        // Same business logic as before."},{"type":"DELETE","lineNumber":189,"oldContent":""},{"type":"DELETE","lineNumber":191,"oldContent":"        ticket.setFeedback(feedback);"},{"type":"DELETE","lineNumber":194,"oldContent":""},{"type":"DELETE","lineNumber":195,"oldContent":"        feedback.setUser(customer);"},{"type":"DELETE","lineNumber":197,"oldContent":"        // Data Integrity: The feedback is FROM the customer, even if submitted by the agent."},{"type":"DELETE","lineNumber":199,"oldContent":""},{"type":"INSERT","lineNumber":176,"content":""},{"type":"INSERT","lineNumber":177,"content":"        // Data Integrity: The feedback is FROM the customer, even if submitted by the agent."},{"type":"INSERT","lineNumber":178,"content":"        feedback.setUser(customer);"},{"type":"INSERT","lineNumber":179,"content":""},{"type":"INSERT","lineNumber":180,"content":"        ticket.setFeedback(feedback);"},{"type":"INSERT","lineNumber":181,"content":""},{"type":"INSERT","lineNumber":182,"content":"        // Same business logic as before."},{"type":"INSERT","lineNumber":183,"content":"        if (dto.getRating() > 2) {"},{"type":"INSERT","lineNumber":184,"content":"            ticket.setStatus(TicketStatus.RESOLVED);"},{"type":"INSERT","lineNumber":185,"content":"            ticket.setResolvedAt(LocalDateTime.now());"},{"type":"INSERT","lineNumber":186,"content":"            // Log this action clearly for auditing."},{"type":"INSERT","lineNumber":187,"content":"            activityLogService.createLog(ticket, agent, ActivityType.RESOLUTION, \"Agent submitted a positive feedback rating (\" + dto.getRating() + \" stars) on behalf of the customer. Ticket resolved.\", false);"},{"type":"INSERT","lineNumber":188,"content":"        } else {"},{"type":"INSERT","lineNumber":189,"content":"            ticket.setStatus(TicketStatus.REOPENED);"},{"type":"INSERT","lineNumber":190,"content":"            activityLogService.createLog(ticket, agent, ActivityType.REOPENED, \"Agent submitted a negative feedback rating (\" + dto.getRating() + \" stars) on behalf of the customer. Ticket reopened.\", false);"},{"type":"INSERT","lineNumber":191,"content":"        }"},{"type":"INSERT","lineNumber":192,"content":""},{"type":"INSERT","lineNumber":193,"content":"        Ticket savedTicket = ticketRepo.save(ticket);"},{"type":"INSERT","lineNumber":194,"content":"        return ticketService.mapTicketToDetailDto(savedTicket);"},{"type":"INSERT","lineNumber":195,"content":"    }"},{"type":"INSERT","lineNumber":196,"content":"}"},{"type":"INSERT","lineNumber":197,"content":""}]},{"timestamp":1762027059967,"changes":[{"type":"MODIFY","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.exceptions.TicketNotFoundException;","oldContent":"import com.capstone.tele_ticketing_backend_1.exceptions.UserNotFoundException;"},{"type":"INSERT","lineNumber":5,"content":"import com.capstone.tele_ticketing_backend_1.exceptions.UserNotFoundException;"},{"type":"DELETE","lineNumber":108,"oldContent":"    @Transactional(readOnly = true)"},{"type":"INSERT","lineNumber":113,"content":"    @Transactional(readOnly = true)"},{"type":"DELETE","lineNumber":133,"oldContent":""},{"type":"DELETE","lineNumber":135,"oldContent":"        return feedbacks.stream()"},{"type":"MODIFY","lineNumber":137,"content":"        List<Feedback> feedbacks = feedbackRepo.findAllByTicket_CreatedByOrderByCreatedAtDesc(agent);","oldContent":"                .map(feedback -> new AgentFeedbackDto("},{"type":"INSERT","lineNumber":138,"content":""},{"type":"INSERT","lineNumber":139,"content":"        return feedbacks.stream()"},{"type":"INSERT","lineNumber":140,"content":"                .map(feedback -> new AgentFeedbackDto("},{"type":"DELETE","lineNumber":141,"oldContent":"        List<Feedback> feedbacks = feedbackRepo.findAllByTicket_CreatedByOrderByCreatedAtDesc(agent);"},{"type":"INSERT","lineNumber":163,"content":"        }"},{"type":"INSERT","lineNumber":165,"content":"        // State Check: Ensure the ticket is in the correct status."},{"type":"INSERT","lineNumber":166,"content":"        if (ticket.getStatus() != TicketStatus.FIXED) {"},{"type":"INSERT","lineNumber":167,"content":"            throw new InvalidTicketStatusException(\"Feedback can only be added to tickets with status FIXED.\");"},{"type":"INSERT","lineNumber":169,"content":""},{"type":"INSERT","lineNumber":170,"content":"        // The customer for whom the ticket was created."},{"type":"INSERT","lineNumber":171,"content":"        AppUser customer = ticket.getCreatedFor();"},{"type":"INSERT","lineNumber":172,"content":""},{"type":"INSERT","lineNumber":173,"content":"        Feedback feedback = new Feedback();"},{"type":"INSERT","lineNumber":174,"content":"        feedback.setRating(dto.getRating());"},{"type":"INSERT","lineNumber":175,"content":"        feedback.setComment(dto.getComment());"},{"type":"INSERT","lineNumber":176,"content":"        feedback.setTicket(ticket);"},{"type":"INSERT","lineNumber":177,"content":""},{"type":"DELETE","lineNumber":167,"oldContent":""},{"type":"DELETE","lineNumber":169,"oldContent":"        // State Check: Ensure the ticket is in the correct status."},{"type":"DELETE","lineNumber":172,"oldContent":"        if (ticket.getStatus() != TicketStatus.FIXED) {"},{"type":"DELETE","lineNumber":175,"oldContent":"            throw new InvalidTicketStatusException(\"Feedback can only be added to tickets with status FIXED.\");"},{"type":"DELETE","lineNumber":178,"oldContent":"        }"},{"type":"DELETE","lineNumber":181,"oldContent":""},{"type":"DELETE","lineNumber":184,"oldContent":"        // The customer for whom the ticket was created."},{"type":"DELETE","lineNumber":187,"oldContent":"        AppUser customer = ticket.getCreatedFor();"},{"type":"DELETE","lineNumber":189,"oldContent":""},{"type":"DELETE","lineNumber":193,"oldContent":"        Feedback feedback = new Feedback();"},{"type":"DELETE","lineNumber":195,"oldContent":"        feedback.setRating(dto.getRating());"},{"type":"DELETE","lineNumber":196,"oldContent":"        feedback.setComment(dto.getComment());"},{"type":"DELETE","lineNumber":197,"oldContent":"        feedback.setTicket(ticket);"}]},{"timestamp":1762027066237,"changes":[{"type":"MODIFY","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.entities.*;","oldContent":"import com.capstone.tele_ticketing_backend_1.exceptions.UserNotFoundException;"},{"type":"INSERT","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.exceptions.AuthorizationException;"},{"type":"INSERT","lineNumber":43,"content":"                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));"},{"type":"INSERT","lineNumber":44,"content":""},{"type":"INSERT","lineNumber":45,"content":"        AppUser customer = userRepo.findByUsername(dto.getCustomerUsername())"},{"type":"DELETE","lineNumber":49,"oldContent":"        ticket.setDescription(dto.getDescription());"},{"type":"DELETE","lineNumber":50,"oldContent":"        ticket.setCategory(dto.getCategory());"},{"type":"INSERT","lineNumber":54,"content":"        ticket.setCreatedFor(customer);"},{"type":"INSERT","lineNumber":55,"content":""},{"type":"DELETE","lineNumber":61,"oldContent":"                ticket.getAttachments().add(attachment);"},{"type":"DELETE","lineNumber":62,"oldContent":"            });"},{"type":"DELETE","lineNumber":63,"oldContent":"        }"},{"type":"INSERT","lineNumber":75,"content":"        AppUser agent = userRepo.findByUsername(agentUsername)"},{"type":"INSERT","lineNumber":76,"content":"                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));"},{"type":"INSERT","lineNumber":77,"content":""},{"type":"DELETE","lineNumber":91,"oldContent":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"DELETE","lineNumber":92,"oldContent":"                .collect(Collectors.toList());"},{"type":"DELETE","lineNumber":93,"oldContent":"    }"},{"type":"INSERT","lineNumber":137,"content":""},{"type":"DELETE","lineNumber":138,"oldContent":""},{"type":"DELETE","lineNumber":140,"oldContent":"                        feedback.getId(),"},{"type":"INSERT","lineNumber":142,"content":"                        feedback.getId(),"},{"type":"DELETE","lineNumber":163,"oldContent":""},{"type":"DELETE","lineNumber":165,"oldContent":"        }"},{"type":"DELETE","lineNumber":166,"oldContent":"        // Data Integrity: The feedback is FROM the customer, even if submitted by the agent."},{"type":"INSERT","lineNumber":165,"content":""},{"type":"DELETE","lineNumber":168,"oldContent":"        feedback.setUser(customer);"},{"type":"DELETE","lineNumber":170,"oldContent":""},{"type":"DELETE","lineNumber":172,"oldContent":"        ticket.setFeedback(feedback);"},{"type":"INSERT","lineNumber":169,"content":"        }"},{"type":"DELETE","lineNumber":175,"oldContent":""},{"type":"DELETE","lineNumber":177,"oldContent":"        // Same business logic as before."},{"type":"DELETE","lineNumber":180,"oldContent":"        if (dto.getRating() > 2) {"},{"type":"DELETE","lineNumber":182,"oldContent":"            ticket.setStatus(TicketStatus.RESOLVED);"},{"type":"DELETE","lineNumber":185,"oldContent":"            ticket.setResolvedAt(LocalDateTime.now());"},{"type":"INSERT","lineNumber":179,"content":"        // Data Integrity: The feedback is FROM the customer, even if submitted by the agent."},{"type":"INSERT","lineNumber":180,"content":"        feedback.setUser(customer);"},{"type":"INSERT","lineNumber":181,"content":""},{"type":"INSERT","lineNumber":182,"content":"        ticket.setFeedback(feedback);"},{"type":"INSERT","lineNumber":183,"content":""},{"type":"INSERT","lineNumber":184,"content":"        // Same business logic as before."},{"type":"INSERT","lineNumber":185,"content":"        if (dto.getRating() > 2) {"},{"type":"INSERT","lineNumber":186,"content":"            ticket.setStatus(TicketStatus.RESOLVED);"},{"type":"INSERT","lineNumber":187,"content":"            ticket.setResolvedAt(LocalDateTime.now());"}]},{"timestamp":1762027070321,"changes":[{"type":"INSERT","lineNumber":5,"content":"import com.capstone.tele_ticketing_backend_1.exceptions.InvalidTicketStatusException;"},{"type":"DELETE","lineNumber":43,"oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"Customer not found: \" + dto.getCustomerUsername()));"},{"type":"INSERT","lineNumber":46,"content":"        AppUser customer = userRepo.findByUsername(dto.getCustomerUsername())"},{"type":"INSERT","lineNumber":47,"content":"                .orElseThrow(() -> new UserNotFoundException(\"Customer not found: \" + dto.getCustomerUsername()));"},{"type":"DELETE","lineNumber":48,"oldContent":"        AppUser customer = userRepo.findByUsername(dto.getCustomerUsername())"},{"type":"DELETE","lineNumber":53,"oldContent":""},{"type":"INSERT","lineNumber":54,"content":"        ticket.setCreatedBy(agent);"},{"type":"DELETE","lineNumber":56,"oldContent":"        ticket.setCreatedFor(customer);"},{"type":"DELETE","lineNumber":58,"oldContent":""},{"type":"INSERT","lineNumber":64,"content":"            });"},{"type":"INSERT","lineNumber":65,"content":"        }"},{"type":"DELETE","lineNumber":75,"oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));"},{"type":"DELETE","lineNumber":77,"oldContent":""},{"type":"MODIFY","lineNumber":79,"content":"        List<TicketStatus> activeStatuses = Arrays.asList(","oldContent":"        List<TicketStatus> activeStatuses = Arrays.asList("},{"type":"INSERT","lineNumber":94,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":95,"content":"    }"},{"type":"INSERT","lineNumber":138,"content":""},{"type":"DELETE","lineNumber":139,"oldContent":""},{"type":"DELETE","lineNumber":167,"oldContent":"        }"},{"type":"INSERT","lineNumber":170,"content":"        }"},{"type":"DELETE","lineNumber":174,"oldContent":"        // Data Integrity: The feedback is FROM the customer, even if submitted by the agent."},{"type":"INSERT","lineNumber":176,"content":"        feedback.setRating(dto.getRating());"},{"type":"INSERT","lineNumber":177,"content":"        feedback.setComment(dto.getComment());"},{"type":"INSERT","lineNumber":178,"content":"        feedback.setTicket(ticket);"},{"type":"INSERT","lineNumber":179,"content":""},{"type":"INSERT","lineNumber":180,"content":"        // Data Integrity: The feedback is FROM the customer, even if submitted by the agent."},{"type":"DELETE","lineNumber":178,"oldContent":"        feedback.setRating(dto.getRating());"},{"type":"DELETE","lineNumber":181,"oldContent":"        feedback.setComment(dto.getComment());"},{"type":"DELETE","lineNumber":183,"oldContent":"        feedback.setTicket(ticket);"},{"type":"DELETE","lineNumber":186,"oldContent":""}]},{"timestamp":1762027080611,"changes":[{"type":"INSERT","lineNumber":16,"content":"import java.time.LocalDateTime;"},{"type":"DELETE","lineNumber":47,"oldContent":""},{"type":"INSERT","lineNumber":49,"content":""},{"type":"DELETE","lineNumber":63,"oldContent":"            });"},{"type":"INSERT","lineNumber":65,"content":"            });"},{"type":"DELETE","lineNumber":78,"oldContent":"        List<TicketStatus> activeStatuses = Arrays.asList("},{"type":"INSERT","lineNumber":80,"content":"        List<TicketStatus> activeStatuses = Arrays.asList("},{"type":"INSERT","lineNumber":81,"content":"                TicketStatus.CREATED,"},{"type":"DELETE","lineNumber":94,"oldContent":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":139,"content":""},{"type":"DELETE","lineNumber":140,"oldContent":""},{"type":"DELETE","lineNumber":177,"oldContent":"        feedback.setUser(customer);"},{"type":"DELETE","lineNumber":179,"oldContent":""},{"type":"MODIFY","lineNumber":182,"content":"        feedback.setUser(customer);","oldContent":"        ticket.setFeedback(feedback);"},{"type":"INSERT","lineNumber":184,"content":"        ticket.setFeedback(feedback);"},{"type":"INSERT","lineNumber":185,"content":""}]},{"timestamp":1762027094505,"changes":[{"type":"DELETE","lineNumber":9,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.Ticket;"},{"type":"DELETE","lineNumber":10,"oldContent":"import com.capstone.tele_ticketing_backend_1.exception.UserNotFoundException;"},{"type":"DELETE","lineNumber":11,"oldContent":"import com.capstone.tele_ticketing_backend_1.model.enums.TicketStatus;"},{"type":"DELETE","lineNumber":12,"oldContent":"import org.springframework.stereotype.Service;"},{"type":"DELETE","lineNumber":13,"oldContent":"import org.springframework.transaction.annotation.Transactional;"},{"type":"DELETE","lineNumber":14,"oldContent":"import com.capstone.tele_ticketing_backend_1.repo.FeedbackRepo;"},{"type":"INSERT","lineNumber":9,"content":"import com.capstone.tele_ticketing_backend_1.repo.TicketRepo;"},{"type":"INSERT","lineNumber":10,"content":"import com.capstone.tele_ticketing_backend_1.repo.UserRepo;"},{"type":"DELETE","lineNumber":16,"oldContent":"import java.time.LocalDateTime;"},{"type":"INSERT","lineNumber":14,"content":"import com.capstone.tele_ticketing_backend_1.repo.FeedbackRepo;"},{"type":"INSERT","lineNumber":16,"content":"import java.time.LocalDateTime;"},{"type":"INSERT","lineNumber":25,"content":"    private TicketRepo ticketRepo;"},{"type":"INSERT","lineNumber":26,"content":""},{"type":"INSERT","lineNumber":27,"content":"    @Autowired"},{"type":"DELETE","lineNumber":50,"oldContent":"        AppUser customer = userRepo.findByUsername(dto.getCustomerUsername())"},{"type":"DELETE","lineNumber":51,"oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"Customer not found: \" + dto.getCustomerUsername()));"},{"type":"MODIFY","lineNumber":52,"content":"        ticket.setDescription(dto.getDescription());","oldContent":""},{"type":"INSERT","lineNumber":53,"content":"        ticket.setCategory(dto.getCategory());"},{"type":"INSERT","lineNumber":54,"content":"        ticket.setStatus(TicketStatus.CREATED);"},{"type":"DELETE","lineNumber":56,"oldContent":""},{"type":"DELETE","lineNumber":57,"oldContent":"        // This is the key business logic for an agent-created ticket."},{"type":"DELETE","lineNumber":58,"oldContent":"        ticket.setCreatedBy(agent);"},{"type":"INSERT","lineNumber":62,"content":"                attachment.setFileName(\"attachment_\" + System.currentTimeMillis());"},{"type":"INSERT","lineNumber":63,"content":"                attachment.setTicket(ticket);"},{"type":"INSERT","lineNumber":64,"content":"                ticket.getAttachments().add(attachment);"},{"type":"DELETE","lineNumber":81,"oldContent":""},{"type":"DELETE","lineNumber":83,"oldContent":"        List<TicketStatus> activeStatuses = Arrays.asList("},{"type":"DELETE","lineNumber":84,"oldContent":"                TicketStatus.CREATED,"},{"type":"INSERT","lineNumber":92,"content":""},{"type":"INSERT","lineNumber":93,"content":"        return tickets.stream()"},{"type":"INSERT","lineNumber":94,"content":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"DELETE","lineNumber":134,"oldContent":""},{"type":"DELETE","lineNumber":135,"oldContent":"    @Transactional(readOnly = true)"},{"type":"DELETE","lineNumber":136,"oldContent":"    public List<AgentFeedbackDto> getFeedbackOnCreatedTickets(String agentUsername) {"},{"type":"DELETE","lineNumber":137,"oldContent":"        AppUser agent = userRepo.findByUsername(agentUsername)"},{"type":"DELETE","lineNumber":138,"oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));"},{"type":"DELETE","lineNumber":139,"oldContent":"        List<Feedback> feedbacks = feedbackRepo.findAllByTicket_CreatedByOrderByCreatedAtDesc(agent);"},{"type":"DELETE","lineNumber":140,"oldContent":""},{"type":"DELETE","lineNumber":141,"oldContent":""},{"type":"DELETE","lineNumber":142,"oldContent":"        return feedbacks.stream()"},{"type":"DELETE","lineNumber":143,"oldContent":"                .map(feedback -> new AgentFeedbackDto("},{"type":"DELETE","lineNumber":144,"oldContent":"                        feedback.getId(),"},{"type":"DELETE","lineNumber":145,"oldContent":"                        feedback.getTicket().getTicketUid(),"},{"type":"DELETE","lineNumber":146,"oldContent":"                        feedback.getTicket().getTitle(),"},{"type":"DELETE","lineNumber":147,"oldContent":"                        feedback.getUser().getFullName(), // The user who left the feedback"},{"type":"DELETE","lineNumber":148,"oldContent":"                        feedback.getRating(),"},{"type":"DELETE","lineNumber":149,"oldContent":"                        feedback.getComment(),"},{"type":"DELETE","lineNumber":150,"oldContent":"                        feedback.getCreatedAt()"},{"type":"DELETE","lineNumber":151,"oldContent":"                ))"},{"type":"DELETE","lineNumber":152,"oldContent":"                .collect(Collectors.toList());"},{"type":"DELETE","lineNumber":153,"oldContent":"    }"},{"type":"DELETE","lineNumber":181,"oldContent":"        feedback.setUser(customer);"},{"type":"INSERT","lineNumber":162,"content":"        feedback.setUser(customer);"},{"type":"INSERT","lineNumber":163,"content":""},{"type":"DELETE","lineNumber":185,"oldContent":""},{"type":"DELETE","lineNumber":202,"oldContent":"        feedback.setTicket(ticket);"}]},{"timestamp":1762027610662,"changes":[{"type":"DELETE","lineNumber":11,"oldContent":"import com.capstone.tele_ticketing_backend_1.repo.FeedbackRepo;"},{"type":"DELETE","lineNumber":13,"oldContent":"import java.time.LocalDateTime;"},{"type":"INSERT","lineNumber":14,"content":"import com.capstone.tele_ticketing_backend_1.repo.FeedbackRepo;"},{"type":"INSERT","lineNumber":16,"content":"import java.time.LocalDateTime;"},{"type":"DELETE","lineNumber":22,"oldContent":"    private TicketRepo ticketRepo;"},{"type":"INSERT","lineNumber":24,"content":"    @Autowired"},{"type":"INSERT","lineNumber":25,"content":"    private TicketRepo ticketRepo;"},{"type":"DELETE","lineNumber":27,"oldContent":"    @Autowired"},{"type":"MODIFY","lineNumber":46,"content":"","oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));"},{"type":"INSERT","lineNumber":50,"content":"        Ticket ticket = new Ticket();"},{"type":"INSERT","lineNumber":51,"content":"        ticket.setTitle(dto.getTitle());"},{"type":"DELETE","lineNumber":52,"oldContent":""},{"type":"DELETE","lineNumber":54,"oldContent":"        Ticket ticket = new Ticket();"},{"type":"DELETE","lineNumber":56,"oldContent":"        ticket.setCreatedBy(agent);"},{"type":"DELETE","lineNumber":59,"oldContent":"                attachment.setFileName(\"attachment_\" + System.currentTimeMillis());"},{"type":"DELETE","lineNumber":61,"oldContent":"                attachment.setTicket(ticket);"},{"type":"DELETE","lineNumber":63,"oldContent":"                ticket.getAttachments().add(attachment);"},{"type":"INSERT","lineNumber":61,"content":"                attachment.setFilePath(attUrl);"},{"type":"INSERT","lineNumber":62,"content":"                attachment.setFileName(\"attachment_\" + System.currentTimeMillis());"},{"type":"INSERT","lineNumber":63,"content":"                attachment.setTicket(ticket);"},{"type":"INSERT","lineNumber":64,"content":"                ticket.getAttachments().add(attachment);"},{"type":"DELETE","lineNumber":82,"oldContent":"                TicketStatus.CREATED,"},{"type":"DELETE","lineNumber":89,"oldContent":""},{"type":"DELETE","lineNumber":91,"oldContent":"        return tickets.stream()"},{"type":"DELETE","lineNumber":93,"oldContent":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"INSERT","lineNumber":91,"content":"        List<Ticket> tickets = ticketRepo.findAllByCreatedByAndStatusIn(agent, activeStatuses);"},{"type":"INSERT","lineNumber":92,"content":""},{"type":"INSERT","lineNumber":93,"content":"        return tickets.stream()"},{"type":"INSERT","lineNumber":94,"content":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"DELETE","lineNumber":142,"oldContent":"        feedback.setUser(customer);"},{"type":"DELETE","lineNumber":144,"oldContent":""},{"type":"INSERT","lineNumber":162,"content":"        feedback.setUser(customer);"},{"type":"INSERT","lineNumber":163,"content":""},{"type":"INSERT","lineNumber":180,"content":""},{"type":"INSERT","lineNumber":181,"content":"    // Finds all tickets CREATED BY a user with a specific status."},{"type":"INSERT","lineNumber":182,"content":"    List<Ticket> findAllByCreatedByAndStatus(AppUser user, TicketStatus status);"},{"type":"DELETE","lineNumber":182,"oldContent":""}]},{"timestamp":1762027614453,"changes":[{"type":"DELETE","lineNumber":12,"oldContent":"import com.capstone.tele_ticketing_backend_1.repo.FeedbackRepo;"},{"type":"DELETE","lineNumber":15,"oldContent":"import java.time.LocalDateTime;"},{"type":"INSERT","lineNumber":14,"content":"import com.capstone.tele_ticketing_backend_1.repo.FeedbackRepo;"},{"type":"INSERT","lineNumber":16,"content":"import java.time.LocalDateTime;"},{"type":"MODIFY","lineNumber":24,"content":"    @Autowired","oldContent":"    @Autowired"},{"type":"MODIFY","lineNumber":52,"content":"        ticket.setDescription(dto.getDescription());","oldContent":"        ticket.setDescription(dto.getDescription());"},{"type":"INSERT","lineNumber":59,"content":"            dto.getAttachments().forEach(attUrl -> {"},{"type":"INSERT","lineNumber":60,"content":"                Attachment attachment = new Attachment();"},{"type":"DELETE","lineNumber":61,"oldContent":"            dto.getAttachments().forEach(attUrl -> {"},{"type":"DELETE","lineNumber":64,"oldContent":"                Attachment attachment = new Attachment();"},{"type":"DELETE","lineNumber":68,"oldContent":"                attachment.setTicket(ticket);"},{"type":"DELETE","lineNumber":69,"oldContent":"            });"},{"type":"INSERT","lineNumber":68,"content":""},{"type":"INSERT","lineNumber":69,"content":"        // Dr. X's Fix: Now, we use the 'savedTicket' object, which is a persisted entity, to create the log."},{"type":"INSERT","lineNumber":82,"content":"                TicketStatus.ASSIGNED,"},{"type":"INSERT","lineNumber":83,"content":"                TicketStatus.IN_PROGRESS,"},{"type":"INSERT","lineNumber":84,"content":"                TicketStatus.NEEDS_TRIAGING,"},{"type":"INSERT","lineNumber":85,"content":"                TicketStatus.REOPENED,"},{"type":"DELETE","lineNumber":89,"oldContent":"        List<Ticket> tickets = ticketRepo.findAllByCreatedByAndStatusIn(agent, activeStatuses);"},{"type":"DELETE","lineNumber":90,"oldContent":""},{"type":"DELETE","lineNumber":92,"oldContent":"        return tickets.stream()"},{"type":"DELETE","lineNumber":94,"oldContent":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"DELETE","lineNumber":160,"oldContent":"        feedback.setUser(customer);"},{"type":"MODIFY","lineNumber":162,"content":"        feedback.setUser(customer);","oldContent":""},{"type":"INSERT","lineNumber":163,"content":""},{"type":"INSERT","lineNumber":181,"content":"    "},{"type":"DELETE","lineNumber":182,"oldContent":"    // Finds all tickets CREATED BY a user with a specific status."},{"type":"DELETE","lineNumber":184,"oldContent":"    List<Ticket> findAllByCreatedByAndStatus(AppUser user, TicketStatus status);"}]},{"timestamp":1762027626485,"changes":[{"type":"DELETE","lineNumber":13,"oldContent":"import com.capstone.tele_ticketing_backend_1.repo.FeedbackRepo;"},{"type":"DELETE","lineNumber":15,"oldContent":"import java.time.LocalDateTime;"},{"type":"INSERT","lineNumber":14,"content":"import com.capstone.tele_ticketing_backend_1.repo.FeedbackRepo;"},{"type":"INSERT","lineNumber":16,"content":"import java.time.LocalDateTime;"},{"type":"INSERT","lineNumber":23,"content":""},{"type":"DELETE","lineNumber":24,"oldContent":"    @Autowired"},{"type":"INSERT","lineNumber":51,"content":"        ticket.setTitle(dto.getTitle());"},{"type":"DELETE","lineNumber":52,"oldContent":"        ticket.setDescription(dto.getDescription());"},{"type":"MODIFY","lineNumber":61,"content":"                attachment.setFilePath(attUrl);","oldContent":"                attachment.setFilePath(attUrl);"},{"type":"MODIFY","lineNumber":71,"content":"","oldContent":"        return ticketRepo.save(ticket);"},{"type":"DELETE","lineNumber":83,"oldContent":"                TicketStatus.FIXED,"},{"type":"DELETE","lineNumber":85,"oldContent":"                TicketStatus.RESOLVED"},{"type":"DELETE","lineNumber":87,"oldContent":"        );"},{"type":"INSERT","lineNumber":86,"content":"                TicketStatus.FIXED,"},{"type":"INSERT","lineNumber":87,"content":"                TicketStatus.RESOLVED"},{"type":"INSERT","lineNumber":88,"content":"        );"},{"type":"INSERT","lineNumber":161,"content":"        // Data Integrity: The feedback is FROM the customer, even if submitted by the agent."},{"type":"DELETE","lineNumber":163,"oldContent":"        // Data Integrity: The feedback is FROM the customer, even if submitted by the agent."},{"type":"MODIFY","lineNumber":181,"content":"    @Transactional(readOnly = true)","oldContent":"    "},{"type":"INSERT","lineNumber":182,"content":"    public List<TicketSummaryDto> getAgentFeedbackPendingTickets(String agentUsername) {"},{"type":"INSERT","lineNumber":183,"content":"        AppUser agent = userRepo.findByUsername(agentUsername)"},{"type":"INSERT","lineNumber":184,"content":"                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));"},{"type":"INSERT","lineNumber":185,"content":""},{"type":"INSERT","lineNumber":186,"content":"        List<Ticket> tickets = ticketRepo.findAllByCreatedByAndStatus(agent, TicketStatus.FIXED);"},{"type":"INSERT","lineNumber":187,"content":""},{"type":"INSERT","lineNumber":188,"content":"        return tickets.stream()"},{"type":"INSERT","lineNumber":189,"content":"                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))"},{"type":"INSERT","lineNumber":190,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":191,"content":"    }"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/AgentController.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/AgentController.java","baseContent":"package com.capstone.tele_ticketing_backend_1.controller;\n\n// File: com/capstone/tele_ticketing_backend_1/controller/AgentController.java\npackage com.capstone.tele_ticketing_backend_1.controller;\n\nimport com.capstone.tele_ticketing_backend_1.dtos.AgentCreateTicketRequestDto;\nimport com.capstone.tele_ticketing_backend_1.dtos.TicketSummaryDto;\nimport com.capstone.tele_ticketing_backend_1.entities.Ticket;\nimport com.capstone.tele_ticketing_backend_1.service.AgentTicketService;\nimport jakarta.validation.Valid;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.HttpStatus;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.security.access.prepost.PreAuthorize;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.web.bind.annotation.*;\n\nimport java.util.List;\n\n@RestController\n@RequestMapping(\"/api/v1/agent\")\n@PreAuthorize(\"hasRole('AGENT')\")\npublic class AgentController {\n\n    @Autowired\n    private AgentTicketService agentTicketService;\n\n    @PostMapping(\"/tickets\")\n    public ResponseEntity<Ticket> createTicket(@Valid @RequestBody AgentCreateTicketRequestDto createDto) {\n        String agentUsername = SecurityContextHolder.getContext().getAuthentication().getName();\n        Ticket createdTicket = agentTicketService.createTicketForCustomer(createDto, agentUsername);\n        return new ResponseEntity<>(createdTicket, HttpStatus.CREATED);\n    }\n\n    @GetMapping(\"/tickets/created-by-me\")\n    public ResponseEntity<List<TicketSummaryDto>> getTicketsCreatedByMe() {\n        String agentUsername = SecurityContextHolder.getContext().getAuthentication().getName();\n        List<TicketSummaryDto> tickets = agentTicketService.getAgentCreatedTickets(agentUsername);\n        return ResponseEntity.ok(tickets);\n    }\n}","baseTimestamp":1761801825751,"deltas":[{"timestamp":1761801829295,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"// File: com/capstone/tele_ticketing_backend_1/controller/AgentController.java"},{"type":"DELETE","lineNumber":3,"oldContent":"package com.capstone.tele_ticketing_backend_1.controller;"},{"type":"DELETE","lineNumber":4,"oldContent":""}]},{"timestamp":1761801834150,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"import com.capstone.tele_ticketing_backend_1.dtos.AgentCreateTicketRequestDto;"},{"type":"MODIFY","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.dto.AgentCreateTicketRequestDto;","oldContent":"import com.capstone.tele_ticketing_backend_1.dtos.TicketSummaryDto;"},{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;"}]},{"timestamp":1761893404396,"changes":[{"type":"MODIFY","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;","oldContent":"import com.capstone.tele_ticketing_backend_1.dtos.TicketSummaryDto;"}]},{"timestamp":1761893483286,"changes":[{"type":"MODIFY","lineNumber":25,"content":"    // 1. Change the return type here from Ticket to TicketDetailDto","oldContent":"    public ResponseEntity<Ticket> createTicket(@Valid @RequestBody AgentCreateTicketRequestDto createDto) {"},{"type":"INSERT","lineNumber":26,"content":"    public ResponseEntity<TicketDetailDto> createTicket(@Valid @RequestBody AgentCreateTicketRequestDto createDto) {"},{"type":"DELETE","lineNumber":27,"oldContent":"        Ticket createdTicket = agentTicketService.createTicketForCustomer(createDto, agentUsername);"},{"type":"INSERT","lineNumber":28,"content":""},{"type":"INSERT","lineNumber":29,"content":"        // 2. The variable 'createdTicket' is now correctly typed as TicketDetailDto"},{"type":"INSERT","lineNumber":30,"content":"        TicketDetailDto createdTicket = agentTicketService.createTicketForCustomer(createDto, agentUsername);"},{"type":"INSERT","lineNumber":31,"content":""}]},{"timestamp":1761893488423,"changes":[{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;"},{"type":"DELETE","lineNumber":29,"oldContent":"        return new ResponseEntity<>(createdTicket, HttpStatus.CREATED);"},{"type":"DELETE","lineNumber":31,"oldContent":"    }"},{"type":"INSERT","lineNumber":33,"content":"        return new ResponseEntity<>(createdTicket, HttpStatus.CREATED);"},{"type":"INSERT","lineNumber":34,"content":"    }"}]},{"timestamp":1761893492728,"changes":[{"type":"DELETE","lineNumber":5,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.Ticket;"},{"type":"MODIFY","lineNumber":32,"content":"        return new ResponseEntity<>(createdTicket, HttpStatus.CREATED);","oldContent":"        return new ResponseEntity<>(createdTicket, HttpStatus.CREATED);"}]},{"timestamp":1762024996214,"changes":[{"type":"MODIFY","lineNumber":32,"content":"        return new ResponseEntity<>(createdTicket, HttpStatus.CREATED);","oldContent":"        return new ResponseEntity<>(createdTicket, HttpStatus.CREATED);"},{"type":"INSERT","lineNumber":41,"content":""},{"type":"INSERT","lineNumber":42,"content":"    @GetMapping(\"/tickets/active\")"},{"type":"INSERT","lineNumber":43,"content":"    public ResponseEntity<List<TicketSummaryDto>> getActiveTickets() {"},{"type":"INSERT","lineNumber":44,"content":"        String agentUsername = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"INSERT","lineNumber":45,"content":"        return ResponseEntity.ok(agentTicketService.getAgentActiveTickets(agentUsername));"},{"type":"INSERT","lineNumber":46,"content":"    }"},{"type":"INSERT","lineNumber":47,"content":""},{"type":"INSERT","lineNumber":48,"content":"    // Dr. X's Addition: A dedicated endpoint for the agent's notification feed."},{"type":"INSERT","lineNumber":49,"content":"    @GetMapping(\"/notifications\")"},{"type":"INSERT","lineNumber":50,"content":"    public ResponseEntity<List<NotificationDto>> getNotifications() {"},{"type":"INSERT","lineNumber":51,"content":"        String agentUsername = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"INSERT","lineNumber":52,"content":"        return ResponseEntity.ok(agentTicketService.getNotifications(agentUsername));"},{"type":"INSERT","lineNumber":53,"content":"    }"}]},{"timestamp":1762025003491,"changes":[{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.dto.NotificationDto;"},{"type":"INSERT","lineNumber":32,"content":""},{"type":"DELETE","lineNumber":32,"oldContent":"        return new ResponseEntity<>(createdTicket, HttpStatus.CREATED);"},{"type":"DELETE","lineNumber":42,"oldContent":"}"},{"type":"DELETE","lineNumber":44,"oldContent":"    }"},{"type":"DELETE","lineNumber":46,"oldContent":"        return ResponseEntity.ok(agentTicketService.getNotifications(agentUsername));"},{"type":"DELETE","lineNumber":48,"oldContent":"        String agentUsername = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"DELETE","lineNumber":50,"oldContent":"    public ResponseEntity<List<NotificationDto>> getNotifications() {"},{"type":"DELETE","lineNumber":52,"oldContent":"    @GetMapping(\"/notifications\")"},{"type":"INSERT","lineNumber":50,"content":"    @GetMapping(\"/notifications\")"},{"type":"INSERT","lineNumber":51,"content":"    public ResponseEntity<List<NotificationDto>> getNotifications() {"},{"type":"INSERT","lineNumber":52,"content":"        String agentUsername = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"INSERT","lineNumber":53,"content":"        return ResponseEntity.ok(agentTicketService.getNotifications(agentUsername));"},{"type":"INSERT","lineNumber":54,"content":"    }"},{"type":"INSERT","lineNumber":55,"content":"}"}]},{"timestamp":1762026215185,"changes":[{"type":"INSERT","lineNumber":14,"content":"import com.capstone.tele_ticketing_backend_1.dto.AgentFeedbackDto;"},{"type":"DELETE","lineNumber":32,"oldContent":"        return new ResponseEntity<>(createdTicket, HttpStatus.CREATED);"},{"type":"INSERT","lineNumber":34,"content":"        return new ResponseEntity<>(createdTicket, HttpStatus.CREATED);"},{"type":"INSERT","lineNumber":48,"content":"    }"},{"type":"INSERT","lineNumber":49,"content":""},{"type":"INSERT","lineNumber":50,"content":"    // Dr. X's Addition: A dedicated endpoint for the agent's notification feed."},{"type":"DELETE","lineNumber":49,"oldContent":"    }"},{"type":"DELETE","lineNumber":52,"oldContent":""},{"type":"DELETE","lineNumber":54,"oldContent":"    // Dr. X's Addition: A dedicated endpoint for the agent's notification feed."}]},{"timestamp":1762026229019,"changes":[{"type":"DELETE","lineNumber":48,"oldContent":"    @GetMapping(\"/notifications\")"},{"type":"DELETE","lineNumber":50,"oldContent":"    public ResponseEntity<List<NotificationDto>> getNotifications() {"},{"type":"INSERT","lineNumber":51,"content":"    @GetMapping(\"/notifications\")"},{"type":"INSERT","lineNumber":52,"content":"    public ResponseEntity<List<NotificationDto>> getNotifications() {"},{"type":"INSERT","lineNumber":56,"content":""},{"type":"INSERT","lineNumber":57,"content":"    @GetMapping(\"/feedback\")"},{"type":"INSERT","lineNumber":58,"content":"    public ResponseEntity<List<AgentFeedbackDto>> getFeedbackHistory() {"},{"type":"INSERT","lineNumber":59,"content":"        String agentUsername = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"INSERT","lineNumber":60,"content":"        return ResponseEntity.ok(agentTicketService.getFeedbackOnCreatedTickets(agentUsername));"},{"type":"INSERT","lineNumber":61,"content":"    }"}]},{"timestamp":1762027129951,"changes":[{"type":"DELETE","lineNumber":49,"oldContent":"    @GetMapping(\"/notifications\")"},{"type":"MODIFY","lineNumber":51,"content":"    @GetMapping(\"/notifications\")","oldContent":"    public ResponseEntity<List<NotificationDto>> getNotifications() {"},{"type":"INSERT","lineNumber":52,"content":"    public ResponseEntity<List<NotificationDto>> getNotifications() {"},{"type":"DELETE","lineNumber":57,"oldContent":"}"},{"type":"MODIFY","lineNumber":59,"content":"        String agentUsername = SecurityContextHolder.getContext().getAuthentication().getName();","oldContent":"    }"},{"type":"INSERT","lineNumber":61,"content":"    }"},{"type":"INSERT","lineNumber":62,"content":""},{"type":"INSERT","lineNumber":63,"content":"    @PostMapping(\"/tickets/{id}/feedback\")"},{"type":"INSERT","lineNumber":64,"content":"    public ResponseEntity<TicketDetailDto> addFeedback(@PathVariable Long id, @Valid @RequestBody FeedbackRequestDto feedbackRequestDto) {"},{"type":"INSERT","lineNumber":66,"content":"        TicketDetailDto updatedTicket = agentTicketService.addFeedbackForCustomer(id, feedbackRequestDto, agentUsername);"},{"type":"INSERT","lineNumber":67,"content":"        return ResponseEntity.ok(updatedTicket);"},{"type":"INSERT","lineNumber":68,"content":"    }"},{"type":"INSERT","lineNumber":69,"content":"}"}]},{"timestamp":1762027134158,"changes":[{"type":"INSERT","lineNumber":50,"content":"    // Dr. X's Addition: A dedicated endpoint for the agent's notification feed."},{"type":"DELETE","lineNumber":52,"oldContent":"    // Dr. X's Addition: A dedicated endpoint for the agent's notification feed."},{"type":"DELETE","lineNumber":56,"oldContent":""},{"type":"DELETE","lineNumber":57,"oldContent":"    @GetMapping(\"/feedback\")"},{"type":"DELETE","lineNumber":58,"oldContent":"        String agentUsername = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"DELETE","lineNumber":59,"oldContent":"    public ResponseEntity<List<AgentFeedbackDto>> getFeedbackHistory() {"},{"type":"DELETE","lineNumber":60,"oldContent":"    }"},{"type":"DELETE","lineNumber":61,"oldContent":"        return ResponseEntity.ok(agentTicketService.getFeedbackOnCreatedTickets(agentUsername));"},{"type":"DELETE","lineNumber":62,"oldContent":""},{"type":"DELETE","lineNumber":63,"oldContent":"        String agentUsername = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"INSERT","lineNumber":56,"content":"    "},{"type":"DELETE","lineNumber":65,"oldContent":"}"},{"type":"DELETE","lineNumber":67,"oldContent":"    }"},{"type":"DELETE","lineNumber":68,"oldContent":"        return ResponseEntity.ok(updatedTicket);"},{"type":"INSERT","lineNumber":59,"content":"        String agentUsername = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"INSERT","lineNumber":61,"content":"        return ResponseEntity.ok(updatedTicket);"},{"type":"INSERT","lineNumber":62,"content":"    }"},{"type":"INSERT","lineNumber":63,"content":"}"}]},{"timestamp":1762027139562,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.AgentCreateTicketRequestDto;"},{"type":"DELETE","lineNumber":3,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.NotificationDto;"},{"type":"DELETE","lineNumber":4,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;"},{"type":"DELETE","lineNumber":5,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;"},{"type":"INSERT","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.dto.*;"},{"type":"DELETE","lineNumber":14,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.AgentFeedbackDto;"},{"type":"INSERT","lineNumber":53,"content":"    @PostMapping(\"/tickets/{id}/feedback\")"},{"type":"INSERT","lineNumber":54,"content":"    public ResponseEntity<TicketDetailDto> addFeedback(@PathVariable Long id, @Valid @RequestBody FeedbackRequestDto feedbackRequestDto) {"},{"type":"INSERT","lineNumber":56,"content":"        TicketDetailDto updatedTicket = agentTicketService.addFeedbackForCustomer(id, feedbackRequestDto, agentUsername);"},{"type":"DELETE","lineNumber":61,"oldContent":"    @PostMapping(\"/tickets/{id}/feedback\")"},{"type":"DELETE","lineNumber":62,"oldContent":"    public ResponseEntity<TicketDetailDto> addFeedback(@PathVariable Long id, @Valid @RequestBody FeedbackRequestDto feedbackRequestDto) {"},{"type":"DELETE","lineNumber":63,"oldContent":"        TicketDetailDto updatedTicket = agentTicketService.addFeedbackForCustomer(id, feedbackRequestDto, agentUsername);"}]},{"timestamp":1762027141893,"changes":[{"type":"DELETE","lineNumber":49,"oldContent":"    @PostMapping(\"/tickets/{id}/feedback\")"},{"type":"DELETE","lineNumber":51,"oldContent":"    public ResponseEntity<TicketDetailDto> addFeedback(@PathVariable Long id, @Valid @RequestBody FeedbackRequestDto feedbackRequestDto) {"},{"type":"DELETE","lineNumber":54,"oldContent":"        TicketDetailDto updatedTicket = agentTicketService.addFeedbackForCustomer(id, feedbackRequestDto, agentUsername);"},{"type":"DELETE","lineNumber":55,"oldContent":"    "},{"type":"INSERT","lineNumber":52,"content":""},{"type":"INSERT","lineNumber":53,"content":"    @PostMapping(\"/tickets/{id}/feedback\")"},{"type":"INSERT","lineNumber":54,"content":"    public ResponseEntity<TicketDetailDto> addFeedback(@PathVariable Long id, @Valid @RequestBody FeedbackRequestDto feedbackRequestDto) {"},{"type":"INSERT","lineNumber":56,"content":"        TicketDetailDto updatedTicket = agentTicketService.addFeedbackForCustomer(id, feedbackRequestDto, agentUsername);"}]},{"timestamp":1762027684698,"changes":[{"type":"DELETE","lineNumber":50,"oldContent":""},{"type":"MODIFY","lineNumber":52,"content":"","oldContent":"    @PostMapping(\"/tickets/{id}/feedback\")"},{"type":"INSERT","lineNumber":53,"content":"    @PostMapping(\"/tickets/{id}/feedback\")"},{"type":"MODIFY","lineNumber":56,"content":"        TicketDetailDto updatedTicket = agentTicketService.addFeedbackForCustomer(id, feedbackRequestDto, agentUsername);","oldContent":"        TicketDetailDto updatedTicket = agentTicketService.addFeedbackForCustomer(id, feedbackRequestDto, agentUsername);"},{"type":"INSERT","lineNumber":59,"content":""},{"type":"INSERT","lineNumber":60,"content":"    @GetMapping(\"/tickets/feedback-pending\")"},{"type":"INSERT","lineNumber":61,"content":"    public ResponseEntity<List<TicketSummaryDto>> getFeedbackPendingTickets() {"},{"type":"INSERT","lineNumber":62,"content":"        String agentUsername = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"INSERT","lineNumber":63,"content":"        return ResponseEntity.ok(agentTicketService.getAgentFeedbackPendingTickets(agentUsername));"},{"type":"INSERT","lineNumber":64,"content":"    }"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/jwt/JwtUtils.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/jwt/JwtUtils.java","baseContent":"import java.security.Key;\nimport java.util.Date;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.core.GrantedAuthority;\nimport org.springframework.stereotype.Component;\n\nimport com.capstone.tele_ticketing_backend_1.security.service.UserDetailsImpl;\n\nimport io.jsonwebtoken.*;\nimport io.jsonwebtoken.io.Decoders;\nimport io.jsonwebtoken.security.Keys;\n\n@Component\npublic class JwtUtils {\n    private static final Logger logger = LoggerFactory.getLogger(JwtUtils.class);\n\n    @Value(\"${jwtSecret}\")\n    private String jwtSecret;\n\n    @Value(\"${jwtExpirationMs}\")\n    private int jwtExpirationMs;\n\n    public String generateJwtToken(Authentication authentication) {\n\n        UserDetailsImpl userPrincipal = (UserDetailsImpl) authentication.getPrincipal();\n\n        // Dr. X's Fix: This is the new logic.\n        // 1. Get the collection of authorities (roles) from the authenticated user.\n        // 2. Convert them into a simple list of strings (e.g., [\"ROLE_CUSTOMER\"]).\n        List<String> roles = userPrincipal.getAuthorities().stream()\n                .map(GrantedAuthority::getAuthority)\n                .collect(Collectors.toList());\n\n        return Jwts.builder()\n                .setSubject((userPrincipal.getUsername()))\n                .setIssuedAt(new Date())\n                .setExpiration(new Date((new Date()).getTime() + jwtExpirationMs))\n\n                // 2. This is the critical new line that adds the roles to the token's payload.\n                .claim(\"authorities\", roles)\n\n                .signWith(getSignInKey(), SignatureAlgorithm.HS512)\n                .compact();\n    }\n\n    public String getUserNameFromJwtToken(String token) {\n        return Jwts.parserBuilder().setSigningKey(getSignInKey()).build().parseClaimsJws(token).getBody().getSubject();\n    }\n\n    public boolean validateJwtToken(String authToken) {\n        try {\n            Jwts.parserBuilder().setSigningKey(getSignInKey()).build().parseClaimsJws(authToken);\n            return true;\n        } catch (MalformedJwtException e) {\n            logger.error(\"Invalid JWT token: {}\", e.getMessage());\n        } catch (ExpiredJwtException e) {\n            logger.error(\"JWT token is expired: {}\", e.getMessage());\n        } catch (UnsupportedJwtException e) {\n            logger.error(\"JWT token is unsupported: {}\", e.getMessage());\n        } catch (IllegalArgumentException e) {\n            logger.error(\"JWT claims string is empty: {}\", e.getMessage());\n        }\n\n        return false;\n    }\n\n    private Key getSignInKey() {\n        byte[] keyBytes = Decoders.BASE64.decode(jwtSecret);\n        return Keys.hmacShaKeyFor(keyBytes);\n    }\n}","baseTimestamp":1761807568734,"deltas":[{"timestamp":1761807571010,"changes":[{"type":"DELETE","lineNumber":0,"oldContent":"import java.security.Key;"},{"type":"DELETE","lineNumber":1,"oldContent":"import java.util.Date;"},{"type":"DELETE","lineNumber":2,"oldContent":"import java.util.List;"},{"type":"DELETE","lineNumber":3,"oldContent":"import java.util.stream.Collectors;"},{"type":"INSERT","lineNumber":0,"content":"package com.capstone.tele_ticketing_backend_1.security.jwt;"},{"type":"INSERT","lineNumber":2,"content":""},{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.security.service.UserDetailsImpl;"},{"type":"INSERT","lineNumber":4,"content":"import io.jsonwebtoken.*;"},{"type":"INSERT","lineNumber":5,"content":"import io.jsonwebtoken.io.Decoders;"},{"type":"INSERT","lineNumber":6,"content":"import io.jsonwebtoken.security.Keys;"},{"type":"DELETE","lineNumber":9,"oldContent":"import org.springframework.security.core.GrantedAuthority;"},{"type":"DELETE","lineNumber":12,"oldContent":"import com.capstone.tele_ticketing_backend_1.security.service.UserDetailsImpl;"},{"type":"INSERT","lineNumber":13,"content":"import java.security.Key;"},{"type":"INSERT","lineNumber":14,"content":"import java.util.Date;"},{"type":"DELETE","lineNumber":14,"oldContent":"import io.jsonwebtoken.*;"},{"type":"DELETE","lineNumber":15,"oldContent":"import io.jsonwebtoken.io.Decoders;"},{"type":"DELETE","lineNumber":16,"oldContent":"import io.jsonwebtoken.security.Keys;"},{"type":"DELETE","lineNumber":17,"oldContent":""},{"type":"DELETE","lineNumber":20,"oldContent":"    private static final Logger logger = LoggerFactory.getLogger(JwtUtils.class);"},{"type":"INSERT","lineNumber":18,"content":"  private static final Logger logger = LoggerFactory.getLogger(JwtUtils.class);"},{"type":"DELETE","lineNumber":22,"oldContent":"    @Value(\"${jwtSecret}\")"},{"type":"DELETE","lineNumber":23,"oldContent":"    private String jwtSecret;"},{"type":"INSERT","lineNumber":20,"content":"  @Value(\"${jwtSecret}\")"},{"type":"INSERT","lineNumber":21,"content":"  private String jwtSecret;"},{"type":"DELETE","lineNumber":25,"oldContent":"    @Value(\"${jwtExpirationMs}\")"},{"type":"DELETE","lineNumber":26,"oldContent":"    private int jwtExpirationMs;"},{"type":"INSERT","lineNumber":23,"content":"  @Value(\"${jwtExpirationMs}\")"},{"type":"INSERT","lineNumber":24,"content":"  private int jwtExpirationMs;"},{"type":"DELETE","lineNumber":28,"oldContent":"    public String generateJwtToken(Authentication authentication) {"},{"type":"INSERT","lineNumber":26,"content":"  public String generateJwtToken(Authentication authentication) {"},{"type":"DELETE","lineNumber":30,"oldContent":"        UserDetailsImpl userPrincipal = (UserDetailsImpl) authentication.getPrincipal();"},{"type":"INSERT","lineNumber":28,"content":"    UserDetailsImpl userPrincipal = (UserDetailsImpl) authentication.getPrincipal();"},{"type":"DELETE","lineNumber":32,"oldContent":"        // Dr. X's Fix: This is the new logic."},{"type":"DELETE","lineNumber":33,"oldContent":"        // 1. Get the collection of authorities (roles) from the authenticated user."},{"type":"DELETE","lineNumber":34,"oldContent":"        // 2. Convert them into a simple list of strings (e.g., [\"ROLE_CUSTOMER\"])."},{"type":"DELETE","lineNumber":35,"oldContent":"        List<String> roles = userPrincipal.getAuthorities().stream()"},{"type":"DELETE","lineNumber":36,"oldContent":"                .map(GrantedAuthority::getAuthority)"},{"type":"DELETE","lineNumber":37,"oldContent":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":30,"content":"    return Jwts.builder().setSubject((userPrincipal.getUsername()))"},{"type":"INSERT","lineNumber":31,"content":"    \t\t.setIssuedAt(new Date())"},{"type":"INSERT","lineNumber":32,"content":"        .setExpiration(new Date((new Date()).getTime() + jwtExpirationMs))"},{"type":"INSERT","lineNumber":33,"content":"        .signWith(getSignInKey(),SignatureAlgorithm.HS512)"},{"type":"INSERT","lineNumber":34,"content":"        .compact(); "},{"type":"INSERT","lineNumber":35,"content":"  }"},{"type":"DELETE","lineNumber":39,"oldContent":"        return Jwts.builder()"},{"type":"DELETE","lineNumber":40,"oldContent":"                .setSubject((userPrincipal.getUsername()))"},{"type":"DELETE","lineNumber":41,"oldContent":"                .setIssuedAt(new Date())"},{"type":"DELETE","lineNumber":42,"oldContent":"                .setExpiration(new Date((new Date()).getTime() + jwtExpirationMs))"},{"type":"INSERT","lineNumber":37,"content":"  public String getUserNameFromJwtToken(String token) {"},{"type":"INSERT","lineNumber":38,"content":"   //0.9.0// return Jwts.parser().setSigningKey(getSignInKey()).parseClaimsJws(token).getBody().getSubject();"},{"type":"INSERT","lineNumber":39,"content":"\t//0.11.5  //return Jwts.parserBuilder().setSigningKey(getSignInKey()).build().parseClaimsJws(token).getBody().getSubject();"},{"type":"INSERT","lineNumber":40,"content":"\t  return Jwts.parserBuilder().setSigningKey(getSignInKey()).build().parseClaimsJws(token).getBody().getSubject();"},{"type":"INSERT","lineNumber":41,"content":"  }"},{"type":"DELETE","lineNumber":44,"oldContent":"                // 2. This is the critical new line that adds the roles to the token's payload."},{"type":"DELETE","lineNumber":45,"oldContent":"                .claim(\"authorities\", roles)"},{"type":"DELETE","lineNumber":46,"oldContent":""},{"type":"DELETE","lineNumber":47,"oldContent":"                .signWith(getSignInKey(), SignatureAlgorithm.HS512)"},{"type":"DELETE","lineNumber":48,"oldContent":"                .compact();"},{"type":"INSERT","lineNumber":43,"content":"  public boolean validateJwtToken(String authToken) {"},{"type":"INSERT","lineNumber":44,"content":"    try {"},{"type":"INSERT","lineNumber":45,"content":"      //Jwts.parser().setSigningKey(getSignInKey()).parseClaimsJws(authToken);"},{"type":"INSERT","lineNumber":46,"content":"    \tJwts.parserBuilder().setSigningKey(getSignInKey()).build().parseClaimsJws(authToken);"},{"type":"INSERT","lineNumber":47,"content":"    \treturn true;"},{"type":"INSERT","lineNumber":48,"content":"\t}catch (MalformedJwtException e) {"},{"type":"INSERT","lineNumber":49,"content":"      logger.error(\"Invalid JWT token: {}\", e.getMessage());"},{"type":"INSERT","lineNumber":50,"content":"    } catch (ExpiredJwtException e) {"},{"type":"INSERT","lineNumber":51,"content":"      logger.error(\"JWT token is expired: {}\", e.getMessage());"},{"type":"INSERT","lineNumber":52,"content":"    } catch (UnsupportedJwtException e) {"},{"type":"INSERT","lineNumber":53,"content":"      logger.error(\"JWT token is unsupported: {}\", e.getMessage());"},{"type":"INSERT","lineNumber":54,"content":"    } catch (IllegalArgumentException e) {"},{"type":"INSERT","lineNumber":55,"content":"      logger.error(\"JWT claims string is empty: {}\", e.getMessage());"},{"type":"DELETE","lineNumber":51,"oldContent":"    public String getUserNameFromJwtToken(String token) {"},{"type":"DELETE","lineNumber":52,"oldContent":"        return Jwts.parserBuilder().setSigningKey(getSignInKey()).build().parseClaimsJws(token).getBody().getSubject();"},{"type":"DELETE","lineNumber":53,"oldContent":"    }"},{"type":"DELETE","lineNumber":54,"oldContent":""},{"type":"DELETE","lineNumber":55,"oldContent":"    public boolean validateJwtToken(String authToken) {"},{"type":"DELETE","lineNumber":56,"oldContent":"        try {"},{"type":"DELETE","lineNumber":57,"oldContent":"            Jwts.parserBuilder().setSigningKey(getSignInKey()).build().parseClaimsJws(authToken);"},{"type":"DELETE","lineNumber":58,"oldContent":"            return true;"},{"type":"DELETE","lineNumber":59,"oldContent":"        } catch (MalformedJwtException e) {"},{"type":"DELETE","lineNumber":60,"oldContent":"            logger.error(\"Invalid JWT token: {}\", e.getMessage());"},{"type":"DELETE","lineNumber":61,"oldContent":"        } catch (ExpiredJwtException e) {"},{"type":"DELETE","lineNumber":62,"oldContent":"            logger.error(\"JWT token is expired: {}\", e.getMessage());"},{"type":"DELETE","lineNumber":63,"oldContent":"        } catch (UnsupportedJwtException e) {"},{"type":"DELETE","lineNumber":64,"oldContent":"            logger.error(\"JWT token is unsupported: {}\", e.getMessage());"},{"type":"DELETE","lineNumber":65,"oldContent":"        } catch (IllegalArgumentException e) {"},{"type":"DELETE","lineNumber":66,"oldContent":"            logger.error(\"JWT claims string is empty: {}\", e.getMessage());"},{"type":"DELETE","lineNumber":67,"oldContent":"        }"},{"type":"DELETE","lineNumber":68,"oldContent":""},{"type":"DELETE","lineNumber":69,"oldContent":"        return false;"},{"type":"DELETE","lineNumber":70,"oldContent":"    }"},{"type":"DELETE","lineNumber":71,"oldContent":""},{"type":"DELETE","lineNumber":72,"oldContent":"    private Key getSignInKey() {"},{"type":"DELETE","lineNumber":73,"oldContent":"        byte[] keyBytes = Decoders.BASE64.decode(jwtSecret);"},{"type":"DELETE","lineNumber":74,"oldContent":"        return Keys.hmacShaKeyFor(keyBytes);"},{"type":"DELETE","lineNumber":75,"oldContent":"    }"},{"type":"INSERT","lineNumber":58,"content":"    return false;"},{"type":"INSERT","lineNumber":59,"content":"  }"},{"type":"INSERT","lineNumber":60,"content":"  "},{"type":"INSERT","lineNumber":61,"content":"  private Key getSignInKey() {"},{"type":"INSERT","lineNumber":62,"content":"\t    byte[] keyBytes = Decoders.BASE64.decode(jwtSecret);"},{"type":"INSERT","lineNumber":63,"content":"\t    return Keys.hmacShaKeyFor(keyBytes);"},{"type":"INSERT","lineNumber":64,"content":"\t  }"}]},{"timestamp":1761807575323,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"import com.capstone.tele_ticketing_backend_1.security.service.UserDetailsImpl;"},{"type":"MODIFY","lineNumber":2,"content":"import java.security.Key;","oldContent":"import io.jsonwebtoken.*;"},{"type":"INSERT","lineNumber":3,"content":"import java.util.Date;"},{"type":"INSERT","lineNumber":4,"content":"import java.util.List;"},{"type":"INSERT","lineNumber":5,"content":"import java.util.stream.Collectors;"},{"type":"DELETE","lineNumber":5,"oldContent":"import io.jsonwebtoken.io.Decoders;"},{"type":"DELETE","lineNumber":7,"oldContent":"import io.jsonwebtoken.security.Keys;"},{"type":"INSERT","lineNumber":11,"content":"import org.springframework.security.core.GrantedAuthority;"},{"type":"DELETE","lineNumber":13,"oldContent":"import java.security.Key;"},{"type":"INSERT","lineNumber":14,"content":"import com.capstone.tele_ticketing_backend_1.security.service.UserDetailsImpl;"},{"type":"DELETE","lineNumber":15,"oldContent":"import java.util.Date;"},{"type":"MODIFY","lineNumber":16,"content":"import io.jsonwebtoken.*;","oldContent":"  private static final Logger logger = LoggerFactory.getLogger(JwtUtils.class);"},{"type":"INSERT","lineNumber":17,"content":"import io.jsonwebtoken.io.Decoders;"},{"type":"INSERT","lineNumber":18,"content":"import io.jsonwebtoken.security.Keys;"},{"type":"INSERT","lineNumber":19,"content":""},{"type":"DELETE","lineNumber":19,"oldContent":"  @Value(\"${jwtSecret}\")"},{"type":"DELETE","lineNumber":20,"oldContent":"  private String jwtSecret;"},{"type":"INSERT","lineNumber":22,"content":"    private static final Logger logger = LoggerFactory.getLogger(JwtUtils.class);"},{"type":"DELETE","lineNumber":22,"oldContent":"  @Value(\"${jwtExpirationMs}\")"},{"type":"DELETE","lineNumber":23,"oldContent":"  private int jwtExpirationMs;"},{"type":"INSERT","lineNumber":24,"content":"    @Value(\"${jwtSecret}\")"},{"type":"INSERT","lineNumber":25,"content":"    private String jwtSecret;"},{"type":"DELETE","lineNumber":25,"oldContent":"  public String generateJwtToken(Authentication authentication) {"},{"type":"INSERT","lineNumber":27,"content":"    @Value(\"${jwtExpirationMs}\")"},{"type":"INSERT","lineNumber":28,"content":"    private int jwtExpirationMs;"},{"type":"DELETE","lineNumber":27,"oldContent":"    UserDetailsImpl userPrincipal = (UserDetailsImpl) authentication.getPrincipal();"},{"type":"INSERT","lineNumber":30,"content":"    public String generateJwtToken(Authentication authentication) {"},{"type":"DELETE","lineNumber":29,"oldContent":"    return Jwts.builder().setSubject((userPrincipal.getUsername()))"},{"type":"DELETE","lineNumber":30,"oldContent":"    \t\t.setIssuedAt(new Date())"},{"type":"INSERT","lineNumber":32,"content":"        UserDetailsImpl userPrincipal = (UserDetailsImpl) authentication.getPrincipal();"},{"type":"DELETE","lineNumber":32,"oldContent":"        .setExpiration(new Date((new Date()).getTime() + jwtExpirationMs))"},{"type":"DELETE","lineNumber":33,"oldContent":"        .signWith(getSignInKey(),SignatureAlgorithm.HS512)"},{"type":"DELETE","lineNumber":34,"oldContent":"        .compact(); "},{"type":"DELETE","lineNumber":35,"oldContent":"  }"},{"type":"DELETE","lineNumber":36,"oldContent":"  public String getUserNameFromJwtToken(String token) {"},{"type":"DELETE","lineNumber":37,"oldContent":"   //0.9.0// return Jwts.parser().setSigningKey(getSignInKey()).parseClaimsJws(token).getBody().getSubject();"},{"type":"INSERT","lineNumber":34,"content":"        // Dr. X's Fix: This is the new logic."},{"type":"INSERT","lineNumber":35,"content":"        // 1. Get the collection of authorities (roles) from the authenticated user."},{"type":"INSERT","lineNumber":36,"content":"        // 2. Convert them into a simple list of strings (e.g., [\"ROLE_CUSTOMER\"])."},{"type":"INSERT","lineNumber":37,"content":"        List<String> roles = userPrincipal.getAuthorities().stream()"},{"type":"INSERT","lineNumber":38,"content":"                .map(GrantedAuthority::getAuthority)"},{"type":"INSERT","lineNumber":39,"content":"                .collect(Collectors.toList());"},{"type":"DELETE","lineNumber":39,"oldContent":"\t//0.11.5  //return Jwts.parserBuilder().setSigningKey(getSignInKey()).build().parseClaimsJws(token).getBody().getSubject();"},{"type":"DELETE","lineNumber":40,"oldContent":"\t  return Jwts.parserBuilder().setSigningKey(getSignInKey()).build().parseClaimsJws(token).getBody().getSubject();"},{"type":"DELETE","lineNumber":41,"oldContent":"  }"},{"type":"DELETE","lineNumber":42,"oldContent":"  public boolean validateJwtToken(String authToken) {"},{"type":"INSERT","lineNumber":41,"content":"        return Jwts.builder()"},{"type":"INSERT","lineNumber":42,"content":"                .setSubject((userPrincipal.getUsername()))"},{"type":"INSERT","lineNumber":43,"content":"                .setIssuedAt(new Date())"},{"type":"INSERT","lineNumber":44,"content":"                .setExpiration(new Date((new Date()).getTime() + jwtExpirationMs))"},{"type":"DELETE","lineNumber":44,"oldContent":"    try {"},{"type":"DELETE","lineNumber":45,"oldContent":"      //Jwts.parser().setSigningKey(getSignInKey()).parseClaimsJws(authToken);"},{"type":"DELETE","lineNumber":46,"oldContent":"    \tJwts.parserBuilder().setSigningKey(getSignInKey()).build().parseClaimsJws(authToken);"},{"type":"DELETE","lineNumber":47,"oldContent":"    \treturn true;"},{"type":"DELETE","lineNumber":48,"oldContent":"\t}catch (MalformedJwtException e) {"},{"type":"DELETE","lineNumber":49,"oldContent":"      logger.error(\"Invalid JWT token: {}\", e.getMessage());"},{"type":"INSERT","lineNumber":46,"content":"                // 2. This is the critical new line that adds the roles to the token's payload."},{"type":"INSERT","lineNumber":47,"content":"                .claim(\"authorities\", roles)"},{"type":"INSERT","lineNumber":48,"content":""},{"type":"INSERT","lineNumber":49,"content":"                .signWith(getSignInKey(), SignatureAlgorithm.HS512)"},{"type":"INSERT","lineNumber":50,"content":"                .compact();"},{"type":"DELETE","lineNumber":51,"oldContent":"    } catch (ExpiredJwtException e) {"},{"type":"DELETE","lineNumber":53,"oldContent":"      logger.error(\"JWT token is expired: {}\", e.getMessage());"},{"type":"DELETE","lineNumber":54,"oldContent":"    } catch (UnsupportedJwtException e) {"},{"type":"DELETE","lineNumber":55,"oldContent":"      logger.error(\"JWT token is unsupported: {}\", e.getMessage());"},{"type":"DELETE","lineNumber":56,"oldContent":"    } catch (IllegalArgumentException e) {"},{"type":"DELETE","lineNumber":57,"oldContent":"      logger.error(\"JWT claims string is empty: {}\", e.getMessage());"},{"type":"DELETE","lineNumber":58,"oldContent":"    return false;"},{"type":"DELETE","lineNumber":59,"oldContent":"  }"},{"type":"DELETE","lineNumber":60,"oldContent":"  "},{"type":"DELETE","lineNumber":61,"oldContent":"  private Key getSignInKey() {"},{"type":"DELETE","lineNumber":62,"oldContent":"\t    byte[] keyBytes = Decoders.BASE64.decode(jwtSecret);"},{"type":"DELETE","lineNumber":63,"oldContent":"\t    return Keys.hmacShaKeyFor(keyBytes);"},{"type":"DELETE","lineNumber":64,"oldContent":"\t  }"},{"type":"INSERT","lineNumber":53,"content":"    public String getUserNameFromJwtToken(String token) {"},{"type":"INSERT","lineNumber":54,"content":"        return Jwts.parserBuilder().setSigningKey(getSignInKey()).build().parseClaimsJws(token).getBody().getSubject();"},{"type":"INSERT","lineNumber":55,"content":"    }"},{"type":"INSERT","lineNumber":56,"content":""},{"type":"INSERT","lineNumber":57,"content":"    public boolean validateJwtToken(String authToken) {"},{"type":"INSERT","lineNumber":58,"content":"        try {"},{"type":"INSERT","lineNumber":59,"content":"            Jwts.parserBuilder().setSigningKey(getSignInKey()).build().parseClaimsJws(authToken);"},{"type":"INSERT","lineNumber":60,"content":"            return true;"},{"type":"INSERT","lineNumber":61,"content":"        } catch (MalformedJwtException e) {"},{"type":"INSERT","lineNumber":62,"content":"            logger.error(\"Invalid JWT token: {}\", e.getMessage());"},{"type":"INSERT","lineNumber":63,"content":"        } catch (ExpiredJwtException e) {"},{"type":"INSERT","lineNumber":64,"content":"            logger.error(\"JWT token is expired: {}\", e.getMessage());"},{"type":"INSERT","lineNumber":65,"content":"        } catch (UnsupportedJwtException e) {"},{"type":"INSERT","lineNumber":66,"content":"            logger.error(\"JWT token is unsupported: {}\", e.getMessage());"},{"type":"INSERT","lineNumber":67,"content":"        } catch (IllegalArgumentException e) {"},{"type":"INSERT","lineNumber":68,"content":"            logger.error(\"JWT claims string is empty: {}\", e.getMessage());"},{"type":"INSERT","lineNumber":69,"content":"        }"},{"type":"INSERT","lineNumber":70,"content":""},{"type":"INSERT","lineNumber":71,"content":"        return false;"},{"type":"INSERT","lineNumber":72,"content":"    }"},{"type":"INSERT","lineNumber":73,"content":""},{"type":"INSERT","lineNumber":74,"content":"    private Key getSignInKey() {"},{"type":"INSERT","lineNumber":75,"content":"        byte[] keyBytes = Decoders.BASE64.decode(jwtSecret);"},{"type":"INSERT","lineNumber":76,"content":"        return Keys.hmacShaKeyFor(keyBytes);"},{"type":"INSERT","lineNumber":77,"content":"    }"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/TriageTicketRequestDto.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/TriageTicketRequestDto.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\nimport com.capstone.tele_ticketing_backend_1.entities.TicketPriority;\nimport com.capstone.tele_ticketing_backend_1.entities.TicketSeverity;\nimport jakarta.validation.constraints.NotEmpty;\nimport jakarta.validation.constraints.NotNull;\nimport lombok.Data;\nimport java.util.Set;\n\n@Data\npublic class TriageTicketRequestDto {\n\n    @NotNull(message = \"Severity must be provided\")\n    private TicketSeverity severity;\n\n    @NotNull(message = \"Priority must be provided\")\n    private TicketPriority priority;\n\n    // Dr. X's Note: We expect a set of user IDs for the engineers to be assigned.\n    // This is efficient and secure.\n    @NotEmpty(message = \"At least one engineer must be assigned\")\n    private Set<Long> assignedToUserIds;\n}","baseTimestamp":1761856708551},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/TriageOfficerService.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/TriageOfficerService.java","baseContent":"package com.capstone.tele_ticketing_backend_1.service;\n\nimport com.capstone.tele_ticketing_backend_1.dto.TriageTicketRequestDto;\nimport com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;\nimport com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;\nimport com.capstone.tele_ticketing_backend_1.dto.UserSummaryDto;\nimport com.capstone.tele_ticketing_backend_1.entities.AppUser;\nimport com.capstone.tele_ticketing_backend_1.entities.Ticket;\nimport com.capstone.tele_ticketing_backend_1.entities.TicketStatus;\nimport com.capstone.tele_ticketing_backend_1.entities.TicketSeverity;\nimport com.capstone.tele_ticketing_backend_1.exceptions.InvalidTicketStatusException;\nimport com.capstone.tele_ticketing_backend_1.exceptions.TicketNotFoundException;\nimport com.capstone.tele_ticketing_backend_1.exceptions.UserNotFoundException;\nimport com.capstone.tele_ticketing_backend_1.repo.TicketRepo;\nimport com.capstone.tele_ticketing_backend_1.repo.UserRepo;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport java.time.LocalDateTime;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Set;\nimport java.util.stream.Collectors;\n\n@Service\npublic class TriageOfficerService {\n\n    @Autowired\n    private TicketRepo ticketRepo;\n\n    @Autowired\n    private UserRepo userRepo;\n\n    // Business Logic: Defines which statuses are considered \"pending\" for a Triage Officer.\n    private static final List<TicketStatus> PENDING_STATUSES = List.of(\n            TicketStatus.CREATED,\n            TicketStatus.NEEDS_TRIAGING,\n            TicketStatus.REOPENED\n    );\n\n    public List<TicketSummaryDto> getPendingTickets() {\n        List<Ticket> tickets = ticketRepo.findAllByStatusIn(PENDING_STATUSES);\n        // Dr. X's Note: We reuse our existing DTO for a clean, consistent list response.\n        return tickets.stream()\n                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))\n                .collect(Collectors.toList());\n    }\n\n    @Transactional\n    public TicketDetailDto triageTicket(Long ticketId, TriageTicketRequestDto dto, String triageOfficerUsername) {\n        AppUser triageOfficer = userRepo.findByUsername(triageOfficerUsername)\n                .orElseThrow(() -> new UserNotFoundException(\"Triage officer not found: \" + triageOfficerUsername));\n\n        Ticket ticket = ticketRepo.findById(ticketId)\n                .orElseThrow(() -> new TicketNotFoundException(\"Ticket not found with id: \" + ticketId));\n\n        // State Validation: A critical business rule.\n        if (!PENDING_STATUSES.contains(ticket.getStatus())) {\n            throw new InvalidTicketStatusException(\"Ticket is not in a state that can be triaged. Current status: \" + ticket.getStatus());\n        }\n\n        List<AppUser> engineersToAssign = userRepo.findAllById(dto.getAssignedToUserIds());\n        if (engineersToAssign.size() != dto.getAssignedToUserIds().size()) {\n            throw new UserNotFoundException(\"One or more specified engineers could not be found.\");\n        }\n\n        // Apply Updates\n        ticket.setSeverity(dto.getSeverity());\n        ticket.setPriority(dto.getPriority());\n        ticket.setAssignedTo(new HashSet<>(engineersToAssign));\n        ticket.setAssignedBy(triageOfficer);\n        ticket.setStatus(TicketStatus.ASSIGNED);\n\n        // Calculate and set SLA\n        int slaHours = calculateSlaHours(dto.getSeverity());\n        ticket.setSlaDurationHours(slaHours);\n        ticket.setSlaBreachAt(LocalDateTime.now().plusHours(slaHours));\n\n        Ticket savedTicket = ticketRepo.save(ticket);\n\n        // Dr. X's Reminder: We are returning a DTO to avoid lazy loading exceptions.\n        return mapTicketToDetailDto(savedTicket);\n    }\n\n    private int calculateSlaHours(TicketSeverity severity) {\n        return switch (severity) {\n            case CRITICAL -> 20;\n            case HIGH -> 18;\n            case MEDIUM -> 15;\n            case LOW -> 10;\n            case TRIVIAL -> 2;\n        };\n    }\n\n    private TicketDetailDto mapTicketToDetailDto(Ticket ticket) {\n        // This helper method can be reused or moved to a dedicated mapper class.\n        TicketDetailDto dto = new TicketDetailDto();\n        dto.setId(ticket.getId());\n        dto.setTicketUid(ticket.getTicketUid());\n        dto.setTitle(ticket.getTitle());\n        dto.setStatus(ticket.getStatus());\n        dto.setCategory(ticket.getCategory());\n        dto.setCreatedAt(ticket.getCreatedAt());\n        dto.setResolvedAt(ticket.getResolvedAt());\n\n        AppUser createdForUser = ticket.getCreatedFor();\n        dto.setCreatedFor(new UserSummaryDto(createdForUser.getId(), createdForUser.getUsername(), createdForUser.getFullName()));\n\n        return dto;\n    }\n}\n","baseTimestamp":1761856740724,"deltas":[{"timestamp":1761863147817,"changes":[{"type":"INSERT","lineNumber":51,"content":"        // ... your existing logic to fetch users and ticket ..."},{"type":"DELETE","lineNumber":57,"oldContent":"        // State Validation: A critical business rule."},{"type":"DELETE","lineNumber":58,"oldContent":"        if (!PENDING_STATUSES.contains(ticket.getStatus())) {"},{"type":"DELETE","lineNumber":59,"oldContent":"            throw new InvalidTicketStatusException(\"Ticket is not in a state that can be triaged. Current status: \" + ticket.getStatus());"},{"type":"DELETE","lineNumber":60,"oldContent":"        }"},{"type":"DELETE","lineNumber":61,"oldContent":""},{"type":"INSERT","lineNumber":58,"content":"        // ... your existing logic for validation, setting fields, and calculating SLA ..."},{"type":"DELETE","lineNumber":63,"oldContent":"        if (engineersToAssign.size() != dto.getAssignedToUserIds().size()) {"},{"type":"DELETE","lineNumber":64,"oldContent":"            throw new UserNotFoundException(\"One or more specified engineers could not be found.\");"},{"type":"DELETE","lineNumber":65,"oldContent":"        }"},{"type":"INSERT","lineNumber":60,"content":"        //... validation ..."},{"type":"DELETE","lineNumber":67,"oldContent":"        // Apply Updates"},{"type":"DELETE","lineNumber":71,"oldContent":"        ticket.setAssignedBy(triageOfficer);"},{"type":"INSERT","lineNumber":65,"content":"        ticket.setAssignedBy(triageOfficer); // This sets the lazy proxy"},{"type":"INSERT","lineNumber":67,"content":"        // ... SLA calculation ..."},{"type":"DELETE","lineNumber":74,"oldContent":"        // Calculate and set SLA"},{"type":"DELETE","lineNumber":75,"oldContent":"        int slaHours = calculateSlaHours(dto.getSeverity());"},{"type":"DELETE","lineNumber":76,"oldContent":"        ticket.setSlaDurationHours(slaHours);"},{"type":"DELETE","lineNumber":77,"oldContent":"        ticket.setSlaBreachAt(LocalDateTime.now().plusHours(slaHours));"},{"type":"DELETE","lineNumber":78,"oldContent":""},{"type":"DELETE","lineNumber":81,"oldContent":"        // Dr. X's Reminder: We are returning a DTO to avoid lazy loading exceptions."},{"type":"INSERT","lineNumber":71,"content":"        // This is the crucial step. We map to a DTO before the transaction ends."},{"type":"DELETE","lineNumber":84,"oldContent":""}]},{"timestamp":1761863167309,"changes":[{"type":"DELETE","lineNumber":59,"oldContent":"        //... validation ..."},{"type":"DELETE","lineNumber":61,"oldContent":"        ticket.setAssignedBy(triageOfficer); // This sets the lazy proxy"},{"type":"INSERT","lineNumber":60,"content":"        //... validation ..."},{"type":"DELETE","lineNumber":63,"oldContent":"        // ... SLA calculation ..."},{"type":"DELETE","lineNumber":67,"oldContent":"        // This is the crucial step. We map to a DTO before the transaction ends."},{"type":"INSERT","lineNumber":65,"content":"        ticket.setAssignedBy(triageOfficer); // This sets the lazy proxy"},{"type":"INSERT","lineNumber":67,"content":"        // ... SLA calculation ..."},{"type":"INSERT","lineNumber":71,"content":"        // This is the crucial step. We map to a DTO before the transaction ends."},{"type":"DELETE","lineNumber":85,"oldContent":"        // This helper method can be reused or moved to a dedicated mapper class."},{"type":"INSERT","lineNumber":89,"content":"        dto.setDescription(ticket.getDescription());"},{"type":"DELETE","lineNumber":92,"oldContent":"        dto.setCreatedAt(ticket.getCreatedAt());"},{"type":"MODIFY","lineNumber":92,"content":"        dto.setPriority(ticket.getPriority());","oldContent":"        dto.setResolvedAt(ticket.getResolvedAt());"},{"type":"INSERT","lineNumber":93,"content":"        dto.setSeverity(ticket.getSeverity());"},{"type":"DELETE","lineNumber":95,"oldContent":"        AppUser createdForUser = ticket.getCreatedFor();"},{"type":"DELETE","lineNumber":96,"oldContent":"        dto.setCreatedFor(new UserSummaryDto(createdForUser.getId(), createdForUser.getUsername(), createdForUser.getFullName()));"},{"type":"INSERT","lineNumber":95,"content":"        // Safely map the 'createdFor' user"},{"type":"INSERT","lineNumber":96,"content":"        dto.setCreatedFor(new UserSummaryDto("},{"type":"INSERT","lineNumber":97,"content":"                ticket.getCreatedFor().getId(),"},{"type":"INSERT","lineNumber":98,"content":"                ticket.getCreatedFor().getUsername(),"},{"type":"INSERT","lineNumber":99,"content":"                ticket.getCreatedFor().getFullName()"},{"type":"INSERT","lineNumber":100,"content":"        ));"},{"type":"INSERT","lineNumber":102,"content":"        // Safely map the 'assignedTo' set"},{"type":"INSERT","lineNumber":103,"content":"        dto.setAssignedTo(ticket.getAssignedTo().stream()"},{"type":"INSERT","lineNumber":104,"content":"                .map(user -> new UserSummaryDto(user.getId(), user.getUsername(), user.getFullName()))"},{"type":"INSERT","lineNumber":105,"content":"                .collect(Collectors.toSet()));"},{"type":"INSERT","lineNumber":106,"content":""},{"type":"INSERT","lineNumber":107,"content":"        // Safely map the 'assignedBy' user, handling the case where it might be null."},{"type":"INSERT","lineNumber":108,"content":"        if (ticket.getAssignedBy() != null) {"},{"type":"INSERT","lineNumber":109,"content":"            dto.setAssignedBy(new UserSummaryDto("},{"type":"INSERT","lineNumber":110,"content":"                    ticket.getAssignedBy().getId(),"},{"type":"INSERT","lineNumber":111,"content":"                    ticket.getAssignedBy().getUsername(),"},{"type":"INSERT","lineNumber":112,"content":"                    ticket.getAssignedBy().getFullName()"},{"type":"INSERT","lineNumber":113,"content":"            ));"},{"type":"INSERT","lineNumber":114,"content":"        }"},{"type":"INSERT","lineNumber":115,"content":""},{"type":"INSERT","lineNumber":116,"content":"        dto.setCreatedAt(ticket.getCreatedAt());"},{"type":"INSERT","lineNumber":117,"content":"        dto.setResolvedAt(ticket.getResolvedAt());"}]},{"timestamp":1761863514538,"changes":[{"type":"MODIFY","lineNumber":60,"content":"        //... validation ...","oldContent":"        //... validation ..."},{"type":"DELETE","lineNumber":63,"oldContent":"        ticket.setAssignedBy(triageOfficer); // This sets the lazy proxy"},{"type":"DELETE","lineNumber":66,"oldContent":"        // ... SLA calculation ..."},{"type":"INSERT","lineNumber":65,"content":"        ticket.setAssignedBy(triageOfficer); // This sets the lazy proxy"},{"type":"INSERT","lineNumber":67,"content":"        // ... SLA calculation ..."},{"type":"MODIFY","lineNumber":70,"content":"        Ticket savedTicket = ticketRepo.save(ticket);","oldContent":"        // This is the crucial step. We map to a DTO before the transaction ends."},{"type":"INSERT","lineNumber":72,"content":"        // This is the crucial step. We map to a DTO before the transaction ends."},{"type":"DELETE","lineNumber":88,"oldContent":"        dto.setDescription(ticket.getDescription());"},{"type":"INSERT","lineNumber":90,"content":"        dto.setDescription(ticket.getDescription());"},{"type":"MODIFY","lineNumber":94,"content":"        dto.setSeverity(ticket.getSeverity());","oldContent":"        dto.setResolvedAt(ticket.getResolvedAt());"},{"type":"DELETE","lineNumber":98,"oldContent":""},{"type":"DELETE","lineNumber":100,"oldContent":"        return dto;"},{"type":"DELETE","lineNumber":102,"oldContent":"    }"},{"type":"DELETE","lineNumber":104,"oldContent":"}"},{"type":"DELETE","lineNumber":107,"oldContent":"        dto.setResolvedAt(ticket.getResolvedAt());"},{"type":"DELETE","lineNumber":109,"oldContent":"        dto.setCreatedAt(ticket.getCreatedAt());"},{"type":"DELETE","lineNumber":111,"oldContent":""},{"type":"DELETE","lineNumber":113,"oldContent":"        }"},{"type":"DELETE","lineNumber":115,"oldContent":"            ));"},{"type":"DELETE","lineNumber":117,"oldContent":"                    ticket.getAssignedBy().getFullName()"},{"type":"DELETE","lineNumber":119,"oldContent":"                    ticket.getAssignedBy().getUsername(),"},{"type":"INSERT","lineNumber":112,"content":"                    ticket.getAssignedBy().getUsername(),"},{"type":"INSERT","lineNumber":113,"content":"                    ticket.getAssignedBy().getFullName()"},{"type":"INSERT","lineNumber":114,"content":"            ));"},{"type":"INSERT","lineNumber":115,"content":"        }"},{"type":"INSERT","lineNumber":116,"content":""},{"type":"INSERT","lineNumber":117,"content":"        dto.setCreatedAt(ticket.getCreatedAt());"},{"type":"INSERT","lineNumber":118,"content":"        dto.setResolvedAt(ticket.getResolvedAt());"},{"type":"INSERT","lineNumber":119,"content":"        return dto;"},{"type":"INSERT","lineNumber":120,"content":"    }"},{"type":"INSERT","lineNumber":121,"content":"}"},{"type":"INSERT","lineNumber":122,"content":""}]},{"timestamp":1761863519644,"changes":[{"type":"INSERT","lineNumber":59,"content":"        List<AppUser> engineersToAssign = userRepo.findAllById(dto.getAssignedToUserIds());"},{"type":"DELETE","lineNumber":60,"oldContent":"        //... validation ..."},{"type":"DELETE","lineNumber":64,"oldContent":"        ticket.setAssignedBy(triageOfficer); // This sets the lazy proxy"},{"type":"DELETE","lineNumber":66,"oldContent":"        // ... SLA calculation ..."},{"type":"INSERT","lineNumber":65,"content":"        ticket.setAssignedBy(triageOfficer); // This sets the lazy proxy"},{"type":"INSERT","lineNumber":67,"content":"        // ... SLA calculation ..."},{"type":"DELETE","lineNumber":70,"oldContent":"        Ticket savedTicket = ticketRepo.save(ticket);"},{"type":"MODIFY","lineNumber":94,"content":"","oldContent":"        dto.setResolvedAt(ticket.getResolvedAt());"},{"type":"MODIFY","lineNumber":106,"content":"","oldContent":"                    ticket.getAssignedBy().getUsername(),"},{"type":"INSERT","lineNumber":107,"content":"        // Safely map the 'assignedBy' user, handling the case where it might be null."},{"type":"INSERT","lineNumber":108,"content":"        if (ticket.getAssignedBy() != null) {"},{"type":"INSERT","lineNumber":109,"content":"            dto.setAssignedBy(new UserSummaryDto("},{"type":"INSERT","lineNumber":110,"content":"                    ticket.getAssignedBy().getId(),"},{"type":"INSERT","lineNumber":111,"content":"                    ticket.getAssignedBy().getUsername(),"},{"type":"DELETE","lineNumber":110,"oldContent":""},{"type":"DELETE","lineNumber":113,"oldContent":"        // Safely map the 'assignedBy' user, handling the case where it might be null."},{"type":"DELETE","lineNumber":116,"oldContent":"        if (ticket.getAssignedBy() != null) {"},{"type":"DELETE","lineNumber":119,"oldContent":"            dto.setAssignedBy(new UserSummaryDto("},{"type":"DELETE","lineNumber":121,"oldContent":"                    ticket.getAssignedBy().getId(),"}]},{"timestamp":1761863543710,"changes":[{"type":"INSERT","lineNumber":33,"content":"    @Autowired"},{"type":"INSERT","lineNumber":34,"content":"    private TicketService ticketService;"},{"type":"DELETE","lineNumber":64,"oldContent":"        ticket.setAssignedBy(triageOfficer); // This sets the lazy proxy"},{"type":"DELETE","lineNumber":66,"oldContent":"        // ... SLA calculation ..."},{"type":"INSERT","lineNumber":67,"content":"        ticket.setAssignedBy(triageOfficer); // This sets the lazy proxy"},{"type":"INSERT","lineNumber":69,"content":"        // ... SLA calculation ..."},{"type":"DELETE","lineNumber":93,"oldContent":""},{"type":"INSERT","lineNumber":96,"content":""},{"type":"INSERT","lineNumber":107,"content":"                .collect(Collectors.toSet()));"},{"type":"DELETE","lineNumber":107,"oldContent":"                .collect(Collectors.toSet()));"},{"type":"DELETE","lineNumber":109,"oldContent":"                    ticket.getAssignedBy().getFullName()"},{"type":"DELETE","lineNumber":111,"oldContent":"            ));"},{"type":"INSERT","lineNumber":114,"content":"                    ticket.getAssignedBy().getFullName()"},{"type":"INSERT","lineNumber":115,"content":"            ));"}]},{"timestamp":1761863573598,"changes":[{"type":"MODIFY","lineNumber":35,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":70,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":74,"content":"        return ticketService.mapTicketToDetailDto(savedTicket);","oldContent":"        return mapTicketToDetailDto(savedTicket);"},{"type":"MODIFY","lineNumber":97,"content":"        // Safely map the 'createdFor' user","oldContent":"        // Safely map the 'createdFor' user"},{"type":"INSERT","lineNumber":107,"content":"                .collect(Collectors.toSet()));"},{"type":"DELETE","lineNumber":109,"oldContent":"                .collect(Collectors.toSet()));"},{"type":"MODIFY","lineNumber":116,"content":"        }","oldContent":"        }"}]},{"timestamp":1761893256000,"changes":[{"type":"INSERT","lineNumber":2,"content":""},{"type":"MODIFY","lineNumber":6,"content":"import com.capstone.tele_ticketing_backend_1.entities.ActivityType;","oldContent":"import com.capstone.tele_ticketing_backend_1.dto.UserSummaryDto;"},{"type":"INSERT","lineNumber":16,"content":"import com.capstone.tele_ticketing_backend_1.service.ActivityLogService;"},{"type":"INSERT","lineNumber":17,"content":"import com.capstone.tele_ticketing_backend_1.service.TicketService;"},{"type":"DELETE","lineNumber":18,"oldContent":""},{"type":"INSERT","lineNumber":35,"content":""},{"type":"INSERT","lineNumber":37,"content":"    private TicketService ticketService;"},{"type":"INSERT","lineNumber":39,"content":"    @Autowired"},{"type":"INSERT","lineNumber":40,"content":"    private ActivityLogService activityLogService;"},{"type":"DELETE","lineNumber":36,"oldContent":"    // Business Logic: Defines which statuses are considered \"pending\" for a Triage Officer."},{"type":"INSERT","lineNumber":42,"content":"    // Defines which statuses are considered \"pending\" for a Triage Officer."},{"type":"DELETE","lineNumber":45,"oldContent":"        // Dr. X's Note: We reuse our existing DTO for a clean, consistent list response."},{"type":"DELETE","lineNumber":53,"oldContent":"        // ... your existing logic to fetch users and ticket ..."},{"type":"DELETE","lineNumber":60,"oldContent":"        // ... your existing logic for validation, setting fields, and calculating SLA ..."},{"type":"INSERT","lineNumber":64,"content":"        // State Validation: Ensure the ticket is in a state that can be triaged."},{"type":"INSERT","lineNumber":65,"content":"        if (!PENDING_STATUSES.contains(ticket.getStatus())) {"},{"type":"INSERT","lineNumber":66,"content":"            throw new InvalidTicketStatusException(\"Ticket is not in a state that can be triaged. Current status: \" + ticket.getStatus());"},{"type":"INSERT","lineNumber":67,"content":"        }"},{"type":"INSERT","lineNumber":68,"content":""},{"type":"DELETE","lineNumber":62,"oldContent":"        //... validation ..."},{"type":"INSERT","lineNumber":70,"content":"        if (engineersToAssign.size() != dto.getAssignedToUserIds().size()) {"},{"type":"INSERT","lineNumber":71,"content":"            throw new UserNotFoundException(\"One or more specified engineers could not be found.\");"},{"type":"INSERT","lineNumber":72,"content":"        }"},{"type":"INSERT","lineNumber":74,"content":"        // Log changes BEFORE applying them for a clear audit trail."},{"type":"INSERT","lineNumber":75,"content":"        if (dto.getPriority() != ticket.getPriority()) {"},{"type":"INSERT","lineNumber":76,"content":"            activityLogService.createLog(ticket, triageOfficer, ActivityType.PRIORITY_CHANGE, \"Priority changed from \" + ticket.getPriority() + \" to \" + dto.getPriority(), false); // Public log"},{"type":"INSERT","lineNumber":77,"content":"        }"},{"type":"INSERT","lineNumber":78,"content":""},{"type":"INSERT","lineNumber":79,"content":"        // Apply Updates to the Ticket"},{"type":"DELETE","lineNumber":67,"oldContent":"        ticket.setAssignedBy(triageOfficer); // This sets the lazy proxy"},{"type":"INSERT","lineNumber":83,"content":"        ticket.setAssignedBy(triageOfficer);"},{"type":"INSERT","lineNumber":86,"content":"        // Calculate and set SLA based on the new severity."},{"type":"INSERT","lineNumber":87,"content":"        int slaHours = calculateSlaHours(dto.getSeverity());"},{"type":"INSERT","lineNumber":88,"content":"        ticket.setSlaDurationHours(slaHours);"},{"type":"INSERT","lineNumber":89,"content":"        ticket.setSlaBreachAt(LocalDateTime.now().plusHours(slaHours));"},{"type":"INSERT","lineNumber":91,"content":"        // Create an internal log for the assignment action."},{"type":"INSERT","lineNumber":92,"content":"        String assignedEngineersNames = engineersToAssign.stream().map(AppUser::getFullName).collect(Collectors.joining(\", \"));"},{"type":"INSERT","lineNumber":93,"content":"        activityLogService.createLog(ticket, triageOfficer, ActivityType.ASSIGNMENT, \"Assigned to \" + assignedEngineersNames, true); // Internal-only log"},{"type":"INSERT","lineNumber":94,"content":""},{"type":"DELETE","lineNumber":73,"oldContent":"        // This is the crucial step. We map to a DTO before the transaction ends."},{"type":"INSERT","lineNumber":97,"content":"        // Return a clean DTO by calling the central mapper."},{"type":"INSERT","lineNumber":100,"content":""},{"type":"INSERT","lineNumber":108,"content":"            default -> 24; // Default fallback"},{"type":"DELETE","lineNumber":85,"oldContent":""},{"type":"DELETE","lineNumber":86,"oldContent":"    private TicketDetailDto mapTicketToDetailDto(Ticket ticket) {"},{"type":"DELETE","lineNumber":87,"oldContent":"        TicketDetailDto dto = new TicketDetailDto();"},{"type":"DELETE","lineNumber":88,"oldContent":"        dto.setId(ticket.getId());"},{"type":"DELETE","lineNumber":89,"oldContent":"        dto.setTicketUid(ticket.getTicketUid());"},{"type":"DELETE","lineNumber":90,"oldContent":"        dto.setTitle(ticket.getTitle());"},{"type":"DELETE","lineNumber":91,"oldContent":"        dto.setDescription(ticket.getDescription());"},{"type":"DELETE","lineNumber":92,"oldContent":"        dto.setStatus(ticket.getStatus());"},{"type":"DELETE","lineNumber":93,"oldContent":"        dto.setCategory(ticket.getCategory());"},{"type":"DELETE","lineNumber":94,"oldContent":"        dto.setPriority(ticket.getPriority());"},{"type":"DELETE","lineNumber":95,"oldContent":"        dto.setSeverity(ticket.getSeverity());"},{"type":"DELETE","lineNumber":96,"oldContent":"        // Safely map the 'createdFor' user"},{"type":"DELETE","lineNumber":97,"oldContent":"        // Safely map the 'createdFor' user"},{"type":"DELETE","lineNumber":98,"oldContent":"        dto.setCreatedFor(new UserSummaryDto("},{"type":"DELETE","lineNumber":99,"oldContent":"                ticket.getCreatedFor().getId(),"},{"type":"DELETE","lineNumber":100,"oldContent":"                ticket.getCreatedFor().getUsername(),"},{"type":"DELETE","lineNumber":101,"oldContent":"                ticket.getCreatedFor().getFullName()"},{"type":"DELETE","lineNumber":102,"oldContent":"        ));"},{"type":"DELETE","lineNumber":103,"oldContent":""},{"type":"DELETE","lineNumber":104,"oldContent":"        // Safely map the 'assignedTo' set"},{"type":"DELETE","lineNumber":105,"oldContent":"        dto.setAssignedTo(ticket.getAssignedTo().stream()"},{"type":"DELETE","lineNumber":106,"oldContent":"                .map(user -> new UserSummaryDto(user.getId(), user.getUsername(), user.getFullName()))"},{"type":"DELETE","lineNumber":107,"oldContent":"                .collect(Collectors.toSet()));"},{"type":"DELETE","lineNumber":108,"oldContent":""},{"type":"DELETE","lineNumber":109,"oldContent":"        // Safely map the 'assignedBy' user, handling the case where it might be null."},{"type":"DELETE","lineNumber":110,"oldContent":"        if (ticket.getAssignedBy() != null) {"},{"type":"DELETE","lineNumber":111,"oldContent":"            dto.setAssignedBy(new UserSummaryDto("},{"type":"DELETE","lineNumber":112,"oldContent":"                    ticket.getAssignedBy().getId(),"},{"type":"DELETE","lineNumber":113,"oldContent":"                    ticket.getAssignedBy().getUsername(),"},{"type":"DELETE","lineNumber":114,"oldContent":"                    ticket.getAssignedBy().getFullName()"},{"type":"DELETE","lineNumber":115,"oldContent":"        }"},{"type":"DELETE","lineNumber":116,"oldContent":"        }"},{"type":"DELETE","lineNumber":117,"oldContent":""},{"type":"DELETE","lineNumber":118,"oldContent":"        dto.setCreatedAt(ticket.getCreatedAt());"},{"type":"DELETE","lineNumber":119,"oldContent":"        dto.setResolvedAt(ticket.getResolvedAt());"},{"type":"DELETE","lineNumber":120,"oldContent":"        return dto;"},{"type":"DELETE","lineNumber":121,"oldContent":"    }"},{"type":"DELETE","lineNumber":123,"oldContent":""}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/TriageOfficerController.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/TriageOfficerController.java","baseContent":"package com.capstone.tele_ticketing_backend_1.controller;\n\nimport com.capstone.tele_ticketing_backend_1.dto.TriageTicketRequestDto;\nimport com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;\nimport com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;\nimport com.capstone.tele_ticketing_backend_1.service.TriageOfficerService;\nimport jakarta.validation.Valid;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.security.access.prepost.PreAuthorize;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.web.bind.annotation.*;\n\nimport java.util.List;\n\n@RestController\n@RequestMapping(\"/api/v1/triage\")\n@PreAuthorize(\"hasRole('TRIAGE_OFFICER')\")\npublic class TriageOfficerController {\n\n    @Autowired\n    private TriageOfficerService triageOfficerService;\n\n    @GetMapping(\"/tickets/pending\")\n    public ResponseEntity<List<TicketSummaryDto>> getPendingTickets() {\n        return ResponseEntity.ok(triageOfficerService.getPendingTickets());\n    }\n\n    // Dr. X's Note: We use PATCH here because it's a partial update of the ticket resource.\n    @PatchMapping(\"/tickets/{id}\")\n    public ResponseEntity<TicketDetailDto> triageTicket(@PathVariable Long id, @Valid @RequestBody TriageTicketRequestDto dto) {\n        String username = SecurityContextHolder.getContext().getAuthentication().getName();\n        TicketDetailDto triagedTicket = triageOfficerService.triageTicket(id, dto, username);\n        return ResponseEntity.ok(triagedTicket);\n    }\n}","baseTimestamp":1761856799453},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/UserSummaryDto.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/UserSummaryDto.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\n@Data\n@NoArgsConstructor\n@AllArgsConstructor\npublic class UserSummaryDto {\n    private Long id;\n    private String username;\n    private String fullName;\n}\n","baseTimestamp":1761856989635},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/TicketDetailDto.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/TicketDetailDto.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\nimport com.capstone.tele_ticketing_backend_1.entities.TicketCategory;\nimport com.capstone.tele_ticketing_backend_1.entities.TicketStatus;\nimport lombok.Data;\n\nimport java.time.LocalDateTime;\n\n@Data\npublic class TicketDetailDto {\n    private Long id;\n    private String ticketUid;\n    private String title;\n    private TicketStatus status;\n    private TicketCategory category;\n    private UserSummaryDto createdFor;\n    private LocalDateTime createdAt;\n    private LocalDateTime resolvedAt;\n    // We can add more fields here as the UI requires them.\n}\n","baseTimestamp":1761857003109,"deltas":[{"timestamp":1761857008251,"changes":[{"type":"DELETE","lineNumber":1,"oldContent":""}]},{"timestamp":1761862543957,"changes":[{"type":"INSERT","lineNumber":1,"content":""}]},{"timestamp":1761862546537,"changes":[{"type":"DELETE","lineNumber":1,"oldContent":""},{"type":"INSERT","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.entities.TicketPriority;"},{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.entities.TicketSeverity;"},{"type":"DELETE","lineNumber":5,"oldContent":""},{"type":"INSERT","lineNumber":7,"content":"import java.util.Set;"},{"type":"INSERT","lineNumber":8,"content":"import java.util.stream.Collectors;"},{"type":"INSERT","lineNumber":15,"content":"    private String description; // Added for modal display"},{"type":"INSERT","lineNumber":18,"content":""},{"type":"INSERT","lineNumber":19,"content":"    // Dr. X's Addition: Add the missing fields."},{"type":"INSERT","lineNumber":20,"content":"    private TicketPriority priority;"},{"type":"INSERT","lineNumber":21,"content":"    private TicketSeverity severity;"},{"type":"INSERT","lineNumber":22,"content":"    private Set<UserSummaryDto> assignedTo; // This will show current assignments."},{"type":"INSERT","lineNumber":23,"content":""},{"type":"DELETE","lineNumber":18,"oldContent":"    // We can add more fields here as the UI requires them."},{"type":"DELETE","lineNumber":20,"oldContent":""}]},{"timestamp":1761863103709,"changes":[{"type":"MODIFY","lineNumber":1,"content":"","oldContent":"import com.capstone.tele_ticketing_backend_1.entities.TicketPriority;"},{"type":"INSERT","lineNumber":2,"content":""},{"type":"INSERT","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.entities.TicketPriority;"},{"type":"DELETE","lineNumber":8,"oldContent":""},{"type":"INSERT","lineNumber":11,"content":""},{"type":"INSERT","lineNumber":17,"content":"    private String description; // Added for modal display"},{"type":"DELETE","lineNumber":17,"oldContent":"    private String description; // Added for modal display"},{"type":"DELETE","lineNumber":18,"oldContent":"    private UserSummaryDto createdFor;"},{"type":"DELETE","lineNumber":19,"oldContent":"    private LocalDateTime createdAt;"},{"type":"DELETE","lineNumber":20,"oldContent":"    private LocalDateTime resolvedAt;"},{"type":"DELETE","lineNumber":23,"oldContent":"}"},{"type":"MODIFY","lineNumber":25,"content":"","oldContent":""},{"type":"INSERT","lineNumber":26,"content":"    private UserSummaryDto createdFor;"},{"type":"INSERT","lineNumber":27,"content":"    private LocalDateTime createdAt;"},{"type":"INSERT","lineNumber":28,"content":"    private LocalDateTime resolvedAt;"},{"type":"INSERT","lineNumber":29,"content":"}"}]},{"timestamp":1761863107357,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":""},{"type":"MODIFY","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.entities.TicketSeverity;","oldContent":"import com.capstone.tele_ticketing_backend_1.entities.TicketSeverity;"},{"type":"DELETE","lineNumber":10,"oldContent":"import java.util.stream.Collectors;"},{"type":"MODIFY","lineNumber":10,"content":"@Data","oldContent":"@Data"},{"type":"INSERT","lineNumber":15,"content":"    private String description;"},{"type":"DELETE","lineNumber":19,"oldContent":"    private String description; // Added for modal display"},{"type":"DELETE","lineNumber":20,"oldContent":""},{"type":"DELETE","lineNumber":21,"oldContent":"    // Dr. X's Addition: Add the missing fields."},{"type":"INSERT","lineNumber":19,"content":"    private TicketSeverity severity;"},{"type":"INSERT","lineNumber":20,"content":"    private Set<UserSummaryDto> assignedTo;"},{"type":"DELETE","lineNumber":24,"oldContent":"    private UserSummaryDto createdFor;"},{"type":"INSERT","lineNumber":22,"content":"    // Dr. X's Addition: Add the field that was causing the error."},{"type":"INSERT","lineNumber":23,"content":"    private UserSummaryDto assignedBy;"},{"type":"INSERT","lineNumber":25,"content":"    private UserSummaryDto createdFor;"},{"type":"DELETE","lineNumber":27,"oldContent":"    private Set<UserSummaryDto> assignedTo; // This will show current assignments."}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/EngineerUpdateDto.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/EngineerUpdateDto.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\nimport com.capstone.tele_ticketing_backend_1.entities.TicketStatus;\nimport jakarta.validation.constraints.NotNull;\nimport lombok.Data;\n\n@Data\npublic class EngineerUpdateDto {\n\n    @NotNull(message = \"New status cannot be null\")\n    private TicketStatus newStatus;\n\n    // The update text/comment is optional.\n    private String updateText;\n}","baseTimestamp":1761857980248},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/repo/UserRepo.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/repo/UserRepo.java","baseContent":"package com.capstone.tele_ticketing_backend_1.repo;\n\nimport com.capstone.tele_ticketing_backend_1.entities.AppUser;\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.stereotype.Repository;\n\nimport java.util.Optional;\n\n@Repository\npublic interface UserRepo extends JpaRepository<AppUser, Long> {\n    Optional<AppUser> findByUsername(String username);\n    Boolean existsByUsername(String username);\n    List<AppUser> findAllByRoles_NameIn(List<ERole> roles);\n}\n","baseTimestamp":1761858010101,"deltas":[{"timestamp":1761858019270,"changes":[{"type":"INSERT","lineNumber":6,"content":"import java.util.List;"}]},{"timestamp":1761858023511,"changes":[{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.entities.ERole;"}]},{"timestamp":1761858026191,"changes":[{"type":"INSERT","lineNumber":14,"content":"    "}]},{"timestamp":1761858028865,"changes":[{"type":"MODIFY","lineNumber":14,"content":"","oldContent":"    "}]},{"timestamp":1761909043670,"changes":[{"type":"INSERT","lineNumber":16,"content":""},{"type":"INSERT","lineNumber":17,"content":"    List<AppUser> findAllByRoles_Name(ERole roleName);"}]},{"timestamp":1762113148879,"changes":[{"type":"DELETE","lineNumber":17,"oldContent":"}"},{"type":"INSERT","lineNumber":19,"content":"    List<AppUser> findByTeamIsNullAndRoles_NameIn(List<ERole> roles);"},{"type":"INSERT","lineNumber":20,"content":"}"},{"type":"INSERT","lineNumber":21,"content":""}]},{"timestamp":1762148125486,"changes":[{"type":"MODIFY","lineNumber":19,"content":"    List<AppUser> findByTeamIsNullAndRoles_NameIn(List<ERole> roles);","oldContent":"    List<AppUser> findByTeamIsNullAndRoles_NameIn(List<ERole> roles);"},{"type":"INSERT","lineNumber":20,"content":"    @Query(\"SELECT DISTINCT u.city FROM AppUser u WHERE u.city IS NOT NULL AND u.city != '' ORDER BY u.city\")"},{"type":"INSERT","lineNumber":21,"content":"    List<String> findDistinctCities();"}]},{"timestamp":1762148129751,"changes":[{"type":"INSERT","lineNumber":5,"content":"import org.springframework.data.jpa.repository.Query;"},{"type":"INSERT","lineNumber":19,"content":""},{"type":"DELETE","lineNumber":19,"oldContent":"    List<AppUser> findByTeamIsNullAndRoles_NameIn(List<ERole> roles);"},{"type":"DELETE","lineNumber":21,"oldContent":"}"},{"type":"INSERT","lineNumber":23,"content":"}"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/EngineerService.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/EngineerService.java","baseContent":"package com.capstone.tele_ticketing_backend_1.service;\nimport com.capstone.tele_ticketing_backend_1.dto.EngineerUpdateDto;\nimport com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;\nimport com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto; // Assuming you created this\nimport com.capstone.tele_ticketing_backend_1.entities.ActivityType;\nimport com.capstone.tele_ticketing_backend_1.entities.AppUser;\nimport com.capstone.tele_ticketing_backend_1.entities.Ticket;\nimport com.capstone.tele_ticketing_backend_1.entities.TicketActivity;\nimport com.capstone.tele_ticketing_backend_1.entities.TicketStatus;\nimport com.capstone.tele_ticketing_backend_1.exceptions.TicketNotFoundException;\nimport com.capstone.tele_ticketing_backend_1.exceptions.UserNotFoundException;\nimport com.capstone.tele_ticketing_backend_1.repo.TicketRepo;\nimport com.capstone.tele_ticketing_backend_1.repo.UserRepo;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n@Service\npublic class EngineerService {\n\n    @Autowired\n    private TicketRepo ticketRepo;\n\n    @Autowired\n    private UserRepo userRepo;\n\n    public List<TicketSummaryDto> getAssignedTickets(String username) {\n        AppUser engineer = userRepo.findByUsername(username)\n                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));\n\n        List<TicketStatus> activeStatuses = List.of(TicketStatus.ASSIGNED, TicketStatus.IN_PROGRESS);\n\n        List<Ticket> tickets = ticketRepo.findAllByAssignedToContainsAndStatusIn(engineer, activeStatuses);\n\n        return tickets.stream()\n                .map(ticket -> new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt()))\n                .collect(Collectors.toList());\n    }\n\n    @Transactional\n    public Ticket updateTicket(Long ticketId, EngineerUpdateDto dto, String username) {\n        AppUser engineer = userRepo.findByUsername(username)\n                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));\n\n        Ticket ticket = ticketRepo.findById(ticketId)\n                .orElseThrow(() -> new TicketNotFoundException(\"Ticket not found with id: \" + ticketId));\n\n        // Create an activity log for the update\n        if (dto.getUpdateText() != null && !dto.getUpdateText().isBlank()) {\n            TicketActivity activity = new TicketActivity();\n            activity.setTicket(ticket);\n            activity.setUser(engineer);\n            activity.setDescription(dto.getUpdateText());\n            activity.setActivityType(ActivityType.COMMENT); // Or a new 'UPDATE' type\n            ticket.getActivities().add(activity);\n        }\n\n        // Update the status and create a status change activity\n        if (dto.getNewStatus() != ticket.getStatus()) {\n            TicketActivity statusChangeActivity = new TicketActivity();\n            statusChangeActivity.setTicket(ticket);\n            statusChangeActivity.setUser(engineer);\n            statusChangeActivity.setDescription(\"Status changed from \" + ticket.getStatus() + \" to \" + dto.getNewStatus());\n            statusChangeActivity.setActivityType(ActivityType.STATUS_CHANGE);\n            ticket.getActivities().add(statusChangeActivity);\n            ticket.setStatus(dto.getNewStatus());\n        }\n\n        return ticketRepo.save(ticket);\n    }\n}","baseTimestamp":1761858044173,"deltas":[{"timestamp":1761861203109,"changes":[{"type":"INSERT","lineNumber":1,"content":""}]},{"timestamp":1761861206205,"changes":[{"type":"DELETE","lineNumber":1,"oldContent":""},{"type":"INSERT","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;"},{"type":"MODIFY","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.dto.UserSummaryDto;","oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto; // Assuming you created this"},{"type":"INSERT","lineNumber":33,"content":"        // Define the statuses that are considered \"active work\" for an engineer."},{"type":"MODIFY","lineNumber":44,"content":"    public TicketDetailDto updateTicket(Long ticketId, EngineerUpdateDto dto, String username) {","oldContent":"    public Ticket updateTicket(Long ticketId, EngineerUpdateDto dto, String username) {"},{"type":"MODIFY","lineNumber":51,"content":"        // Create an activity log for the update text, if provided.","oldContent":"        // Create an activity log for the update"},{"type":"MODIFY","lineNumber":57,"content":"            activity.setActivityType(ActivityType.COMMENT);","oldContent":"            activity.setActivityType(ActivityType.COMMENT); // Or a new 'UPDATE' type"},{"type":"MODIFY","lineNumber":61,"content":"        // Update the status and create a corresponding status change log.","oldContent":"        // Update the status and create a status change activity"},{"type":"MODIFY","lineNumber":72,"content":"        Ticket savedTicket = ticketRepo.save(ticket);","oldContent":"        return ticketRepo.save(ticket);"},{"type":"INSERT","lineNumber":73,"content":""},{"type":"INSERT","lineNumber":74,"content":"        // Map the saved entity to our clean DTO before returning to prevent lazy loading errors."},{"type":"INSERT","lineNumber":75,"content":"        return mapTicketToDetailDto(savedTicket);"},{"type":"INSERT","lineNumber":77,"content":""},{"type":"INSERT","lineNumber":78,"content":"    private TicketDetailDto mapTicketToDetailDto(Ticket ticket) {"},{"type":"INSERT","lineNumber":79,"content":"        TicketDetailDto dto = new TicketDetailDto();"},{"type":"INSERT","lineNumber":80,"content":"        dto.setId(ticket.getId());"},{"type":"INSERT","lineNumber":81,"content":"        dto.setTicketUid(ticket.getTicketUid());"},{"type":"INSERT","lineNumber":82,"content":"        dto.setTitle(ticket.getTitle());"},{"type":"INSERT","lineNumber":83,"content":"        dto.setStatus(ticket.getStatus());"},{"type":"INSERT","lineNumber":84,"content":"        dto.setCategory(ticket.getCategory());"},{"type":"INSERT","lineNumber":85,"content":"        dto.setCreatedAt(ticket.getCreatedAt());"},{"type":"INSERT","lineNumber":86,"content":"        dto.setResolvedAt(ticket.getResolvedAt());"},{"type":"INSERT","lineNumber":87,"content":""},{"type":"INSERT","lineNumber":88,"content":"        // Trigger the lazy load for the 'createdFor' user while the session is active."},{"type":"INSERT","lineNumber":89,"content":"        AppUser createdForUser = ticket.getCreatedFor();"},{"type":"INSERT","lineNumber":90,"content":"        dto.setCreatedFor(new UserSummaryDto(createdForUser.getId(), createdForUser.getUsername(), createdForUser.getFullName()));"},{"type":"INSERT","lineNumber":91,"content":""},{"type":"INSERT","lineNumber":92,"content":"        return dto;"},{"type":"INSERT","lineNumber":93,"content":"    }"}]},{"timestamp":1761861209570,"changes":[{"type":"MODIFY","lineNumber":1,"content":"","oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;"},{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;"},{"type":"DELETE","lineNumber":44,"oldContent":"    public Ticket updateTicket(Long ticketId, EngineerUpdateDto dto, String username) {"},{"type":"INSERT","lineNumber":46,"content":"        AppUser engineer = userRepo.findByUsername(username)"},{"type":"DELETE","lineNumber":51,"oldContent":"        // Create an activity log for the update"},{"type":"INSERT","lineNumber":53,"content":"        if (dto.getUpdateText() != null && !dto.getUpdateText().isBlank()) {"},{"type":"DELETE","lineNumber":57,"oldContent":"            activity.setActivityType(ActivityType.COMMENT); // Or a new 'UPDATE' type"},{"type":"INSERT","lineNumber":59,"content":"            ticket.getActivities().add(activity);"},{"type":"DELETE","lineNumber":61,"oldContent":"        // Update the status and create a status change activity"},{"type":"INSERT","lineNumber":63,"content":"        if (dto.getNewStatus() != ticket.getStatus()) {"},{"type":"DELETE","lineNumber":72,"oldContent":"        return ticketRepo.save(ticket);"},{"type":"DELETE","lineNumber":75,"oldContent":"}"},{"type":"DELETE","lineNumber":77,"oldContent":"    }"},{"type":"DELETE","lineNumber":79,"oldContent":"        return dto;"},{"type":"INSERT","lineNumber":77,"content":"    }"},{"type":"DELETE","lineNumber":81,"oldContent":""},{"type":"DELETE","lineNumber":82,"oldContent":"        dto.setCreatedFor(new UserSummaryDto(createdForUser.getId(), createdForUser.getUsername(), createdForUser.getFullName()));"},{"type":"DELETE","lineNumber":84,"oldContent":"        AppUser createdForUser = ticket.getCreatedFor();"},{"type":"DELETE","lineNumber":86,"oldContent":"        // Trigger the lazy load for the 'createdFor' user while the session is active."},{"type":"DELETE","lineNumber":88,"oldContent":""},{"type":"DELETE","lineNumber":90,"oldContent":"        dto.setResolvedAt(ticket.getResolvedAt());"},{"type":"DELETE","lineNumber":92,"oldContent":"        dto.setCreatedAt(ticket.getCreatedAt());"},{"type":"INSERT","lineNumber":86,"content":"        dto.setCreatedAt(ticket.getCreatedAt());"},{"type":"INSERT","lineNumber":87,"content":"        dto.setResolvedAt(ticket.getResolvedAt());"},{"type":"INSERT","lineNumber":88,"content":""},{"type":"INSERT","lineNumber":89,"content":"        // Trigger the lazy load for the 'createdFor' user while the session is active."},{"type":"INSERT","lineNumber":90,"content":"        AppUser createdForUser = ticket.getCreatedFor();"},{"type":"INSERT","lineNumber":91,"content":"        dto.setCreatedFor(new UserSummaryDto(createdForUser.getId(), createdForUser.getUsername(), createdForUser.getFullName()));"},{"type":"INSERT","lineNumber":92,"content":""},{"type":"INSERT","lineNumber":93,"content":"        return dto;"},{"type":"INSERT","lineNumber":94,"content":"    }"},{"type":"INSERT","lineNumber":95,"content":"}"}]},{"timestamp":1761863599868,"changes":[{"type":"INSERT","lineNumber":30,"content":"    @Autowired"},{"type":"INSERT","lineNumber":31,"content":"    private TicketService ticketService;"},{"type":"INSERT","lineNumber":32,"content":""},{"type":"DELETE","lineNumber":76,"oldContent":"    }"},{"type":"INSERT","lineNumber":80,"content":"    }"},{"type":"INSERT","lineNumber":84,"content":"        dto.setId(ticket.getId());"},{"type":"INSERT","lineNumber":85,"content":"        dto.setTicketUid(ticket.getTicketUid());"},{"type":"INSERT","lineNumber":86,"content":"        dto.setTitle(ticket.getTitle());"},{"type":"INSERT","lineNumber":87,"content":"        dto.setStatus(ticket.getStatus());"},{"type":"INSERT","lineNumber":88,"content":"        dto.setCategory(ticket.getCategory());"},{"type":"DELETE","lineNumber":83,"oldContent":"        dto.setId(ticket.getId());"},{"type":"DELETE","lineNumber":86,"oldContent":"        dto.setTicketUid(ticket.getTicketUid());"},{"type":"DELETE","lineNumber":89,"oldContent":"        dto.setTitle(ticket.getTitle());"},{"type":"DELETE","lineNumber":92,"oldContent":"        dto.setStatus(ticket.getStatus());"},{"type":"DELETE","lineNumber":94,"oldContent":"        dto.setCategory(ticket.getCategory());"}]},{"timestamp":1761863626293,"changes":[{"type":"DELETE","lineNumber":31,"oldContent":"    public List<TicketSummaryDto> getAssignedTickets(String username) {"},{"type":"MODIFY","lineNumber":33,"content":"    public List<TicketSummaryDto> getAssignedTickets(String username) {","oldContent":"        AppUser engineer = userRepo.findByUsername(username)"},{"type":"INSERT","lineNumber":34,"content":"        AppUser engineer = userRepo.findByUsername(username)"},{"type":"MODIFY","lineNumber":79,"content":"        return ticketService.mapTicketToDetailDto(savedTicket);","oldContent":"        return mapTicketToDetailDto(savedTicket);"},{"type":"INSERT","lineNumber":80,"content":"    }"},{"type":"DELETE","lineNumber":82,"oldContent":"    }"},{"type":"DELETE","lineNumber":84,"oldContent":"        dto.setCreatedAt(ticket.getCreatedAt());"},{"type":"DELETE","lineNumber":85,"oldContent":"        dto.setResolvedAt(ticket.getResolvedAt());"},{"type":"DELETE","lineNumber":87,"oldContent":""},{"type":"DELETE","lineNumber":89,"oldContent":"        // Trigger the lazy load for the 'createdFor' user while the session is active."},{"type":"DELETE","lineNumber":92,"oldContent":"        AppUser createdForUser = ticket.getCreatedFor();"},{"type":"INSERT","lineNumber":89,"content":"        dto.setCreatedAt(ticket.getCreatedAt());"},{"type":"INSERT","lineNumber":90,"content":"        dto.setResolvedAt(ticket.getResolvedAt());"},{"type":"INSERT","lineNumber":91,"content":""},{"type":"INSERT","lineNumber":92,"content":"        // Trigger the lazy load for the 'createdFor' user while the session is active."},{"type":"INSERT","lineNumber":93,"content":"        AppUser createdForUser = ticket.getCreatedFor();"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/EngineerController.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/EngineerController.java","baseContent":"package com.capstone.tele_ticketing_backend_1.controller;\n\nimport com.capstone.tele_ticketing_backend_1.dto.EngineerUpdateDto;\nimport com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;\nimport com.capstone.tele_ticketing_backend_1.entities.Ticket;\nimport com.capstone.tele_ticketing_backend_1.service.EngineerService;\nimport jakarta.validation.Valid;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.security.access.prepost.PreAuthorize;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.web.bind.annotation.*;\nimport java.util.List;\n\n@RestController\n@RequestMapping(\"/api/v1/engineer\")\n@PreAuthorize(\"hasAnyRole('L1_ENGINEER', 'NOC_ENGINEER', 'FIELD_ENGINEER')\")\npublic class EngineerController {\n\n    @Autowired\n    private EngineerService engineerService;\n\n    @GetMapping(\"/tickets/assigned\")\n    public ResponseEntity<List<TicketSummaryDto>> getAssignedTickets() {\n        String username = SecurityContextHolder.getContext().getAuthentication().getName();\n        return ResponseEntity.ok(engineerService.getAssignedTickets(username));\n    }\n\n    @PatchMapping(\"/tickets/{id}\")\n    public ResponseEntity<Ticket> updateTicket(@PathVariable Long id, @Valid @RequestBody EngineerUpdateDto dto) {\n        String username = SecurityContextHolder.getContext().getAuthentication().getName();\n        return ResponseEntity.ok(engineerService.updateTicket(id, dto, username));\n    }\n}","baseTimestamp":1761858063899,"deltas":[{"timestamp":1761861235715,"changes":[{"type":"DELETE","lineNumber":1,"oldContent":""},{"type":"INSERT","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;"},{"type":"DELETE","lineNumber":4,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.Ticket;"},{"type":"MODIFY","lineNumber":28,"content":"    public ResponseEntity<TicketDetailDto> updateTicket(@PathVariable Long id, @Valid @RequestBody EngineerUpdateDto dto) {","oldContent":"    public ResponseEntity<Ticket> updateTicket(@PathVariable Long id, @Valid @RequestBody EngineerUpdateDto dto) {"},{"type":"MODIFY","lineNumber":30,"content":"        TicketDetailDto updatedTicket = engineerService.updateTicket(id, dto, username);","oldContent":"        return ResponseEntity.ok(engineerService.updateTicket(id, dto, username));"},{"type":"INSERT","lineNumber":31,"content":"        return ResponseEntity.ok(updatedTicket);"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/UserController.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/UserController.java","baseContent":"package com.capstone.tele_ticketing_backend_1.controller;\n\nimport com.capstone.tele_ticketing_backend_1.dto.UserSummaryDto;\nimport com.capstone.tele_ticketing_backend_1.entities.ERole;\nimport com.capstone.tele_ticketing_backend_1.repo.UserRepo;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.security.access.prepost.PreAuthorize;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n@RestController\n@RequestMapping(\"/api/v1/users\")\npublic class UserController {\n\n    @Autowired\n    private UserRepo userRepo;\n\n    @GetMapping(\"/engineers\")\n    @PreAuthorize(\"hasRole('TRIAGE_OFFICER')\")\n    public ResponseEntity<List<UserSummaryDto>> getAssignableEngineers() {\n        List<ERole> engineerRoles = List.of(ERole.ROLE_FIELD_ENGINEER, ERole.ROLE_L1_ENGINEER, ERole.ROLE_NOC_ENGINEER);\n        List<UserSummaryDto> engineers = userRepo.findAllByRoles_NameIn(engineerRoles).stream()\n                .map(user -> new UserSummaryDto(user.getId(), user.getUsername(), user.getFullName()))\n                .collect(Collectors.toList());\n        return ResponseEntity.ok(engineers);\n    }\n}","baseTimestamp":1761858117980,"deltas":[{"timestamp":1761909191255,"changes":[{"type":"INSERT","lineNumber":2,"content":""},{"type":"INSERT","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.entities.AppUser;"},{"type":"DELETE","lineNumber":6,"oldContent":"import org.springframework.http.ResponseEntity;"},{"type":"DELETE","lineNumber":7,"oldContent":"import org.springframework.security.access.prepost.PreAuthorize;"},{"type":"DELETE","lineNumber":8,"oldContent":"import org.springframework.web.bind.annotation.GetMapping;"},{"type":"DELETE","lineNumber":9,"oldContent":"import org.springframework.web.bind.annotation.RequestMapping;"},{"type":"DELETE","lineNumber":10,"oldContent":"import org.springframework.web.bind.annotation.RestController;"},{"type":"INSERT","lineNumber":8,"content":"import org.springframework.stereotype.Service;"},{"type":"INSERT","lineNumber":9,"content":"import org.springframework.transaction.annotation.Transactional;"},{"type":"DELETE","lineNumber":14,"oldContent":"@RestController"},{"type":"DELETE","lineNumber":15,"oldContent":"@RequestMapping(\"/api/v1/users\")"},{"type":"DELETE","lineNumber":16,"oldContent":"public class UserController {"},{"type":"INSERT","lineNumber":13,"content":"@Service"},{"type":"INSERT","lineNumber":14,"content":"public class UserService {"},{"type":"DELETE","lineNumber":21,"oldContent":"    @GetMapping(\"/engineers\")"},{"type":"DELETE","lineNumber":22,"oldContent":"    @PreAuthorize(\"hasRole('TRIAGE_OFFICER')\")"},{"type":"DELETE","lineNumber":23,"oldContent":"    public ResponseEntity<List<UserSummaryDto>> getAssignableEngineers() {"},{"type":"DELETE","lineNumber":24,"oldContent":"        List<ERole> engineerRoles = List.of(ERole.ROLE_FIELD_ENGINEER, ERole.ROLE_L1_ENGINEER, ERole.ROLE_NOC_ENGINEER);"},{"type":"DELETE","lineNumber":25,"oldContent":"        List<UserSummaryDto> engineers = userRepo.findAllByRoles_NameIn(engineerRoles).stream()"},{"type":"INSERT","lineNumber":19,"content":"    @Transactional(readOnly = true)"},{"type":"INSERT","lineNumber":20,"content":"    public List<UserSummaryDto> getAllCustomers() {"},{"type":"INSERT","lineNumber":21,"content":"        List<AppUser> customers = userRepo.findAllByRoles_Name(ERole.ROLE_CUSTOMER);"},{"type":"INSERT","lineNumber":22,"content":"        return mapUsersToSummaryDto(customers);"},{"type":"INSERT","lineNumber":23,"content":"    }"},{"type":"INSERT","lineNumber":24,"content":""},{"type":"INSERT","lineNumber":25,"content":"    // Dr. X's Addition: Move the engineer-fetching logic here."},{"type":"INSERT","lineNumber":26,"content":"    @Transactional(readOnly = true)"},{"type":"INSERT","lineNumber":27,"content":"    public List<UserSummaryDto> getAssignableEngineers() {"},{"type":"INSERT","lineNumber":28,"content":"        List<ERole> engineerRoles = List.of("},{"type":"INSERT","lineNumber":29,"content":"                ERole.ROLE_FIELD_ENGINEER,"},{"type":"INSERT","lineNumber":30,"content":"                ERole.ROLE_L1_ENGINEER,"},{"type":"INSERT","lineNumber":31,"content":"                ERole.ROLE_NOC_ENGINEER"},{"type":"INSERT","lineNumber":32,"content":"        );"},{"type":"INSERT","lineNumber":33,"content":"        List<AppUser> engineers = userRepo.findAllByRoles_NameIn(engineerRoles);"},{"type":"INSERT","lineNumber":34,"content":"        return mapUsersToSummaryDto(engineers);"},{"type":"INSERT","lineNumber":35,"content":"    }"},{"type":"INSERT","lineNumber":36,"content":""},{"type":"INSERT","lineNumber":37,"content":"    // Helper method to avoid code duplication"},{"type":"INSERT","lineNumber":38,"content":"    private List<UserSummaryDto> mapUsersToSummaryDto(List<AppUser> users) {"},{"type":"INSERT","lineNumber":39,"content":"        return users.stream()"},{"type":"DELETE","lineNumber":28,"oldContent":"        return ResponseEntity.ok(engineers);"}]},{"timestamp":1761909322577,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":""},{"type":"DELETE","lineNumber":5,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.AppUser;"},{"type":"DELETE","lineNumber":8,"oldContent":"import org.springframework.stereotype.Service;"},{"type":"DELETE","lineNumber":9,"oldContent":"import org.springframework.transaction.annotation.Transactional;"},{"type":"INSERT","lineNumber":6,"content":"import org.springframework.http.ResponseEntity;"},{"type":"INSERT","lineNumber":7,"content":"import org.springframework.security.access.prepost.PreAuthorize;"},{"type":"INSERT","lineNumber":8,"content":"import org.springframework.web.bind.annotation.GetMapping;"},{"type":"INSERT","lineNumber":9,"content":"import org.springframework.web.bind.annotation.RequestMapping;"},{"type":"INSERT","lineNumber":10,"content":"import org.springframework.web.bind.annotation.RestController;"},{"type":"DELETE","lineNumber":12,"oldContent":"@Service"},{"type":"MODIFY","lineNumber":14,"content":"@RestController","oldContent":"public class UserService {"},{"type":"INSERT","lineNumber":15,"content":"@RequestMapping(\"/api/v1/users\")"},{"type":"INSERT","lineNumber":16,"content":"public class UserController {"},{"type":"DELETE","lineNumber":17,"oldContent":"    @Transactional(readOnly = true)"},{"type":"DELETE","lineNumber":19,"oldContent":"    public List<UserSummaryDto> getAllCustomers() {"},{"type":"DELETE","lineNumber":21,"oldContent":"        List<AppUser> customers = userRepo.findAllByRoles_Name(ERole.ROLE_CUSTOMER);"},{"type":"DELETE","lineNumber":22,"oldContent":"        return mapUsersToSummaryDto(customers);"},{"type":"DELETE","lineNumber":23,"oldContent":"    }"},{"type":"DELETE","lineNumber":24,"oldContent":""},{"type":"DELETE","lineNumber":25,"oldContent":"    // Dr. X's Addition: Move the engineer-fetching logic here."},{"type":"DELETE","lineNumber":26,"oldContent":"    @Transactional(readOnly = true)"},{"type":"INSERT","lineNumber":21,"content":"    @GetMapping(\"/engineers\")"},{"type":"INSERT","lineNumber":22,"content":"    @PreAuthorize(\"hasRole('TRIAGE_OFFICER')\")"},{"type":"INSERT","lineNumber":23,"content":"    public ResponseEntity<List<UserSummaryDto>> getAssignableEngineers() {"},{"type":"INSERT","lineNumber":24,"content":"        List<ERole> engineerRoles = List.of(ERole.ROLE_FIELD_ENGINEER, ERole.ROLE_L1_ENGINEER, ERole.ROLE_NOC_ENGINEER);"},{"type":"INSERT","lineNumber":25,"content":"        List<UserSummaryDto> engineers = userRepo.findAllByRoles_NameIn(engineerRoles).stream()"},{"type":"DELETE","lineNumber":28,"oldContent":"    public List<UserSummaryDto> getAssignableEngineers() {"},{"type":"DELETE","lineNumber":30,"oldContent":"        List<ERole> engineerRoles = List.of("},{"type":"DELETE","lineNumber":31,"oldContent":"                ERole.ROLE_FIELD_ENGINEER,"},{"type":"INSERT","lineNumber":28,"content":"        return ResponseEntity.ok(engineers);"},{"type":"DELETE","lineNumber":33,"oldContent":"                ERole.ROLE_L1_ENGINEER,"},{"type":"DELETE","lineNumber":35,"oldContent":"                ERole.ROLE_NOC_ENGINEER"},{"type":"DELETE","lineNumber":36,"oldContent":"        return users.stream()"},{"type":"DELETE","lineNumber":37,"oldContent":"        );"},{"type":"DELETE","lineNumber":38,"oldContent":"    private List<UserSummaryDto> mapUsersToSummaryDto(List<AppUser> users) {"},{"type":"DELETE","lineNumber":39,"oldContent":"        List<AppUser> engineers = userRepo.findAllByRoles_NameIn(engineerRoles);"},{"type":"DELETE","lineNumber":40,"oldContent":"    // Helper method to avoid code duplication"},{"type":"DELETE","lineNumber":41,"oldContent":"        return mapUsersToSummaryDto(engineers);"},{"type":"DELETE","lineNumber":42,"oldContent":""},{"type":"DELETE","lineNumber":43,"oldContent":"    }"}]},{"timestamp":1761909383450,"changes":[{"type":"INSERT","lineNumber":2,"content":""},{"type":"MODIFY","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.service.UserService;","oldContent":"import com.capstone.tele_ticketing_backend_1.entities.ERole;"},{"type":"INSERT","lineNumber":5,"content":"import org.springframework.beans.factory.annotation.Autowired;"},{"type":"DELETE","lineNumber":5,"oldContent":"import com.capstone.tele_ticketing_backend_1.repo.UserRepo;"},{"type":"DELETE","lineNumber":7,"oldContent":"import org.springframework.beans.factory.annotation.Autowired;"},{"type":"DELETE","lineNumber":12,"oldContent":"import java.util.stream.Collectors;"},{"type":"MODIFY","lineNumber":16,"content":"","oldContent":""},{"type":"INSERT","lineNumber":17,"content":"    // Dr. X's Fix: Inject the service, not the repository."},{"type":"MODIFY","lineNumber":19,"content":"    private UserService userService;","oldContent":"    private UserRepo userRepo;"},{"type":"DELETE","lineNumber":24,"oldContent":"        List<ERole> engineerRoles = List.of(ERole.ROLE_FIELD_ENGINEER, ERole.ROLE_L1_ENGINEER, ERole.ROLE_NOC_ENGINEER);"},{"type":"DELETE","lineNumber":25,"oldContent":"        List<UserSummaryDto> engineers = userRepo.findAllByRoles_NameIn(engineerRoles).stream()"},{"type":"DELETE","lineNumber":26,"oldContent":"                .map(user -> new UserSummaryDto(user.getId(), user.getUsername(), user.getFullName()))"},{"type":"DELETE","lineNumber":27,"oldContent":"        return ResponseEntity.ok(engineers);"},{"type":"DELETE","lineNumber":28,"oldContent":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":24,"content":"        // The controller's only job is to call the service and return the response."},{"type":"INSERT","lineNumber":25,"content":"        return ResponseEntity.ok(userService.getAssignableEngineers());"},{"type":"INSERT","lineNumber":27,"content":""},{"type":"INSERT","lineNumber":28,"content":"    // Dr. X's Addition: The new endpoint for the agent's form."},{"type":"INSERT","lineNumber":29,"content":"    @GetMapping(\"/customers\")"},{"type":"INSERT","lineNumber":30,"content":"    @PreAuthorize(\"hasRole('AGENT')\")"},{"type":"INSERT","lineNumber":31,"content":"    public ResponseEntity<List<UserSummaryDto>> getAllCustomers() {"},{"type":"INSERT","lineNumber":32,"content":"        return ResponseEntity.ok(userService.getAllCustomers());"},{"type":"INSERT","lineNumber":33,"content":"    }"}]},{"timestamp":1761909488344,"changes":[{"type":"DELETE","lineNumber":4,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.ERole;"},{"type":"INSERT","lineNumber":6,"content":"import org.springframework.http.ResponseEntity;"},{"type":"INSERT","lineNumber":15,"content":"public class UserController {"},{"type":"DELETE","lineNumber":17,"oldContent":"public class UserController {"},{"type":"INSERT","lineNumber":26,"content":"    }"},{"type":"DELETE","lineNumber":29,"oldContent":"    }"},{"type":"DELETE","lineNumber":31,"oldContent":"}"},{"type":"INSERT","lineNumber":32,"content":"        return ResponseEntity.ok(userService.getAllCustomers());"},{"type":"INSERT","lineNumber":34,"content":""},{"type":"INSERT","lineNumber":35,"content":"    @GetMapping(\"/customers\")"},{"type":"INSERT","lineNumber":36,"content":"    @PreAuthorize(\"hasRole('AGENT')\") // Only agents need this list for now."},{"type":"INSERT","lineNumber":37,"content":"    public ResponseEntity<List<UserSummaryDto>> getAllCustomers() {"},{"type":"INSERT","lineNumber":39,"content":"    }"},{"type":"INSERT","lineNumber":40,"content":"}"}]},{"timestamp":1761909492464,"changes":[{"type":"MODIFY","lineNumber":6,"content":"import org.springframework.http.ResponseEntity;","oldContent":"import org.springframework.http.ResponseEntity;"},{"type":"DELETE","lineNumber":31,"oldContent":"        return ResponseEntity.ok(userService.getAllCustomers());"},{"type":"DELETE","lineNumber":33,"oldContent":"    }"},{"type":"DELETE","lineNumber":34,"oldContent":""},{"type":"DELETE","lineNumber":36,"oldContent":"    @GetMapping(\"/customers\")"},{"type":"DELETE","lineNumber":37,"oldContent":"}"},{"type":"DELETE","lineNumber":38,"oldContent":"    @PreAuthorize(\"hasRole('AGENT')\") // Only agents need this list for now."},{"type":"DELETE","lineNumber":40,"oldContent":"    public ResponseEntity<List<UserSummaryDto>> getAllCustomers() {"},{"type":"INSERT","lineNumber":34,"content":"}"}]},{"timestamp":1762113365216,"changes":[{"type":"INSERT","lineNumber":5,"content":"import org.springframework.beans.factory.annotation.Autowired;"},{"type":"DELETE","lineNumber":6,"oldContent":"import org.springframework.http.ResponseEntity;"},{"type":"DELETE","lineNumber":32,"oldContent":"}"},{"type":"INSERT","lineNumber":34,"content":""},{"type":"INSERT","lineNumber":35,"content":""},{"type":"INSERT","lineNumber":36,"content":"    @GetMapping(\"/unassigned-engineers\")"},{"type":"INSERT","lineNumber":37,"content":"    @PreAuthorize(\"hasRole('TEAM_LEAD')\")"},{"type":"INSERT","lineNumber":38,"content":"    public ResponseEntity<List<UserSummaryDto>> getUnassignedEngineers() {"},{"type":"INSERT","lineNumber":39,"content":"        return ResponseEntity.ok(userService.getUnassignedEngineers());"},{"type":"INSERT","lineNumber":40,"content":"    }"},{"type":"INSERT","lineNumber":41,"content":""},{"type":"INSERT","lineNumber":42,"content":"    // And add the corresponding method to UserService.java"},{"type":"INSERT","lineNumber":43,"content":"    public List<UserSummaryDto> getUnassignedEngineers() {"},{"type":"INSERT","lineNumber":44,"content":"        List<ERole> engineerRoles = List.of(ERole.ROLE_FIELD_ENGINEER, ERole.ROLE_L1_ENGINEER, ERole.ROLE_NOC_ENGINEER);"},{"type":"INSERT","lineNumber":45,"content":"        List<AppUser> engineers = userRepo.findByTeamIsNullAndRoles_NameIn(engineerRoles);"},{"type":"INSERT","lineNumber":46,"content":"        return mapUsersToSummaryDto(engineers);"},{"type":"INSERT","lineNumber":47,"content":"    }"},{"type":"INSERT","lineNumber":48,"content":"}"}]},{"timestamp":1762113368912,"changes":[{"type":"DELETE","lineNumber":33,"oldContent":""},{"type":"DELETE","lineNumber":36,"oldContent":"}"},{"type":"INSERT","lineNumber":35,"content":""},{"type":"DELETE","lineNumber":38,"oldContent":"    }"},{"type":"DELETE","lineNumber":40,"oldContent":"        return mapUsersToSummaryDto(engineers);"},{"type":"DELETE","lineNumber":42,"oldContent":"        List<AppUser> engineers = userRepo.findByTeamIsNullAndRoles_NameIn(engineerRoles);"},{"type":"DELETE","lineNumber":44,"oldContent":"        List<ERole> engineerRoles = List.of(ERole.ROLE_FIELD_ENGINEER, ERole.ROLE_L1_ENGINEER, ERole.ROLE_NOC_ENGINEER);"},{"type":"DELETE","lineNumber":46,"oldContent":"    public List<UserSummaryDto> getUnassignedEngineers() {"},{"type":"INSERT","lineNumber":43,"content":"    public List<UserSummaryDto> getUnassignedEngineers() {"},{"type":"INSERT","lineNumber":44,"content":"        List<ERole> engineerRoles = List.of(ERole.ROLE_FIELD_ENGINEER, ERole.ROLE_L1_ENGINEER, ERole.ROLE_NOC_ENGINEER);"},{"type":"INSERT","lineNumber":45,"content":"        List<AppUser> engineers = userRepo.findByTeamIsNullAndRoles_NameIn(engineerRoles);"},{"type":"INSERT","lineNumber":46,"content":"        return mapUsersToSummaryDto(engineers);"},{"type":"INSERT","lineNumber":47,"content":"    }"},{"type":"INSERT","lineNumber":48,"content":"}"}]},{"timestamp":1762113373739,"changes":[{"type":"INSERT","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.entities.ERole;"},{"type":"DELETE","lineNumber":39,"oldContent":"    public List<UserSummaryDto> getUnassignedEngineers() {"},{"type":"INSERT","lineNumber":41,"content":"    }"},{"type":"INSERT","lineNumber":42,"content":""},{"type":"INSERT","lineNumber":43,"content":"    // And add the corresponding method to UserService.java"},{"type":"INSERT","lineNumber":44,"content":"    public List<UserSummaryDto> getUnassignedEngineers() {"},{"type":"DELETE","lineNumber":43,"oldContent":"    }"},{"type":"DELETE","lineNumber":46,"oldContent":""},{"type":"DELETE","lineNumber":48,"oldContent":"    // And add the corresponding method to UserService.java"}]},{"timestamp":1762113429962,"changes":[{"type":"INSERT","lineNumber":37,"content":"    // In UserController.java"},{"type":"DELETE","lineNumber":42,"oldContent":"        List<ERole> engineerRoles = List.of(ERole.ROLE_FIELD_ENGINEER, ERole.ROLE_L1_ENGINEER, ERole.ROLE_NOC_ENGINEER);"},{"type":"DELETE","lineNumber":44,"oldContent":"        List<AppUser> engineers = userRepo.findByTeamIsNullAndRoles_NameIn(engineerRoles);"},{"type":"INSERT","lineNumber":46,"content":"        List<ERole> engineerRoles = List.of(ERole.ROLE_FIELD_ENGINEER, ERole.ROLE_L1_ENGINEER, ERole.ROLE_NOC_ENGINEER);"},{"type":"INSERT","lineNumber":47,"content":"        List<AppUser> engineers = userRepo.findByTeamIsNullAndRoles_NameIn(engineerRoles);"}]},{"timestamp":1762113442704,"changes":[{"type":"MODIFY","lineNumber":46,"content":"        List<ERole> engineerRoles = List.of(ERole.ROLE_FIELD_ENGINEER, ERole.ROLE_L1_ENGINEER, ERole.ROLE_NOC_ENGINEER);","oldContent":"        List<ERole> engineerRoles = List.of(ERole.ROLE_FIELD_ENGINEER, ERole.ROLE_L1_ENGINEER, ERole.ROLE_NOC_ENGINEER);"}]},{"timestamp":1762113448520,"changes":[{"type":"INSERT","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.entities.AppUser;"},{"type":"INSERT","lineNumber":46,"content":"    public List<UserSummaryDto> getUnassignedEngineers() {"},{"type":"DELETE","lineNumber":46,"oldContent":"        List<ERole> engineerRoles = List.of(ERole.ROLE_FIELD_ENGINEER, ERole.ROLE_L1_ENGINEER, ERole.ROLE_NOC_ENGINEER);"}]},{"timestamp":1762113466656,"changes":[{"type":"INSERT","lineNumber":22,"content":"    "},{"type":"INSERT","lineNumber":23,"content":"    @Autowired"},{"type":"INSERT","lineNumber":24,"content":"    private "},{"type":"DELETE","lineNumber":46,"oldContent":"        List<ERole> engineerRoles = List.of(ERole.ROLE_FIELD_ENGINEER, ERole.ROLE_L1_ENGINEER, ERole.ROLE_NOC_ENGINEER);"},{"type":"INSERT","lineNumber":50,"content":"        List<ERole> engineerRoles = List.of(ERole.ROLE_FIELD_ENGINEER, ERole.ROLE_L1_ENGINEER, ERole.ROLE_NOC_ENGINEER);"}]},{"timestamp":1762113472749,"changes":[{"type":"INSERT","lineNumber":6,"content":"import com.capstone.tele_ticketing_backend_1.repo.UserRepo;"},{"type":"DELETE","lineNumber":23,"oldContent":""},{"type":"INSERT","lineNumber":25,"content":"    private UserRepo userRepo;"},{"type":"INSERT","lineNumber":26,"content":""},{"type":"DELETE","lineNumber":26,"oldContent":"    private "},{"type":"INSERT","lineNumber":51,"content":"        List<ERole> engineerRoles = List.of(ERole.ROLE_FIELD_ENGINEER, ERole.ROLE_L1_ENGINEER, ERole.ROLE_NOC_ENGINEER);"},{"type":"DELETE","lineNumber":52,"oldContent":"        List<ERole> engineerRoles = List.of(ERole.ROLE_FIELD_ENGINEER, ERole.ROLE_L1_ENGINEER, ERole.ROLE_NOC_ENGINEER);"}]},{"timestamp":1762113477189,"changes":[{"type":"MODIFY","lineNumber":27,"content":"    @GetMapping(\"/engineers\")","oldContent":"    @GetMapping(\"/engineers\")"},{"type":"MODIFY","lineNumber":52,"content":"        List<AppUser> engineers = userRepo.findByTeamIsNullAndRoles_NameIn(engineerRoles);","oldContent":"        List<AppUser> engineers = userRepo.findByTeamIsNullAndRoles_NameIn(engineerRoles);"}]},{"timestamp":1762113482269,"changes":[{"type":"MODIFY","lineNumber":23,"content":"","oldContent":"    "},{"type":"INSERT","lineNumber":26,"content":""},{"type":"DELETE","lineNumber":27,"oldContent":"    @GetMapping(\"/engineers\")"},{"type":"INSERT","lineNumber":51,"content":"        List<ERole> engineerRoles = List.of(ERole.ROLE_FIELD_ENGINEER, ERole.ROLE_L1_ENGINEER, ERole.ROLE_NOC_ENGINEER);"},{"type":"DELETE","lineNumber":52,"oldContent":"        List<AppUser> engineers = userRepo.findByTeamIsNullAndRoles_NameIn(engineerRoles);"}]},{"timestamp":1762113505215,"changes":[{"type":"DELETE","lineNumber":48,"oldContent":""},{"type":"DELETE","lineNumber":49,"oldContent":"    // And add the corresponding method to UserService.java"},{"type":"DELETE","lineNumber":50,"oldContent":"    public List<UserSummaryDto> getUnassignedEngineers() {"},{"type":"DELETE","lineNumber":51,"oldContent":"        List<ERole> engineerRoles = List.of(ERole.ROLE_FIELD_ENGINEER, ERole.ROLE_L1_ENGINEER, ERole.ROLE_NOC_ENGINEER);"},{"type":"DELETE","lineNumber":52,"oldContent":"        List<AppUser> engineers = userRepo.findByTeamIsNullAndRoles_NameIn(engineerRoles);"},{"type":"DELETE","lineNumber":53,"oldContent":"        return mapUsersToSummaryDto(engineers);"},{"type":"DELETE","lineNumber":54,"oldContent":"    }"},{"type":"INSERT","lineNumber":48,"content":"    "}]},{"timestamp":1762113514031,"changes":[{"type":"MODIFY","lineNumber":48,"content":"","oldContent":"    "}]},{"timestamp":1762168943435,"changes":[{"type":"INSERT","lineNumber":49,"content":"    @GetMapping(\"/cities\")"},{"type":"INSERT","lineNumber":50,"content":"    @PreAuthorize(\"hasRole('MANAGER')\")"},{"type":"INSERT","lineNumber":51,"content":"    public ResponseEntity<List<String>> getCustomerCities() {"},{"type":"INSERT","lineNumber":52,"content":"        return ResponseEntity.ok(userService.getCustomerCities());"},{"type":"INSERT","lineNumber":53,"content":"    }"},{"type":"INSERT","lineNumber":54,"content":""}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/TicketService.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/TicketService.java","baseContent":"package com.capstone.tele_ticketing_backend_1.service;\n\nimport com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;\nimport com.capstone.tele_ticketing_backend_1.dto.UserSummaryDto;\nimport com.capstone.tele_ticketing_backend_1.entities.Ticket;\nimport com.capstone.tele_ticketing_backend_1.exceptions.TicketNotFoundException;\nimport com.capstone.tele_ticketing_backend_1.repo.TicketRepo;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\nimport java.util.stream.Collectors;\n\n@Service\npublic class TicketService {\n\n    @Autowired\n    private TicketRepo ticketRepo;\n\n    @Transactional(readOnly = true) // This is a read-only operation\n    public TicketDetailDto getTicketById(Long ticketId) {\n        Ticket ticket = ticketRepo.findById(ticketId)\n                .orElseThrow(() -> new TicketNotFoundException(\"Ticket not found with id: \" + ticketId));\n        return mapTicketToDetailDto(ticket);\n    }\n\n    // Dr. X's Note: This mapper now becomes our single source of truth for creating a detailed view.\n    // It's enhanced to include all necessary fields.\n    private TicketDetailDto mapTicketToDetailDto(Ticket ticket) {\n        TicketDetailDto dto = new TicketDetailDto();\n        dto.setId(ticket.getId());\n        dto.setTicketUid(ticket.getTicketUid());\n        dto.setTitle(ticket.getTitle());\n        dto.setDescription(ticket.getDescription());\n        dto.setStatus(ticket.getStatus());\n        dto.setCategory(ticket.getCategory());\n        dto.setPriority(ticket.getPriority());\n        dto.setSeverity(ticket.getSeverity());\n\n        dto.setCreatedFor(new UserSummaryDto(\n                ticket.getCreatedFor().getId(),\n                ticket.getCreatedFor().getUsername(),\n                ticket.getCreatedFor().getFullName()\n        ));\n\n        dto.setAssignedTo(ticket.getAssignedTo().stream()\n                .map(user -> new UserSummaryDto(user.getId(), user.getUsername(), user.getFullName()))\n                .collect(Collectors.toSet()));\n\n        dto.setCreatedAt(ticket.getCreatedAt());\n        dto.setResolvedAt(ticket.getResolvedAt());\n        return dto;\n    }\n}","baseTimestamp":1761862579109,"deltas":[{"timestamp":1761863463721,"changes":[{"type":"INSERT","lineNumber":2,"content":""},{"type":"MODIFY","lineNumber":19,"content":"    @Transactional(readOnly = true)","oldContent":"    @Transactional(readOnly = true) // This is a read-only operation"},{"type":"DELETE","lineNumber":25,"oldContent":"    // Dr. X's Note: This mapper now becomes our single source of truth for creating a detailed view."},{"type":"DELETE","lineNumber":26,"oldContent":"    // It's enhanced to include all necessary fields."},{"type":"DELETE","lineNumber":27,"oldContent":"    private TicketDetailDto mapTicketToDetailDto(Ticket ticket) {"},{"type":"INSERT","lineNumber":26,"content":"    // Dr. X's Fix: This is now the CENTRAL and COMPLETE mapper for all services."},{"type":"INSERT","lineNumber":27,"content":"    // It is public so other services can call it."},{"type":"INSERT","lineNumber":28,"content":"    public TicketDetailDto mapTicketToDetailDto(Ticket ticket) {"},{"type":"INSERT","lineNumber":49,"content":"        if (ticket.getAssignedBy() != null) {"},{"type":"INSERT","lineNumber":50,"content":"            dto.setAssignedBy(new UserSummaryDto("},{"type":"INSERT","lineNumber":51,"content":"                    ticket.getAssignedBy().getId(),"},{"type":"INSERT","lineNumber":52,"content":"                    ticket.getAssignedBy().getUsername(),"},{"type":"INSERT","lineNumber":53,"content":"                    ticket.getAssignedBy().getFullName()"},{"type":"INSERT","lineNumber":54,"content":"            ));"},{"type":"INSERT","lineNumber":55,"content":"        }"},{"type":"INSERT","lineNumber":56,"content":""}]},{"timestamp":1762148208414,"changes":[{"type":"DELETE","lineNumber":19,"oldContent":"    @Transactional(readOnly = true) // This is a read-only operation"},{"type":"INSERT","lineNumber":20,"content":"    public TicketDetailDto getTicketById(Long ticketId) {"},{"type":"DELETE","lineNumber":49,"oldContent":"        dto.setCreatedAt(ticket.getCreatedAt());"},{"type":"DELETE","lineNumber":51,"oldContent":"        dto.setResolvedAt(ticket.getResolvedAt());"},{"type":"DELETE","lineNumber":53,"oldContent":"        return dto;"},{"type":"DELETE","lineNumber":55,"oldContent":"    }"},{"type":"DELETE","lineNumber":57,"oldContent":"}"},{"type":"DELETE","lineNumber":59,"oldContent":""},{"type":"INSERT","lineNumber":56,"content":""},{"type":"INSERT","lineNumber":57,"content":"        dto.setCreatedAt(ticket.getCreatedAt());"},{"type":"INSERT","lineNumber":58,"content":"        dto.setResolvedAt(ticket.getResolvedAt());"},{"type":"INSERT","lineNumber":59,"content":"        return dto;"},{"type":"INSERT","lineNumber":60,"content":"    }"},{"type":"INSERT","lineNumber":61,"content":""},{"type":"INSERT","lineNumber":62,"content":"    @Transactional(readOnly = true)"},{"type":"INSERT","lineNumber":63,"content":"    public List<Team> getAllTeams() {"},{"type":"INSERT","lineNumber":64,"content":"        return teamRepo.findAll();"},{"type":"INSERT","lineNumber":65,"content":"    }"},{"type":"INSERT","lineNumber":66,"content":"}"}]},{"timestamp":1762148217338,"changes":[{"type":"INSERT","lineNumber":5,"content":"import com.capstone.tele_ticketing_backend_1.entities.Team;"},{"type":"DELETE","lineNumber":19,"oldContent":"    public TicketDetailDto getTicketById(Long ticketId) {"},{"type":"INSERT","lineNumber":21,"content":"    public TicketDetailDto getTicketById(Long ticketId) {"},{"type":"DELETE","lineNumber":52,"oldContent":""},{"type":"INSERT","lineNumber":54,"content":"                    ticket.getAssignedBy().getFullName()"},{"type":"INSERT","lineNumber":55,"content":"            ));"},{"type":"INSERT","lineNumber":56,"content":"        }"},{"type":"INSERT","lineNumber":57,"content":""},{"type":"DELETE","lineNumber":56,"oldContent":"                    ticket.getAssignedBy().getFullName()"},{"type":"DELETE","lineNumber":59,"oldContent":"            ));"},{"type":"DELETE","lineNumber":61,"oldContent":"        }"},{"type":"DELETE","lineNumber":63,"oldContent":"}"},{"type":"MODIFY","lineNumber":66,"content":"    }","oldContent":"    }"},{"type":"INSERT","lineNumber":67,"content":"}"}]},{"timestamp":1762148222680,"changes":[{"type":"INSERT","lineNumber":12,"content":""},{"type":"INSERT","lineNumber":13,"content":"import java.util.List;"},{"type":"DELETE","lineNumber":55,"oldContent":"        dto.setCreatedAt(ticket.getCreatedAt());"},{"type":"DELETE","lineNumber":57,"oldContent":"        dto.setResolvedAt(ticket.getResolvedAt());"},{"type":"INSERT","lineNumber":60,"content":"        dto.setCreatedAt(ticket.getCreatedAt());"},{"type":"INSERT","lineNumber":61,"content":"        dto.setResolvedAt(ticket.getResolvedAt());"},{"type":"INSERT","lineNumber":67,"content":"        return teamRepo.findAll();"},{"type":"DELETE","lineNumber":66,"oldContent":"    }"}]},{"timestamp":1762148225469,"changes":[{"type":"MODIFY","lineNumber":14,"content":"import java.util.stream.Collectors;","oldContent":"import java.util.stream.Collectors;"},{"type":"MODIFY","lineNumber":62,"content":"        return dto;","oldContent":"        return dto;"},{"type":"MODIFY","lineNumber":68,"content":"    }","oldContent":"    }"}]},{"timestamp":1762148235240,"changes":[{"type":"INSERT","lineNumber":13,"content":"import java.util.List;"},{"type":"DELETE","lineNumber":14,"oldContent":"import java.util.stream.Collectors;"},{"type":"INSERT","lineNumber":22,"content":"    @Autowired"},{"type":"INSERT","lineNumber":23,"content":"    private TeamRepo teamRepo;"},{"type":"INSERT","lineNumber":24,"content":""},{"type":"INSERT","lineNumber":64,"content":"        dto.setResolvedAt(ticket.getResolvedAt());"},{"type":"DELETE","lineNumber":62,"oldContent":"        return dto;"},{"type":"INSERT","lineNumber":70,"content":"        return teamRepo.findAll();"},{"type":"DELETE","lineNumber":68,"oldContent":"    }"}]},{"timestamp":1762148242140,"changes":[{"type":"INSERT","lineNumber":8,"content":"import com.capstone.tele_ticketing_backend_1.repo.TeamRepo;"},{"type":"DELETE","lineNumber":23,"oldContent":"    @Transactional(readOnly = true)"},{"type":"DELETE","lineNumber":25,"oldContent":"    public TicketDetailDto getTicketById(Long ticketId) {"},{"type":"INSERT","lineNumber":26,"content":"    @Transactional(readOnly = true)"},{"type":"INSERT","lineNumber":27,"content":"    public TicketDetailDto getTicketById(Long ticketId) {"},{"type":"INSERT","lineNumber":65,"content":"        dto.setResolvedAt(ticket.getResolvedAt());"},{"type":"DELETE","lineNumber":66,"oldContent":"        dto.setResolvedAt(ticket.getResolvedAt());"},{"type":"INSERT","lineNumber":71,"content":"        return teamRepo.findAll();"},{"type":"DELETE","lineNumber":72,"oldContent":"        return teamRepo.findAll();"}]},{"timestamp":1762148273607,"changes":[{"type":"MODIFY","lineNumber":26,"content":"    @Transactional(readOnly = true)","oldContent":"    @Transactional(readOnly = true)"},{"type":"DELETE","lineNumber":33,"oldContent":"    // Dr. X's Fix: This is now the CENTRAL and COMPLETE mapper for all services."},{"type":"DELETE","lineNumber":34,"oldContent":"    // It is public so other services can call it."},{"type":"INSERT","lineNumber":33,"content":"    "},{"type":"MODIFY","lineNumber":65,"content":"        return dto;","oldContent":"        return dto;"},{"type":"MODIFY","lineNumber":71,"content":"    }","oldContent":"    }"}]},{"timestamp":1762148302326,"changes":[{"type":"INSERT","lineNumber":25,"content":""},{"type":"DELETE","lineNumber":26,"oldContent":"    @Transactional(readOnly = true)"},{"type":"MODIFY","lineNumber":33,"content":"","oldContent":"    "},{"type":"MODIFY","lineNumber":65,"content":"        return dto;","oldContent":"        return dto;"},{"type":"MODIFY","lineNumber":71,"content":"    }","oldContent":"    }"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/TicketController.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/TicketController.java","baseContent":"package com.capstone.tele_ticketing_backend_1.controller;\n\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;\nimport com.capstone.tele_ticketing_backend_1.service.TicketService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.security.access.prepost.PreAuthorize;\nimport org.springframework.web.bind.annotation.*;\n\n@RestController\n@RequestMapping(\"/api/v1/tickets\")\n// Dr. X's Note: Any authenticated user can view a ticket's details.\n// We can add more specific \"ownership\" security later if needed.\n@PreAuthorize(\"isAuthenticated()\")\npublic class TicketController {\n\n    @Autowired\n    private TicketService ticketService;\n\n    @GetMapping(\"/{id}\")\n    public ResponseEntity<TicketDetailDto> getTicketById(@PathVariable Long id) {\n        return ResponseEntity.ok(ticketService.getTicketById(id));\n    }\n}","baseTimestamp":1761862714661},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/ActivityLogDto.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/ActivityLogDto.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\nimport lombok.Data;\nimport java.time.LocalDateTime;\n\n@Data\npublic class ActivityLogDto {\n    private Long id;\n    private String description;\n    private String activityType;\n    private UserSummaryDto user; // Reusing our existing UserSummaryDto\n    private LocalDateTime createdAt;\n    private boolean internalOnly;\n}","baseTimestamp":1761886869638,"deltas":[{"timestamp":1761886997343,"changes":[{"type":"MODIFY","lineNumber":10,"content":"    private UserSummaryDto user;","oldContent":"    private UserSummaryDto user; // Reusing our existing UserSummaryDto"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/exceptions/AuthorizationException.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/exceptions/AuthorizationException.java","baseContent":"package com.capstone.tele_ticketing_backend_1.exceptions;\n\npublic class AuthorizationException extends RuntimeException {\n    public AuthorizationException(String message) {\n        super(message);\n    }\n}\n","baseTimestamp":1761887018906,"deltas":[{"timestamp":1761887027978,"changes":[{"type":"INSERT","lineNumber":2,"content":"import org.springframework.http.HttpStatus;"},{"type":"INSERT","lineNumber":3,"content":"import org.springframework.web.bind.annotation.ResponseStatus;"},{"type":"INSERT","lineNumber":4,"content":""},{"type":"INSERT","lineNumber":5,"content":"@ResponseStatus(HttpStatus.FORBIDDEN)"},{"type":"DELETE","lineNumber":7,"oldContent":""}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/repo/TicketActivityRepo.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/repo/TicketActivityRepo.java","baseContent":"package com.capstone.tele_ticketing_backend_1.repo;\n\npublic interface TicketActivityRepo {\n}\n","baseTimestamp":1761887047651,"deltas":[{"timestamp":1761887053693,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"public interface TicketActivityRepo {"},{"type":"DELETE","lineNumber":3,"oldContent":"}"},{"type":"INSERT","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.entities.TicketActivity;"},{"type":"INSERT","lineNumber":3,"content":"import org.springframework.data.jpa.repository.JpaRepository;"},{"type":"INSERT","lineNumber":4,"content":"import org.springframework.stereotype.Repository;"},{"type":"INSERT","lineNumber":6,"content":"import java.util.List;"},{"type":"INSERT","lineNumber":7,"content":""},{"type":"INSERT","lineNumber":8,"content":"@Repository"},{"type":"INSERT","lineNumber":9,"content":"public interface TicketActivityRepo extends JpaRepository<TicketActivity, Long> {"},{"type":"INSERT","lineNumber":10,"content":""},{"type":"INSERT","lineNumber":11,"content":"    // Gets all logs for a ticket, sorted by most recent first. (For internal users)"},{"type":"INSERT","lineNumber":12,"content":"    List<TicketActivity> findByTicketIdOrderByCreatedAtDesc(Long ticketId);"},{"type":"INSERT","lineNumber":13,"content":""},{"type":"INSERT","lineNumber":14,"content":"    // Gets only public logs for a ticket. (For customers/agents)"},{"type":"INSERT","lineNumber":15,"content":"    List<TicketActivity> findByTicketIdAndInternalOnlyFalseOrderByCreatedAtDesc(Long ticketId);"},{"type":"INSERT","lineNumber":16,"content":"}"}]},{"timestamp":1761894877156,"changes":[{"type":"DELETE","lineNumber":6,"oldContent":"}"},{"type":"DELETE","lineNumber":8,"oldContent":"    List<TicketActivity> findByTicketIdAndInternalOnlyFalseOrderByCreatedAtDesc(Long ticketId);"},{"type":"DELETE","lineNumber":10,"oldContent":"    // Gets only public logs for a ticket. (For customers/agents)"},{"type":"DELETE","lineNumber":12,"oldContent":""},{"type":"DELETE","lineNumber":14,"oldContent":"    List<TicketActivity> findByTicketIdOrderByCreatedAtDesc(Long ticketId);"},{"type":"INSERT","lineNumber":12,"content":"    List<TicketActivity> findByTicketIdOrderByCreatedAtDesc(Long ticketId);"},{"type":"INSERT","lineNumber":13,"content":""},{"type":"INSERT","lineNumber":14,"content":"    // Gets only public logs for a ticket. (For customers/agents)"},{"type":"INSERT","lineNumber":15,"content":"    List<TicketActivity> findByTicketIdAndInternalOnlyFalseOrderByCreatedAtDesc(Long ticketId);"},{"type":"INSERT","lineNumber":16,"content":""},{"type":"INSERT","lineNumber":17,"content":"    List<TicketActivity> findFirst8ByTicket_CreatedForAndInternalOnlyFalseOrderByCreatedAtDesc(AppUser user);"},{"type":"INSERT","lineNumber":18,"content":"}"}]},{"timestamp":1761894888135,"changes":[{"type":"INSERT","lineNumber":9,"content":"public interface TicketActivityRepo extends JpaRepository<TicketActivity, Long> {"},{"type":"INSERT","lineNumber":10,"content":""},{"type":"INSERT","lineNumber":11,"content":"    // Gets all logs for a ticket, sorted by most recent first. (For internal users)"},{"type":"DELETE","lineNumber":11,"oldContent":"public interface TicketActivityRepo extends JpaRepository<TicketActivity, Long> {"},{"type":"DELETE","lineNumber":15,"oldContent":""},{"type":"DELETE","lineNumber":16,"oldContent":"    // Gets all logs for a ticket, sorted by most recent first. (For internal users)"}]},{"timestamp":1761894898457,"changes":[{"type":"INSERT","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.entities.AppUser;"},{"type":"DELETE","lineNumber":10,"oldContent":"    List<TicketActivity> findByTicketIdOrderByCreatedAtDesc(Long ticketId);"},{"type":"DELETE","lineNumber":12,"oldContent":""},{"type":"INSERT","lineNumber":13,"content":"    List<TicketActivity> findByTicketIdOrderByCreatedAtDesc(Long ticketId);"},{"type":"INSERT","lineNumber":14,"content":""}]},{"timestamp":1761899655989,"changes":[{"type":"MODIFY","lineNumber":13,"content":"    List<TicketActivity> findByTicketIdOrderByCreatedAtDesc(Long ticketId);","oldContent":"    List<TicketActivity> findByTicketIdOrderByCreatedAtDesc(Long ticketId);"},{"type":"INSERT","lineNumber":19,"content":""},{"type":"INSERT","lineNumber":20,"content":"    List<TicketActivity> findAllByTicket_CreatedForAndInternalOnlyFalseOrderByCreatedAtDesc(AppUser user);"}]},{"timestamp":1761908738761,"changes":[{"type":"INSERT","lineNumber":12,"content":"    // Gets all logs for a ticket, sorted by most recent first. (For internal users)"},{"type":"DELETE","lineNumber":13,"oldContent":"    List<TicketActivity> findByTicketIdOrderByCreatedAtDesc(Long ticketId);"},{"type":"DELETE","lineNumber":20,"oldContent":"}"},{"type":"INSERT","lineNumber":21,"content":""},{"type":"INSERT","lineNumber":22,"content":"    List<TicketActivity> findFirst8ByTicket_CreatedByAndInternalOnlyFalseOrderByCreatedAtDesc(AppUser user);"},{"type":"INSERT","lineNumber":23,"content":"}"}]},{"timestamp":1762024841755,"changes":[{"type":"MODIFY","lineNumber":21,"content":"","oldContent":""},{"type":"INSERT","lineNumber":23,"content":""},{"type":"INSERT","lineNumber":24,"content":"    // Finds all public activities for tickets CREATED BY a specific user, ordered by most recent."},{"type":"INSERT","lineNumber":25,"content":"    List<TicketActivity> findAllByTicket_CreatedByAndInternalOnlyFalseOrderByCreatedAtDesc(AppUser user);"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/ActivityLogService.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/ActivityLogService.java","baseContent":"package com.capstone.tele_ticketing_backend_1.service;\n\nimport com.capstone.tele_ticketing_backend_1.dto.ActivityLogDto;\nimport com.capstone.tele_ticketing_backend_1.dto.UserSummaryDto;\nimport com.capstone.tele_ticketing_backend_1.entities.*;\nimport com.capstone.tele_ticketing_backend_1.exceptions.AuthorizationException;\nimport com.capstone.tele_ticketing_backend_1.exceptions.TicketNotFoundException;\nimport com.capstone.tele_ticketing_backend_1.repo.TicketActivityRepo;\nimport com.capstone.tele_ticketing_backend_1.repo.TicketRepo;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n@Service\npublic class ActivityLogService {\n\n    @Autowired\n    private TicketActivityRepo activityRepo;\n\n    @Autowired\n    private TicketRepo ticketRepo;\n\n    /**\n     * Core method to create a new log entry. This will be called by other services.\n     */\n    @Transactional\n    public void createLog(Ticket ticket, AppUser user, ActivityType type, String description, boolean isInternal) {\n        TicketActivity log = new TicketActivity();\n        log.setTicket(ticket);\n        log.setUser(user);\n        log.setActivityType(type);\n        log.setDescription(description);\n        log.setInternalOnly(isInternal);\n        activityRepo.save(log);\n    }\n\n    /**\n     * Retrieves logs for a ticket based on the requesting user's role and permissions.\n     */\n    @Transactional(readOnly = true)\n    public List<ActivityLogDto> getLogsForTicket(Long ticketId, AppUser requestingUser) {\n        Ticket ticket = ticketRepo.findById(ticketId)\n                .orElseThrow(() -> new TicketNotFoundException(\"Ticket not found with id: \" + ticketId));\n\n        // Determine if the user has internal viewing rights.\n        boolean canViewInternalLogs = canUserViewInternalLogs(requestingUser, ticket);\n\n        List<TicketActivity> activities;\n        if (canViewInternalLogs) {\n            activities = activityRepo.findByTicketIdOrderByCreatedAtDesc(ticketId);\n        } else {\n            // Customers/Agents can only view their own tickets.\n            if (!ticket.getCreatedFor().getId().equals(requestingUser.getId()) &&\n                    !ticket.getCreatedBy().getId().equals(requestingUser.getId())) {\n                throw new AuthorizationException(\"You are not authorized to view this ticket's logs.\");\n            }\n            activities = activityRepo.findByTicketIdAndInternalOnlyFalseOrderByCreatedAtDesc(ticketId);\n        }\n\n        return activities.stream().map(this::mapToDto).collect(Collectors.toList());\n    }\n\n    private boolean canUserViewInternalLogs(AppUser user, Ticket ticket) {\n        // Simple logic: If the user is not a customer, they can see internal logs.\n        // A more complex system might check if the engineer is assigned to the ticket.\n        return user.getRoles().stream()\n                .noneMatch(role -> role.getName().equals(ERole.ROLE_CUSTOMER));\n    }\n\n    private ActivityLogDto mapToDto(TicketActivity activity) {\n        ActivityLogDto dto = new ActivityLogDto();\n        dto.setId(activity.getId());\n        dto.setDescription(activity.getDescription());\n        dto.setActivityType(activity.getActivityType().name());\n        dto.setInternalOnly(activity.isInternalOnly());\n        dto.setCreatedAt(activity.getCreatedAt());\n\n        AppUser user = activity.getUser();\n        dto.setUser(new UserSummaryDto(user.getId(), user.getUsername(), user.getFullName()));\n\n        return dto;\n    }\n}","baseTimestamp":1761887069581},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/ActivityLogController.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/ActivityLogController.java","baseContent":"package com.capstone.tele_ticketing_backend_1.controller;\n\nimport com.capstone.tele_ticketing_backend_1.dto.ActivityLogDto;\nimport com.capstone.tele_ticketing_backend_1.entities.AppUser;\nimport com.capstone.tele_ticketing_backend_1.exceptions.UserNotFoundException;\nimport com.capstone.tele_ticketing_backend_1.repo.UserRepo;\nimport com.capstone.tele_ticketing_backend_1.service.ActivityLogService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.security.access.prepost.PreAuthorize;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.util.List;\n\n@RestController\n@RequestMapping(\"/api/v1/tickets/{ticketId}/logs\")\n@PreAuthorize(\"isAuthenticated()\")\npublic class ActivityLogController {\n\n    @Autowired\n    private ActivityLogService activityLogService;\n\n    @Autowired\n    private UserRepo userRepo;\n\n    @GetMapping\n    public ResponseEntity<List<ActivityLogDto>> getTicketLogs(@PathVariable Long ticketId) {\n        String username = SecurityContextHolder.getContext().getAuthentication().getName();\n        AppUser user = userRepo.findByUsername(username)\n                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));\n\n        List<ActivityLogDto> logs = activityLogService.getLogsForTicket(ticketId, user);\n        return ResponseEntity.ok(logs);\n    }\n}","baseTimestamp":1761887088876},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/DashboardStatsDto.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/DashboardStatsDto.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\nimport lombok.Data;\n\n@Data\npublic class DashboardStatsDto {\n    private long activeTickets;\n    private long resolvedTickets;\n    private long feedbackRequiredTickets;\n}","baseTimestamp":1761894788976},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/DashboardActivityDto.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/DashboardActivityDto.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport java.time.LocalDateTime;\n\n@Data\n@AllArgsConstructor\npublic class DashboardActivityDto {\n    private Long activityId;\n    private String description;\n    private String ticketUid;\n    private String ticketTitle;\n    private LocalDateTime createdAt;\n}","baseTimestamp":1761894802914},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/DashboardService.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/DashboardService.java","baseContent":"package com.capstone.tele_ticketing_backend_1.service;\n\nimport com.capstone.tele_ticketing_backend_1.dto.DashboardActivityDto;\nimport com.capstone.tele_ticketing_backend_1.dto.DashboardStatsDto;\nimport com.capstone.tele_ticketing_backend_1.entities.AppUser;\nimport com.capstone.tele_ticketing_backend_1.entities.TicketStatus;\nimport com.capstone.tele_ticketing_backend_1.exceptions.UserNotFoundException;\nimport com.capstone.tele_ticketing_backend_1.repo.TicketActivityRepo;\nimport com.capstone.tele_ticketing_backend_1.repo.TicketRepo;\nimport com.capstone.tele_ticketing_backend_1.repo.UserRepo;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n@Service\npublic class DashboardService {\n\n    @Autowired\n    private TicketRepo ticketRepo;\n\n    @Autowired\n    private TicketActivityRepo activityRepo;\n\n    @Autowired\n    private UserRepo userRepo;\n\n    @Transactional(readOnly = true)\n    public DashboardStatsDto getDashboardStats(String username) {\n        AppUser user = userRepo.findByUsername(username)\n                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));\n\n        List<TicketStatus> activeStatuses = List.of(\n                TicketStatus.CREATED, TicketStatus.ASSIGNED, TicketStatus.IN_PROGRESS,\n                TicketStatus.NEEDS_TRIAGING, TicketStatus.REOPENED, TicketStatus.FIXED\n        );\n\n        long activeCount = ticketRepo.countByCreatedForAndStatusIn(user, activeStatuses);\n        long resolvedCount = ticketRepo.countByCreatedForAndStatus(user, TicketStatus.RESOLVED);\n        long feedbackCount = ticketRepo.countByCreatedForAndStatus(user, TicketStatus.FIXED);\n\n        DashboardStatsDto stats = new DashboardStatsDto();\n        stats.setActiveTickets(activeCount);\n        stats.setResolvedTickets(resolvedCount);\n        stats.setFeedbackRequiredTickets(feedbackCount);\n\n        return stats;\n    }\n\n    @Transactional(readOnly = true)\n    public List<DashboardActivityDto> getRecentActivities(String username) {\n        AppUser user = userRepo.findByUsername(username)\n                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));\n\n        return activityRepo.findFirst8ByTicket_CreatedForAndInternalOnlyFalseOrderByCreatedAtDesc(user)\n                .stream()\n                .map(activity -> new DashboardActivityDto(\n                        activity.getId(),\n                        activity.getDescription(),\n                        activity.getTicket().getTicketUid(),\n                        activity.getTicket().getTitle(),\n                        activity.getCreatedAt()\n                ))\n                .collect(Collectors.toList());\n    }\n}\n","baseTimestamp":1761894910780},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/DashboardController.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/DashboardController.java","baseContent":"package com.capstone.tele_ticketing_backend_1.controller;\n\n\nimport com.capstone.tele_ticketing_backend_1.dto.DashboardActivityDto;\nimport com.capstone.tele_ticketing_backend_1.dto.DashboardStatsDto;\nimport com.capstone.tele_ticketing_backend_1.entities.AppUser;\nimport com.capstone.tele_ticketing_backend_1.entities.TicketStatus;\nimport com.capstone.tele_ticketing_backend_1.exceptions.UserNotFoundException;\nimport com.capstone.tele_ticketing_backend_1.repo.TicketActivityRepo;\nimport com.capstone.tele_ticketing_backend_1.repo.TicketRepo;\nimport com.capstone.tele_ticketing_backend_1.repo.UserRepo;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n@Service\npublic class DashboardService {\n\n    @Autowired\n    private TicketRepo ticketRepo;\n\n    @Autowired\n    private TicketActivityRepo activityRepo;\n\n    @Autowired\n    private UserRepo userRepo;\n\n    @Transactional(readOnly = true)\n    public DashboardStatsDto getDashboardStats(String username) {\n        AppUser user = userRepo.findByUsername(username)\n                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));\n\n        List<TicketStatus> activeStatuses = List.of(\n                TicketStatus.CREATED, TicketStatus.ASSIGNED, TicketStatus.IN_PROGRESS,\n                TicketStatus.NEEDS_TRIAGING, TicketStatus.REOPENED, TicketStatus.FIXED\n        );\n\n        long activeCount = ticketRepo.countByCreatedForAndStatusIn(user, activeStatuses);\n        long resolvedCount = ticketRepo.countByCreatedForAndStatus(user, TicketStatus.RESOLVED);\n        long feedbackCount = ticketRepo.countByCreatedForAndStatus(user, TicketStatus.FIXED);\n\n        DashboardStatsDto stats = new DashboardStatsDto();\n        stats.setActiveTickets(activeCount);\n        stats.setResolvedTickets(resolvedCount);\n        stats.setFeedbackRequiredTickets(feedbackCount);\n\n        return stats;\n    }\n\n    @Transactional(readOnly = true)\n    public List<DashboardActivityDto> getRecentActivities(String username) {\n        AppUser user = userRepo.findByUsername(username)\n                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));\n\n        return activityRepo.findFirst8ByTicket_CreatedForAndInternalOnlyFalseOrderByCreatedAtDesc(user)\n                .stream()\n                .map(activity -> new DashboardActivityDto(\n                        activity.getId(),\n                        activity.getDescription(),\n                        activity.getTicket().getTicketUid(),\n                        activity.getTicket().getTitle(),\n                        activity.getCreatedAt()\n                ))\n                .collect(Collectors.toList());\n    }\n}","baseTimestamp":1761894938227,"deltas":[{"timestamp":1761894954429,"changes":[{"type":"DELETE","lineNumber":5,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.AppUser;"},{"type":"DELETE","lineNumber":6,"oldContent":"import com.capstone.tele_ticketing_backend_1.entities.TicketStatus;"},{"type":"DELETE","lineNumber":7,"oldContent":"import com.capstone.tele_ticketing_backend_1.exceptions.UserNotFoundException;"},{"type":"DELETE","lineNumber":8,"oldContent":"import com.capstone.tele_ticketing_backend_1.repo.TicketActivityRepo;"},{"type":"DELETE","lineNumber":9,"oldContent":"import com.capstone.tele_ticketing_backend_1.repo.TicketRepo;"},{"type":"DELETE","lineNumber":10,"oldContent":"import com.capstone.tele_ticketing_backend_1.repo.UserRepo;"},{"type":"INSERT","lineNumber":5,"content":"import com.capstone.tele_ticketing_backend_1.service.DashboardService;"},{"type":"DELETE","lineNumber":12,"oldContent":"import org.springframework.stereotype.Service;"},{"type":"DELETE","lineNumber":13,"oldContent":"import org.springframework.transaction.annotation.Transactional;"},{"type":"INSERT","lineNumber":7,"content":"import org.springframework.http.ResponseEntity;"},{"type":"INSERT","lineNumber":8,"content":"import org.springframework.security.access.prepost.PreAuthorize;"},{"type":"INSERT","lineNumber":9,"content":"import org.springframework.security.core.context.SecurityContextHolder;"},{"type":"INSERT","lineNumber":10,"content":"import org.springframework.web.bind.annotation.GetMapping;"},{"type":"INSERT","lineNumber":11,"content":"import org.springframework.web.bind.annotation.RequestMapping;"},{"type":"INSERT","lineNumber":12,"content":"import org.springframework.web.bind.annotation.RestController;"},{"type":"DELETE","lineNumber":15,"oldContent":"import java.util.stream.Collectors;"},{"type":"DELETE","lineNumber":17,"oldContent":"@Service"},{"type":"DELETE","lineNumber":18,"oldContent":"public class DashboardService {"},{"type":"INSERT","lineNumber":15,"content":"@RestController"},{"type":"INSERT","lineNumber":16,"content":"@RequestMapping(\"/api/v1/customer/dashboard\")"},{"type":"INSERT","lineNumber":17,"content":"@PreAuthorize(\"hasRole('CUSTOMER')\")"},{"type":"INSERT","lineNumber":18,"content":"public class DashboardController {"},{"type":"MODIFY","lineNumber":21,"content":"    private DashboardService dashboardService;","oldContent":"    private TicketRepo ticketRepo;"},{"type":"DELETE","lineNumber":23,"oldContent":"    @Autowired"},{"type":"DELETE","lineNumber":24,"oldContent":"    private TicketActivityRepo activityRepo;"},{"type":"DELETE","lineNumber":25,"oldContent":""},{"type":"DELETE","lineNumber":26,"oldContent":"    @Autowired"},{"type":"DELETE","lineNumber":27,"oldContent":"    private UserRepo userRepo;"},{"type":"DELETE","lineNumber":28,"oldContent":""},{"type":"DELETE","lineNumber":29,"oldContent":"    @Transactional(readOnly = true)"},{"type":"DELETE","lineNumber":30,"oldContent":"    public DashboardStatsDto getDashboardStats(String username) {"},{"type":"DELETE","lineNumber":31,"oldContent":"        AppUser user = userRepo.findByUsername(username)"},{"type":"DELETE","lineNumber":32,"oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));"},{"type":"DELETE","lineNumber":33,"oldContent":""},{"type":"DELETE","lineNumber":34,"oldContent":"        List<TicketStatus> activeStatuses = List.of("},{"type":"DELETE","lineNumber":35,"oldContent":"                TicketStatus.CREATED, TicketStatus.ASSIGNED, TicketStatus.IN_PROGRESS,"},{"type":"DELETE","lineNumber":36,"oldContent":"                TicketStatus.NEEDS_TRIAGING, TicketStatus.REOPENED, TicketStatus.FIXED"},{"type":"DELETE","lineNumber":37,"oldContent":"        );"},{"type":"DELETE","lineNumber":38,"oldContent":""},{"type":"DELETE","lineNumber":39,"oldContent":"        long activeCount = ticketRepo.countByCreatedForAndStatusIn(user, activeStatuses);"},{"type":"DELETE","lineNumber":40,"oldContent":"        long resolvedCount = ticketRepo.countByCreatedForAndStatus(user, TicketStatus.RESOLVED);"},{"type":"DELETE","lineNumber":41,"oldContent":"        long feedbackCount = ticketRepo.countByCreatedForAndStatus(user, TicketStatus.FIXED);"},{"type":"DELETE","lineNumber":42,"oldContent":""},{"type":"DELETE","lineNumber":43,"oldContent":"        DashboardStatsDto stats = new DashboardStatsDto();"},{"type":"DELETE","lineNumber":44,"oldContent":"        stats.setActiveTickets(activeCount);"},{"type":"DELETE","lineNumber":45,"oldContent":"        stats.setResolvedTickets(resolvedCount);"},{"type":"DELETE","lineNumber":46,"oldContent":"        stats.setFeedbackRequiredTickets(feedbackCount);"},{"type":"DELETE","lineNumber":47,"oldContent":""},{"type":"DELETE","lineNumber":48,"oldContent":"        return stats;"},{"type":"INSERT","lineNumber":23,"content":"    @GetMapping(\"/stats\")"},{"type":"INSERT","lineNumber":24,"content":"    public ResponseEntity<DashboardStatsDto> getStats() {"},{"type":"INSERT","lineNumber":25,"content":"        String username = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"INSERT","lineNumber":26,"content":"        return ResponseEntity.ok(dashboardService.getDashboardStats(username));"},{"type":"DELETE","lineNumber":51,"oldContent":"    @Transactional(readOnly = true)"},{"type":"DELETE","lineNumber":52,"oldContent":"    public List<DashboardActivityDto> getRecentActivities(String username) {"},{"type":"DELETE","lineNumber":53,"oldContent":"        AppUser user = userRepo.findByUsername(username)"},{"type":"DELETE","lineNumber":54,"oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"User not found: \" + username));"},{"type":"DELETE","lineNumber":55,"oldContent":""},{"type":"DELETE","lineNumber":56,"oldContent":"        return activityRepo.findFirst8ByTicket_CreatedForAndInternalOnlyFalseOrderByCreatedAtDesc(user)"},{"type":"DELETE","lineNumber":57,"oldContent":"                .stream()"},{"type":"DELETE","lineNumber":58,"oldContent":"                .map(activity -> new DashboardActivityDto("},{"type":"DELETE","lineNumber":59,"oldContent":"                        activity.getId(),"},{"type":"DELETE","lineNumber":60,"oldContent":"                        activity.getDescription(),"},{"type":"DELETE","lineNumber":61,"oldContent":"                        activity.getTicket().getTicketUid(),"},{"type":"DELETE","lineNumber":62,"oldContent":"                        activity.getTicket().getTitle(),"},{"type":"DELETE","lineNumber":63,"oldContent":"                        activity.getCreatedAt()"},{"type":"DELETE","lineNumber":64,"oldContent":"                ))"},{"type":"DELETE","lineNumber":65,"oldContent":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":29,"content":"    @GetMapping(\"/recent-activities\")"},{"type":"INSERT","lineNumber":30,"content":"    public ResponseEntity<List<DashboardActivityDto>> getRecentActivities() {"},{"type":"INSERT","lineNumber":31,"content":"        String username = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"INSERT","lineNumber":32,"content":"        return ResponseEntity.ok(dashboardService.getRecentActivities(username));"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/NotificationDto.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/NotificationDto.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\nimport java.time.LocalDateTime;\n\n@Data\n@NoArgsConstructor\n@AllArgsConstructor\npublic class NotificationDto {\n    private Long activityId;\n    private String ticketUid;\n    private String ticketTitle;\n    private String description;\n    private String activityType;\n    private LocalDateTime createdAt;\n}","baseTimestamp":1761899640314},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/AgentDashboardService.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/AgentDashboardService.java","baseContent":"package com.capstone.tele_ticketing_backend_1.service;\n\n\n\nimport com.capstone.tele_ticketing_backend_1.dto.DashboardActivityDto;\nimport com.capstone.tele_ticketing_backend_1.dto.DashboardStatsDto;\nimport com.capstone.tele_ticketing_backend_1.entities.AppUser;\nimport com.capstone.tele_ticketing_backend_1.entities.TicketStatus;\nimport com.capstone.tele_ticketing_backend_1.exceptions.UserNotFoundException;\nimport com.capstone.tele_ticketing_backend_1.repo.TicketActivityRepo;\nimport com.capstone.tele_ticketing_backend_1.repo.TicketRepo;\nimport com.capstone.tele_ticketing_backend_1.repo.UserRepo;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n@Service\npublic class AgentDashboardService {\n\n    @Autowired\n    private TicketRepo ticketRepo;\n\n    @Autowired\n    private TicketActivityRepo activityRepo;\n\n    @Autowired\n    private UserRepo userRepo;\n\n    @Transactional(readOnly = true)\n    public DashboardStatsDto getDashboardStats(String agentUsername) {\n        AppUser agent = userRepo.findByUsername(agentUsername)\n                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));\n\n        List<TicketStatus> activeStatuses = List.of(\n                TicketStatus.CREATED, TicketStatus.ASSIGNED, TicketStatus.IN_PROGRESS,\n                TicketStatus.NEEDS_TRIAGING, TicketStatus.REOPENED, TicketStatus.FIXED\n        );\n\n        long activeCount = ticketRepo.countByCreatedByAndStatusIn(agent, activeStatuses);\n        long resolvedCount = ticketRepo.countByCreatedByAndStatus(agent, TicketStatus.RESOLVED);\n        long feedbackCount = ticketRepo.countByCreatedByAndStatus(agent, TicketStatus.FIXED);\n\n        DashboardStatsDto stats = new DashboardStatsDto();\n        stats.setActiveTickets(activeCount);\n        stats.setResolvedTickets(resolvedCount);\n        stats.setFeedbackRequiredTickets(feedbackCount);\n\n        return stats;\n    }\n\n    @Transactional(readOnly = true)\n    public List<DashboardActivityDto> getRecentActivities(String agentUsername) {\n        AppUser agent = userRepo.findByUsername(agentUsername)\n                .orElseThrow(() -> new UserNotFoundException(\"Agent not found: \" + agentUsername));\n\n        return activityRepo.findFirst8ByTicket_CreatedByAndInternalOnlyFalseOrderByCreatedAtDesc(agent)\n                .stream()\n                .map(activity -> new DashboardActivityDto(\n                        activity.getId(),\n                        activity.getDescription(),\n                        activity.getTicket().getTicketUid(),\n                        activity.getTicket().getTitle(),\n                        activity.getCreatedAt()\n                ))\n                .collect(Collectors.toList());\n    }\n}","baseTimestamp":1761908753210},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/AgentDashboardController.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/AgentDashboardController.java","baseContent":"package com.capstone.tele_ticketing_backend_1.controller;\n\n\n\nimport com.capstone.tele_ticketing_backend_1.dto.DashboardActivityDto;\nimport com.capstone.tele_ticketing_backend_1.dto.DashboardStatsDto;\nimport com.capstone.tele_ticketing_backend_1.service.AgentDashboardService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.security.access.prepost.PreAuthorize;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\nimport java.util.List;\n\n@RestController\n@RequestMapping(\"/api/v1/agent/dashboard\")\n@PreAuthorize(\"hasRole('AGENT')\")\npublic class AgentDashboardController {\n\n    @Autowired\n    private AgentDashboardService agentDashboardService;\n\n    @GetMapping(\"/stats\")\n    public ResponseEntity<DashboardStatsDto> getStats() {\n        String username = SecurityContextHolder.getContext().getAuthentication().getName();\n        return ResponseEntity.ok(agentDashboardService.getDashboardStats(username));\n    }\n\n    @GetMapping(\"/recent-activities\")\n    public ResponseEntity<List<DashboardActivityDto>> getRecentActivities() {\n        String username = SecurityContextHolder.getContext().getAuthentication().getName();\n        return ResponseEntity.ok(agentDashboardService.getRecentActivities(username));\n    }\n}","baseTimestamp":1761908771182},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/UserService.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/UserService.java","baseContent":"package com.capstone.tele_ticketing_backend_1.service;\n\nimport com.capstone.tele_ticketing_backend_1.dto.UserSummaryDto;\nimport com.capstone.tele_ticketing_backend_1.entities.AppUser;\nimport com.capstone.tele_ticketing_backend_1.entities.ERole;\nimport com.capstone.tele_ticketing_backend_1.repo.UserRepo;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n@Service\npublic class UserService {\n\n    @Autowired\n    private UserRepo userRepo;\n\n    @Transactional(readOnly = true)\n    public List<UserSummaryDto> getAllCustomers() {\n        List<AppUser> customers = userRepo.findAllByRoles_Name(ERole.ROLE_CUSTOMER);\n        return customers.stream()\n                .map(user -> new UserSummaryDto(user.getId(), user.getUsername(), user.getFullName()))\n                .collect(Collectors.toList());\n    }\n}","baseTimestamp":1761909073634,"deltas":[{"timestamp":1761909342414,"changes":[{"type":"DELETE","lineNumber":1,"oldContent":""},{"type":"MODIFY","lineNumber":20,"content":"        return mapUsersToSummaryDto(customers);","oldContent":"        return customers.stream()"},{"type":"INSERT","lineNumber":21,"content":"    }"},{"type":"INSERT","lineNumber":22,"content":""},{"type":"INSERT","lineNumber":23,"content":"    // Dr. X's Addition: Move the engineer-fetching logic here."},{"type":"INSERT","lineNumber":24,"content":"    @Transactional(readOnly = true)"},{"type":"INSERT","lineNumber":25,"content":"    public List<UserSummaryDto> getAssignableEngineers() {"},{"type":"INSERT","lineNumber":26,"content":"        List<ERole> engineerRoles = List.of("},{"type":"INSERT","lineNumber":27,"content":"                ERole.ROLE_FIELD_ENGINEER,"},{"type":"INSERT","lineNumber":28,"content":"                ERole.ROLE_L1_ENGINEER,"},{"type":"INSERT","lineNumber":29,"content":"                ERole.ROLE_NOC_ENGINEER"},{"type":"INSERT","lineNumber":30,"content":"        );"},{"type":"INSERT","lineNumber":31,"content":"        List<AppUser> engineers = userRepo.findAllByRoles_NameIn(engineerRoles);"},{"type":"INSERT","lineNumber":32,"content":"        return mapUsersToSummaryDto(engineers);"},{"type":"INSERT","lineNumber":33,"content":"    }"},{"type":"INSERT","lineNumber":34,"content":""},{"type":"INSERT","lineNumber":35,"content":"    // Helper method to avoid code duplication"},{"type":"INSERT","lineNumber":36,"content":"    private List<UserSummaryDto> mapUsersToSummaryDto(List<AppUser> users) {"},{"type":"INSERT","lineNumber":37,"content":"        return users.stream()"}]},{"timestamp":1762113522961,"changes":[{"type":"INSERT","lineNumber":19,"content":"        List<AppUser> customers = userRepo.findAllByRoles_Name(ERole.ROLE_CUSTOMER);"},{"type":"DELETE","lineNumber":21,"oldContent":"        return customers.stream()"},{"type":"DELETE","lineNumber":23,"oldContent":"                .map(user -> new UserSummaryDto(user.getId(), user.getUsername(), user.getFullName()))"},{"type":"DELETE","lineNumber":25,"oldContent":"                .collect(Collectors.toList());"},{"type":"DELETE","lineNumber":27,"oldContent":"    }"},{"type":"DELETE","lineNumber":29,"oldContent":"}"},{"type":"DELETE","lineNumber":31,"oldContent":"        return users.stream()"},{"type":"DELETE","lineNumber":33,"oldContent":"    private List<UserSummaryDto> mapUsersToSummaryDto(List<AppUser> users) {"},{"type":"DELETE","lineNumber":35,"oldContent":"    // Helper method to avoid code duplication"},{"type":"DELETE","lineNumber":37,"oldContent":""},{"type":"DELETE","lineNumber":39,"oldContent":"    }"},{"type":"INSERT","lineNumber":33,"content":"    }"},{"type":"INSERT","lineNumber":34,"content":""},{"type":"INSERT","lineNumber":35,"content":"    // Helper method to avoid code duplication"},{"type":"INSERT","lineNumber":36,"content":"    private List<UserSummaryDto> mapUsersToSummaryDto(List<AppUser> users) {"},{"type":"INSERT","lineNumber":37,"content":"        return users.stream()"},{"type":"INSERT","lineNumber":38,"content":"                .map(user -> new UserSummaryDto(user.getId(), user.getUsername(), user.getFullName()))"},{"type":"INSERT","lineNumber":39,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":40,"content":"    }"},{"type":"INSERT","lineNumber":41,"content":""},{"type":"INSERT","lineNumber":42,"content":"    public List<UserSummaryDto> getUnassignedEngineers() {"},{"type":"INSERT","lineNumber":43,"content":"        List<ERole> engineerRoles = List.of(ERole.ROLE_FIELD_ENGINEER, ERole.ROLE_L1_ENGINEER, ERole.ROLE_NOC_ENGINEER);"},{"type":"INSERT","lineNumber":44,"content":"        List<AppUser> engineers = userRepo.findByTeamIsNullAndRoles_NameIn(engineerRoles);"},{"type":"INSERT","lineNumber":45,"content":"        return mapUsersToSummaryDto(engineers);"},{"type":"INSERT","lineNumber":46,"content":"    }"},{"type":"INSERT","lineNumber":47,"content":"}"}]},{"timestamp":1762148183005,"changes":[{"type":"INSERT","lineNumber":28,"content":"                ERole.ROLE_L1_ENGINEER,"},{"type":"INSERT","lineNumber":29,"content":"                ERole.ROLE_NOC_ENGINEER"},{"type":"INSERT","lineNumber":30,"content":"        );"},{"type":"INSERT","lineNumber":31,"content":"        List<AppUser> engineers = userRepo.findAllByRoles_NameIn(engineerRoles);"},{"type":"INSERT","lineNumber":32,"content":"        return mapUsersToSummaryDto(engineers);"},{"type":"DELETE","lineNumber":30,"oldContent":"                ERole.ROLE_L1_ENGINEER,"},{"type":"DELETE","lineNumber":33,"oldContent":"                ERole.ROLE_NOC_ENGINEER"},{"type":"DELETE","lineNumber":36,"oldContent":"        );"},{"type":"DELETE","lineNumber":39,"oldContent":"        List<AppUser> engineers = userRepo.findAllByRoles_NameIn(engineerRoles);"},{"type":"DELETE","lineNumber":41,"oldContent":"        return mapUsersToSummaryDto(engineers);"},{"type":"DELETE","lineNumber":43,"oldContent":"}"},{"type":"MODIFY","lineNumber":46,"content":"    }","oldContent":"    }"},{"type":"INSERT","lineNumber":47,"content":""},{"type":"INSERT","lineNumber":48,"content":"    @Transactional(readOnly = true)"},{"type":"INSERT","lineNumber":49,"content":"    public List<String> getCustomerCities() {"},{"type":"INSERT","lineNumber":50,"content":"        return userRepo.findDistinctCities();"},{"type":"INSERT","lineNumber":51,"content":"    }"},{"type":"INSERT","lineNumber":52,"content":"}"}]},{"timestamp":1762159567139,"changes":[{"type":"DELETE","lineNumber":29,"oldContent":"    }"},{"type":"DELETE","lineNumber":31,"oldContent":""},{"type":"DELETE","lineNumber":34,"oldContent":"    // Helper method to avoid code duplication"},{"type":"INSERT","lineNumber":33,"content":"    }"},{"type":"INSERT","lineNumber":34,"content":""},{"type":"INSERT","lineNumber":35,"content":"    // Helper method to avoid code duplication"},{"type":"INSERT","lineNumber":44,"content":"        List<AppUser> engineers = userRepo.findByTeamIsNullAndRoles_NameIn(engineerRoles);"},{"type":"INSERT","lineNumber":45,"content":"        return mapUsersToSummaryDto(engineers);"},{"type":"DELETE","lineNumber":45,"oldContent":"    }"},{"type":"DELETE","lineNumber":47,"oldContent":"        return mapUsersToSummaryDto(engineers);"},{"type":"DELETE","lineNumber":49,"oldContent":"}"},{"type":"INSERT","lineNumber":50,"content":"        return userRepo.findDistinctCities();"},{"type":"INSERT","lineNumber":52,"content":""},{"type":"INSERT","lineNumber":53,"content":"    @Transactional(readOnly = true)"},{"type":"INSERT","lineNumber":54,"content":"    public List<String> getCustomerCities() {"},{"type":"INSERT","lineNumber":56,"content":"    }"},{"type":"INSERT","lineNumber":57,"content":"}"}]},{"timestamp":1762159571711,"changes":[{"type":"DELETE","lineNumber":31,"oldContent":"    }"},{"type":"INSERT","lineNumber":32,"content":"        return mapUsersToSummaryDto(engineers);"},{"type":"INSERT","lineNumber":33,"content":"    }"},{"type":"DELETE","lineNumber":35,"oldContent":"        return mapUsersToSummaryDto(engineers);"},{"type":"DELETE","lineNumber":45,"oldContent":"    }"},{"type":"DELETE","lineNumber":47,"oldContent":""},{"type":"DELETE","lineNumber":48,"oldContent":"    @Transactional(readOnly = true)"},{"type":"DELETE","lineNumber":49,"oldContent":"        return userRepo.findDistinctCities();"},{"type":"DELETE","lineNumber":50,"oldContent":"    public List<String> getCustomerCities() {"},{"type":"DELETE","lineNumber":53,"oldContent":"        return userRepo.findDistinctCities();"},{"type":"DELETE","lineNumber":55,"oldContent":"}"},{"type":"INSERT","lineNumber":50,"content":"        return userRepo.findDistinctCities();"},{"type":"INSERT","lineNumber":52,"content":"    "},{"type":"INSERT","lineNumber":53,"content":"}"}]},{"timestamp":1762159605532,"changes":[{"type":"MODIFY","lineNumber":32,"content":"        return mapUsersToSummaryDto(engineers);","oldContent":"        return mapUsersToSummaryDto(engineers);"},{"type":"DELETE","lineNumber":46,"oldContent":"        return userRepo.findDistinctCities();"},{"type":"DELETE","lineNumber":48,"oldContent":"    "},{"type":"MODIFY","lineNumber":50,"content":"        return userRepo.findDistinctCities();","oldContent":"}"},{"type":"INSERT","lineNumber":52,"content":""},{"type":"INSERT","lineNumber":53,"content":"}"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/AgentFeedbackDto.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/AgentFeedbackDto.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\nimport java.time.LocalDateTime;\n\n@Data\n@NoArgsConstructor\n@AllArgsConstructor\npublic class AgentFeedbackDto {\n    private Long feedbackId;\n    private String ticketUid;\n    private String ticketTitle;\n    private String customerFullName;\n    private Integer rating;\n    private String comment;\n    private LocalDateTime feedbackCreatedAt;\n}","baseTimestamp":1762026109721},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/repo/FeedbackRepo.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/repo/FeedbackRepo.java","baseContent":"package com.capstone.tele_ticketing_backend_1.repo;\n\n\n\nimport com.capstone.tele_ticketing_backend_1.entities.AppUser;\nimport com.capstone.tele_ticketing_backend_1.entities.Feedback;\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.stereotype.Repository;\nimport java.util.List;\n\n@Repository\npublic interface FeedbackRepo extends JpaRepository<Feedback, Long> {\n\n    // Dr. X's Note: This is a powerful Spring Data JPA query.\n    // It finds all Feedback entities by joining through the Ticket entity\n    // and filtering on the 'createdBy' user, ordering by the most recent feedback.\n    List<Feedback> findAllByTicket_CreatedByOrderByCreatedAtDesc(AppUser agent);\n}","baseTimestamp":1762026134854},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/TeamMemberUpdateRequestDto.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/TeamMemberUpdateRequestDto.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\nimport lombok.Data;\nimport java.util.Set;\n\n@Data\npublic class TeamMemberUpdateRequestDto {\n    private Set<Long> userIdsToAdd;\n    private Set<Long> userIdsToRemove;\n}\n","baseTimestamp":1762097741793},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/ReassignTicketDto.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/ReassignTicketDto.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\nimport jakarta.validation.constraints.NotEmpty;\nimport lombok.Data;\nimport java.util.Set;\n\n@Data\npublic class ReassignTicketDto {\n    @NotEmpty(message = \"At least one engineer must be assigned.\")\n    private Set<Long> newAssigneeUserIds;\n}","baseTimestamp":1762097759817},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/TeamLeadService.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/TeamLeadService.java","baseContent":"package com.capstone.tele_ticketing_backend_1.service;\n\n\n\nimport com.capstone.tele_ticketing_backend_1.dto.ReassignTicketDto;\nimport com.capstone.tele_ticketing_backend_1.dto.TeamMemberUpdateRequestDto;\nimport com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;\nimport com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;\nimport com.capstone.tele_ticketing_backend_1.entities.*;\nimport com.capstone.tele_ticketing_backend_1.exceptions.*;\nimport com.capstone.tele_ticketing_backend_1.repo.*;\nimport com.capstone.tele_ticketing_backend_1.service.ActivityLogService;\nimport com.capstone.tele_ticketing_backend_1.service.TicketService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\nimport java.time.LocalDateTime;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n@Service\npublic class TeamLeadService {\n\n    @Autowired private UserRepo userRepo;\n    @Autowired private TeamRepo teamRepo;\n    @Autowired private TicketRepo ticketRepo;\n    @Autowired private TicketService ticketService;\n    @Autowired private ActivityLogService activityLogService;\n\n    @Transactional(readOnly = true)\n    public List<TicketSummaryDto> getActiveTeamTickets(String teamLeadUsername) {\n        Team team = findTeamByLead(teamLeadUsername);\n        List<TicketStatus> activeStatuses = List.of(TicketStatus.ASSIGNED, TicketStatus.IN_PROGRESS);\n        List<Ticket> tickets = ticketRepo.findTicketsByTeamAndStatus(team.getId(), activeStatuses);\n        return tickets.stream().map(this::mapTicketToSummaryDto).collect(Collectors.toList());\n    }\n\n    @Transactional(readOnly = true)\n    public List<TicketSummaryDto> getSlaRiskTeamTickets(String teamLeadUsername) {\n        Team team = findTeamByLead(teamLeadUsername);\n        LocalDateTime now = LocalDateTime.now();\n        LocalDateTime twoHoursFromNow = now.plusHours(2);\n        List<Ticket> tickets = ticketRepo.findSlaRiskTicketsByTeam(team.getId(), now, twoHoursFromNow);\n        return tickets.stream().map(this::mapTicketToSummaryDto).collect(Collectors.toList());\n    }\n\n    @Transactional\n    public TicketDetailDto reassignTicket(Long ticketId, ReassignTicketDto dto, String teamLeadUsername) {\n        Team team = findTeamByLead(teamLeadUsername);\n        AppUser teamLead = team.getTeamLead();\n        Ticket ticket = ticketRepo.findById(ticketId).orElseThrow(() -> new TicketNotFoundException(\"Ticket not found\"));\n\n        // Security Check 1: Ensure the ticket belongs to the team lead's team.\n        boolean ticketBelongsToTeam = ticket.getAssignedTo().stream().anyMatch(user -> user.getTeam() != null && user.getTeam().getId().equals(team.getId()));\n        if (!ticketBelongsToTeam) {\n            throw new AuthorizationException(\"You can only reassign tickets within your own team.\");\n        }\n\n        List<AppUser> newAssignees = userRepo.findAllById(dto.getNewAssigneeUserIds());\n        // Security Check 2: Ensure all new assignees are part of the team.\n        for (AppUser assignee : newAssignees) {\n            if (assignee.getTeam() == null || !assignee.getTeam().getId().equals(team.getId())) {\n                throw new BadRequestException(\"User \" + assignee.getUsername() + \" is not a member of your team.\");\n            }\n        }\n\n        String oldAssignees = ticket.getAssignedTo().stream().map(AppUser::getFullName).collect(Collectors.joining(\", \"));\n        ticket.setAssignedTo(new HashSet<>(newAssignees));\n        Ticket savedTicket = ticketRepo.save(ticket);\n\n        String newAssigneesNames = newAssignees.stream().map(AppUser::getFullName).collect(Collectors.joining(\", \"));\n        activityLogService.createLog(savedTicket, teamLead, ActivityType.ASSIGNMENT, \"Re-assigned from [\" + oldAssignees + \"] to [\" + newAssigneesNames + \"]\", true);\n\n        return ticketService.mapTicketToDetailDto(savedTicket);\n    }\n\n    @Transactional\n    public Team updateTeamMembers(TeamMemberUpdateRequestDto dto, String teamLeadUsername) {\n        Team team = findTeamByLead(teamLeadUsername);\n\n        if (dto.getUserIdsToAdd() != null) {\n            userRepo.findAllById(dto.getUserIdsToAdd()).forEach(user -> user.setTeam(team));\n        }\n        if (dto.getUserIdsToRemove() != null) {\n            userRepo.findAllById(dto.getUserIdsToRemove()).forEach(user -> {\n                // Security Check: Ensure team lead isn't removing a member from another team.\n                if (user.getTeam() != null && user.getTeam().getId().equals(team.getId())) {\n                    user.setTeam(null);\n                }\n            });\n        }\n        return teamRepo.save(team);\n    }\n\n    private Team findTeamByLead(String username) {\n        AppUser teamLead = userRepo.findByUsername(username).orElseThrow(() -> new UserNotFoundException(\"Team Lead not found\"));\n        Team team = teamRepo.findByTeamLead(teamLead).orElseThrow(() -> new BadRequestException(\"You are not registered as a lead of any team.\"));\n        return team;\n    }\n\n    private TicketSummaryDto mapTicketToSummaryDto(Ticket ticket) {\n        return new TicketSummaryDto(ticket.getId(), ticket.getTicketUid(), ticket.getTitle(), ticket.getStatus(), ticket.getCreatedAt());\n    }\n}","baseTimestamp":1762097828917,"deltas":[{"timestamp":1762098130256,"changes":[{"type":"DELETE","lineNumber":11,"oldContent":"import com.capstone.tele_ticketing_backend_1.service.ActivityLogService;"},{"type":"DELETE","lineNumber":12,"oldContent":"import com.capstone.tele_ticketing_backend_1.service.TicketService;"}]},{"timestamp":1762112224581,"changes":[{"type":"INSERT","lineNumber":102,"content":""},{"type":"INSERT","lineNumber":103,"content":"    @Transactional(readOnly = true)"},{"type":"INSERT","lineNumber":104,"content":"    public List<UserSummaryDto> getTeamMembers(String teamLeadUsername) {"},{"type":"INSERT","lineNumber":105,"content":"        Team team = findTeamByLead(teamLeadUsername);"},{"type":"INSERT","lineNumber":106,"content":"        return team.getMembers().stream()"},{"type":"INSERT","lineNumber":107,"content":"                .map(member -> new UserSummaryDto(member.getId(), member.getUsername(), member.getFullName()))"},{"type":"INSERT","lineNumber":108,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":109,"content":"    }"}]},{"timestamp":1762112229121,"changes":[{"type":"DELETE","lineNumber":4,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.ReassignTicketDto;"},{"type":"DELETE","lineNumber":5,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TeamMemberUpdateRequestDto;"},{"type":"DELETE","lineNumber":6,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;"},{"type":"DELETE","lineNumber":7,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;"},{"type":"INSERT","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.dto.*;"},{"type":"DELETE","lineNumber":103,"oldContent":"}"},{"type":"DELETE","lineNumber":105,"oldContent":"    }"},{"type":"DELETE","lineNumber":107,"oldContent":"                .collect(Collectors.toList());"},{"type":"DELETE","lineNumber":109,"oldContent":"                .map(member -> new UserSummaryDto(member.getId(), member.getUsername(), member.getFullName()))"},{"type":"INSERT","lineNumber":104,"content":"                .map(member -> new UserSummaryDto(member.getId(), member.getUsername(), member.getFullName()))"},{"type":"INSERT","lineNumber":105,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":106,"content":"    }"},{"type":"INSERT","lineNumber":107,"content":"}"}]},{"timestamp":1762113186623,"changes":[{"type":"DELETE","lineNumber":100,"oldContent":"                .map(member -> new UserSummaryDto(member.getId(), member.getUsername(), member.getFullName()))"},{"type":"DELETE","lineNumber":102,"oldContent":"                .collect(Collectors.toList());"},{"type":"DELETE","lineNumber":103,"oldContent":"    }"},{"type":"DELETE","lineNumber":105,"oldContent":"}"},{"type":"INSERT","lineNumber":104,"content":"                .map(member -> new UserSummaryDto(member.getId(), member.getUsername(), member.getFullName()))"},{"type":"INSERT","lineNumber":105,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":106,"content":"    }"},{"type":"INSERT","lineNumber":107,"content":""},{"type":"INSERT","lineNumber":108,"content":"    @Transactional(readOnly = true)"},{"type":"INSERT","lineNumber":109,"content":"    public TeamDetailDto getTeamDetails(String teamLeadUsername) {"},{"type":"INSERT","lineNumber":110,"content":"        AppUser teamLead = userRepo.findByUsername(teamLeadUsername).orElseThrow(() -> new UserNotFoundException(\"Team Lead not found\"));"},{"type":"INSERT","lineNumber":111,"content":"        // This will throw if no team is found, which we'll handle on the frontend."},{"type":"INSERT","lineNumber":112,"content":"        Team team = teamRepo.findByTeamLead(teamLead).orElseThrow(() -> new ResourceNotFoundException(\"Team not found for the current user.\"));"},{"type":"INSERT","lineNumber":113,"content":""},{"type":"INSERT","lineNumber":114,"content":"        return mapTeamToDetailDto(team);"},{"type":"INSERT","lineNumber":115,"content":"    }"},{"type":"INSERT","lineNumber":116,"content":""},{"type":"INSERT","lineNumber":117,"content":"    @Transactional"},{"type":"INSERT","lineNumber":118,"content":"    public TeamDetailDto createOrUpdateTeam(TeamUpdateRequestDto dto, String teamLeadUsername) {"},{"type":"INSERT","lineNumber":119,"content":"        AppUser teamLead = userRepo.findByUsername(teamLeadUsername).orElseThrow(() -> new UserNotFoundException(\"Team Lead not found\"));"},{"type":"INSERT","lineNumber":120,"content":""},{"type":"INSERT","lineNumber":121,"content":"        // Find existing team or create a new one."},{"type":"INSERT","lineNumber":122,"content":"        Team team = teamRepo.findByTeamLead(teamLead).orElse(new Team());"},{"type":"INSERT","lineNumber":123,"content":"        team.setTeamLead(teamLead);"},{"type":"INSERT","lineNumber":124,"content":""},{"type":"INSERT","lineNumber":125,"content":"        if (dto.getName() != null && !dto.getName().isBlank()) {"},{"type":"INSERT","lineNumber":126,"content":"            team.setName(dto.getName());"},{"type":"INSERT","lineNumber":127,"content":"        } else if (team.getName() == null) {"},{"type":"INSERT","lineNumber":128,"content":"            team.setName(teamLead.getFullName() + \"'s Team\"); // Default name"},{"type":"INSERT","lineNumber":129,"content":"        }"},{"type":"INSERT","lineNumber":130,"content":""},{"type":"INSERT","lineNumber":131,"content":"        // Add new members"},{"type":"INSERT","lineNumber":132,"content":"        if (dto.getUserIdsToAdd() != null) {"},{"type":"INSERT","lineNumber":133,"content":"            userRepo.findAllById(dto.getUserIdsToAdd()).forEach(user -> user.setTeam(team));"},{"type":"INSERT","lineNumber":134,"content":"        }"},{"type":"INSERT","lineNumber":135,"content":""},{"type":"INSERT","lineNumber":136,"content":"        // Remove members"},{"type":"INSERT","lineNumber":137,"content":"        if (dto.getUserIdsToRemove() != null) {"},{"type":"INSERT","lineNumber":138,"content":"            userRepo.findAllById(dto.getUserIdsToRemove()).forEach(user -> {"},{"type":"INSERT","lineNumber":139,"content":"                if (user.getTeam() != null && user.getTeam().getId().equals(team.getId())) {"},{"type":"INSERT","lineNumber":140,"content":"                    user.setTeam(null);"},{"type":"INSERT","lineNumber":141,"content":"                }"},{"type":"INSERT","lineNumber":142,"content":"            });"},{"type":"INSERT","lineNumber":143,"content":"        }"},{"type":"INSERT","lineNumber":144,"content":""},{"type":"INSERT","lineNumber":145,"content":"        Team savedTeam = teamRepo.save(team);"},{"type":"INSERT","lineNumber":146,"content":"        return mapTeamToDetailDto(savedTeam);"},{"type":"INSERT","lineNumber":147,"content":"    }"},{"type":"INSERT","lineNumber":148,"content":""},{"type":"INSERT","lineNumber":149,"content":"    private TeamDetailDto mapTeamToDetailDto(Team team) {"},{"type":"INSERT","lineNumber":150,"content":"        TeamDetailDto dto = new TeamDetailDto();"},{"type":"INSERT","lineNumber":151,"content":"        dto.setId(team.getId());"},{"type":"INSERT","lineNumber":152,"content":"        dto.setName(team.getName());"},{"type":"INSERT","lineNumber":153,"content":"        dto.setMembers(team.getMembers().stream()"},{"type":"INSERT","lineNumber":154,"content":"                .map(member -> new UserSummaryDto(member.getId(), member.getUsername(), member.getFullName()))"},{"type":"INSERT","lineNumber":155,"content":"                .collect(Collectors.toList()));"},{"type":"INSERT","lineNumber":156,"content":"        return dto;"},{"type":"INSERT","lineNumber":157,"content":"    }"},{"type":"INSERT","lineNumber":158,"content":"}"}]},{"timestamp":1762113204137,"changes":[{"type":"DELETE","lineNumber":101,"oldContent":"                .map(member -> new UserSummaryDto(member.getId(), member.getUsername(), member.getFullName()))"},{"type":"INSERT","lineNumber":102,"content":"        Team team = findTeamByLead(teamLeadUsername);"},{"type":"INSERT","lineNumber":103,"content":"        return team.getMembers().stream()"},{"type":"INSERT","lineNumber":104,"content":"                .map(member -> new UserSummaryDto(member.getId(), member.getUsername(), member.getFullName()))"},{"type":"DELETE","lineNumber":105,"oldContent":"        Team team = findTeamByLead(teamLeadUsername);"},{"type":"DELETE","lineNumber":107,"oldContent":"        return team.getMembers().stream()"},{"type":"DELETE","lineNumber":109,"oldContent":"}"},{"type":"DELETE","lineNumber":111,"oldContent":"    }"},{"type":"DELETE","lineNumber":113,"oldContent":"        return dto;"},{"type":"DELETE","lineNumber":115,"oldContent":"                .collect(Collectors.toList()));"},{"type":"DELETE","lineNumber":117,"oldContent":"                .map(member -> new UserSummaryDto(member.getId(), member.getUsername(), member.getFullName()))"},{"type":"DELETE","lineNumber":119,"oldContent":"        dto.setMembers(team.getMembers().stream()"},{"type":"DELETE","lineNumber":121,"oldContent":"        dto.setName(team.getName());"},{"type":"DELETE","lineNumber":123,"oldContent":"        dto.setId(team.getId());"},{"type":"DELETE","lineNumber":125,"oldContent":"        TeamDetailDto dto = new TeamDetailDto();"},{"type":"DELETE","lineNumber":127,"oldContent":"    private TeamDetailDto mapTeamToDetailDto(Team team) {"},{"type":"DELETE","lineNumber":129,"oldContent":""},{"type":"DELETE","lineNumber":131,"oldContent":"    }"},{"type":"DELETE","lineNumber":133,"oldContent":"        return mapTeamToDetailDto(savedTeam);"},{"type":"DELETE","lineNumber":135,"oldContent":"        Team savedTeam = teamRepo.save(team);"},{"type":"DELETE","lineNumber":137,"oldContent":""},{"type":"DELETE","lineNumber":139,"oldContent":"        }"},{"type":"DELETE","lineNumber":141,"oldContent":"            });"},{"type":"DELETE","lineNumber":143,"oldContent":"                }"},{"type":"DELETE","lineNumber":145,"oldContent":"                    user.setTeam(null);"},{"type":"DELETE","lineNumber":147,"oldContent":"                if (user.getTeam() != null && user.getTeam().getId().equals(team.getId())) {"},{"type":"DELETE","lineNumber":149,"oldContent":"            userRepo.findAllById(dto.getUserIdsToRemove()).forEach(user -> {"},{"type":"DELETE","lineNumber":151,"oldContent":"        if (dto.getUserIdsToRemove() != null) {"},{"type":"DELETE","lineNumber":153,"oldContent":"        // Remove members"},{"type":"DELETE","lineNumber":155,"oldContent":""},{"type":"DELETE","lineNumber":157,"oldContent":"        }"},{"type":"INSERT","lineNumber":134,"content":"        }"},{"type":"INSERT","lineNumber":135,"content":""},{"type":"INSERT","lineNumber":136,"content":"        // Remove members"},{"type":"INSERT","lineNumber":137,"content":"        if (dto.getUserIdsToRemove() != null) {"},{"type":"INSERT","lineNumber":138,"content":"            userRepo.findAllById(dto.getUserIdsToRemove()).forEach(user -> {"},{"type":"INSERT","lineNumber":139,"content":"                if (user.getTeam() != null && user.getTeam().getId().equals(team.getId())) {"},{"type":"INSERT","lineNumber":140,"content":"                    user.setTeam(null);"},{"type":"INSERT","lineNumber":141,"content":"                }"},{"type":"INSERT","lineNumber":142,"content":"            });"},{"type":"INSERT","lineNumber":143,"content":"        }"},{"type":"INSERT","lineNumber":144,"content":""},{"type":"INSERT","lineNumber":145,"content":"        Team savedTeam = teamRepo.save(team);"},{"type":"INSERT","lineNumber":146,"content":"        return mapTeamToDetailDto(savedTeam);"},{"type":"INSERT","lineNumber":147,"content":"    }"},{"type":"INSERT","lineNumber":148,"content":""},{"type":"INSERT","lineNumber":149,"content":"    private TeamDetailDto mapTeamToDetailDto(Team team) {"},{"type":"INSERT","lineNumber":150,"content":"        TeamDetailDto dto = new TeamDetailDto();"},{"type":"INSERT","lineNumber":151,"content":"        dto.setId(team.getId());"},{"type":"INSERT","lineNumber":152,"content":"        dto.setName(team.getName());"},{"type":"INSERT","lineNumber":153,"content":"        dto.setMembers(team.getMembers().stream()"},{"type":"INSERT","lineNumber":154,"content":"                .map(member -> new UserSummaryDto(member.getId(), member.getUsername(), member.getFullName()))"},{"type":"INSERT","lineNumber":155,"content":"                .collect(Collectors.toList()));"},{"type":"INSERT","lineNumber":156,"content":"        return dto;"},{"type":"INSERT","lineNumber":157,"content":"    }"},{"type":"INSERT","lineNumber":158,"content":"}"}]},{"timestamp":1762115034440,"changes":[{"type":"MODIFY","lineNumber":102,"content":"        Team team = findTeamByLead(teamLeadUsername);","oldContent":"        Team team = findTeamByLead(teamLeadUsername);"},{"type":"MODIFY","lineNumber":105,"content":"                .collect(Collectors.toList());","oldContent":"                .collect(Collectors.toList());"},{"type":"DELETE","lineNumber":121,"oldContent":"        }"},{"type":"INSERT","lineNumber":122,"content":"        Team team = teamRepo.findByTeamLead(teamLead).orElse(new Team());"},{"type":"INSERT","lineNumber":123,"content":"        team.setTeamLead(teamLead);"},{"type":"INSERT","lineNumber":125,"content":"        if (dto.getName() != null && !dto.getName().isBlank()) {"},{"type":"INSERT","lineNumber":126,"content":"            team.setName(dto.getName());"},{"type":"INSERT","lineNumber":127,"content":"        } else if (team.getName() == null) {"},{"type":"INSERT","lineNumber":128,"content":"            team.setName(teamLead.getFullName() + \"'s Team\"); // Default name"},{"type":"INSERT","lineNumber":129,"content":"        }"},{"type":"INSERT","lineNumber":130,"content":""},{"type":"INSERT","lineNumber":131,"content":"        // Add new members"},{"type":"INSERT","lineNumber":132,"content":"        if (dto.getUserIdsToAdd() != null) {"},{"type":"INSERT","lineNumber":133,"content":"            userRepo.findAllById(dto.getUserIdsToAdd()).forEach(user -> user.setTeam(team));"},{"type":"INSERT","lineNumber":134,"content":"        }"},{"type":"INSERT","lineNumber":135,"content":""},{"type":"DELETE","lineNumber":125,"oldContent":"        Team team = teamRepo.findByTeamLead(teamLead).orElse(new Team());"},{"type":"DELETE","lineNumber":128,"oldContent":"        team.setTeamLead(teamLead);"},{"type":"INSERT","lineNumber":141,"content":"                }"},{"type":"INSERT","lineNumber":142,"content":"            });"},{"type":"INSERT","lineNumber":143,"content":"        }"},{"type":"INSERT","lineNumber":145,"content":"        Team savedTeam = teamRepo.save(team);"},{"type":"INSERT","lineNumber":146,"content":"        return mapTeamToDetailDto(savedTeam);"},{"type":"INSERT","lineNumber":147,"content":"    }"},{"type":"INSERT","lineNumber":148,"content":""},{"type":"INSERT","lineNumber":149,"content":"    @Transactional"},{"type":"INSERT","lineNumber":150,"content":"    public TeamDetailDto updateTeam(TeamMemberUpdateRequestDto dto, String teamLeadUsername) {"},{"type":"INSERT","lineNumber":151,"content":"        AppUser teamLead = userRepo.findByUsername(teamLeadUsername)"},{"type":"INSERT","lineNumber":152,"content":"                .orElseThrow(() -> new UserNotFoundException(\"Team Lead not found\"));"},{"type":"INSERT","lineNumber":153,"content":""},{"type":"INSERT","lineNumber":154,"content":"        // Find existing team or create a new one if adding members for the first time."},{"type":"INSERT","lineNumber":155,"content":"        Team team = teamRepo.findByTeamLead(teamLead).orElseGet(() -> {"},{"type":"INSERT","lineNumber":156,"content":"            Team newTeam = new Team();"},{"type":"INSERT","lineNumber":157,"content":"            newTeam.setTeamLead(teamLead);"},{"type":"INSERT","lineNumber":158,"content":"            newTeam.setName(teamLead.getFullName() + \"'s Team\"); // Set name automatically"},{"type":"INSERT","lineNumber":159,"content":"            return newTeam;"},{"type":"INSERT","lineNumber":160,"content":"        });"},{"type":"INSERT","lineNumber":161,"content":""},{"type":"INSERT","lineNumber":162,"content":"        // Add new members"},{"type":"INSERT","lineNumber":163,"content":"        if (dto.getUserIdsToAdd() != null) {"},{"type":"INSERT","lineNumber":164,"content":"            userRepo.findAllById(dto.getUserIdsToAdd()).forEach(user -> user.setTeam(team));"},{"type":"INSERT","lineNumber":165,"content":"        }"},{"type":"INSERT","lineNumber":166,"content":""},{"type":"INSERT","lineNumber":167,"content":"        // Remove members"},{"type":"INSERT","lineNumber":168,"content":"        if (dto.getUserIdsToRemove() != null) {"},{"type":"INSERT","lineNumber":169,"content":"            userRepo.findAllById(dto.getUserIdsToRemove()).forEach(user -> {"},{"type":"INSERT","lineNumber":170,"content":"                if (user.getTeam() != null && user.getTeam().getId().equals(team.getId())) {"},{"type":"INSERT","lineNumber":171,"content":"                    user.setTeam(null);"},{"type":"DELETE","lineNumber":134,"oldContent":"        if (dto.getName() != null && !dto.getName().isBlank()) {"},{"type":"DELETE","lineNumber":137,"oldContent":"            team.setName(dto.getName());"},{"type":"DELETE","lineNumber":140,"oldContent":"        } else if (team.getName() == null) {"},{"type":"DELETE","lineNumber":143,"oldContent":"            team.setName(teamLead.getFullName() + \"'s Team\"); // Default name"},{"type":"DELETE","lineNumber":146,"oldContent":"        }"},{"type":"DELETE","lineNumber":149,"oldContent":""},{"type":"DELETE","lineNumber":152,"oldContent":"        // Add new members"},{"type":"DELETE","lineNumber":155,"oldContent":"        if (dto.getUserIdsToAdd() != null) {"},{"type":"DELETE","lineNumber":158,"oldContent":"            userRepo.findAllById(dto.getUserIdsToAdd()).forEach(user -> user.setTeam(team));"}]},{"timestamp":1762115050364,"changes":[{"type":"INSERT","lineNumber":101,"content":"    public List<UserSummaryDto> getTeamMembers(String teamLeadUsername) {"},{"type":"DELETE","lineNumber":102,"oldContent":"        Team team = findTeamByLead(teamLeadUsername);"},{"type":"INSERT","lineNumber":104,"content":"                .map(member -> new UserSummaryDto(member.getId(), member.getUsername(), member.getFullName()))"},{"type":"DELETE","lineNumber":105,"oldContent":"                .collect(Collectors.toList());"},{"type":"DELETE","lineNumber":118,"oldContent":"    public TeamDetailDto createOrUpdateTeam(TeamUpdateRequestDto dto, String teamLeadUsername) {"},{"type":"DELETE","lineNumber":119,"oldContent":"        AppUser teamLead = userRepo.findByUsername(teamLeadUsername).orElseThrow(() -> new UserNotFoundException(\"Team Lead not found\"));"},{"type":"INSERT","lineNumber":118,"content":"    public TeamDetailDto updateTeam(TeamMemberUpdateRequestDto dto, String teamLeadUsername) {"},{"type":"INSERT","lineNumber":119,"content":"        AppUser teamLead = userRepo.findByUsername(teamLeadUsername)"},{"type":"INSERT","lineNumber":120,"content":"                .orElseThrow(() -> new UserNotFoundException(\"Team Lead not found\"));"},{"type":"DELETE","lineNumber":121,"oldContent":"        Team team = teamRepo.findByTeamLead(teamLead).orElse(new Team());"},{"type":"DELETE","lineNumber":122,"oldContent":"        // Find existing team or create a new one."},{"type":"DELETE","lineNumber":123,"oldContent":"        team.setTeamLead(teamLead);"},{"type":"INSERT","lineNumber":122,"content":"        // Find existing team or create a new one if adding members for the first time."},{"type":"INSERT","lineNumber":123,"content":"        Team team = teamRepo.findByTeamLead(teamLead).orElseGet(() -> {"},{"type":"INSERT","lineNumber":124,"content":"            Team newTeam = new Team();"},{"type":"INSERT","lineNumber":125,"content":"            newTeam.setTeamLead(teamLead);"},{"type":"INSERT","lineNumber":126,"content":"            newTeam.setName(teamLead.getFullName() + \"'s Team\"); // Set name automatically"},{"type":"INSERT","lineNumber":127,"content":"            return newTeam;"},{"type":"INSERT","lineNumber":128,"content":"        });"},{"type":"INSERT","lineNumber":130,"content":"        // Add new members"},{"type":"INSERT","lineNumber":131,"content":"        if (dto.getUserIdsToAdd() != null) {"},{"type":"INSERT","lineNumber":132,"content":"            userRepo.findAllById(dto.getUserIdsToAdd()).forEach(user -> user.setTeam(team));"},{"type":"INSERT","lineNumber":133,"content":"        }"},{"type":"INSERT","lineNumber":134,"content":""},{"type":"DELETE","lineNumber":126,"oldContent":"        if (dto.getName() != null && !dto.getName().isBlank()) {"},{"type":"DELETE","lineNumber":127,"oldContent":"            team.setName(dto.getName());"},{"type":"DELETE","lineNumber":129,"oldContent":"        } else if (team.getName() == null) {"},{"type":"DELETE","lineNumber":131,"oldContent":"            team.setName(teamLead.getFullName() + \"'s Team\"); // Default name"},{"type":"DELETE","lineNumber":132,"oldContent":"        }"},{"type":"DELETE","lineNumber":134,"oldContent":""},{"type":"DELETE","lineNumber":136,"oldContent":"        // Add new members"},{"type":"DELETE","lineNumber":137,"oldContent":""},{"type":"DELETE","lineNumber":138,"oldContent":"        if (dto.getUserIdsToAdd() != null) {"},{"type":"DELETE","lineNumber":140,"oldContent":"            userRepo.findAllById(dto.getUserIdsToAdd()).forEach(user -> user.setTeam(team));"},{"type":"DELETE","lineNumber":144,"oldContent":"        }"},{"type":"DELETE","lineNumber":145,"oldContent":""},{"type":"DELETE","lineNumber":148,"oldContent":"                }"},{"type":"DELETE","lineNumber":150,"oldContent":"            });"},{"type":"DELETE","lineNumber":152,"oldContent":"        }"},{"type":"DELETE","lineNumber":154,"oldContent":"        Team savedTeam = teamRepo.save(team);"},{"type":"DELETE","lineNumber":156,"oldContent":"        return mapTeamToDetailDto(savedTeam);"},{"type":"DELETE","lineNumber":157,"oldContent":"    }"},{"type":"DELETE","lineNumber":159,"oldContent":""},{"type":"DELETE","lineNumber":161,"oldContent":"    @Transactional"},{"type":"DELETE","lineNumber":162,"oldContent":"    public TeamDetailDto updateTeam(TeamMemberUpdateRequestDto dto, String teamLeadUsername) {"},{"type":"DELETE","lineNumber":164,"oldContent":"        AppUser teamLead = userRepo.findByUsername(teamLeadUsername)"},{"type":"DELETE","lineNumber":166,"oldContent":"                .orElseThrow(() -> new UserNotFoundException(\"Team Lead not found\"));"},{"type":"DELETE","lineNumber":167,"oldContent":""},{"type":"DELETE","lineNumber":169,"oldContent":"        // Find existing team or create a new one if adding members for the first time."},{"type":"DELETE","lineNumber":171,"oldContent":"        Team team = teamRepo.findByTeamLead(teamLead).orElseGet(() -> {"},{"type":"DELETE","lineNumber":172,"oldContent":"            Team newTeam = new Team();"},{"type":"DELETE","lineNumber":174,"oldContent":"            newTeam.setTeamLead(teamLead);"},{"type":"DELETE","lineNumber":176,"oldContent":"            newTeam.setName(teamLead.getFullName() + \"'s Team\"); // Set name automatically"},{"type":"DELETE","lineNumber":177,"oldContent":"            return newTeam;"},{"type":"DELETE","lineNumber":178,"oldContent":"                    user.setTeam(null);"},{"type":"DELETE","lineNumber":179,"oldContent":"        });"},{"type":"DELETE","lineNumber":180,"oldContent":"                if (user.getTeam() != null && user.getTeam().getId().equals(team.getId())) {"},{"type":"DELETE","lineNumber":181,"oldContent":""},{"type":"DELETE","lineNumber":182,"oldContent":"            userRepo.findAllById(dto.getUserIdsToRemove()).forEach(user -> {"},{"type":"DELETE","lineNumber":183,"oldContent":"        // Add new members"},{"type":"DELETE","lineNumber":184,"oldContent":"        if (dto.getUserIdsToRemove() != null) {"},{"type":"DELETE","lineNumber":185,"oldContent":"        if (dto.getUserIdsToAdd() != null) {"},{"type":"DELETE","lineNumber":186,"oldContent":"        // Remove members"},{"type":"DELETE","lineNumber":187,"oldContent":"            userRepo.findAllById(dto.getUserIdsToAdd()).forEach(user -> user.setTeam(team));"},{"type":"DELETE","lineNumber":188,"oldContent":""},{"type":"DELETE","lineNumber":189,"oldContent":"        }"}]},{"timestamp":1762115069640,"changes":[{"type":"DELETE","lineNumber":125,"oldContent":""},{"type":"DELETE","lineNumber":127,"oldContent":"        // Remove members"},{"type":"DELETE","lineNumber":131,"oldContent":"        if (dto.getUserIdsToRemove() != null) {"},{"type":"INSERT","lineNumber":129,"content":""},{"type":"DELETE","lineNumber":133,"oldContent":"            userRepo.findAllById(dto.getUserIdsToRemove()).forEach(user -> {"},{"type":"DELETE","lineNumber":137,"oldContent":"                if (user.getTeam() != null && user.getTeam().getId().equals(team.getId())) {"},{"type":"INSERT","lineNumber":135,"content":"        // Remove members"},{"type":"INSERT","lineNumber":136,"content":"        if (dto.getUserIdsToRemove() != null) {"},{"type":"INSERT","lineNumber":137,"content":"            userRepo.findAllById(dto.getUserIdsToRemove()).forEach(user -> {"},{"type":"INSERT","lineNumber":138,"content":"                if (user.getTeam() != null && user.getTeam().getId().equals(team.getId())) {"},{"type":"MODIFY","lineNumber":152,"content":"","oldContent":"        dto.setMembers(team.getMembers().stream()"},{"type":"INSERT","lineNumber":153,"content":"        List<UserSummaryDto> members = team.getMembers().stream()"},{"type":"MODIFY","lineNumber":155,"content":"                .collect(Collectors.toList());","oldContent":"                .collect(Collectors.toList()));"},{"type":"INSERT","lineNumber":156,"content":""},{"type":"INSERT","lineNumber":157,"content":"        // Dr. X's Fix: Always include the team lead in the member list for the frontend."},{"type":"INSERT","lineNumber":158,"content":"        members.add(0, new UserSummaryDto(team.getTeamLead().getId(), team.getTeamLead().getUsername(), team.getTeamLead().getFullName()));"},{"type":"INSERT","lineNumber":159,"content":""},{"type":"INSERT","lineNumber":160,"content":"        dto.setMembers(members);"}]},{"timestamp":1762115072730,"changes":[{"type":"DELETE","lineNumber":127,"oldContent":""},{"type":"INSERT","lineNumber":129,"content":""},{"type":"DELETE","lineNumber":132,"oldContent":"        // Remove members"},{"type":"MODIFY","lineNumber":134,"content":"","oldContent":"        if (dto.getUserIdsToRemove() != null) {"},{"type":"INSERT","lineNumber":135,"content":"        // Remove members"},{"type":"INSERT","lineNumber":136,"content":"        if (dto.getUserIdsToRemove() != null) {"},{"type":"DELETE","lineNumber":138,"oldContent":""},{"type":"DELETE","lineNumber":152,"oldContent":""},{"type":"MODIFY","lineNumber":152,"content":"        dto.setMembers(team.getMembers().stream()","oldContent":"        List<UserSummaryDto> members = team.getMembers().stream()"},{"type":"DELETE","lineNumber":156,"oldContent":"                .collect(Collectors.toList());"},{"type":"DELETE","lineNumber":157,"oldContent":""},{"type":"INSERT","lineNumber":155,"content":"        return dto;"},{"type":"DELETE","lineNumber":159,"oldContent":"        // Dr. X's Fix: Always include the team lead in the member list for the frontend."},{"type":"DELETE","lineNumber":161,"oldContent":"        members.add(0, new UserSummaryDto(team.getTeamLead().getId(), team.getTeamLead().getUsername(), team.getTeamLead().getFullName()));"},{"type":"DELETE","lineNumber":162,"oldContent":"        dto.setMembers(members);"},{"type":"DELETE","lineNumber":163,"oldContent":""}]},{"timestamp":1762115078405,"changes":[{"type":"MODIFY","lineNumber":129,"content":"","oldContent":""},{"type":"INSERT","lineNumber":133,"content":"        }"},{"type":"DELETE","lineNumber":135,"oldContent":"        }"},{"type":"MODIFY","lineNumber":152,"content":"","oldContent":"        dto.setMembers(team.getMembers().stream()"},{"type":"INSERT","lineNumber":153,"content":"        List<UserSummaryDto> members = team.getMembers().stream()"},{"type":"INSERT","lineNumber":155,"content":"                .collect(Collectors.toList());"},{"type":"INSERT","lineNumber":156,"content":""},{"type":"INSERT","lineNumber":157,"content":"        // Dr. X's Fix: Always include the team lead in the member list for the frontend."},{"type":"INSERT","lineNumber":158,"content":"        members.add(0, new UserSummaryDto(team.getTeamLead().getId(), team.getTeamLead().getUsername(), team.getTeamLead().getFullName()));"},{"type":"INSERT","lineNumber":159,"content":""},{"type":"INSERT","lineNumber":160,"content":"        dto.setMembers(members);"},{"type":"DELETE","lineNumber":155,"oldContent":"                .collect(Collectors.toList()));"}]},{"timestamp":1762206210294,"changes":[{"type":"MODIFY","lineNumber":37,"content":"        LocalDateTime twoHoursFromNow = now.plusHours();","oldContent":"        LocalDateTime twoHoursFromNow = now.plusHours(2);"},{"type":"INSERT","lineNumber":128,"content":"        });"},{"type":"DELETE","lineNumber":129,"oldContent":""},{"type":"DELETE","lineNumber":155,"oldContent":"        return dto;"},{"type":"DELETE","lineNumber":158,"oldContent":"    }"},{"type":"DELETE","lineNumber":160,"oldContent":"}"},{"type":"DELETE","lineNumber":162,"oldContent":"        dto.setMembers(members);"},{"type":"INSERT","lineNumber":160,"content":"        dto.setMembers(members);"},{"type":"INSERT","lineNumber":161,"content":"        return dto;"},{"type":"INSERT","lineNumber":162,"content":"    }"},{"type":"INSERT","lineNumber":163,"content":"}"}]},{"timestamp":1762206212403,"changes":[{"type":"MODIFY","lineNumber":37,"content":"        LocalDateTime twoHoursFromNow = now.plusHours(44);","oldContent":"        LocalDateTime twoHoursFromNow = now.plusHours();"},{"type":"INSERT","lineNumber":158,"content":"        members.add(0, new UserSummaryDto(team.getTeamLead().getId(), team.getTeamLead().getUsername(), team.getTeamLead().getFullName()));"},{"type":"INSERT","lineNumber":159,"content":""},{"type":"DELETE","lineNumber":160,"oldContent":"        members.add(0, new UserSummaryDto(team.getTeamLead().getId(), team.getTeamLead().getUsername(), team.getTeamLead().getFullName()));"},{"type":"DELETE","lineNumber":163,"oldContent":""}]},{"timestamp":1762206296296,"changes":[{"type":"MODIFY","lineNumber":160,"content":"        dto.setMembers(members);","oldContent":"        dto.setMembers(members);"}]},{"timestamp":1762206300611,"changes":[{"type":"MODIFY","lineNumber":37,"content":"        LocalDateTime twoHoursFromNow = now.plusHours(2);","oldContent":"        LocalDateTime twoHoursFromNow = now.plusHours(44);"},{"type":"INSERT","lineNumber":159,"content":""},{"type":"DELETE","lineNumber":160,"oldContent":"        dto.setMembers(members);"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/repo/TeamRepo.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/repo/TeamRepo.java","baseContent":"package com.capstone.tele_ticketing_backend_1.repo;\n\n\n\nimport com.capstone.tele_ticketing_backend_1.entities.AppUser;\nimport com.capstone.tele_ticketing_backend_1.entities.Team;\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.stereotype.Repository;\nimport java.util.Optional;\n\n@Repository\npublic interface TeamRepo extends JpaRepository<Team, Long> {\n\n    // Finds a team based on the AppUser object who is the team lead.\n    Optional<Team> findByTeamLead(AppUser teamLead);\n}\n","baseTimestamp":1762098054610},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/exceptions/BadRequestException.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/exceptions/BadRequestException.java","baseContent":"package com.capstone.tele_ticketing_backend_1.exceptions;\n\n\n\nimport org.springframework.http.HttpStatus;\nimport org.springframework.web.bind.annotation.ResponseStatus;\n\n@ResponseStatus(HttpStatus.BAD_REQUEST)\npublic class BadRequestException extends RuntimeException {\n    public BadRequestException(String message) {\n        super(message);\n    }\n}\n","baseTimestamp":1762098087123},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/TeamLeadController.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/TeamLeadController.java","baseContent":"package com.capstone.tele_ticketing_backend_1.controller;\n\n\n\nimport com.capstone.tele_ticketing_backend_1.dto.ReassignTicketDto;\nimport com.capstone.tele_ticketing_backend_1.dto.TeamMemberUpdateRequestDto;\nimport com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;\nimport com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;\nimport com.capstone.tele_ticketing_backend_1.entities.Team;\nimport com.capstone.tele_ticketing_backend_1.service.TeamLeadService;\nimport jakarta.validation.Valid;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.security.access.prepost.PreAuthorize;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.web.bind.annotation.*;\nimport java.util.List;\n\n@RestController\n@RequestMapping(\"/api/v1/team-lead\")\n@PreAuthorize(\"hasRole('TEAM_LEAD')\")\npublic class TeamLeadController {\n\n    @Autowired\n    private TeamLeadService teamLeadService;\n\n    @GetMapping(\"/tickets/active\")\n    public ResponseEntity<List<TicketSummaryDto>> getActiveTeamTickets() {\n        String username = SecurityContextHolder.getContext().getAuthentication().getName();\n        return ResponseEntity.ok(teamLeadService.getActiveTeamTickets(username));\n    }\n\n    @GetMapping(\"/tickets/sla-risk\")\n    public ResponseEntity<List<TicketSummaryDto>> getSlaRiskTeamTickets() {\n        String username = SecurityContextHolder.getContext().getAuthentication().getName();\n        return ResponseEntity.ok(teamLeadService.getSlaRiskTeamTickets(username));\n    }\n\n    @PatchMapping(\"/tickets/{id}/reassign\")\n    public ResponseEntity<TicketDetailDto> reassignTicket(@PathVariable Long id, @Valid @RequestBody ReassignTicketDto dto) {\n        String username = SecurityContextHolder.getContext().getAuthentication().getName();\n        return ResponseEntity.ok(teamLeadService.reassignTicket(id, dto, username));\n    }\n\n    @PatchMapping(\"/team/members\")\n    public ResponseEntity<Team> updateTeamMembers(@RequestBody TeamMemberUpdateRequestDto dto) {\n        String username = SecurityContextHolder.getContext().getAuthentication().getName();\n        return ResponseEntity.ok(teamLeadService.updateTeamMembers(dto, username));\n    }\n}\n","baseTimestamp":1762098364693,"deltas":[{"timestamp":1762112251253,"changes":[{"type":"INSERT","lineNumber":49,"content":""},{"type":"INSERT","lineNumber":50,"content":"    @GetMapping(\"/team/members\")"},{"type":"INSERT","lineNumber":51,"content":"    public ResponseEntity<List<UserSummaryDto>> getTeamMembers() {"},{"type":"INSERT","lineNumber":52,"content":"        String username = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"INSERT","lineNumber":53,"content":"        return ResponseEntity.ok(teamLeadService.getTeamMembers(username));"},{"type":"INSERT","lineNumber":54,"content":"    }"}]},{"timestamp":1762112255308,"changes":[{"type":"DELETE","lineNumber":4,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.ReassignTicketDto;"},{"type":"DELETE","lineNumber":5,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TeamMemberUpdateRequestDto;"},{"type":"DELETE","lineNumber":6,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketDetailDto;"},{"type":"DELETE","lineNumber":7,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;"},{"type":"INSERT","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.dto.*;"},{"type":"DELETE","lineNumber":50,"oldContent":"}"},{"type":"DELETE","lineNumber":52,"oldContent":""},{"type":"DELETE","lineNumber":54,"oldContent":"    }"},{"type":"INSERT","lineNumber":51,"content":"    }"},{"type":"INSERT","lineNumber":52,"content":"}"},{"type":"INSERT","lineNumber":53,"content":""}]},{"timestamp":1762113550884,"changes":[{"type":"INSERT","lineNumber":35,"content":"    @GetMapping(\"/team\")"},{"type":"INSERT","lineNumber":36,"content":"    public ResponseEntity<TeamDetailDto> getTeamDetails() {"},{"type":"INSERT","lineNumber":37,"content":"        String username = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"INSERT","lineNumber":38,"content":"        return ResponseEntity.ok(teamLeadService.getTeamDetails(username));"},{"type":"INSERT","lineNumber":39,"content":"    }"},{"type":"INSERT","lineNumber":40,"content":""},{"type":"INSERT","lineNumber":41,"content":"    // This single endpoint handles creation, renaming, and member updates."},{"type":"INSERT","lineNumber":42,"content":"    @PatchMapping(\"/team\")"},{"type":"INSERT","lineNumber":43,"content":"    public ResponseEntity<TeamDetailDto> createOrUpdateTeam(@RequestBody TeamUpdateRequestDto dto) {"},{"type":"INSERT","lineNumber":44,"content":"        String username = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"INSERT","lineNumber":45,"content":"        return ResponseEntity.ok(teamLeadService.createOrUpdateTeam(dto, username));"},{"type":"INSERT","lineNumber":46,"content":"    }"},{"type":"INSERT","lineNumber":47,"content":""},{"type":"DELETE","lineNumber":47,"oldContent":"    }"},{"type":"DELETE","lineNumber":49,"oldContent":"}"},{"type":"DELETE","lineNumber":50,"oldContent":""},{"type":"INSERT","lineNumber":64,"content":"    }"},{"type":"INSERT","lineNumber":65,"content":"}"},{"type":"INSERT","lineNumber":66,"content":""}]},{"timestamp":1762115125846,"changes":[{"type":"DELETE","lineNumber":36,"oldContent":"    @PatchMapping(\"/tickets/{id}/reassign\")"},{"type":"DELETE","lineNumber":38,"oldContent":"    public ResponseEntity<TicketDetailDto> reassignTicket(@PathVariable Long id, @Valid @RequestBody ReassignTicketDto dto) {"},{"type":"DELETE","lineNumber":40,"oldContent":"        String username = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"DELETE","lineNumber":42,"oldContent":"        return ResponseEntity.ok(teamLeadService.reassignTicket(id, dto, username));"},{"type":"INSERT","lineNumber":40,"content":""},{"type":"INSERT","lineNumber":41,"content":"    // This single endpoint handles creation, renaming, and member updates."},{"type":"INSERT","lineNumber":42,"content":"    @PatchMapping(\"/team/members\")"},{"type":"INSERT","lineNumber":43,"content":"    public ResponseEntity<TeamDetailDto> updateTeamMembers(@RequestBody TeamMemberUpdateRequestDto dto) {"},{"type":"INSERT","lineNumber":44,"content":"        String username = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"INSERT","lineNumber":45,"content":"        return ResponseEntity.ok(teamLeadService.updateTeam(dto, username));"},{"type":"INSERT","lineNumber":48,"content":"    @PatchMapping(\"/tickets/{id}/reassign\")"},{"type":"INSERT","lineNumber":49,"content":"    public ResponseEntity<TicketDetailDto> reassignTicket(@PathVariable Long id, @Valid @RequestBody ReassignTicketDto dto) {"},{"type":"INSERT","lineNumber":50,"content":"        String username = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"INSERT","lineNumber":51,"content":"        return ResponseEntity.ok(teamLeadService.reassignTicket(id, dto, username));"},{"type":"INSERT","lineNumber":52,"content":"    }"},{"type":"DELETE","lineNumber":47,"oldContent":"    // This single endpoint handles creation, renaming, and member updates."},{"type":"DELETE","lineNumber":49,"oldContent":"    @PatchMapping(\"/team\")"},{"type":"DELETE","lineNumber":51,"oldContent":"    public ResponseEntity<TeamDetailDto> createOrUpdateTeam(@RequestBody TeamUpdateRequestDto dto) {"},{"type":"DELETE","lineNumber":53,"oldContent":"        String username = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"DELETE","lineNumber":55,"oldContent":"        return ResponseEntity.ok(teamLeadService.createOrUpdateTeam(dto, username));"},{"type":"DELETE","lineNumber":57,"oldContent":"    }"},{"type":"DELETE","lineNumber":59,"oldContent":""},{"type":"DELETE","lineNumber":64,"oldContent":""},{"type":"MODIFY","lineNumber":65,"content":"}","oldContent":"}"},{"type":"INSERT","lineNumber":66,"content":""}]},{"timestamp":1762115149852,"changes":[{"type":"DELETE","lineNumber":38,"oldContent":""},{"type":"DELETE","lineNumber":39,"oldContent":"    // This single endpoint handles creation, renaming, and member updates."},{"type":"DELETE","lineNumber":41,"oldContent":"    @PatchMapping(\"/team/members\")"},{"type":"DELETE","lineNumber":42,"oldContent":"    public ResponseEntity<TeamDetailDto> updateTeamMembers(@RequestBody TeamMemberUpdateRequestDto dto) {"},{"type":"INSERT","lineNumber":40,"content":""},{"type":"INSERT","lineNumber":41,"content":"    // This single endpoint handles creation, renaming, and member updates."},{"type":"INSERT","lineNumber":42,"content":"    @PatchMapping(\"/team\")"},{"type":"INSERT","lineNumber":43,"content":"    public ResponseEntity<TeamDetailDto> createOrUpdateTeam(@RequestBody TeamUpdateRequestDto dto) {"},{"type":"INSERT","lineNumber":45,"content":"        return ResponseEntity.ok(teamLeadService.createOrUpdateTeam(dto, username));"},{"type":"DELETE","lineNumber":46,"oldContent":"        return ResponseEntity.ok(teamLeadService.updateTeam(dto, username));"},{"type":"DELETE","lineNumber":48,"oldContent":""},{"type":"DELETE","lineNumber":50,"oldContent":"    @PatchMapping(\"/team/members\")"},{"type":"MODIFY","lineNumber":53,"content":"","oldContent":"    public ResponseEntity<Team> updateTeamMembers(@RequestBody TeamMemberUpdateRequestDto dto) {"},{"type":"INSERT","lineNumber":54,"content":"    @PatchMapping(\"/team/members\")"},{"type":"INSERT","lineNumber":55,"content":"    public ResponseEntity<Team> updateTeamMembers(@RequestBody TeamMemberUpdateRequestDto dto) {"},{"type":"INSERT","lineNumber":64,"content":"    }"},{"type":"DELETE","lineNumber":66,"oldContent":"    }"}]},{"timestamp":1762115184866,"changes":[{"type":"DELETE","lineNumber":38,"oldContent":""},{"type":"DELETE","lineNumber":40,"oldContent":"    // This single endpoint handles creation, renaming, and member updates."},{"type":"DELETE","lineNumber":41,"oldContent":"    @PatchMapping(\"/team\")"},{"type":"DELETE","lineNumber":42,"oldContent":"    public ResponseEntity<TeamDetailDto> createOrUpdateTeam(@RequestBody TeamUpdateRequestDto dto) {"},{"type":"INSERT","lineNumber":40,"content":""},{"type":"INSERT","lineNumber":41,"content":"    // This single endpoint handles creation, renaming, and member updates."},{"type":"INSERT","lineNumber":42,"content":"    @PatchMapping(\"/team/members\")"},{"type":"INSERT","lineNumber":43,"content":"    public ResponseEntity<TeamDetailDto> updateTeamMembers(@RequestBody TeamMemberUpdateRequestDto dto) {"},{"type":"MODIFY","lineNumber":45,"content":"        return ResponseEntity.ok(teamLeadService.updateTeam(dto, username));","oldContent":"        return ResponseEntity.ok(teamLeadService.createOrUpdateTeam(dto, username));"},{"type":"INSERT","lineNumber":51,"content":"        return ResponseEntity.ok(teamLeadService.reassignTicket(id, dto, username));"},{"type":"INSERT","lineNumber":52,"content":"    }"},{"type":"DELETE","lineNumber":53,"oldContent":"        return ResponseEntity.ok(teamLeadService.reassignTicket(id, dto, username));"},{"type":"DELETE","lineNumber":55,"oldContent":"    }"}]},{"timestamp":1762115194060,"changes":[{"type":"INSERT","lineNumber":39,"content":"    }"},{"type":"DELETE","lineNumber":43,"oldContent":"    }"},{"type":"DELETE","lineNumber":52,"oldContent":""},{"type":"DELETE","lineNumber":54,"oldContent":"    @PatchMapping(\"/team/members\")"},{"type":"DELETE","lineNumber":55,"oldContent":"    public ResponseEntity<Team> updateTeamMembers(@RequestBody TeamMemberUpdateRequestDto dto) {"},{"type":"DELETE","lineNumber":56,"oldContent":"        String username = SecurityContextHolder.getContext().getAuthentication().getName();"},{"type":"DELETE","lineNumber":57,"oldContent":"        return ResponseEntity.ok(teamLeadService.updateTeamMembers(dto, username));"},{"type":"DELETE","lineNumber":58,"oldContent":"    }"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/Coordinates.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/Coordinates.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\n\n\nimport java.math.BigDecimal;\n\n// A simple, immutable record to hold coordinate data.\npublic record Coordinates(BigDecimal latitude, BigDecimal longitude) {}","baseTimestamp":1762099029904,"deltas":[{"timestamp":1762099033566,"changes":[{"type":"DELETE","lineNumber":6,"oldContent":"// A simple, immutable record to hold coordinate data."}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/GeocodingService.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/GeocodingService.java","baseContent":"package com.capstone.tele_ticketing_backend_1.service;\n\n\nimport org.springframework.stereotype.Service;\nimport java.math.BigDecimal;\n\n@Service\npublic class GeocodingService {\n\n    /**\n     * Converts address components into geographic coordinates.\n     * Dr. X's Note: This is a placeholder. In a real production system, this method\n     * would make an HTTP call to an external geocoding API (like Google Maps, OpenCage, etc.)\n     * to get real coordinates. For our development, we will return a default value for Chennai.\n     * @return Coordinates object or null if not found.\n     */\n    public Coordinates getCoordinates(String city, String state, String postalCode) {\n        // Mock implementation for development\n        if (\"Chennai\".equalsIgnoreCase(city)) {\n            return new Coordinates(new BigDecimal(\"13.0827\"), new BigDecimal(\"80.2707\"));\n        }\n        // In a real system, you would handle cases where the address can't be found.\n        return null;\n    }\n}\n","baseTimestamp":1762099053066,"deltas":[{"timestamp":1762099085175,"changes":[{"type":"MODIFY","lineNumber":16,"content":"    public Coordinate getCoordinates(String city, String state, String postalCode) {","oldContent":"    public Coordinates getCoordinates(String city, String state, String postalCode) {"}]},{"timestamp":1762099091127,"changes":[{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.dto.Coordinates;"}]},{"timestamp":1762099093214,"changes":[{"type":"MODIFY","lineNumber":17,"content":"    public Coordinates getCoordinates(String city, String state, String postalCode) {","oldContent":"    public Coordinate getCoordinates(String city, String state, String postalCode) {"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/payload/request/SignupRequest.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/security/payload/request/SignupRequest.java","baseContent":"package com.capstone.tele_ticketing_backend_1.security.payload.request;\n\n\nimport jakarta.validation.constraints.NotBlank;\nimport jakarta.validation.constraints.Size;\nimport lombok.Data;\nimport java.util.Set;\n\n@Data\npublic class SignupRequest {\n\t@NotBlank\n\t@Size(min = 3, max = 20)\n\tprivate String username;\n\n\t@NotBlank\n\tprivate String fullname;\n\n\tprivate Set<String> role;\n\n\t@NotBlank\n\t@Size(min = 6, max = 40)\n\tprivate String password;\n\n\t// Dr. X's Addition: New location fields. These can be optional for non-customer roles.\n\tprivate String city;\n\tprivate String state;\n\tprivate String postalCode;\n}}","baseTimestamp":1762099119021,"deltas":[{"timestamp":1762099122528,"changes":[{"type":"MODIFY","lineNumber":27,"content":"}","oldContent":"}}"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/TeamDetailDto.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/TeamDetailDto.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\n\n\nimport lombok.Data;\nimport java.util.List;\n\n@Data\npublic class TeamDetailDto {\n    private Long id;\n    private String name;\n    private List<UserSummaryDto> members;\n}\n","baseTimestamp":1762113109344},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/TeamUpdateRequestDto.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/TeamUpdateRequestDto.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\n\n\nimport lombok.Data;\nimport java.util.Set;\n\n@Data\npublic class TeamUpdateRequestDto {\n    private String name;\n    private Set<Long> userIdsToAdd;\n    private Set<Long> userIdsToRemove;\n}\n","baseTimestamp":1762113128886,"deltas":[{"timestamp":1762114956563,"changes":[{"type":"DELETE","lineNumber":9,"oldContent":"    private String name;"},{"type":"DELETE","lineNumber":13,"oldContent":""}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/exceptions/ResourceNotFoundException.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/exceptions/ResourceNotFoundException.java","baseContent":"package com.capstone.tele_ticketing_backend_1.exceptions;\n\npublic class ResourceNotFoundException extends RuntimeException {\n    public ResourceNotFoundException(String message) {\n        super(message);\n    }\n}\n","baseTimestamp":1762113223562,"deltas":[{"timestamp":1762113302531,"changes":[{"type":"INSERT","lineNumber":2,"content":""},{"type":"INSERT","lineNumber":3,"content":"@ResponseStatus(HttpStatus.NOT_FOUND)"}]},{"timestamp":1762113310564,"changes":[{"type":"MODIFY","lineNumber":3,"content":"import org.springframework.http.HttpStatus;","oldContent":"public class ResourceNotFoundException extends RuntimeException {"},{"type":"INSERT","lineNumber":4,"content":"import org.springframework.web.bind.annotation.ResponseStatus;"},{"type":"INSERT","lineNumber":5,"content":""},{"type":"INSERT","lineNumber":7,"content":"public class ResourceNotFoundException extends RuntimeException {"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/TicketFilterDto.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/TicketFilterDto.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\n\nimport com.capstone.tele_ticketing_backend_1.entities.TicketStatus;\nimport lombok.Data;\nimport java.util.List;\n\n@Data\npublic class TicketFilterDto {\n    private List<TicketStatus> statuses;\n    private Long teamId;\n    private String city;\n    private boolean isSlaAtRisk; // true if filtering for tickets at risk\n    private boolean isSlaBreached; // true if filtering for breached tickets\n}","baseTimestamp":1762146988253},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/ManagerService.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/ManagerService.java","baseContent":"package com.capstone.tele_ticketing_backend_1.service;\n\n\nimport com.capstone.tele_ticketing_backend_1.dto.TicketFilterDto;\nimport com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;\nimport com.capstone.tele_ticketing_backend_1.entities.Ticket;\nimport com.capstone.tele_ticketing_backend_1.repo.TicketRepo;\nimport com.capstone.tele_ticketing_backend_1.service.TicketSpecification;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.data.jpa.domain.Specification;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n@Service\npublic class ManagerService {\n\n    @Autowired\n    private TicketRepo ticketRepo;\n\n    @Transactional(readOnly = true)\n    public List<TicketSummaryDto> findTicketsByCriteria(TicketFilterDto filters) {\n        // Start with a base specification that matches everything.\n        Specification<Ticket> spec = Specification.where(null);\n\n        // Chain specifications based on the provided filters.\n        if (filters.getStatuses() != null && !filters.getStatuses().isEmpty()) {\n            spec = spec.and(TicketSpecification.hasStatusIn(filters.getStatuses()));\n        }\n        if (filters.getTeamId() != null) {\n            spec = spec.and(TicketSpecification.inTeam(filters.getTeamId()));\n        }\n        if (filters.getCity() != null) {\n            spec = spec.and(TicketSpecification.inCity(filters.getCity()));\n        }\n        if (filters.isSlaAtRisk()) {\n            spec = spec.and(TicketSpecification.isAtSlaRisk());\n        }\n        if (filters.isSlaBreached()) {\n            spec = spec.and(TicketSpecification.isSlaBreached());\n        }\n\n        List<Ticket> tickets = ticketRepo.findAll(spec);\n\n        return tickets.stream()\n                .map(ticket -> new TicketSummaryDto(\n                        ticket.getId(), ticket.getTicketUid(), ticket.getTitle(),\n                        ticket.getStatus(), ticket.getCreatedAt()))\n                .collect(Collectors.toList());\n    }\n}\n","baseTimestamp":1762147148207,"deltas":[{"timestamp":1762147502791,"changes":[{"type":"DELETE","lineNumber":23,"oldContent":"        // Start with a base specification that matches everything."},{"type":"DELETE","lineNumber":24,"oldContent":"        Specification<Ticket> spec = Specification.where(null);"},{"type":"INSERT","lineNumber":23,"content":"        // Dr. X's Fix: This is the non-deprecated way to start a dynamic query."},{"type":"INSERT","lineNumber":24,"content":"        Specification<Ticket> spec = (root, query, criteriaBuilder) -> criteriaBuilder.conjunction();"},{"type":"MODIFY","lineNumber":26,"content":"        // The rest of the logic remains unchanged.","oldContent":"        // Chain specifications based on the provided filters."},{"type":"DELETE","lineNumber":52,"oldContent":""}]},{"timestamp":1762147506916,"changes":[{"type":"DELETE","lineNumber":7,"oldContent":"import com.capstone.tele_ticketing_backend_1.service.TicketSpecification;"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/TicketSpecification.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/TicketSpecification.java","baseContent":"package com.capstone.tele_ticketing_backend_1.service;\n\nimport com.capstone.tele_ticketing_backend_1.entities.Ticket;\nimport com.capstone.tele_ticketing_backend_1.entities.TicketStatus;\nimport org.springframework.data.jpa.domain.Specification;\nimport java.time.LocalDateTime;\nimport java.util.List;\n\npublic class TicketSpecification {\n\n    public static Specification<Ticket> hasStatusIn(List<TicketStatus> statuses) {\n        return (root, query, criteriaBuilder) -> {\n            if (statuses == null || statuses.isEmpty()) {\n                return criteriaBuilder.conjunction(); // No filter if list is empty\n            }\n            return root.get(\"status\").in(statuses);\n        };\n    }\n\n    public static Specification<Ticket> inTeam(Long teamId) {\n        return (root, query, criteriaBuilder) -> {\n            if (teamId == null) {\n                return criteriaBuilder.conjunction();\n            }\n            // Joins Ticket -> assignedTo (users) -> team\n            return criteriaBuilder.equal(root.join(\"assignedTo\").get(\"team\").get(\"id\"), teamId);\n        };\n    }\n\n    public static Specification<Ticket> inCity(String city) {\n        return (root, query, criteriaBuilder) -> {\n            if (city == null || city.isBlank()) {\n                return criteriaBuilder.conjunction();\n            }\n            // Joins Ticket -> createdFor (user) -> city\n            return criteriaBuilder.equal(root.join(\"createdFor\").get(\"city\"), city);\n        };\n    }\n\n    public static Specification<Ticket> isAtSlaRisk() {\n        LocalDateTime now = LocalDateTime.now();\n        LocalDateTime twoHoursFromNow = now.plusHours(2);\n        return (root, query, criteriaBuilder) -> criteriaBuilder.between(root.get(\"slaBreachAt\"), now, twoHoursFromNow);\n    }\n\n    public static Specification<Ticket> isSlaBreached() {\n        return (root, query, criteriaBuilder) -> criteriaBuilder.lessThan(root.get(\"slaBreachAt\"), LocalDateTime.now());\n    }\n}\n","baseTimestamp":1762147170751,"deltas":[{"timestamp":1762147173155,"changes":[{"type":"INSERT","lineNumber":2,"content":""}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/ManagerController.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/ManagerController.java","baseContent":"package com.capstone.tele_ticketing_backend_1.controller;\n\n\nimport com.capstone.tele_ticketing_backend_1.dto.TicketFilterDto;\nimport com.capstone.tele_ticketing_backend_1.dto.TicketSummaryDto;\nimport com.capstone.tele_ticketing_backend_1.entities.TicketStatus;\nimport com.capstone.tele_ticketing_backend_1.service.ManagerService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.security.access.prepost.PreAuthorize;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.util.List;\n\n@RestController\n@RequestMapping(\"/api/v1/manager\")\n@PreAuthorize(\"hasRole('MANAGER')\")\npublic class ManagerController {\n\n    @Autowired\n    private ManagerService managerService;\n\n    @GetMapping(\"/tickets\")\n    public ResponseEntity<List<TicketSummaryDto>> getAllTickets(\n            @RequestParam(required = false) List<TicketStatus> statuses,\n            @RequestParam(required = false) Long teamId,\n            @RequestParam(required = false) String city,\n            @RequestParam(required = false) Boolean slaAtRisk,\n            @RequestParam(required = false) Boolean slaBreached\n    ) {\n        TicketFilterDto filters = new TicketFilterDto();\n        filters.setStatuses(statuses);\n        filters.setTeamId(teamId);\n        filters.setCity(city);\n        filters.setSlaAtRisk(slaAtRisk != null && slaAtRisk);\n        filters.setSlaBreached(slaBreached != null && slaBreached);\n\n        List<TicketSummaryDto> tickets = managerService.findTicketsByCriteria(filters);\n        return ResponseEntity.ok(tickets);\n    }\n}","baseTimestamp":1762147323373},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/TeamService.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/service/TeamService.java","baseContent":"package com.capstone.tele_ticketing_backend_1.service;\n\n\nimport com.capstone.tele_ticketing_backend_1.dto.UserSummaryDto;\nimport com.capstone.tele_ticketing_backend_1.entities.Team;\nimport com.capstone.tele_ticketing_backend_1.repo.TeamRepo;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n@Service\npublic class TeamService {\n\n    @Autowired\n    private TeamRepo teamRepo;\n\n    @Transactional(readOnly = true)\n    public List<Team> getAllTeams() {\n        return teamRepo.findAll();\n    }\n}","baseTimestamp":1762148405480,"deltas":[{"timestamp":1762148410325,"changes":[{"type":"DELETE","lineNumber":3,"oldContent":"import com.capstone.tele_ticketing_backend_1.dto.UserSummaryDto;"}]},{"timestamp":1762160119456,"changes":[{"type":"INSERT","lineNumber":3,"content":"import com.capstone.tele_ticketing_backend_1.dto.TeamSummaryDto;"},{"type":"INSERT","lineNumber":4,"content":"import com.capstone.tele_ticketing_backend_1.dto.UserSummaryDto;"},{"type":"DELETE","lineNumber":8,"oldContent":""},{"type":"DELETE","lineNumber":19,"oldContent":"    public List<Team> getAllTeams() {"},{"type":"MODIFY","lineNumber":20,"content":"    // Dr. X's Fix: Change the return type to a list of DTOs.","oldContent":"        return teamRepo.findAll();"},{"type":"INSERT","lineNumber":21,"content":"    public List<TeamSummaryDto> getAllTeams() {"},{"type":"INSERT","lineNumber":22,"content":"        return teamRepo.findAll().stream()"},{"type":"INSERT","lineNumber":23,"content":"                .map(this::mapTeamToSummaryDto)"},{"type":"INSERT","lineNumber":24,"content":"                .collect(Collectors.toList());"},{"type":"DELETE","lineNumber":22,"oldContent":"}"},{"type":"INSERT","lineNumber":26,"content":""},{"type":"INSERT","lineNumber":27,"content":"    // Dr. X's Fix: Create a helper method to perform the mapping."},{"type":"INSERT","lineNumber":28,"content":"    private TeamSummaryDto mapTeamToSummaryDto(Team team) {"},{"type":"INSERT","lineNumber":29,"content":"        TeamSummaryDto dto = new TeamSummaryDto();"},{"type":"INSERT","lineNumber":30,"content":"        dto.setId(team.getId());"},{"type":"INSERT","lineNumber":31,"content":"        dto.setName(team.getName());"},{"type":"INSERT","lineNumber":32,"content":""},{"type":"INSERT","lineNumber":33,"content":"        // This is the crucial part. We access team.getTeamLead() here,"},{"type":"INSERT","lineNumber":34,"content":"        // which forces Hibernate to load the lazy AppUser object while the transaction is still active."},{"type":"INSERT","lineNumber":35,"content":"        if (team.getTeamLead() != null) {"},{"type":"INSERT","lineNumber":36,"content":"            dto.setTeamLead(new UserSummaryDto("},{"type":"INSERT","lineNumber":37,"content":"                    team.getTeamLead().getId(),"},{"type":"INSERT","lineNumber":38,"content":"                    team.getTeamLead().getUsername(),"},{"type":"INSERT","lineNumber":39,"content":"                    team.getTeamLead().getFullName()"},{"type":"INSERT","lineNumber":40,"content":"            ));"},{"type":"INSERT","lineNumber":41,"content":"        }"},{"type":"INSERT","lineNumber":42,"content":"        return dto;"},{"type":"INSERT","lineNumber":43,"content":"    }"},{"type":"INSERT","lineNumber":44,"content":"}}"}]},{"timestamp":1762160127374,"changes":[{"type":"MODIFY","lineNumber":5,"content":"import com.capstone.tele_ticketing_backend_1.entities.Team;","oldContent":"import com.capstone.tele_ticketing_backend_1.entities.Team;"},{"type":"DELETE","lineNumber":22,"oldContent":"    }"},{"type":"DELETE","lineNumber":25,"oldContent":"}}"},{"type":"DELETE","lineNumber":28,"oldContent":"        return dto;"},{"type":"DELETE","lineNumber":30,"oldContent":"        }"},{"type":"DELETE","lineNumber":32,"oldContent":"            ));"},{"type":"DELETE","lineNumber":34,"oldContent":"                    team.getTeamLead().getFullName()"},{"type":"DELETE","lineNumber":36,"oldContent":"                    team.getTeamLead().getUsername(),"},{"type":"DELETE","lineNumber":38,"oldContent":"                    team.getTeamLead().getId(),"},{"type":"DELETE","lineNumber":40,"oldContent":"            dto.setTeamLead(new UserSummaryDto("},{"type":"DELETE","lineNumber":42,"oldContent":"        if (team.getTeamLead() != null) {"},{"type":"INSERT","lineNumber":35,"content":"        if (team.getTeamLead() != null) {"},{"type":"INSERT","lineNumber":36,"content":"            dto.setTeamLead(new UserSummaryDto("},{"type":"INSERT","lineNumber":37,"content":"                    team.getTeamLead().getId(),"},{"type":"INSERT","lineNumber":38,"content":"                    team.getTeamLead().getUsername(),"},{"type":"INSERT","lineNumber":39,"content":"                    team.getTeamLead().getFullName()"},{"type":"INSERT","lineNumber":40,"content":"            ));"},{"type":"INSERT","lineNumber":41,"content":"        }"},{"type":"INSERT","lineNumber":42,"content":"        return dto;"},{"type":"INSERT","lineNumber":43,"content":"    }"},{"type":"INSERT","lineNumber":44,"content":"}"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/TeamController.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/controller/TeamController.java","baseContent":"package com.capstone.tele_ticketing_backend_1.controller;\n\nimport com.capstone.tele_ticketing_backend_1.entities.Team;\nimport com.capstone.tele_ticketing_backend_1.service.TeamService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.security.access.prepost.PreAuthorize;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\nimport java.util.List;\n\n@RestController\n@RequestMapping(\"/api/v1/teams\")\n@PreAuthorize(\"hasRole('MANAGER')\")\npublic class TeamController {\n\n    @Autowired\n    private TeamService teamService;\n\n    @GetMapping\n    public ResponseEntity<List<Team>> getAllTeams() {\n        return ResponseEntity.ok(teamService.getAllTeams());\n    }\n}","baseTimestamp":1762148467380,"deltas":[{"timestamp":1762160149232,"changes":[{"type":"MODIFY","lineNumber":2,"content":"import com.capstone.tele_ticketing_backend_1.dto.TeamSummaryDto; // Import the new DTO","oldContent":"import com.capstone.tele_ticketing_backend_1.entities.Team;"},{"type":"MODIFY","lineNumber":21,"content":"    // Dr. X's Fix: Change the return type to a list of DTOs.","oldContent":"    public ResponseEntity<List<Team>> getAllTeams() {"},{"type":"INSERT","lineNumber":22,"content":"    public ResponseEntity<List<TeamSummaryDto>> getAllTeams() {"}]}]},"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/TeamSummaryDto.java":{"filePath":"D:/tele-ticketing-backend-1/src/main/java/com/capstone/tele_ticketing_backend_1/dto/TeamSummaryDto.java","baseContent":"package com.capstone.tele_ticketing_backend_1.dto;\n\n\nimport lombok.Data;\n\n@Data\npublic class TeamSummaryDto {\n    private Long id;\n    private String name;\n    private UserSummaryDto teamLead; // Reuse our existing DTO\n}\n","baseTimestamp":1762160097780}}}